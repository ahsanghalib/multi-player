/* eslint-disable */
/** multi-players-0.0.20 */
var Dn=Object.create;var pn=Object.defineProperty;var Rn=Object.getOwnPropertyDescriptor;var Ln=Object.getOwnPropertyNames;var On=Object.getPrototypeOf,Un=Object.prototype.hasOwnProperty;var Nn=(t,r,i)=>r in t?pn(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i;var Qa=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(r,i)=>(typeof require<"u"?require:r)[i]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var Mi=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports);var Fn=(t,r,i,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of Ln(r))!Un.call(t,s)&&s!==i&&pn(t,s,{get:()=>r[s],enumerable:!(n=Rn(r,s))||n.enumerable});return t};var wi=(t,r,i)=>(i=t!=null?Dn(On(t)):{},Fn(r||!t||!t.__esModule?pn(i,"default",{value:t,enumerable:!0}):i,t));var yr=(t,r,i)=>(Nn(t,typeof r!="symbol"?r+"":r,i),i);var En=Mi((fn,gn)=>{(function(t,r){typeof fn=="object"&&typeof gn<"u"?gn.exports=r():typeof define=="function"&&define.amd?define(r):(t=typeof globalThis<"u"?globalThis:t||self,t.muxjs=r())})(fn,function(){"use strict";var t=function(){this.init=function(){var g={};this.on=function(_,P){g[_]||(g[_]=[]),g[_]=g[_].concat(P)},this.off=function(_,P){var A;return g[_]?(A=g[_].indexOf(P),g[_]=g[_].slice(),g[_].splice(A,1),A>-1):!1},this.trigger=function(_){var P,A,L,N;if(P=g[_],!!P)if(arguments.length===2)for(L=P.length,A=0;A<L;++A)P[A].call(this,arguments[1]);else{for(N=[],A=arguments.length,A=1;A<arguments.length;++A)N.push(arguments[A]);for(L=P.length,A=0;A<L;++A)P[A].apply(this,N)}},this.dispose=function(){g={}}}};t.prototype.pipe=function(j){return this.on("data",function(g){j.push(g)}),this.on("done",function(g){j.flush(g)}),this.on("partialdone",function(g){j.partialFlush(g)}),this.on("endedtimeline",function(g){j.endTimeline(g)}),this.on("reset",function(g){j.reset(g)}),j},t.prototype.push=function(j){this.trigger("data",j)},t.prototype.flush=function(j){this.trigger("done",j)},t.prototype.partialFlush=function(j){this.trigger("partialdone",j)},t.prototype.endTimeline=function(j){this.trigger("endedtimeline",j)},t.prototype.reset=function(j){this.trigger("reset",j)};var r=t,i=9e4,n,s,o,l,u,m,E;n=function(g){return g*i},s=function(g,_){return g*_},o=function(g){return g/i},l=function(g,_){return g/_},u=function(g,_){return n(l(g,_))},m=function(g,_){return s(o(g),_)},E=function(g,_,P){return o(P?g:g-_)};var y={ONE_SECOND_IN_TS:i,secondsToVideoTs:n,secondsToAudioTs:s,videoTsToSeconds:o,audioTsToSeconds:l,audioTsToVideoTs:u,videoTsToAudioTs:m,metadataTsToSeconds:E},D=y.ONE_SECOND_IN_TS,w,B=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];w=function(g){var _,P=0;w.prototype.init.call(this),this.skipWarn_=function(A,L){this.trigger("log",{level:"warn",message:"adts skiping bytes "+A+" to "+L+" in frame "+P+" outside syncword"})},this.push=function(A){var L=0,N,Y,ne,ce,se;if(g||(P=0),A.type==="audio"){_&&_.length?(ne=_,_=new Uint8Array(ne.byteLength+A.data.byteLength),_.set(ne),_.set(A.data,ne.byteLength)):_=A.data;for(var pe;L+7<_.length;){if(_[L]!==255||(_[L+1]&246)!==240){typeof pe!="number"&&(pe=L),L++;continue}if(typeof pe=="number"&&(this.skipWarn_(pe,L),pe=null),Y=(~_[L+1]&1)*2,N=(_[L+3]&3)<<11|_[L+4]<<3|(_[L+5]&224)>>5,ce=((_[L+6]&3)+1)*1024,se=ce*D/B[(_[L+2]&60)>>>2],_.byteLength-L<N)break;this.trigger("data",{pts:A.pts+P*se,dts:A.dts+P*se,sampleCount:ce,audioobjecttype:(_[L+2]>>>6&3)+1,channelcount:(_[L+2]&1)<<2|(_[L+3]&192)>>>6,samplerate:B[(_[L+2]&60)>>>2],samplingfrequencyindex:(_[L+2]&60)>>>2,samplesize:16,data:_.subarray(L+7+Y,L+N)}),P++,L+=N}typeof pe=="number"&&(this.skipWarn_(pe,L),pe=null),_=_.subarray(L)}},this.flush=function(){P=0,this.trigger("done")},this.reset=function(){_=void 0,this.trigger("reset")},this.endTimeline=function(){_=void 0,this.trigger("endedtimeline")}},w.prototype=new r;var F=w,V;V=function(g){var _=g.byteLength,P=0,A=0;this.length=function(){return 8*_},this.bitsAvailable=function(){return 8*_+A},this.loadWord=function(){var L=g.byteLength-_,N=new Uint8Array(4),Y=Math.min(4,_);if(Y===0)throw new Error("no bytes available");N.set(g.subarray(L,L+Y)),P=new DataView(N.buffer).getUint32(0),A=Y*8,_-=Y},this.skipBits=function(L){var N;A>L?(P<<=L,A-=L):(L-=A,N=Math.floor(L/8),L-=N*8,_-=N,this.loadWord(),P<<=L,A-=L)},this.readBits=function(L){var N=Math.min(A,L),Y=P>>>32-N;return A-=N,A>0?P<<=N:_>0&&this.loadWord(),N=L-N,N>0?Y<<N|this.readBits(N):Y},this.skipLeadingZeros=function(){var L;for(L=0;L<A;++L)if(P&2147483648>>>L)return P<<=L,A-=L,L;return this.loadWord(),L+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var L=this.skipLeadingZeros();return this.readBits(L+1)-1},this.readExpGolomb=function(){var L=this.readUnsignedExpGolomb();return 1&L?1+L>>>1:-1*(L>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var K=V,q,re,ee;re=function(){var g=0,_,P;re.prototype.init.call(this),this.push=function(A){var L;P?(L=new Uint8Array(P.byteLength+A.data.byteLength),L.set(P),L.set(A.data,P.byteLength),P=L):P=A.data;for(var N=P.byteLength;g<N-3;g++)if(P[g+2]===1){_=g+5;break}for(;_<N;)switch(P[_]){case 0:if(P[_-1]!==0){_+=2;break}else if(P[_-2]!==0){_++;break}g+3!==_-2&&this.trigger("data",P.subarray(g+3,_-2));do _++;while(P[_]!==1&&_<N);g=_-2,_+=3;break;case 1:if(P[_-1]!==0||P[_-2]!==0){_+=3;break}this.trigger("data",P.subarray(g+3,_-2)),g=_-2,_+=3;break;default:_+=3;break}P=P.subarray(g),_-=g,g=0},this.reset=function(){P=null,g=0,this.trigger("reset")},this.flush=function(){P&&P.byteLength>3&&this.trigger("data",P.subarray(g+3)),P=null,g=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},re.prototype=new r,ee={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},q=function(){var g=new re,_,P,A,L,N,Y,ne;q.prototype.init.call(this),_=this,this.push=function(ce){ce.type==="video"&&(P=ce.trackId,A=ce.pts,L=ce.dts,g.push(ce))},g.on("data",function(ce){var se={trackId:P,pts:A,dts:L,data:ce,nalUnitTypeCode:ce[0]&31};switch(se.nalUnitTypeCode){case 5:se.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:se.nalUnitType="sei_rbsp",se.escapedRBSP=N(ce.subarray(1));break;case 7:se.nalUnitType="seq_parameter_set_rbsp",se.escapedRBSP=N(ce.subarray(1)),se.config=Y(se.escapedRBSP);break;case 8:se.nalUnitType="pic_parameter_set_rbsp";break;case 9:se.nalUnitType="access_unit_delimiter_rbsp";break}_.trigger("data",se)}),g.on("done",function(){_.trigger("done")}),g.on("partialdone",function(){_.trigger("partialdone")}),g.on("reset",function(){_.trigger("reset")}),g.on("endedtimeline",function(){_.trigger("endedtimeline")}),this.flush=function(){g.flush()},this.partialFlush=function(){g.partialFlush()},this.reset=function(){g.reset()},this.endTimeline=function(){g.endTimeline()},ne=function(se,pe){var Me=8,qe=8,Qe,We;for(Qe=0;Qe<se;Qe++)qe!==0&&(We=pe.readExpGolomb(),qe=(Me+We+256)%256),Me=qe===0?Me:qe},N=function(se){for(var pe=se.byteLength,Me=[],qe=1,Qe,We;qe<pe-2;)se[qe]===0&&se[qe+1]===0&&se[qe+2]===3?(Me.push(qe+2),qe+=2):qe++;if(Me.length===0)return se;Qe=pe-Me.length,We=new Uint8Array(Qe);var dt=0;for(qe=0;qe<Qe;dt++,qe++)dt===Me[0]&&(dt++,Me.shift()),We[qe]=se[dt];return We},Y=function(se){var pe=0,Me=0,qe=0,Qe=0,We,dt,Rt,Bt,xr,Or,qr,zr,Ur,Xr,_n,Xt=[1,1],kn,sa;if(We=new K(se),dt=We.readUnsignedByte(),Bt=We.readUnsignedByte(),Rt=We.readUnsignedByte(),We.skipUnsignedExpGolomb(),ee[dt]&&(xr=We.readUnsignedExpGolomb(),xr===3&&We.skipBits(1),We.skipUnsignedExpGolomb(),We.skipUnsignedExpGolomb(),We.skipBits(1),We.readBoolean()))for(_n=xr!==3?8:12,sa=0;sa<_n;sa++)We.readBoolean()&&(sa<6?ne(16,We):ne(64,We));if(We.skipUnsignedExpGolomb(),Or=We.readUnsignedExpGolomb(),Or===0)We.readUnsignedExpGolomb();else if(Or===1)for(We.skipBits(1),We.skipExpGolomb(),We.skipExpGolomb(),qr=We.readUnsignedExpGolomb(),sa=0;sa<qr;sa++)We.skipExpGolomb();if(We.skipUnsignedExpGolomb(),We.skipBits(1),zr=We.readUnsignedExpGolomb(),Ur=We.readUnsignedExpGolomb(),Xr=We.readBits(1),Xr===0&&We.skipBits(1),We.skipBits(1),We.readBoolean()&&(pe=We.readUnsignedExpGolomb(),Me=We.readUnsignedExpGolomb(),qe=We.readUnsignedExpGolomb(),Qe=We.readUnsignedExpGolomb()),We.readBoolean()&&We.readBoolean()){switch(kn=We.readUnsignedByte(),kn){case 1:Xt=[1,1];break;case 2:Xt=[12,11];break;case 3:Xt=[10,11];break;case 4:Xt=[16,11];break;case 5:Xt=[40,33];break;case 6:Xt=[24,11];break;case 7:Xt=[20,11];break;case 8:Xt=[32,11];break;case 9:Xt=[80,33];break;case 10:Xt=[18,11];break;case 11:Xt=[15,11];break;case 12:Xt=[64,33];break;case 13:Xt=[160,99];break;case 14:Xt=[4,3];break;case 15:Xt=[3,2];break;case 16:Xt=[2,1];break;case 255:{Xt=[We.readUnsignedByte()<<8|We.readUnsignedByte(),We.readUnsignedByte()<<8|We.readUnsignedByte()];break}}Xt&&Xt[0]/Xt[1]}return{profileIdc:dt,levelIdc:Rt,profileCompatibility:Bt,width:(zr+1)*16-pe*2-Me*2,height:(2-Xr)*(Ur+1)*16-qe*2-Qe*2,sarRatio:Xt}}},q.prototype=new r;var H={H264Stream:q,NalByteStream:re},te={Adts:F,h264:H},W=Math.pow(2,32)-1,z,X,Q,$,oe,ae,_e,ve,Pe,fe,xe,Ce,De,ke,Xe,et,tt,nt,Be,Fe,J,ue,de,Oe,Ue,Ke,at,ut,st,ct,yt,Ct,vt,ft,Ut,Nt;(function(){var j;if(de={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(j in de)de.hasOwnProperty(j)&&(de[j]=[j.charCodeAt(0),j.charCodeAt(1),j.charCodeAt(2),j.charCodeAt(3)]);Oe=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),Ke=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),Ue=new Uint8Array([0,0,0,1]),at=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),ut=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),st={video:at,audio:ut},Ct=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),yt=new Uint8Array([0,0,0,0,0,0,0,0]),vt=new Uint8Array([0,0,0,0,0,0,0,0]),ft=vt,Ut=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Nt=vt,ct=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),z=function(g){var _=[],P=0,A,L,N;for(A=1;A<arguments.length;A++)_.push(arguments[A]);for(A=_.length;A--;)P+=_[A].byteLength;for(L=new Uint8Array(P+8),N=new DataView(L.buffer,L.byteOffset,L.byteLength),N.setUint32(0,L.byteLength),L.set(g,4),A=0,P=8;A<_.length;A++)L.set(_[A],P),P+=_[A].byteLength;return L},X=function(){return z(de.dinf,z(de.dref,Ct))},Q=function(g){return z(de.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,g.audioobjecttype<<3|g.samplingfrequencyindex>>>1,g.samplingfrequencyindex<<7|g.channelcount<<3,6,1,2]))},$=function(){return z(de.ftyp,Oe,Ue,Oe,Ke)},et=function(g){return z(de.hdlr,st[g])},oe=function(g){return z(de.mdat,g)},Xe=function(g){var _=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,g.duration>>>24&255,g.duration>>>16&255,g.duration>>>8&255,g.duration&255,85,196,0,0]);return g.samplerate&&(_[12]=g.samplerate>>>24&255,_[13]=g.samplerate>>>16&255,_[14]=g.samplerate>>>8&255,_[15]=g.samplerate&255),z(de.mdhd,_)},ke=function(g){return z(de.mdia,Xe(g),et(g.type),_e(g))},ae=function(g){return z(de.mfhd,new Uint8Array([0,0,0,0,(g&4278190080)>>24,(g&16711680)>>16,(g&65280)>>8,g&255]))},_e=function(g){return z(de.minf,g.type==="video"?z(de.vmhd,ct):z(de.smhd,yt),X(),nt(g))},ve=function(g,_){for(var P=[],A=_.length;A--;)P[A]=Fe(_[A]);return z.apply(null,[de.moof,ae(g)].concat(P))},Pe=function(g){for(var _=g.length,P=[];_--;)P[_]=Ce(g[_]);return z.apply(null,[de.moov,xe(4294967295)].concat(P).concat(fe(g)))},fe=function(g){for(var _=g.length,P=[];_--;)P[_]=J(g[_]);return z.apply(null,[de.mvex].concat(P))},xe=function(g){var _=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(g&4278190080)>>24,(g&16711680)>>16,(g&65280)>>8,g&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return z(de.mvhd,_)},tt=function(g){var _=g.samples||[],P=new Uint8Array(4+_.length),A,L;for(L=0;L<_.length;L++)A=_[L].flags,P[L+4]=A.dependsOn<<4|A.isDependedOn<<2|A.hasRedundancy;return z(de.sdtp,P)},nt=function(g){return z(de.stbl,Be(g),z(de.stts,Nt),z(de.stsc,ft),z(de.stsz,Ut),z(de.stco,vt))},function(){var j,g;Be=function(P){return z(de.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),P.type==="video"?j(P):g(P))},j=function(P){var A=P.sps||[],L=P.pps||[],N=[],Y=[],ne,ce;for(ne=0;ne<A.length;ne++)N.push((A[ne].byteLength&65280)>>>8),N.push(A[ne].byteLength&255),N=N.concat(Array.prototype.slice.call(A[ne]));for(ne=0;ne<L.length;ne++)Y.push((L[ne].byteLength&65280)>>>8),Y.push(L[ne].byteLength&255),Y=Y.concat(Array.prototype.slice.call(L[ne]));if(ce=[de.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(P.width&65280)>>8,P.width&255,(P.height&65280)>>8,P.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),z(de.avcC,new Uint8Array([1,P.profileIdc,P.profileCompatibility,P.levelIdc,255].concat([A.length],N,[L.length],Y))),z(de.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],P.sarRatio){var se=P.sarRatio[0],pe=P.sarRatio[1];ce.push(z(de.pasp,new Uint8Array([(se&4278190080)>>24,(se&16711680)>>16,(se&65280)>>8,se&255,(pe&4278190080)>>24,(pe&16711680)>>16,(pe&65280)>>8,pe&255])))}return z.apply(null,ce)},g=function(P){return z(de.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(P.channelcount&65280)>>8,P.channelcount&255,(P.samplesize&65280)>>8,P.samplesize&255,0,0,0,0,(P.samplerate&65280)>>8,P.samplerate&255,0,0]),Q(P))}}(),De=function(g){var _=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(g.id&4278190080)>>24,(g.id&16711680)>>16,(g.id&65280)>>8,g.id&255,0,0,0,0,(g.duration&4278190080)>>24,(g.duration&16711680)>>16,(g.duration&65280)>>8,g.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(g.width&65280)>>8,g.width&255,0,0,(g.height&65280)>>8,g.height&255,0,0]);return z(de.tkhd,_)},Fe=function(g){var _,P,A,L,N,Y,ne;return _=z(de.tfhd,new Uint8Array([0,0,0,58,(g.id&4278190080)>>24,(g.id&16711680)>>16,(g.id&65280)>>8,g.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),Y=Math.floor(g.baseMediaDecodeTime/(W+1)),ne=Math.floor(g.baseMediaDecodeTime%(W+1)),P=z(de.tfdt,new Uint8Array([1,0,0,0,Y>>>24&255,Y>>>16&255,Y>>>8&255,Y&255,ne>>>24&255,ne>>>16&255,ne>>>8&255,ne&255])),N=32+20+8+16+8+8,g.type==="audio"?(A=ue(g,N),z(de.traf,_,P,A)):(L=tt(g),A=ue(g,L.length+N),z(de.traf,_,P,A,L))},Ce=function(g){return g.duration=g.duration||4294967295,z(de.trak,De(g),ke(g))},J=function(g){var _=new Uint8Array([0,0,0,0,(g.id&4278190080)>>24,(g.id&16711680)>>16,(g.id&65280)>>8,g.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return g.type!=="video"&&(_[_.length-1]=0),z(de.trex,_)},function(){var j,g,_;_=function(A,L){var N=0,Y=0,ne=0,ce=0;return A.length&&(A[0].duration!==void 0&&(N=1),A[0].size!==void 0&&(Y=2),A[0].flags!==void 0&&(ne=4),A[0].compositionTimeOffset!==void 0&&(ce=8)),[0,0,N|Y|ne|ce,1,(A.length&4278190080)>>>24,(A.length&16711680)>>>16,(A.length&65280)>>>8,A.length&255,(L&4278190080)>>>24,(L&16711680)>>>16,(L&65280)>>>8,L&255]},g=function(A,L){var N,Y,ne,ce,se,pe;for(ce=A.samples||[],L+=8+12+16*ce.length,ne=_(ce,L),Y=new Uint8Array(ne.length+ce.length*16),Y.set(ne),N=ne.length,pe=0;pe<ce.length;pe++)se=ce[pe],Y[N++]=(se.duration&4278190080)>>>24,Y[N++]=(se.duration&16711680)>>>16,Y[N++]=(se.duration&65280)>>>8,Y[N++]=se.duration&255,Y[N++]=(se.size&4278190080)>>>24,Y[N++]=(se.size&16711680)>>>16,Y[N++]=(se.size&65280)>>>8,Y[N++]=se.size&255,Y[N++]=se.flags.isLeading<<2|se.flags.dependsOn,Y[N++]=se.flags.isDependedOn<<6|se.flags.hasRedundancy<<4|se.flags.paddingValue<<1|se.flags.isNonSyncSample,Y[N++]=se.flags.degradationPriority&240<<8,Y[N++]=se.flags.degradationPriority&15,Y[N++]=(se.compositionTimeOffset&4278190080)>>>24,Y[N++]=(se.compositionTimeOffset&16711680)>>>16,Y[N++]=(se.compositionTimeOffset&65280)>>>8,Y[N++]=se.compositionTimeOffset&255;return z(de.trun,Y)},j=function(A,L){var N,Y,ne,ce,se,pe;for(ce=A.samples||[],L+=8+12+8*ce.length,ne=_(ce,L),N=new Uint8Array(ne.length+ce.length*8),N.set(ne),Y=ne.length,pe=0;pe<ce.length;pe++)se=ce[pe],N[Y++]=(se.duration&4278190080)>>>24,N[Y++]=(se.duration&16711680)>>>16,N[Y++]=(se.duration&65280)>>>8,N[Y++]=se.duration&255,N[Y++]=(se.size&4278190080)>>>24,N[Y++]=(se.size&16711680)>>>16,N[Y++]=(se.size&65280)>>>8,N[Y++]=se.size&255;return z(de.trun,N)},ue=function(A,L){return A.type==="audio"?j(A,L):g(A,L)}}();var bt={ftyp:$,mdat:oe,moof:ve,moov:Pe,initSegment:function(g){var _=$(),P=Pe(g),A;return A=new Uint8Array(_.byteLength+P.byteLength),A.set(_),A.set(P,_.byteLength),A}},sr=function(g){return g>>>0},Yt=function(g){return("00"+g.toString(16)).slice(-2)},Qt={toUnsigned:sr,toHexString:Yt},lr=function(g){var _="";return _+=String.fromCharCode(g[0]),_+=String.fromCharCode(g[1]),_+=String.fromCharCode(g[2]),_+=String.fromCharCode(g[3]),_},$t=lr,Ae=Qt.toUnsigned,ye=function j(g,_){var P=[],A,L,N,Y,ne;if(!_.length)return null;for(A=0;A<g.byteLength;)L=Ae(g[A]<<24|g[A+1]<<16|g[A+2]<<8|g[A+3]),N=$t(g.subarray(A+4,A+8)),Y=L>1?A+L:g.byteLength,N===_[0]&&(_.length===1?P.push(g.subarray(A+8,Y)):(ne=j(g.subarray(A+8,Y),_.slice(1)),ne.length&&(P=P.concat(ne)))),A=Y;return P},Z=ye,me=function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={version:g[0],flags:new Uint8Array(g.subarray(1,4)),trackId:_.getUint32(4)},A=P.flags[2]&1,L=P.flags[2]&2,N=P.flags[2]&8,Y=P.flags[2]&16,ne=P.flags[2]&32,ce=P.flags[0]&65536,se=P.flags[0]&131072,pe;return pe=8,A&&(pe+=4,P.baseDataOffset=_.getUint32(12),pe+=4),L&&(P.sampleDescriptionIndex=_.getUint32(pe),pe+=4),N&&(P.defaultSampleDuration=_.getUint32(pe),pe+=4),Y&&(P.defaultSampleSize=_.getUint32(pe),pe+=4),ne&&(P.defaultSampleFlags=_.getUint32(pe)),ce&&(P.durationIsEmpty=!0),!A&&se&&(P.baseDataOffsetIsMoof=!0),P},ge=me,Se=function(g){return{isLeading:(g[0]&12)>>>2,dependsOn:g[0]&3,isDependedOn:(g[1]&192)>>>6,hasRedundancy:(g[1]&48)>>>4,paddingValue:(g[1]&14)>>>1,isNonSyncSample:g[1]&1,degradationPriority:g[2]<<8|g[3]}},be=Se,we=function(g){var _={version:g[0],flags:new Uint8Array(g.subarray(1,4)),samples:[]},P=new DataView(g.buffer,g.byteOffset,g.byteLength),A=_.flags[2]&1,L=_.flags[2]&4,N=_.flags[1]&1,Y=_.flags[1]&2,ne=_.flags[1]&4,ce=_.flags[1]&8,se=P.getUint32(4),pe=8,Me;for(A&&(_.dataOffset=P.getInt32(pe),pe+=4),L&&se&&(Me={flags:be(g.subarray(pe,pe+4))},pe+=4,N&&(Me.duration=P.getUint32(pe),pe+=4),Y&&(Me.size=P.getUint32(pe),pe+=4),ce&&(_.version===1?Me.compositionTimeOffset=P.getInt32(pe):Me.compositionTimeOffset=P.getUint32(pe),pe+=4),_.samples.push(Me),se--);se--;)Me={},N&&(Me.duration=P.getUint32(pe),pe+=4),Y&&(Me.size=P.getUint32(pe),pe+=4),ne&&(Me.flags=be(g.subarray(pe,pe+4)),pe+=4),ce&&(_.version===1?Me.compositionTimeOffset=P.getInt32(pe):Me.compositionTimeOffset=P.getUint32(pe),pe+=4),_.samples.push(Me);return _},$e=we,ze=Qt.toUnsigned,Ge=function(g){var _={version:g[0],flags:new Uint8Array(g.subarray(1,4)),baseMediaDecodeTime:ze(g[4]<<24|g[5]<<16|g[6]<<8|g[7])};return _.version===1&&(_.baseMediaDecodeTime*=Math.pow(2,32),_.baseMediaDecodeTime+=ze(g[8]<<24|g[9]<<16|g[10]<<8|g[11])),_},Ze=Ge,it=Qt.toUnsigned,rt=Qt.toHexString,ot,gt,St,lt,At,Ht;ot=function(g){var _={},P=Z(g,["moov","trak"]);return P.reduce(function(A,L){var N,Y,ne,ce,se;return N=Z(L,["tkhd"])[0],!N||(Y=N[0],ne=Y===0?12:20,ce=it(N[ne]<<24|N[ne+1]<<16|N[ne+2]<<8|N[ne+3]),se=Z(L,["mdia","mdhd"])[0],!se)?null:(Y=se[0],ne=Y===0?12:20,A[ce]=it(se[ne]<<24|se[ne+1]<<16|se[ne+2]<<8|se[ne+3]),A)},_)},gt=function(g,_){var P,A,L;return P=Z(_,["moof","traf"]),A=[].concat.apply([],P.map(function(N){return Z(N,["tfhd"]).map(function(Y){var ne,ce,se;return ne=it(Y[4]<<24|Y[5]<<16|Y[6]<<8|Y[7]),ce=g[ne]||9e4,se=Z(N,["tfdt"]).map(function(pe){var Me,qe;return Me=pe[0],qe=it(pe[4]<<24|pe[5]<<16|pe[6]<<8|pe[7]),Me===1&&(qe*=Math.pow(2,32),qe+=it(pe[8]<<24|pe[9]<<16|pe[10]<<8|pe[11])),qe})[0],se=typeof se=="number"&&!isNaN(se)?se:1/0,se/ce})})),L=Math.min.apply(null,A),isFinite(L)?L:0},St=function(g,_){var P=Z(_,["moof","traf"]),A=0,L=0,N;if(P&&P.length){var Y=Z(P[0],["tfhd"])[0],ne=Z(P[0],["trun"])[0],ce=Z(P[0],["tfdt"])[0];if(Y){var se=ge(Y);N=se.trackId}if(ce){var pe=Ze(ce);A=pe.baseMediaDecodeTime}if(ne){var Me=$e(ne);Me.samples&&Me.samples.length&&(L=Me.samples[0].compositionTimeOffset||0)}}var qe=g[N]||9e4;return(A+L)/qe},lt=function(g){var _=Z(g,["moov","trak"]),P=[];return _.forEach(function(A){var L=Z(A,["mdia","hdlr"]),N=Z(A,["tkhd"]);L.forEach(function(Y,ne){var ce=$t(Y.subarray(8,12)),se=N[ne],pe,Me,qe;ce==="vide"&&(pe=new DataView(se.buffer,se.byteOffset,se.byteLength),Me=pe.getUint8(0),qe=Me===0?pe.getUint32(12):pe.getUint32(20),P.push(qe))})}),P},Ht=function(g){var _=g[0],P=_===0?12:20;return it(g[P]<<24|g[P+1]<<16|g[P+2]<<8|g[P+3])},At=function(g){var _=Z(g,["moov","trak"]),P=[];return _.forEach(function(A){var L={},N=Z(A,["tkhd"])[0],Y,ne;N&&(Y=new DataView(N.buffer,N.byteOffset,N.byteLength),ne=Y.getUint8(0),L.id=ne===0?Y.getUint32(12):Y.getUint32(20));var ce=Z(A,["mdia","hdlr"])[0];if(ce){var se=$t(ce.subarray(8,12));se==="vide"?L.type="video":se==="soun"?L.type="audio":L.type=se}var pe=Z(A,["mdia","minf","stbl","stsd"])[0];if(pe){var Me=pe.subarray(8);L.codec=$t(Me.subarray(4,8));var qe=Z(Me,[L.codec])[0],Qe,We;qe&&(/^[asm]vc[1-9]$/i.test(L.codec)?(Qe=qe.subarray(78),We=$t(Qe.subarray(4,8)),We==="avcC"&&Qe.length>11?(L.codec+=".",L.codec+=rt(Qe[9]),L.codec+=rt(Qe[10]),L.codec+=rt(Qe[11])):L.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(L.codec)?(Qe=qe.subarray(28),We=$t(Qe.subarray(4,8)),We==="esds"&&Qe.length>20&&Qe[19]!==0?(L.codec+="."+rt(Qe[19]),L.codec+="."+rt(Qe[20]>>>2&63).replace(/^0/,"")):L.codec="mp4a.40.2"):L.codec=L.codec.toLowerCase())}var dt=Z(A,["mdia","mdhd"])[0];dt&&(L.timescale=Ht(dt)),P.push(L)}),P};var Vt={findBox:Z,parseType:$t,timescale:ot,startTime:gt,compositionStartTime:St,videoTrackIds:lt,tracks:At,getTimescaleFromMediaHeader:Ht},Lt=function(g){var _,P,A=[],L=[];for(L.byteLength=0,L.nalCount=0,L.duration=0,A.byteLength=0,_=0;_<g.length;_++)P=g[_],P.nalUnitType==="access_unit_delimiter_rbsp"?(A.length&&(A.duration=P.dts-A.dts,L.byteLength+=A.byteLength,L.nalCount+=A.length,L.duration+=A.duration,L.push(A)),A=[P],A.byteLength=P.data.byteLength,A.pts=P.pts,A.dts=P.dts):(P.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(A.keyFrame=!0),A.duration=P.dts-A.dts,A.byteLength+=P.data.byteLength,A.push(P));return L.length&&(!A.duration||A.duration<=0)&&(A.duration=L[L.length-1].duration),L.byteLength+=A.byteLength,L.nalCount+=A.length,L.duration+=A.duration,L.push(A),L},Jt=function(g){var _,P,A=[],L=[];for(A.byteLength=0,A.nalCount=0,A.duration=0,A.pts=g[0].pts,A.dts=g[0].dts,L.byteLength=0,L.nalCount=0,L.duration=0,L.pts=g[0].pts,L.dts=g[0].dts,_=0;_<g.length;_++)P=g[_],P.keyFrame?(A.length&&(L.push(A),L.byteLength+=A.byteLength,L.nalCount+=A.nalCount,L.duration+=A.duration),A=[P],A.nalCount=P.length,A.byteLength=P.byteLength,A.pts=P.pts,A.dts=P.dts,A.duration=P.duration):(A.duration+=P.duration,A.nalCount+=P.length,A.byteLength+=P.byteLength,A.push(P));return L.length&&A.duration<=0&&(A.duration=L[L.length-1].duration),L.byteLength+=A.byteLength,L.nalCount+=A.nalCount,L.duration+=A.duration,L.push(A),L},mt=function(g){var _;return!g[0][0].keyFrame&&g.length>1&&(_=g.shift(),g.byteLength-=_.byteLength,g.nalCount-=_.nalCount,g[0][0].dts=_.dts,g[0][0].pts=_.pts,g[0][0].duration+=_.duration),g},qt=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},cr=function(g,_){var P=qt();return P.dataOffset=_,P.compositionTimeOffset=g.pts-g.dts,P.duration=g.duration,P.size=4*g.length,P.size+=g.byteLength,g.keyFrame&&(P.flags.dependsOn=2,P.flags.isNonSyncSample=0),P},Kt=function(g,_){var P,A,L,N,Y,ne=_||0,ce=[];for(P=0;P<g.length;P++)for(N=g[P],A=0;A<N.length;A++)Y=N[A],L=cr(Y,ne),ne+=L.size,ce.push(L);return ce},dr=function(g){var _,P,A,L,N,Y,ne=0,ce=g.byteLength,se=g.nalCount,pe=ce+4*se,Me=new Uint8Array(pe),qe=new DataView(Me.buffer);for(_=0;_<g.length;_++)for(L=g[_],P=0;P<L.length;P++)for(N=L[P],A=0;A<N.length;A++)Y=N[A],qe.setUint32(ne,Y.data.byteLength),ne+=4,Me.set(Y.data,ne),ne+=Y.data.byteLength;return Me},tr=function(g,_){var P,A=_||0,L=[];return P=cr(g,A),L.push(P),L},Pr=function(g){var _,P,A=0,L=g.byteLength,N=g.length,Y=L+4*N,ne=new Uint8Array(Y),ce=new DataView(ne.buffer);for(_=0;_<g.length;_++)P=g[_],ce.setUint32(A,P.data.byteLength),A+=4,ne.set(P.data,A),A+=P.data.byteLength;return ne},Wt={groupNalsIntoFrames:Lt,groupFramesIntoGops:Jt,extendFirstKeyFrame:mt,generateSampleTable:Kt,concatenateNalData:dr,generateSampleTableForFrame:tr,concatenateNalDataForFrame:Pr},pr=[33,16,5,32,164,27],la=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],Mt=function(g){for(var _=[];g--;)_.push(0);return _},gr=function(g){return Object.keys(g).reduce(function(_,P){return _[P]=new Uint8Array(g[P].reduce(function(A,L){return A.concat(L)},[])),_},{})},Tt,ba=function(){if(!Tt){var g={96e3:[pr,[227,64],Mt(154),[56]],88200:[pr,[231],Mt(170),[56]],64e3:[pr,[248,192],Mt(240),[56]],48e3:[pr,[255,192],Mt(268),[55,148,128],Mt(54),[112]],44100:[pr,[255,192],Mt(268),[55,163,128],Mt(84),[112]],32e3:[pr,[255,192],Mt(268),[55,234],Mt(226),[112]],24e3:[pr,[255,192],Mt(268),[55,255,128],Mt(268),[111,112],Mt(126),[224]],16e3:[pr,[255,192],Mt(268),[55,255,128],Mt(268),[111,255],Mt(269),[223,108],Mt(195),[1,192]],12e3:[la,Mt(268),[3,127,248],Mt(268),[6,255,240],Mt(268),[13,255,224],Mt(268),[27,253,128],Mt(259),[56]],11025:[la,Mt(268),[3,127,248],Mt(268),[6,255,240],Mt(268),[13,255,224],Mt(268),[27,255,192],Mt(268),[55,175,128],Mt(108),[112]],8e3:[la,Mt(268),[3,121,16],Mt(47),[7]]};Tt=gr(g)}return Tt},Nr=function(g){var _,P,A=0;for(_=0;_<g.length;_++)P=g[_],A+=P.data.byteLength;return A},Fr=function(g,_,P,A){var L,N=0,Y=0,ne=0,ce=0,se,pe,Me;if(_.length&&(L=y.audioTsToVideoTs(g.baseMediaDecodeTime,g.samplerate),N=Math.ceil(y.ONE_SECOND_IN_TS/(g.samplerate/1024)),P&&A&&(Y=L-Math.max(P,A),ne=Math.floor(Y/N),ce=ne*N),!(ne<1||ce>y.ONE_SECOND_IN_TS/2))){for(se=ba()[g.samplerate],se||(se=_[0].data),pe=0;pe<ne;pe++)Me=_[0],_.splice(0,0,{data:se,dts:Me.dts-N,pts:Me.pts-N});return g.baseMediaDecodeTime-=Math.floor(y.videoTsToAudioTs(ce,g.samplerate)),ce}},ua=function(g,_,P){return _.minSegmentDts>=P?g:(_.minSegmentDts=1/0,g.filter(function(A){return A.dts>=P?(_.minSegmentDts=Math.min(_.minSegmentDts,A.dts),_.minSegmentPts=_.minSegmentDts,!0):!1}))},mr=function(g){var _,P,A=[];for(_=0;_<g.length;_++)P=g[_],A.push({size:P.data.byteLength,duration:1024});return A},Qr=function(g){var _,P,A=0,L=new Uint8Array(Nr(g));for(_=0;_<g.length;_++)P=g[_],L.set(P.data,A),A+=P.data.byteLength;return L},fr={prefixWithSilence:Fr,trimAdtsFramesByEarliestDts:ua,generateSampleTable:mr,concatenateFrameData:Qr},Ar=y.ONE_SECOND_IN_TS,Jr=function(g,_){typeof _.pts=="number"&&(g.timelineStartInfo.pts===void 0&&(g.timelineStartInfo.pts=_.pts),g.minSegmentPts===void 0?g.minSegmentPts=_.pts:g.minSegmentPts=Math.min(g.minSegmentPts,_.pts),g.maxSegmentPts===void 0?g.maxSegmentPts=_.pts:g.maxSegmentPts=Math.max(g.maxSegmentPts,_.pts)),typeof _.dts=="number"&&(g.timelineStartInfo.dts===void 0&&(g.timelineStartInfo.dts=_.dts),g.minSegmentDts===void 0?g.minSegmentDts=_.dts:g.minSegmentDts=Math.min(g.minSegmentDts,_.dts),g.maxSegmentDts===void 0?g.maxSegmentDts=_.dts:g.maxSegmentDts=Math.max(g.maxSegmentDts,_.dts))},Br=function(g){delete g.minSegmentDts,delete g.maxSegmentDts,delete g.minSegmentPts,delete g.maxSegmentPts},Ia=function(g,_){var P,A,L=g.minSegmentDts;return _||(L-=g.timelineStartInfo.dts),P=g.timelineStartInfo.baseMediaDecodeTime,P+=L,P=Math.max(0,P),g.type==="audio"&&(A=g.samplerate/Ar,P*=A,P=Math.floor(P)),P},Gt={clearDtsInfo:Br,calculateTrackBaseMediaDecodeTime:Ia,collectDtsInfo:Jr},Ma=4,wa=128,ei=function(g){for(var _=0,P={payloadType:-1,payloadSize:0},A=0,L=0;_<g.byteLength&&g[_]!==wa;){for(;g[_]===255;)A+=255,_++;for(A+=g[_++];g[_]===255;)L+=255,_++;if(L+=g[_++],!P.payload&&A===Ma){var N=String.fromCharCode(g[_+3],g[_+4],g[_+5],g[_+6]);if(N==="GA94"){P.payloadType=A,P.payloadSize=L,P.payload=g.subarray(_,_+L);break}else P.payload=void 0}_+=L,A=0,L=0}return P},ti=function(g){return g.payload[0]!==181||(g.payload[1]<<8|g.payload[2])!==49||String.fromCharCode(g.payload[3],g.payload[4],g.payload[5],g.payload[6])!=="GA94"||g.payload[7]!==3?null:g.payload.subarray(8,g.payload.length-1)},Vi=function(g,_){var P=[],A,L,N,Y;if(!(_[0]&64))return P;for(L=_[0]&31,A=0;A<L;A++)N=A*3,Y={type:_[N+2]&3,pts:g},_[N+2]&4&&(Y.ccData=_[N+3]<<8|_[N+4],P.push(Y));return P},Gi=function(g){for(var _=g.byteLength,P=[],A=1,L,N;A<_-2;)g[A]===0&&g[A+1]===0&&g[A+2]===3?(P.push(A+2),A+=2):A++;if(P.length===0)return g;L=_-P.length,N=new Uint8Array(L);var Y=0;for(A=0;A<L;Y++,A++)Y===P[0]&&(Y++,P.shift()),N[A]=g[Y];return N},$r={parseSei:ei,parseUserData:ti,parseCaptionPackets:Vi,discardEmulationPreventionBytes:Gi,USER_DATA_REGISTERED_ITU_T_T35:Ma},Zt=function j(g){g=g||{},j.prototype.init.call(this),this.parse708captions_=typeof g.parse708captions=="boolean"?g.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new jt(0,0),new jt(0,1),new jt(1,0),new jt(1,1)],this.parse708captions_&&(this.cc708Stream_=new Ot({captionServices:g.captionServices})),this.reset(),this.ccStreams_.forEach(function(_){_.on("data",this.trigger.bind(this,"data")),_.on("partialdone",this.trigger.bind(this,"partialdone")),_.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};Zt.prototype=new r,Zt.prototype.push=function(j){var g,_,P;if(j.nalUnitType==="sei_rbsp"&&(g=$r.parseSei(j.escapedRBSP),!!g.payload&&g.payloadType===$r.USER_DATA_REGISTERED_ITU_T_T35&&(_=$r.parseUserData(g),!!_))){if(j.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(j.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}P=$r.parseCaptionPackets(j.pts,_),this.captionPackets_=this.captionPackets_.concat(P),this.latestDts_!==j.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=j.dts}},Zt.prototype.flushCCStreams=function(j){this.ccStreams_.forEach(function(g){return j==="flush"?g.flush():g.partialFlush()},this)},Zt.prototype.flushStream=function(j){if(!this.captionPackets_.length){this.flushCCStreams(j);return}this.captionPackets_.forEach(function(g,_){g.presortIndex=_}),this.captionPackets_.sort(function(g,_){return g.pts===_.pts?g.presortIndex-_.presortIndex:g.pts-_.pts}),this.captionPackets_.forEach(function(g){g.type<2?this.dispatchCea608Packet(g):this.dispatchCea708Packet(g)},this),this.captionPackets_.length=0,this.flushCCStreams(j)},Zt.prototype.flush=function(){return this.flushStream("flush")},Zt.prototype.partialFlush=function(){return this.flushStream("partialFlush")},Zt.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(j){j.reset()})},Zt.prototype.dispatchCea608Packet=function(j){this.setsTextOrXDSActive(j)?this.activeCea608Channel_[j.type]=null:this.setsChannel1Active(j)?this.activeCea608Channel_[j.type]=0:this.setsChannel2Active(j)&&(this.activeCea608Channel_[j.type]=1),this.activeCea608Channel_[j.type]!==null&&this.ccStreams_[(j.type<<1)+this.activeCea608Channel_[j.type]].push(j)},Zt.prototype.setsChannel1Active=function(j){return(j.ccData&30720)===4096},Zt.prototype.setsChannel2Active=function(j){return(j.ccData&30720)===6144},Zt.prototype.setsTextOrXDSActive=function(j){return(j.ccData&28928)===256||(j.ccData&30974)===4138||(j.ccData&30974)===6186},Zt.prototype.dispatchCea708Packet=function(j){this.parse708captions_&&this.cc708Stream_.push(j)};var ri={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},Da=function(g){var _=ri[g]||g;return g&4096&&g===_?"":String.fromCharCode(_)},Zr=function(g){return 32<=g&&g<=127||160<=g&&g<=255},_r=function(g){this.windowNum=g,this.reset()};_r.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},_r.prototype.getText=function(){return this.rows.join(`
`)},_r.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},_r.prototype.newLine=function(j){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(j),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},_r.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},_r.prototype.addText=function(j){this.rows[this.rowIdx]+=j},_r.prototype.backspace=function(){if(!this.isEmpty()){var j=this.rows[this.rowIdx];this.rows[this.rowIdx]=j.substr(0,j.length-1)}};var da=function(g,_,P){this.serviceNum=g,this.text="",this.currentWindow=new _r(-1),this.windows=[],this.stream=P,typeof _=="string"&&this.createTextDecoder(_)};da.prototype.init=function(j,g){this.startPts=j;for(var _=0;_<8;_++)this.windows[_]=new _r(_),typeof g=="function"&&(this.windows[_].beforeRowOverflow=g)},da.prototype.setCurrentWindow=function(j){this.currentWindow=this.windows[j]},da.prototype.createTextDecoder=function(j){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(j)}catch(g){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+j+" encoding. "+g})}};var Ot=function j(g){g=g||{},j.prototype.init.call(this);var _=this,P=g.captionServices||{},A={},L;Object.keys(P).forEach(function(N){L=P[N],/^SERVICE/.test(N)&&(A[N]=L.encoding)}),this.serviceEncodings=A,this.current708Packet=null,this.services={},this.push=function(N){N.type===3?(_.new708Packet(),_.add708Bytes(N)):(_.current708Packet===null&&_.new708Packet(),_.add708Bytes(N))}};Ot.prototype=new r,Ot.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Ot.prototype.add708Bytes=function(j){var g=j.ccData,_=g>>>8,P=g&255;this.current708Packet.ptsVals.push(j.pts),this.current708Packet.data.push(_),this.current708Packet.data.push(P)},Ot.prototype.push708Packet=function(){var j=this.current708Packet,g=j.data,_=null,P=null,A=0,L=g[A++];for(j.seq=L>>6,j.sizeCode=L&63;A<g.length;A++)L=g[A++],_=L>>5,P=L&31,_===7&&P>0&&(L=g[A++],_=L),this.pushServiceBlock(_,A,P),P>0&&(A+=P-1)},Ot.prototype.pushServiceBlock=function(j,g,_){var P,A=g,L=this.current708Packet.data,N=this.services[j];for(N||(N=this.initService(j,A));A<g+_&&A<L.length;A++)P=L[A],Zr(P)?A=this.handleText(A,N):P===24?A=this.multiByteCharacter(A,N):P===16?A=this.extendedCommands(A,N):128<=P&&P<=135?A=this.setCurrentWindow(A,N):152<=P&&P<=159?A=this.defineWindow(A,N):P===136?A=this.clearWindows(A,N):P===140?A=this.deleteWindows(A,N):P===137?A=this.displayWindows(A,N):P===138?A=this.hideWindows(A,N):P===139?A=this.toggleWindows(A,N):P===151?A=this.setWindowAttributes(A,N):P===144?A=this.setPenAttributes(A,N):P===145?A=this.setPenColor(A,N):P===146?A=this.setPenLocation(A,N):P===143?N=this.reset(A,N):P===8?N.currentWindow.backspace():P===12?N.currentWindow.clearText():P===13?N.currentWindow.pendingNewLine=!0:P===14?N.currentWindow.clearText():P===141&&A++},Ot.prototype.extendedCommands=function(j,g){var _=this.current708Packet.data,P=_[++j];return Zr(P)&&(j=this.handleText(j,g,{isExtended:!0})),j},Ot.prototype.getPts=function(j){return this.current708Packet.ptsVals[Math.floor(j/2)]},Ot.prototype.initService=function(j,g){var P="SERVICE"+j,_=this,P,A;return P in this.serviceEncodings&&(A=this.serviceEncodings[P]),this.services[j]=new da(j,A,_),this.services[j].init(this.getPts(g),function(L){_.flushDisplayed(L,_.services[j])}),this.services[j]},Ot.prototype.handleText=function(j,g,_){var P=_&&_.isExtended,A=_&&_.isMultiByte,L=this.current708Packet.data,N=P?4096:0,Y=L[j],ne=L[j+1],ce=g.currentWindow,se,pe;return g.textDecoder_&&!P?(A?(pe=[Y,ne],j++):pe=[Y],se=g.textDecoder_.decode(new Uint8Array(pe))):se=Da(N|Y),ce.pendingNewLine&&!ce.isEmpty()&&ce.newLine(this.getPts(j)),ce.pendingNewLine=!1,ce.addText(se),j},Ot.prototype.multiByteCharacter=function(j,g){var _=this.current708Packet.data,P=_[j+1],A=_[j+2];return Zr(P)&&Zr(A)&&(j=this.handleText(++j,g,{isMultiByte:!0})),j},Ot.prototype.setCurrentWindow=function(j,g){var _=this.current708Packet.data,P=_[j],A=P&7;return g.setCurrentWindow(A),j},Ot.prototype.defineWindow=function(j,g){var _=this.current708Packet.data,P=_[j],A=P&7;g.setCurrentWindow(A);var L=g.currentWindow;return P=_[++j],L.visible=(P&32)>>5,L.rowLock=(P&16)>>4,L.columnLock=(P&8)>>3,L.priority=P&7,P=_[++j],L.relativePositioning=(P&128)>>7,L.anchorVertical=P&127,P=_[++j],L.anchorHorizontal=P,P=_[++j],L.anchorPoint=(P&240)>>4,L.rowCount=P&15,P=_[++j],L.columnCount=P&63,P=_[++j],L.windowStyle=(P&56)>>3,L.penStyle=P&7,L.virtualRowCount=L.rowCount+1,j},Ot.prototype.setWindowAttributes=function(j,g){var _=this.current708Packet.data,P=_[j],A=g.currentWindow.winAttr;return P=_[++j],A.fillOpacity=(P&192)>>6,A.fillRed=(P&48)>>4,A.fillGreen=(P&12)>>2,A.fillBlue=P&3,P=_[++j],A.borderType=(P&192)>>6,A.borderRed=(P&48)>>4,A.borderGreen=(P&12)>>2,A.borderBlue=P&3,P=_[++j],A.borderType+=(P&128)>>5,A.wordWrap=(P&64)>>6,A.printDirection=(P&48)>>4,A.scrollDirection=(P&12)>>2,A.justify=P&3,P=_[++j],A.effectSpeed=(P&240)>>4,A.effectDirection=(P&12)>>2,A.displayEffect=P&3,j},Ot.prototype.flushDisplayed=function(j,g){for(var _=[],P=0;P<8;P++)g.windows[P].visible&&!g.windows[P].isEmpty()&&_.push(g.windows[P].getText());g.endPts=j,g.text=_.join(`

`),this.pushCaption(g),g.startPts=j},Ot.prototype.pushCaption=function(j){j.text!==""&&(this.trigger("data",{startPts:j.startPts,endPts:j.endPts,text:j.text,stream:"cc708_"+j.serviceNum}),j.text="",j.startPts=j.endPts)},Ot.prototype.displayWindows=function(j,g){var _=this.current708Packet.data,P=_[++j],A=this.getPts(j);this.flushDisplayed(A,g);for(var L=0;L<8;L++)P&1<<L&&(g.windows[L].visible=1);return j},Ot.prototype.hideWindows=function(j,g){var _=this.current708Packet.data,P=_[++j],A=this.getPts(j);this.flushDisplayed(A,g);for(var L=0;L<8;L++)P&1<<L&&(g.windows[L].visible=0);return j},Ot.prototype.toggleWindows=function(j,g){var _=this.current708Packet.data,P=_[++j],A=this.getPts(j);this.flushDisplayed(A,g);for(var L=0;L<8;L++)P&1<<L&&(g.windows[L].visible^=1);return j},Ot.prototype.clearWindows=function(j,g){var _=this.current708Packet.data,P=_[++j],A=this.getPts(j);this.flushDisplayed(A,g);for(var L=0;L<8;L++)P&1<<L&&g.windows[L].clearText();return j},Ot.prototype.deleteWindows=function(j,g){var _=this.current708Packet.data,P=_[++j],A=this.getPts(j);this.flushDisplayed(A,g);for(var L=0;L<8;L++)P&1<<L&&g.windows[L].reset();return j},Ot.prototype.setPenAttributes=function(j,g){var _=this.current708Packet.data,P=_[j],A=g.currentWindow.penAttr;return P=_[++j],A.textTag=(P&240)>>4,A.offset=(P&12)>>2,A.penSize=P&3,P=_[++j],A.italics=(P&128)>>7,A.underline=(P&64)>>6,A.edgeType=(P&56)>>3,A.fontStyle=P&7,j},Ot.prototype.setPenColor=function(j,g){var _=this.current708Packet.data,P=_[j],A=g.currentWindow.penColor;return P=_[++j],A.fgOpacity=(P&192)>>6,A.fgRed=(P&48)>>4,A.fgGreen=(P&12)>>2,A.fgBlue=P&3,P=_[++j],A.bgOpacity=(P&192)>>6,A.bgRed=(P&48)>>4,A.bgGreen=(P&12)>>2,A.bgBlue=P&3,P=_[++j],A.edgeRed=(P&48)>>4,A.edgeGreen=(P&12)>>2,A.edgeBlue=P&3,j},Ot.prototype.setPenLocation=function(j,g){var _=this.current708Packet.data,P=_[j],A=g.currentWindow.penLoc;return g.currentWindow.pendingNewLine=!0,P=_[++j],A.row=P&15,P=_[++j],A.column=P&63,j},Ot.prototype.reset=function(j,g){var _=this.getPts(j);return this.flushDisplayed(_,g),this.initService(g.serviceNum,j)};var Hi={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},br=function(g){return g===null?"":(g=Hi[g]||g,String.fromCharCode(g))},ha=14,Ki=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Ir=function(){for(var g=[],_=ha+1;_--;)g.push("");return g},jt=function j(g,_){j.prototype.init.call(this),this.field_=g||0,this.dataChannel_=_||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(P){var A,L,N,Y,ne;if(A=P.ccData&32639,A===this.lastControlCode_){this.lastControlCode_=null;return}if((A&61440)===4096?this.lastControlCode_=A:A!==this.PADDING_&&(this.lastControlCode_=null),N=A>>>8,Y=A&255,A!==this.PADDING_)if(A===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(A===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(P.pts),this.flushDisplayed(P.pts),L=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=L,this.startPts_=P.pts;else if(A===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(P.pts);else if(A===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(P.pts);else if(A===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(P.pts);else if(A===this.CARRIAGE_RETURN_)this.clearFormatting(P.pts),this.flushDisplayed(P.pts),this.shiftRowsUp_(),this.startPts_=P.pts;else if(A===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(A===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(P.pts),this.displayed_=Ir();else if(A===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Ir();else if(A===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(P.pts),this.displayed_=Ir()),this.mode_="paintOn",this.startPts_=P.pts;else if(this.isSpecialCharacter(N,Y))N=(N&3)<<8,ne=br(N|Y),this[this.mode_](P.pts,ne),this.column_++;else if(this.isExtCharacter(N,Y))this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),N=(N&3)<<8,ne=br(N|Y),this[this.mode_](P.pts,ne),this.column_++;else if(this.isMidRowCode(N,Y))this.clearFormatting(P.pts),this[this.mode_](P.pts," "),this.column_++,(Y&14)===14&&this.addFormatting(P.pts,["i"]),(Y&1)===1&&this.addFormatting(P.pts,["u"]);else if(this.isOffsetControlCode(N,Y))this.column_+=Y&3;else if(this.isPAC(N,Y)){var ce=Ki.indexOf(A&7968);this.mode_==="rollUp"&&(ce-this.rollUpRows_+1<0&&(ce=this.rollUpRows_-1),this.setRollUp(P.pts,ce)),ce!==this.row_&&(this.clearFormatting(P.pts),this.row_=ce),Y&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(P.pts,["u"]),(A&16)===16&&(this.column_=((A&14)>>1)*4),this.isColorPAC(Y)&&(Y&14)===14&&this.addFormatting(P.pts,["i"])}else this.isNormalChar(N)&&(Y===0&&(Y=null),ne=br(N),ne+=br(Y),this[this.mode_](P.pts,ne),this.column_+=ne.length)}};jt.prototype=new r,jt.prototype.flushDisplayed=function(j){var g=this.displayed_.map(function(_,P){try{return _.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+P+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");g.length&&this.trigger("data",{startPts:this.startPts_,endPts:j,text:g,stream:this.name_})},jt.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Ir(),this.nonDisplayed_=Ir(),this.lastControlCode_=null,this.column_=0,this.row_=ha,this.rollUpRows_=2,this.formatting_=[]},jt.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},jt.prototype.isSpecialCharacter=function(j,g){return j===this.EXT_&&g>=48&&g<=63},jt.prototype.isExtCharacter=function(j,g){return(j===this.EXT_+1||j===this.EXT_+2)&&g>=32&&g<=63},jt.prototype.isMidRowCode=function(j,g){return j===this.EXT_&&g>=32&&g<=47},jt.prototype.isOffsetControlCode=function(j,g){return j===this.OFFSET_&&g>=33&&g<=35},jt.prototype.isPAC=function(j,g){return j>=this.BASE_&&j<this.BASE_+8&&g>=64&&g<=127},jt.prototype.isColorPAC=function(j){return j>=64&&j<=79||j>=96&&j<=127},jt.prototype.isNormalChar=function(j){return j>=32&&j<=127},jt.prototype.setRollUp=function(j,g){if(this.mode_!=="rollUp"&&(this.row_=ha,this.mode_="rollUp",this.flushDisplayed(j),this.nonDisplayed_=Ir(),this.displayed_=Ir()),g!==void 0&&g!==this.row_)for(var _=0;_<this.rollUpRows_;_++)this.displayed_[g-_]=this.displayed_[this.row_-_],this.displayed_[this.row_-_]="";g===void 0&&(g=this.row_),this.topRow_=g-this.rollUpRows_+1},jt.prototype.addFormatting=function(j,g){this.formatting_=this.formatting_.concat(g);var _=g.reduce(function(P,A){return P+"<"+A+">"},"");this[this.mode_](j,_)},jt.prototype.clearFormatting=function(j){if(this.formatting_.length){var g=this.formatting_.reverse().reduce(function(_,P){return _+"</"+P+">"},"");this.formatting_=[],this[this.mode_](j,g)}},jt.prototype.popOn=function(j,g){var _=this.nonDisplayed_[this.row_];_+=g,this.nonDisplayed_[this.row_]=_},jt.prototype.rollUp=function(j,g){var _=this.displayed_[this.row_];_+=g,this.displayed_[this.row_]=_},jt.prototype.shiftRowsUp_=function(){var j;for(j=0;j<this.topRow_;j++)this.displayed_[j]="";for(j=this.row_+1;j<ha+1;j++)this.displayed_[j]="";for(j=this.topRow_;j<this.row_;j++)this.displayed_[j]=this.displayed_[j+1];this.displayed_[this.row_]=""},jt.prototype.paintOn=function(j,g){var _=this.displayed_[this.row_];_+=g,this.displayed_[this.row_]=_};var Mr={CaptionStream:Zt,Cea608Stream:jt,Cea708Stream:Ot},zt={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Wi=8589934592,qi=4294967296,ai="shared",ea=function(g,_){var P=1;for(g>_&&(P=-1);Math.abs(_-g)>qi;)g+=P*Wi;return g},ii=function j(g){var _,P;j.prototype.init.call(this),this.type_=g||ai,this.push=function(A){this.type_!==ai&&A.type!==this.type_||(P===void 0&&(P=A.dts),A.dts=ea(A.dts,P),A.pts=ea(A.pts,P),_=A.dts,this.trigger("data",A))},this.flush=function(){P=_,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){P=void 0,_=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};ii.prototype=new r;var ni={TimestampRolloverStream:ii,handleRollover:ea},ca=function(g,_,P){var A,L="";for(A=_;A<P;A++)L+="%"+("00"+g[A].toString(16)).slice(-2);return L},pa=function(g,_,P){return decodeURIComponent(ca(g,_,P))},zi=function(g,_,P){return unescape(ca(g,_,P))},fa=function(g){return g[0]<<21|g[1]<<14|g[2]<<7|g[3]},ga={TXXX:function(g){var _;if(g.data[0]===3){for(_=1;_<g.data.length;_++)if(g.data[_]===0){g.description=pa(g.data,1,_),g.value=pa(g.data,_+1,g.data.length).replace(/\0*$/,"");break}g.data=g.value}},WXXX:function(g){var _;if(g.data[0]===3){for(_=1;_<g.data.length;_++)if(g.data[_]===0){g.description=pa(g.data,1,_),g.url=pa(g.data,_+1,g.data.length);break}}},PRIV:function(g){var _;for(_=0;_<g.data.length;_++)if(g.data[_]===0){g.owner=zi(g.data,0,_);break}g.privateData=g.data.subarray(_+1),g.data=g.privateData}},jr;jr=function(g){var _={descriptor:g&&g.descriptor},P=0,A=[],L=0,N;if(jr.prototype.init.call(this),this.dispatchType=zt.METADATA_STREAM_TYPE.toString(16),_.descriptor)for(N=0;N<_.descriptor.length;N++)this.dispatchType+=("00"+_.descriptor[N].toString(16)).slice(-2);this.push=function(Y){var ne,ce,se,pe,Me,qe;if(Y.type==="timed-metadata"){if(Y.dataAlignmentIndicator&&(L=0,A.length=0),A.length===0&&(Y.data.length<10||Y.data[0]!=="I".charCodeAt(0)||Y.data[1]!=="D".charCodeAt(0)||Y.data[2]!=="3".charCodeAt(0))){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(A.push(Y),L+=Y.data.byteLength,A.length===1&&(P=fa(Y.data.subarray(6,10)),P+=10),!(L<P)){for(ne={data:new Uint8Array(P),frames:[],pts:A[0].pts,dts:A[0].dts},Me=0;Me<P;)ne.data.set(A[0].data.subarray(0,P-Me),Me),Me+=A[0].data.byteLength,L-=A[0].data.byteLength,A.shift();ce=10,ne.data[5]&64&&(ce+=4,ce+=fa(ne.data.subarray(10,14)),P-=fa(ne.data.subarray(16,20)));do{if(se=fa(ne.data.subarray(ce+4,ce+8)),se<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping metadata parsing."});return}if(qe=String.fromCharCode(ne.data[ce],ne.data[ce+1],ne.data[ce+2],ne.data[ce+3]),pe={id:qe,data:ne.data.subarray(ce+10,ce+se+10)},pe.key=pe.id,ga[pe.id]&&(ga[pe.id](pe),pe.owner==="com.apple.streaming.transportStreamTimestamp")){var Qe=pe.data,We=(Qe[3]&1)<<30|Qe[4]<<22|Qe[5]<<14|Qe[6]<<6|Qe[7]>>>2;We*=4,We+=Qe[7]&3,pe.timeStamp=We,ne.pts===void 0&&ne.dts===void 0&&(ne.pts=pe.timeStamp,ne.dts=pe.timeStamp),this.trigger("timestamp",pe)}ne.frames.push(pe),ce+=10,ce+=se}while(ce<P);this.trigger("data",ne)}}}},jr.prototype=new r;var Xi=jr,xt=ni.TimestampRolloverStream,ma,Vr,ta,Gr=188,ya=71;ma=function(){var g=new Uint8Array(Gr),_=0;ma.prototype.init.call(this),this.push=function(P){var A=0,L=Gr,N;for(_?(N=new Uint8Array(P.byteLength+_),N.set(g.subarray(0,_)),N.set(P,_),_=0):N=P;L<N.byteLength;){if(N[A]===ya&&N[L]===ya){this.trigger("data",N.subarray(A,L)),A+=Gr,L+=Gr;continue}A++,L++}A<N.byteLength&&(g.set(N.subarray(A),0),_=N.byteLength-A)},this.flush=function(){_===Gr&&g[0]===ya&&(this.trigger("data",g),_=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){_=0,this.trigger("reset")}},ma.prototype=new r,Vr=function(){var g,_,P,A;Vr.prototype.init.call(this),A=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,g=function(N,Y){var ne=0;Y.payloadUnitStartIndicator&&(ne+=N[ne]+1),Y.type==="pat"?_(N.subarray(ne),Y):P(N.subarray(ne),Y)},_=function(N,Y){Y.section_number=N[7],Y.last_section_number=N[8],A.pmtPid=(N[10]&31)<<8|N[11],Y.pmtPid=A.pmtPid},P=function(N,Y){var ne,ce,se,pe;if(N[5]&1){for(A.programMapTable={video:null,audio:null,"timed-metadata":{}},ne=(N[1]&15)<<8|N[2],ce=3+ne-4,se=(N[10]&15)<<8|N[11],pe=12+se;pe<ce;){var Me=N[pe],qe=(N[pe+1]&31)<<8|N[pe+2];Me===zt.H264_STREAM_TYPE&&A.programMapTable.video===null?A.programMapTable.video=qe:Me===zt.ADTS_STREAM_TYPE&&A.programMapTable.audio===null?A.programMapTable.audio=qe:Me===zt.METADATA_STREAM_TYPE&&(A.programMapTable["timed-metadata"][qe]=Me),pe+=((N[pe+3]&15)<<8|N[pe+4])+5}Y.programMapTable=A.programMapTable}},this.push=function(L){var N={},Y=4;if(N.payloadUnitStartIndicator=!!(L[1]&64),N.pid=L[1]&31,N.pid<<=8,N.pid|=L[2],(L[3]&48)>>>4>1&&(Y+=L[Y]+1),N.pid===0)N.type="pat",g(L.subarray(Y),N),this.trigger("data",N);else if(N.pid===this.pmtPid)for(N.type="pmt",g(L.subarray(Y),N),this.trigger("data",N);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([L,Y,N]):this.processPes_(L,Y,N)},this.processPes_=function(L,N,Y){Y.pid===this.programMapTable.video?Y.streamType=zt.H264_STREAM_TYPE:Y.pid===this.programMapTable.audio?Y.streamType=zt.ADTS_STREAM_TYPE:Y.streamType=this.programMapTable["timed-metadata"][Y.pid],Y.type="pes",Y.data=L.subarray(N),this.trigger("data",Y)}},Vr.prototype=new r,Vr.STREAM_TYPES={h264:27,adts:15},ta=function(){var g=this,_=!1,P={data:[],size:0},A={data:[],size:0},L={data:[],size:0},N,Y=function(se,pe){var Me,qe=se[0]<<16|se[1]<<8|se[2];pe.data=new Uint8Array,qe===1&&(pe.packetLength=6+(se[4]<<8|se[5]),pe.dataAlignmentIndicator=(se[6]&4)!==0,Me=se[7],Me&192&&(pe.pts=(se[9]&14)<<27|(se[10]&255)<<20|(se[11]&254)<<12|(se[12]&255)<<5|(se[13]&254)>>>3,pe.pts*=4,pe.pts+=(se[13]&6)>>>1,pe.dts=pe.pts,Me&64&&(pe.dts=(se[14]&14)<<27|(se[15]&255)<<20|(se[16]&254)<<12|(se[17]&255)<<5|(se[18]&254)>>>3,pe.dts*=4,pe.dts+=(se[18]&6)>>>1)),pe.data=se.subarray(9+se[8]))},ne=function(se,pe,Me){var qe=new Uint8Array(se.size),Qe={type:pe},We=0,dt=0,Rt=!1,Bt;if(!(!se.data.length||se.size<9)){for(Qe.trackId=se.data[0].pid,We=0;We<se.data.length;We++)Bt=se.data[We],qe.set(Bt.data,dt),dt+=Bt.data.byteLength;Y(qe,Qe),Rt=pe==="video"||Qe.packetLength<=se.size,(Me||Rt)&&(se.size=0,se.data.length=0),Rt&&g.trigger("data",Qe)}};ta.prototype.init.call(this),this.push=function(ce){({pat:function(){},pes:function(){var pe,Me;switch(ce.streamType){case zt.H264_STREAM_TYPE:pe=P,Me="video";break;case zt.ADTS_STREAM_TYPE:pe=A,Me="audio";break;case zt.METADATA_STREAM_TYPE:pe=L,Me="timed-metadata";break;default:return}ce.payloadUnitStartIndicator&&ne(pe,Me,!0),pe.data.push(ce),pe.size+=ce.data.byteLength},pmt:function(){var pe={type:"metadata",tracks:[]};N=ce.programMapTable,N.video!==null&&pe.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+N.video,codec:"avc",type:"video"}),N.audio!==null&&pe.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+N.audio,codec:"adts",type:"audio"}),_=!0,g.trigger("data",pe)}})[ce.type]()},this.reset=function(){P.size=0,P.data.length=0,A.size=0,A.data.length=0,this.trigger("reset")},this.flushStreams_=function(){ne(P,"video"),ne(A,"audio"),ne(L,"timed-metadata")},this.flush=function(){if(!_&&N){var ce={type:"metadata",tracks:[]};N.video!==null&&ce.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+N.video,codec:"avc",type:"video"}),N.audio!==null&&ce.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+N.audio,codec:"adts",type:"audio"}),g.trigger("data",ce)}_=!1,this.flushStreams_(),this.trigger("done")}},ta.prototype=new r;var Ra={PAT_PID:0,MP2T_PACKET_LENGTH:Gr,TransportPacketStream:ma,TransportParseStream:Vr,ElementaryStream:ta,TimestampRolloverStream:xt,CaptionStream:Mr.CaptionStream,Cea608Stream:Mr.Cea608Stream,Cea708Stream:Mr.Cea708Stream,MetadataStream:Xi};for(var kr in zt)zt.hasOwnProperty(kr)&&(Ra[kr]=zt[kr]);var Pt=Ra,Yi=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],si=function(g,_){var P=g[_+6]<<21|g[_+7]<<14|g[_+8]<<7|g[_+9],A=g[_+5],L=(A&16)>>4;return P=P>=0?P:0,L?P+20:P+10},Qi=function j(g,_){return g.length-_<10||g[_]!=="I".charCodeAt(0)||g[_+1]!=="D".charCodeAt(0)||g[_+2]!=="3".charCodeAt(0)?_:(_+=si(g,_),j(g,_))},Ji=function(g){var _=Qi(g,0);return g.length>=_+2&&(g[_]&255)===255&&(g[_+1]&240)===240&&(g[_+1]&22)===16},oi=function(g){return g[0]<<21|g[1]<<14|g[2]<<7|g[3]},Zi=function(g,_,P){var A,L="";for(A=_;A<P;A++)L+="%"+("00"+g[A].toString(16)).slice(-2);return L},wr=function(g,_,P){return unescape(Zi(g,_,P))},li=function(g,_){var P=(g[_+5]&224)>>5,A=g[_+4]<<3,L=g[_+3]&3<<11;return L|A|P},en=function(g,_){return g[_]==="I".charCodeAt(0)&&g[_+1]==="D".charCodeAt(0)&&g[_+2]==="3".charCodeAt(0)?"timed-metadata":g[_]&!0&&(g[_+1]&240)===240?"audio":null},tn=function(g){for(var _=0;_+5<g.length;){if(g[_]!==255||(g[_+1]&246)!==240){_++;continue}return Yi[(g[_+2]&60)>>>2]}return null},La=function(g){var _,P,A,L;_=10,g[5]&64&&(_+=4,_+=oi(g.subarray(10,14)));do{if(P=oi(g.subarray(_+4,_+8)),P<1)return null;if(L=String.fromCharCode(g[_],g[_+1],g[_+2],g[_+3]),L==="PRIV"){A=g.subarray(_+10,_+P+10);for(var N=0;N<A.byteLength;N++)if(A[N]===0){var Y=wr(A,0,N);if(Y==="com.apple.streaming.transportStreamTimestamp"){var ne=A.subarray(N+1),ce=(ne[3]&1)<<30|ne[4]<<22|ne[5]<<14|ne[6]<<6|ne[7]>>>2;return ce*=4,ce+=ne[7]&3,ce}break}}_+=10,_+=P}while(_<g.byteLength);return null},Hr={isLikelyAacData:Ji,parseId3TagSize:si,parseAdtsSize:li,parseType:en,parseSampleRate:tn,parseAacTimestamp:La},va;va=function(){var g=new Uint8Array,_=0;va.prototype.init.call(this),this.setTimestamp=function(P){_=P},this.push=function(P){var A=0,L=0,N,Y,ne,ce;for(g.length?(ce=g.length,g=new Uint8Array(P.byteLength+ce),g.set(g.subarray(0,ce)),g.set(P,ce)):g=P;g.length-L>=3;){if(g[L]==="I".charCodeAt(0)&&g[L+1]==="D".charCodeAt(0)&&g[L+2]==="3".charCodeAt(0)){if(g.length-L<10||(A=Hr.parseId3TagSize(g,L),L+A>g.length))break;Y={type:"timed-metadata",data:g.subarray(L,L+A)},this.trigger("data",Y),L+=A;continue}else if((g[L]&255)===255&&(g[L+1]&240)===240){if(g.length-L<7||(A=Hr.parseAdtsSize(g,L),L+A>g.length))break;ne={type:"audio",data:g.subarray(L,L+A),pts:_,dts:_},this.trigger("data",ne),L+=A;continue}L++}N=g.length-L,N>0?g=g.subarray(L):g=new Uint8Array},this.reset=function(){g=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){g=new Uint8Array,this.trigger("endedtimeline")}},va.prototype=new r;var Dr=va,ui=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],ra=ui,_a=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Kr=_a,rn=H.H264Stream,di=Hr.isLikelyAacData,an=y.ONE_SECOND_IN_TS,Wr,Sr,Rr,Lr,hi=function(g,_){_.stream=g,this.trigger("log",_)},ci=function(g,_){for(var P=Object.keys(_),A=0;A<P.length;A++){var L=P[A];L==="headOfPipeline"||!_[L].on||_[L].on("log",hi.bind(g,L))}},Oa=function(g,_){var P;if(g.length!==_.length)return!1;for(P=0;P<g.length;P++)if(g[P]!==_[P])return!1;return!0},Ua=function(g,_,P,A,L,N){var Y=P-_,ne=A-_,ce=L-P;return{start:{dts:g,pts:g+Y},end:{dts:g+ne,pts:g+ce},prependedContentDuration:N,baseMediaDecodeTime:g}};Sr=function(g,_){var P=[],A,L=0,N=0,Y=1/0;_=_||{},A=_.firstSequenceNumber||0,Sr.prototype.init.call(this),this.push=function(ne){Gt.collectDtsInfo(g,ne),g&&ra.forEach(function(ce){g[ce]=ne[ce]}),P.push(ne)},this.setEarliestDts=function(ne){L=ne},this.setVideoBaseMediaDecodeTime=function(ne){Y=ne},this.setAudioAppendStart=function(ne){N=ne},this.flush=function(){var ne,ce,se,pe,Me,qe,Qe;if(P.length===0){this.trigger("done","AudioSegmentStream");return}ne=fr.trimAdtsFramesByEarliestDts(P,g,L),g.baseMediaDecodeTime=Gt.calculateTrackBaseMediaDecodeTime(g,_.keepOriginalTimestamps),Qe=fr.prefixWithSilence(g,ne,N,Y),g.samples=fr.generateSampleTable(ne),se=bt.mdat(fr.concatenateFrameData(ne)),P=[],ce=bt.moof(A,[g]),pe=new Uint8Array(ce.byteLength+se.byteLength),A++,pe.set(ce),pe.set(se,ce.byteLength),Gt.clearDtsInfo(g),Me=Math.ceil(an*1024/g.samplerate),ne.length&&(qe=ne.length*Me,this.trigger("segmentTimingInfo",Ua(y.audioTsToVideoTs(g.baseMediaDecodeTime,g.samplerate),ne[0].dts,ne[0].pts,ne[0].dts+qe,ne[0].pts+qe,Qe||0)),this.trigger("timingInfo",{start:ne[0].pts,end:ne[0].pts+qe})),this.trigger("data",{track:g,boxes:pe}),this.trigger("done","AudioSegmentStream")},this.reset=function(){Gt.clearDtsInfo(g),P=[],this.trigger("reset")}},Sr.prototype=new r,Wr=function(g,_){var P,A=[],L=[],N,Y;_=_||{},P=_.firstSequenceNumber||0,Wr.prototype.init.call(this),delete g.minPTS,this.gopCache_=[],this.push=function(ne){Gt.collectDtsInfo(g,ne),ne.nalUnitType==="seq_parameter_set_rbsp"&&!N&&(N=ne.config,g.sps=[ne.data],Kr.forEach(function(ce){g[ce]=N[ce]},this)),ne.nalUnitType==="pic_parameter_set_rbsp"&&!Y&&(Y=ne.data,g.pps=[ne.data]),A.push(ne)},this.flush=function(){for(var ne,ce,se,pe,Me,qe,Qe=0,We,dt;A.length&&A[0].nalUnitType!=="access_unit_delimiter_rbsp";)A.shift();if(A.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(ne=Wt.groupNalsIntoFrames(A),se=Wt.groupFramesIntoGops(ne),se[0][0].keyFrame||(ce=this.getGopForFusion_(A[0],g),ce?(Qe=ce.duration,se.unshift(ce),se.byteLength+=ce.byteLength,se.nalCount+=ce.nalCount,se.pts=ce.pts,se.dts=ce.dts,se.duration+=ce.duration):se=Wt.extendFirstKeyFrame(se)),L.length){var Rt;if(_.alignGopsAtEnd?Rt=this.alignGopsAtEnd_(se):Rt=this.alignGopsAtStart_(se),!Rt){this.gopCache_.unshift({gop:se.pop(),pps:g.pps,sps:g.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),A=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}Gt.clearDtsInfo(g),se=Rt}Gt.collectDtsInfo(g,se),g.samples=Wt.generateSampleTable(se),Me=bt.mdat(Wt.concatenateNalData(se)),g.baseMediaDecodeTime=Gt.calculateTrackBaseMediaDecodeTime(g,_.keepOriginalTimestamps),this.trigger("processedGopsInfo",se.map(function(Bt){return{pts:Bt.pts,dts:Bt.dts,byteLength:Bt.byteLength}})),We=se[0],dt=se[se.length-1],this.trigger("segmentTimingInfo",Ua(g.baseMediaDecodeTime,We.dts,We.pts,dt.dts+dt.duration,dt.pts+dt.duration,Qe)),this.trigger("timingInfo",{start:se[0].pts,end:se[se.length-1].pts+se[se.length-1].duration}),this.gopCache_.unshift({gop:se.pop(),pps:g.pps,sps:g.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),A=[],this.trigger("baseMediaDecodeTime",g.baseMediaDecodeTime),this.trigger("timelineStartInfo",g.timelineStartInfo),pe=bt.moof(P,[g]),qe=new Uint8Array(pe.byteLength+Me.byteLength),P++,qe.set(pe),qe.set(Me,pe.byteLength),this.trigger("data",{track:g,boxes:qe}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),A=[],this.gopCache_.length=0,L.length=0,this.trigger("reset")},this.resetStream_=function(){Gt.clearDtsInfo(g),N=void 0,Y=void 0},this.getGopForFusion_=function(ne){var ce=45e3,se=1e4,pe=1/0,Me,qe,Qe,We,dt;for(dt=0;dt<this.gopCache_.length;dt++)We=this.gopCache_[dt],Qe=We.gop,!(!(g.pps&&Oa(g.pps[0],We.pps[0]))||!(g.sps&&Oa(g.sps[0],We.sps[0])))&&(Qe.dts<g.timelineStartInfo.dts||(Me=ne.dts-Qe.dts-Qe.duration,Me>=-se&&Me<=ce&&(!qe||pe>Me)&&(qe=We,pe=Me)));return qe?qe.gop:null},this.alignGopsAtStart_=function(ne){var ce,se,pe,Me,qe,Qe,We,dt;for(qe=ne.byteLength,Qe=ne.nalCount,We=ne.duration,ce=se=0;ce<L.length&&se<ne.length&&(pe=L[ce],Me=ne[se],pe.pts!==Me.pts);){if(Me.pts>pe.pts){ce++;continue}se++,qe-=Me.byteLength,Qe-=Me.nalCount,We-=Me.duration}return se===0?ne:se===ne.length?null:(dt=ne.slice(se),dt.byteLength=qe,dt.duration=We,dt.nalCount=Qe,dt.pts=dt[0].pts,dt.dts=dt[0].dts,dt)},this.alignGopsAtEnd_=function(ne){var ce,se,pe,Me,qe,Qe;for(ce=L.length-1,se=ne.length-1,qe=null,Qe=!1;ce>=0&&se>=0;){if(pe=L[ce],Me=ne[se],pe.pts===Me.pts){Qe=!0;break}if(pe.pts>Me.pts){ce--;continue}ce===L.length-1&&(qe=se),se--}if(!Qe&&qe===null)return null;var We;if(Qe?We=se:We=qe,We===0)return ne;var dt=ne.slice(We),Rt=dt.reduce(function(Bt,xr){return Bt.byteLength+=xr.byteLength,Bt.duration+=xr.duration,Bt.nalCount+=xr.nalCount,Bt},{byteLength:0,duration:0,nalCount:0});return dt.byteLength=Rt.byteLength,dt.duration=Rt.duration,dt.nalCount=Rt.nalCount,dt.pts=dt[0].pts,dt.dts=dt[0].dts,dt},this.alignGopsWith=function(ne){L=ne}},Wr.prototype=new r,Lr=function(g,_){this.numberOfTracks=0,this.metadataStream=_,g=g||{},typeof g.remux<"u"?this.remuxTracks=!!g.remux:this.remuxTracks=!0,typeof g.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=g.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Lr.prototype.init.call(this),this.push=function(P){if(P.text)return this.pendingCaptions.push(P);if(P.frames)return this.pendingMetadata.push(P);this.pendingTracks.push(P.track),this.pendingBytes+=P.boxes.byteLength,P.track.type==="video"&&(this.videoTrack=P.track,this.pendingBoxes.push(P.boxes)),P.track.type==="audio"&&(this.audioTrack=P.track,this.pendingBoxes.unshift(P.boxes))}},Lr.prototype=new r,Lr.prototype.flush=function(j){var g=0,_={captions:[],captionStreams:{},metadata:[],info:{}},P,A,L,N=0,Y;if(this.pendingTracks.length<this.numberOfTracks){if(j!=="VideoSegmentStream"&&j!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(N=this.videoTrack.timelineStartInfo.pts,Kr.forEach(function(ne){_.info[ne]=this.videoTrack[ne]},this)):this.audioTrack&&(N=this.audioTrack.timelineStartInfo.pts,ra.forEach(function(ne){_.info[ne]=this.audioTrack[ne]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?_.type=this.pendingTracks[0].type:_.type="combined",this.emittedTracks+=this.pendingTracks.length,L=bt.initSegment(this.pendingTracks),_.initSegment=new Uint8Array(L.byteLength),_.initSegment.set(L),_.data=new Uint8Array(this.pendingBytes),Y=0;Y<this.pendingBoxes.length;Y++)_.data.set(this.pendingBoxes[Y],g),g+=this.pendingBoxes[Y].byteLength;for(Y=0;Y<this.pendingCaptions.length;Y++)P=this.pendingCaptions[Y],P.startTime=y.metadataTsToSeconds(P.startPts,N,this.keepOriginalTimestamps),P.endTime=y.metadataTsToSeconds(P.endPts,N,this.keepOriginalTimestamps),_.captionStreams[P.stream]=!0,_.captions.push(P);for(Y=0;Y<this.pendingMetadata.length;Y++)A=this.pendingMetadata[Y],A.cueTime=y.metadataTsToSeconds(A.pts,N,this.keepOriginalTimestamps),_.metadata.push(A);for(_.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",_),Y=0;Y<_.captions.length;Y++)P=_.captions[Y],this.trigger("caption",P);for(Y=0;Y<_.metadata.length;Y++)A=_.metadata[Y],this.trigger("id3Frame",A)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},Lr.prototype.setRemux=function(j){this.remuxTracks=j},Rr=function(g){var _=this,P=!0,A,L;Rr.prototype.init.call(this),g=g||{},this.baseMediaDecodeTime=g.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var N={};this.transmuxPipeline_=N,N.type="aac",N.metadataStream=new Pt.MetadataStream,N.aacStream=new Dr,N.audioTimestampRolloverStream=new Pt.TimestampRolloverStream("audio"),N.timedMetadataTimestampRolloverStream=new Pt.TimestampRolloverStream("timed-metadata"),N.adtsStream=new F,N.coalesceStream=new Lr(g,N.metadataStream),N.headOfPipeline=N.aacStream,N.aacStream.pipe(N.audioTimestampRolloverStream).pipe(N.adtsStream),N.aacStream.pipe(N.timedMetadataTimestampRolloverStream).pipe(N.metadataStream).pipe(N.coalesceStream),N.metadataStream.on("timestamp",function(Y){N.aacStream.setTimestamp(Y.timeStamp)}),N.aacStream.on("data",function(Y){Y.type!=="timed-metadata"&&Y.type!=="audio"||N.audioSegmentStream||(L=L||{timelineStartInfo:{baseMediaDecodeTime:_.baseMediaDecodeTime},codec:"adts",type:"audio"},N.coalesceStream.numberOfTracks++,N.audioSegmentStream=new Sr(L,g),N.audioSegmentStream.on("log",_.getLogTrigger_("audioSegmentStream")),N.audioSegmentStream.on("timingInfo",_.trigger.bind(_,"audioTimingInfo")),N.adtsStream.pipe(N.audioSegmentStream).pipe(N.coalesceStream),_.trigger("trackinfo",{hasAudio:!!L,hasVideo:!!A}))}),N.coalesceStream.on("data",this.trigger.bind(this,"data")),N.coalesceStream.on("done",this.trigger.bind(this,"done")),ci(this,N)},this.setupTsPipeline=function(){var N={};this.transmuxPipeline_=N,N.type="ts",N.metadataStream=new Pt.MetadataStream,N.packetStream=new Pt.TransportPacketStream,N.parseStream=new Pt.TransportParseStream,N.elementaryStream=new Pt.ElementaryStream,N.timestampRolloverStream=new Pt.TimestampRolloverStream,N.adtsStream=new F,N.h264Stream=new rn,N.captionStream=new Pt.CaptionStream(g),N.coalesceStream=new Lr(g,N.metadataStream),N.headOfPipeline=N.packetStream,N.packetStream.pipe(N.parseStream).pipe(N.elementaryStream).pipe(N.timestampRolloverStream),N.timestampRolloverStream.pipe(N.h264Stream),N.timestampRolloverStream.pipe(N.adtsStream),N.timestampRolloverStream.pipe(N.metadataStream).pipe(N.coalesceStream),N.h264Stream.pipe(N.captionStream).pipe(N.coalesceStream),N.elementaryStream.on("data",function(Y){var ne;if(Y.type==="metadata"){for(ne=Y.tracks.length;ne--;)!A&&Y.tracks[ne].type==="video"?(A=Y.tracks[ne],A.timelineStartInfo.baseMediaDecodeTime=_.baseMediaDecodeTime):!L&&Y.tracks[ne].type==="audio"&&(L=Y.tracks[ne],L.timelineStartInfo.baseMediaDecodeTime=_.baseMediaDecodeTime);A&&!N.videoSegmentStream&&(N.coalesceStream.numberOfTracks++,N.videoSegmentStream=new Wr(A,g),N.videoSegmentStream.on("log",_.getLogTrigger_("videoSegmentStream")),N.videoSegmentStream.on("timelineStartInfo",function(ce){L&&!g.keepOriginalTimestamps&&(L.timelineStartInfo=ce,N.audioSegmentStream.setEarliestDts(ce.dts-_.baseMediaDecodeTime))}),N.videoSegmentStream.on("processedGopsInfo",_.trigger.bind(_,"gopInfo")),N.videoSegmentStream.on("segmentTimingInfo",_.trigger.bind(_,"videoSegmentTimingInfo")),N.videoSegmentStream.on("baseMediaDecodeTime",function(ce){L&&N.audioSegmentStream.setVideoBaseMediaDecodeTime(ce)}),N.videoSegmentStream.on("timingInfo",_.trigger.bind(_,"videoTimingInfo")),N.h264Stream.pipe(N.videoSegmentStream).pipe(N.coalesceStream)),L&&!N.audioSegmentStream&&(N.coalesceStream.numberOfTracks++,N.audioSegmentStream=new Sr(L,g),N.audioSegmentStream.on("log",_.getLogTrigger_("audioSegmentStream")),N.audioSegmentStream.on("timingInfo",_.trigger.bind(_,"audioTimingInfo")),N.audioSegmentStream.on("segmentTimingInfo",_.trigger.bind(_,"audioSegmentTimingInfo")),N.adtsStream.pipe(N.audioSegmentStream).pipe(N.coalesceStream)),_.trigger("trackinfo",{hasAudio:!!L,hasVideo:!!A})}}),N.coalesceStream.on("data",this.trigger.bind(this,"data")),N.coalesceStream.on("id3Frame",function(Y){Y.dispatchType=N.metadataStream.dispatchType,_.trigger("id3Frame",Y)}),N.coalesceStream.on("caption",this.trigger.bind(this,"caption")),N.coalesceStream.on("done",this.trigger.bind(this,"done")),ci(this,N)},this.setBaseMediaDecodeTime=function(N){var Y=this.transmuxPipeline_;g.keepOriginalTimestamps||(this.baseMediaDecodeTime=N),L&&(L.timelineStartInfo.dts=void 0,L.timelineStartInfo.pts=void 0,Gt.clearDtsInfo(L),Y.audioTimestampRolloverStream&&Y.audioTimestampRolloverStream.discontinuity()),A&&(Y.videoSegmentStream&&(Y.videoSegmentStream.gopCache_=[]),A.timelineStartInfo.dts=void 0,A.timelineStartInfo.pts=void 0,Gt.clearDtsInfo(A),Y.captionStream.reset()),Y.timestampRolloverStream&&Y.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(N){L&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(N)},this.setRemux=function(N){var Y=this.transmuxPipeline_;g.remux=N,Y&&Y.coalesceStream&&Y.coalesceStream.setRemux(N)},this.alignGopsWith=function(N){A&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(N)},this.getLogTrigger_=function(N){var Y=this;return function(ne){ne.stream=N,Y.trigger("log",ne)}},this.push=function(N){if(P){var Y=di(N);Y&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!Y&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),P=!1}this.transmuxPipeline_.headOfPipeline.push(N)},this.flush=function(){P=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},Rr.prototype=new r;var Na={Transmuxer:Rr,VideoSegmentStream:Wr,AudioSegmentStream:Sr,AUDIO_PROPERTIES:ra,VIDEO_PROPERTIES:Kr,generateSegmentTimingInfo:Ua},Fa=$r.discardEmulationPreventionBytes,Ba=Mr.CaptionStream,$a=function(g,_){for(var P=g,A=0;A<_.length;A++){var L=_[A];if(P<L.size)return L;P-=L.size}return null},ja=function(g,_,P){var A=new DataView(g.buffer,g.byteOffset,g.byteLength),L={logs:[],seiNals:[]},N,Y,ne,ce;for(Y=0;Y+4<g.length;Y+=ne)if(ne=A.getUint32(Y),Y+=4,!(ne<=0))switch(g[Y]&31){case 6:var se=g.subarray(Y+1,Y+1+ne),pe=$a(Y,_);if(N={nalUnitType:"sei_rbsp",size:ne,data:se,escapedRBSP:Fa(se),trackId:P},pe)N.pts=pe.pts,N.dts=pe.dts,ce=pe;else if(ce)N.pts=ce.pts,N.dts=ce.dts;else{L.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+Y+" for trackId "+P+". See mux.js#223."});break}L.seiNals.push(N);break}return L},Va=function(g,_,P){var A=_,L=P.defaultSampleDuration||0,N=P.defaultSampleSize||0,Y=P.trackId,ne=[];return g.forEach(function(ce){var se=$e(ce),pe=se.samples;pe.forEach(function(Me){Me.duration===void 0&&(Me.duration=L),Me.size===void 0&&(Me.size=N),Me.trackId=Y,Me.dts=A,Me.compositionTimeOffset===void 0&&(Me.compositionTimeOffset=0),Me.pts=A+Me.compositionTimeOffset,A+=Me.duration}),ne=ne.concat(pe)}),ne},pi=function(g,_){var P=Z(g,["moof","traf"]),A=Z(g,["mdat"]),L={},N=[];return A.forEach(function(Y,ne){var ce=P[ne];N.push({mdat:Y,traf:ce})}),N.forEach(function(Y){var ne=Y.mdat,ce=Y.traf,se=Z(ce,["tfhd"]),pe=ge(se[0]),Me=pe.trackId,qe=Z(ce,["tfdt"]),Qe=qe.length>0?Ze(qe[0]).baseMediaDecodeTime:0,We=Z(ce,["trun"]),dt,Rt;_===Me&&We.length>0&&(dt=Va(We,Qe,pe),Rt=ja(ne,dt,Me),L[Me]||(L[Me]={seiNals:[],logs:[]}),L[Me].seiNals=L[Me].seiNals.concat(Rt.seiNals),L[Me].logs=L[Me].logs.concat(Rt.logs))}),L},fi=function(g,_,P){var A;if(_===null)return null;A=pi(g,_);var L=A[_]||{};return{seiNals:L.seiNals,logs:L.logs,timescale:P}},nn=function(){var g=!1,_,P,A,L,N,Y;this.isInitialized=function(){return g},this.init=function(ne){_=new Ba,g=!0,Y=ne?ne.isPartial:!1,_.on("data",function(ce){ce.startTime=ce.startPts/L,ce.endTime=ce.endPts/L,N.captions.push(ce),N.captionStreams[ce.stream]=!0}),_.on("log",function(ce){N.logs.push(ce)})},this.isNewInit=function(ne,ce){return ne&&ne.length===0||ce&&typeof ce=="object"&&Object.keys(ce).length===0?!1:A!==ne[0]||L!==ce[A]},this.parse=function(ne,ce,se){var pe;if(this.isInitialized()){if(!ce||!se)return null;if(this.isNewInit(ce,se))A=ce[0],L=se[A];else if(A===null||!L)return P.push(ne),null}else return null;for(;P.length>0;){var Me=P.shift();this.parse(Me,ce,se)}return pe=fi(ne,A,L),pe&&pe.logs&&(N.logs=N.logs.concat(pe.logs)),pe===null||!pe.seiNals?N.logs.length?{logs:N.logs,captions:[],captionStreams:[]}:null:(this.pushNals(pe.seiNals),this.flushStream(),N)},this.pushNals=function(ne){if(!this.isInitialized()||!ne||ne.length===0)return null;ne.forEach(function(ce){_.push(ce)})},this.flushStream=function(){if(!this.isInitialized())return null;Y?_.partialFlush():_.flush()},this.clearParsedCaptions=function(){N.captions=[],N.captionStreams={},N.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;_.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){P=[],A=null,L=null,N?this.clearParsedCaptions():N={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},gi=nn,Ga={generator:bt,probe:Vt,Transmuxer:Na.Transmuxer,AudioSegmentStream:Na.AudioSegmentStream,VideoSegmentStream:Na.VideoSegmentStream,CaptionParser:gi},wt;wt=function(g,_){var P=0,A=16384,L=function(pe,Me){var qe,Qe=pe.position+Me;Qe<pe.bytes.byteLength||(qe=new Uint8Array(Qe*2),qe.set(pe.bytes.subarray(0,pe.position),0),pe.bytes=qe,pe.view=new DataView(pe.bytes.buffer))},N=wt.widthBytes||new Uint8Array(5),Y=wt.heightBytes||new Uint8Array(6),ne=wt.videocodecidBytes||new Uint8Array(12),ce;if(!wt.widthBytes){for(ce=0;ce<5;ce++)N[ce]="width".charCodeAt(ce);for(ce=0;ce<6;ce++)Y[ce]="height".charCodeAt(ce);for(ce=0;ce<12;ce++)ne[ce]="videocodecid".charCodeAt(ce);wt.widthBytes=N,wt.heightBytes=Y,wt.videocodecidBytes=ne}switch(this.keyFrame=!1,g){case wt.VIDEO_TAG:this.length=16,A*=6;break;case wt.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case wt.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(A),this.view=new DataView(this.bytes.buffer),this.bytes[0]=g,this.position=this.length,this.keyFrame=_,this.pts=0,this.dts=0,this.writeBytes=function(se,pe,Me){var qe=pe||0,Qe;Me=Me||se.byteLength,Qe=qe+Me,L(this,Me),this.bytes.set(se.subarray(qe,Qe),this.position),this.position+=Me,this.length=Math.max(this.length,this.position)},this.writeByte=function(se){L(this,1),this.bytes[this.position]=se,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(se){L(this,2),this.view.setUint16(this.position,se),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(se){return this.bytes[this.length-se]},this.nalUnitSize=function(){return P===0?0:this.length-(P+4)},this.startNalUnit=function(){if(P>0)throw new Error("Attempted to create new NAL wihout closing the old one");P=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(se){var pe,Me;this.length===P+4?this.length-=4:P>0&&(pe=P+4,Me=this.length-pe,this.position=P,this.view.setUint32(this.position,Me),this.position=this.length,se&&se.push(this.bytes.subarray(pe,pe+Me))),P=0},this.writeMetaDataDouble=function(se,pe){var Me;if(L(this,2+se.length+9),this.view.setUint16(this.position,se.length),this.position+=2,se==="width")this.bytes.set(N,this.position),this.position+=5;else if(se==="height")this.bytes.set(Y,this.position),this.position+=6;else if(se==="videocodecid")this.bytes.set(ne,this.position),this.position+=12;else for(Me=0;Me<se.length;Me++)this.bytes[this.position]=se.charCodeAt(Me),this.position++;this.position++,this.view.setFloat64(this.position,pe),this.position+=8,this.length=Math.max(this.length,this.position),++P},this.writeMetaDataBoolean=function(se,pe){var Me;for(L(this,2),this.view.setUint16(this.position,se.length),this.position+=2,Me=0;Me<se.length;Me++)L(this,1),this.bytes[this.position]=se.charCodeAt(Me),this.position++;L(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,pe?1:0),this.position++,this.length=Math.max(this.length,this.position),++P},this.finalize=function(){var se,pe;switch(this.bytes[0]){case wt.VIDEO_TAG:this.bytes[11]=(this.keyFrame||_?16:32)|7,this.bytes[12]=_?0:1,se=this.pts-this.dts,this.bytes[13]=(se&16711680)>>>16,this.bytes[14]=(se&65280)>>>8,this.bytes[15]=(se&255)>>>0;break;case wt.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=_?0:1;break;case wt.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,P),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position;break}return pe=this.length-11,this.bytes[1]=(pe&16711680)>>>16,this.bytes[2]=(pe&65280)>>>8,this.bytes[3]=(pe&255)>>>0,this.bytes[4]=(this.dts&16711680)>>>16,this.bytes[5]=(this.dts&65280)>>>8,this.bytes[6]=(this.dts&255)>>>0,this.bytes[7]=(this.dts&4278190080)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,L(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=wt.frameTime(this.bytes),this}},wt.AUDIO_TAG=8,wt.VIDEO_TAG=9,wt.METADATA_TAG=18,wt.isAudioFrame=function(j){return wt.AUDIO_TAG===j[0]},wt.isVideoFrame=function(j){return wt.VIDEO_TAG===j[0]},wt.isMetaData=function(j){return wt.METADATA_TAG===j[0]},wt.isKeyFrame=function(j){return wt.isVideoFrame(j)?j[11]===23:!!(wt.isAudioFrame(j)||wt.isMetaData(j))},wt.frameTime=function(j){var g=j[4]<<16;return g|=j[5]<<8,g|=j[6]<<0,g|=j[7]<<24,g};var ar=wt,aa=function j(g){this.numberOfTracks=0,this.metadataStream=g.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,j.prototype.init.call(this),this.push=function(_){if(_.text)return this.pendingCaptions.push(_);if(_.frames)return this.pendingMetadata.push(_);_.track.type==="video"&&(this.videoTrack=_.track,this.videoTags=_.tags,this.pendingTracks++),_.track.type==="audio"&&(this.audioTrack=_.track,this.audioTags=_.tags,this.pendingTracks++)}};aa.prototype=new r,aa.prototype.flush=function(j){var g,_,P,A,L={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(j!=="VideoSegmentStream"&&j!=="AudioSegmentStream")return;if(this.pendingTracks===0&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?A=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(A=this.audioTrack.timelineStartInfo.pts),L.tags.videoTags=this.videoTags,L.tags.audioTags=this.audioTags,P=0;P<this.pendingCaptions.length;P++)_=this.pendingCaptions[P],_.startTime=_.startPts-A,_.startTime/=9e4,_.endTime=_.endPts-A,_.endTime/=9e4,L.captionStreams[_.stream]=!0,L.captions.push(_);for(P=0;P<this.pendingMetadata.length;P++)g=this.pendingMetadata[P],g.cueTime=g.pts-A,g.cueTime/=9e4,L.metadata.push(g);L.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",L),this.trigger("done")}};var mi=aa,Ha=function(){var g=this;this.list=[],this.push=function(_){this.list.push({bytes:_.bytes,dts:_.dts,pts:_.pts,keyFrame:_.keyFrame,metaDataTag:_.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return g.list.length}})},yi=Ha,sn=H.H264Stream,ka,Ea,Sa,Tr,vi,_i;Tr=function(g,_){typeof _.pts=="number"&&(g.timelineStartInfo.pts===void 0?g.timelineStartInfo.pts=_.pts:g.timelineStartInfo.pts=Math.min(g.timelineStartInfo.pts,_.pts)),typeof _.dts=="number"&&(g.timelineStartInfo.dts===void 0?g.timelineStartInfo.dts=_.dts:g.timelineStartInfo.dts=Math.min(g.timelineStartInfo.dts,_.dts))},vi=function(g,_){var P=new ar(ar.METADATA_TAG);return P.dts=_,P.pts=_,P.writeMetaDataDouble("videocodecid",7),P.writeMetaDataDouble("width",g.width),P.writeMetaDataDouble("height",g.height),P},_i=function(g,_){var P,A=new ar(ar.VIDEO_TAG,!0);for(A.dts=_,A.pts=_,A.writeByte(1),A.writeByte(g.profileIdc),A.writeByte(g.profileCompatibility),A.writeByte(g.levelIdc),A.writeByte(255),A.writeByte(225),A.writeShort(g.sps[0].length),A.writeBytes(g.sps[0]),A.writeByte(g.pps.length),P=0;P<g.pps.length;++P)A.writeShort(g.pps[P].length),A.writeBytes(g.pps[P]);return A},Sa=function(g){var _=[],P=[],A;Sa.prototype.init.call(this),this.push=function(L){Tr(g,L),g&&(g.audioobjecttype=L.audioobjecttype,g.channelcount=L.channelcount,g.samplerate=L.samplerate,g.samplingfrequencyindex=L.samplingfrequencyindex,g.samplesize=L.samplesize,g.extraData=g.audioobjecttype<<11|g.samplingfrequencyindex<<7|g.channelcount<<3),L.pts=Math.round(L.pts/90),L.dts=Math.round(L.dts/90),_.push(L)},this.flush=function(){var L,N,Y,ne=new yi;if(_.length===0){this.trigger("done","AudioSegmentStream");return}for(Y=-1/0;_.length;)L=_.shift(),P.length&&L.pts>=P[0]&&(Y=P.shift(),this.writeMetaDataTags(ne,Y)),(g.extraData!==A||L.pts-Y>=1e3)&&(this.writeMetaDataTags(ne,L.pts),A=g.extraData,Y=L.pts),N=new ar(ar.AUDIO_TAG),N.pts=L.pts,N.dts=L.dts,N.writeBytes(L.data),ne.push(N.finalize());P.length=0,A=null,this.trigger("data",{track:g,tags:ne.list}),this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(L,N){var Y;Y=new ar(ar.METADATA_TAG),Y.pts=N,Y.dts=N,Y.writeMetaDataDouble("audiocodecid",10),Y.writeMetaDataBoolean("stereo",g.channelcount===2),Y.writeMetaDataDouble("audiosamplerate",g.samplerate),Y.writeMetaDataDouble("audiosamplesize",16),L.push(Y.finalize()),Y=new ar(ar.AUDIO_TAG,!0),Y.pts=N,Y.dts=N,Y.view.setUint16(Y.position,g.extraData),Y.position+=2,Y.length=Math.max(Y.length,Y.position),L.push(Y.finalize())},this.onVideoKeyFrame=function(L){P.push(L)}},Sa.prototype=new r,Ea=function(g){var _=[],P,A;Ea.prototype.init.call(this),this.finishFrame=function(L,N){if(N){if(P&&g&&g.newMetadata&&(N.keyFrame||L.length===0)){var Y=vi(P,N.dts).finalize(),ne=_i(g,N.dts).finalize();Y.metaDataTag=ne.metaDataTag=!0,L.push(Y),L.push(ne),g.newMetadata=!1,this.trigger("keyframe",N.dts)}N.endNalUnit(),L.push(N.finalize()),A=null}},this.push=function(L){Tr(g,L),L.pts=Math.round(L.pts/90),L.dts=Math.round(L.dts/90),_.push(L)},this.flush=function(){for(var L,N=new yi;_.length&&_[0].nalUnitType!=="access_unit_delimiter_rbsp";)_.shift();if(_.length===0){this.trigger("done","VideoSegmentStream");return}for(;_.length;)L=_.shift(),L.nalUnitType==="seq_parameter_set_rbsp"?(g.newMetadata=!0,P=L.config,g.width=P.width,g.height=P.height,g.sps=[L.data],g.profileIdc=P.profileIdc,g.levelIdc=P.levelIdc,g.profileCompatibility=P.profileCompatibility,A.endNalUnit()):L.nalUnitType==="pic_parameter_set_rbsp"?(g.newMetadata=!0,g.pps=[L.data],A.endNalUnit()):L.nalUnitType==="access_unit_delimiter_rbsp"?(A&&this.finishFrame(N,A),A=new ar(ar.VIDEO_TAG),A.pts=L.pts,A.dts=L.dts):(L.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(A.keyFrame=!0),A.endNalUnit()),A.startNalUnit(),A.writeBytes(L.data);A&&this.finishFrame(N,A),this.trigger("data",{track:g,tags:N.list}),this.trigger("done","VideoSegmentStream")}},Ea.prototype=new r,ka=function(g){var _=this,P,A,L,N,Y,ne,ce,se,pe,Me,qe,Qe;ka.prototype.init.call(this),g=g||{},this.metadataStream=new Pt.MetadataStream,g.metadataStream=this.metadataStream,P=new Pt.TransportPacketStream,A=new Pt.TransportParseStream,L=new Pt.ElementaryStream,N=new Pt.TimestampRolloverStream("video"),Y=new Pt.TimestampRolloverStream("audio"),ne=new Pt.TimestampRolloverStream("timed-metadata"),ce=new F,se=new sn,Qe=new mi(g),P.pipe(A).pipe(L),L.pipe(N).pipe(se),L.pipe(Y).pipe(ce),L.pipe(ne).pipe(this.metadataStream).pipe(Qe),qe=new Pt.CaptionStream(g),se.pipe(qe).pipe(Qe),L.on("data",function(We){var dt,Rt,Bt;if(We.type==="metadata"){for(dt=We.tracks.length;dt--;)We.tracks[dt].type==="video"?Rt=We.tracks[dt]:We.tracks[dt].type==="audio"&&(Bt=We.tracks[dt]);Rt&&!pe&&(Qe.numberOfTracks++,pe=new Ea(Rt),se.pipe(pe).pipe(Qe)),Bt&&!Me&&(Qe.numberOfTracks++,Me=new Sa(Bt),ce.pipe(Me).pipe(Qe),pe&&pe.on("keyframe",Me.onVideoKeyFrame))}}),this.push=function(We){P.push(We)},this.flush=function(){P.flush()},this.resetCaptions=function(){qe.reset()},Qe.on("data",function(We){_.trigger("data",We)}),Qe.on("done",function(){_.trigger("done")})},ka.prototype=new r;var on=ka,ir=function(g,_,P){var A=new Uint8Array(9),L=new DataView(A.buffer),N,Y,ne;return g=g||0,_=_===void 0?!0:_,P=P===void 0?!0:P,L.setUint8(0,70),L.setUint8(1,76),L.setUint8(2,86),L.setUint8(3,1),L.setUint8(4,(_?4:0)|(P?1:0)),L.setUint32(5,A.byteLength),g<=0?(Y=new Uint8Array(A.byteLength+4),Y.set(A),Y.set([0,0,0,0],A.byteLength),Y):(N=new ar(ar.METADATA_TAG),N.pts=N.dts=0,N.writeMetaDataDouble("duration",g),ne=N.finalize().length,Y=new Uint8Array(A.byteLength+ne),Y.set(A),Y.set(L.byteLength,ne),Y)},Ka=ir,ki={tag:ar,Transmuxer:on,getFlvHeader:Ka},Ei=Pt,Si=y.ONE_SECOND_IN_TS,Wa=function j(g,_){var P=[],A=0,L=0,N=0,Y=1/0,ne=null,ce=null;_=_||{},j.prototype.init.call(this),this.push=function(se){Gt.collectDtsInfo(g,se),g&&ra.forEach(function(pe){g[pe]=se[pe]}),P.push(se)},this.setEarliestDts=function(se){L=se},this.setVideoBaseMediaDecodeTime=function(se){Y=se},this.setAudioAppendStart=function(se){N=se},this.processFrames_=function(){var se,pe,Me,qe,Qe;P.length!==0&&(se=fr.trimAdtsFramesByEarliestDts(P,g,L),se.length!==0&&(g.baseMediaDecodeTime=Gt.calculateTrackBaseMediaDecodeTime(g,_.keepOriginalTimestamps),fr.prefixWithSilence(g,se,N,Y),g.samples=fr.generateSampleTable(se),Me=bt.mdat(fr.concatenateFrameData(se)),P=[],pe=bt.moof(A,[g]),A++,g.initSegment=bt.initSegment([g]),qe=new Uint8Array(pe.byteLength+Me.byteLength),qe.set(pe),qe.set(Me,pe.byteLength),Gt.clearDtsInfo(g),ne===null&&(ce=ne=se[0].pts),ce+=se.length*(Si*1024/g.samplerate),Qe={start:ne},this.trigger("timingInfo",Qe),this.trigger("data",{track:g,boxes:qe})))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:ne,end:ce}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){Gt.clearDtsInfo(g),ne=null,ce=null},this.reset=function(){this.resetTiming_(),P=[],this.trigger("reset")}};Wa.prototype=new r;var qa=Wa,ia=function j(g,_){var P=0,A=[],L=[],N,Y,ne=null,ce=null,se,pe=!0;_=_||{},j.prototype.init.call(this),this.push=function(Me){Gt.collectDtsInfo(g,Me),typeof g.timelineStartInfo.dts>"u"&&(g.timelineStartInfo.dts=Me.dts),Me.nalUnitType==="seq_parameter_set_rbsp"&&!N&&(N=Me.config,g.sps=[Me.data],Kr.forEach(function(qe){g[qe]=N[qe]},this)),Me.nalUnitType==="pic_parameter_set_rbsp"&&!Y&&(Y=Me.data,g.pps=[Me.data]),A.push(Me)},this.processNals_=function(Me){var qe;for(A=L.concat(A);A.length&&A[0].nalUnitType!=="access_unit_delimiter_rbsp";)A.shift();if(A.length!==0){var Qe=Wt.groupNalsIntoFrames(A);if(Qe.length){if(L=Qe[Qe.length-1],Me&&(Qe.pop(),Qe.duration-=L.duration,Qe.nalCount-=L.length,Qe.byteLength-=L.byteLength),!Qe.length){A=[];return}if(this.trigger("timelineStartInfo",g.timelineStartInfo),pe){if(se=Wt.groupFramesIntoGops(Qe),!se[0][0].keyFrame){if(se=Wt.extendFirstKeyFrame(se),!se[0][0].keyFrame){A=[].concat.apply([],Qe).concat(L),L=[];return}Qe=[].concat.apply([],se),Qe.duration=se.duration}pe=!1}for(ne===null&&(ne=Qe[0].pts,ce=ne),ce+=Qe.duration,this.trigger("timingInfo",{start:ne,end:ce}),qe=0;qe<Qe.length;qe++){var We=Qe[qe];g.samples=Wt.generateSampleTableForFrame(We);var dt=bt.mdat(Wt.concatenateNalDataForFrame(We));Gt.clearDtsInfo(g),Gt.collectDtsInfo(g,We),g.baseMediaDecodeTime=Gt.calculateTrackBaseMediaDecodeTime(g,_.keepOriginalTimestamps);var Rt=bt.moof(P,[g]);P++,g.initSegment=bt.initSegment([g]);var Bt=new Uint8Array(Rt.byteLength+dt.byteLength);Bt.set(Rt),Bt.set(dt,Rt.byteLength),this.trigger("data",{track:g,boxes:Bt,sequence:P,videoFrameDts:We.dts,videoFramePts:We.pts})}A=[]}}},this.resetTimingAndConfig_=function(){N=void 0,Y=void 0,ne=null,ce=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),L=[],A=[],pe=!0,this.trigger("reset")}};ia.prototype=new r;var ln=ia,Ti=Hr.isLikelyAacData,xi=function(g){return g.prototype=new r,g.prototype.init.call(g),g},Ci=function(g){var _={type:"ts",tracks:{audio:null,video:null},packet:new Pt.TransportPacketStream,parse:new Pt.TransportParseStream,elementary:new Pt.ElementaryStream,timestampRollover:new Pt.TimestampRolloverStream,adts:new te.Adts,h264:new te.h264.H264Stream,captionStream:new Pt.CaptionStream(g),metadataStream:new Pt.MetadataStream};return _.headOfPipeline=_.packet,_.packet.pipe(_.parse).pipe(_.elementary).pipe(_.timestampRollover),_.timestampRollover.pipe(_.h264),_.h264.pipe(_.captionStream),_.timestampRollover.pipe(_.metadataStream),_.timestampRollover.pipe(_.adts),_.elementary.on("data",function(P){if(P.type==="metadata"){for(var A=0;A<P.tracks.length;A++)_.tracks[P.tracks[A].type]||(_.tracks[P.tracks[A].type]=P.tracks[A],_.tracks[P.tracks[A].type].timelineStartInfo.baseMediaDecodeTime=g.baseMediaDecodeTime);_.tracks.video&&!_.videoSegmentStream&&(_.videoSegmentStream=new ln(_.tracks.video,g),_.videoSegmentStream.on("timelineStartInfo",function(L){_.tracks.audio&&!g.keepOriginalTimestamps&&_.audioSegmentStream.setEarliestDts(L.dts-g.baseMediaDecodeTime)}),_.videoSegmentStream.on("timingInfo",_.trigger.bind(_,"videoTimingInfo")),_.videoSegmentStream.on("data",function(L){_.trigger("data",{type:"video",data:L})}),_.videoSegmentStream.on("done",_.trigger.bind(_,"done")),_.videoSegmentStream.on("partialdone",_.trigger.bind(_,"partialdone")),_.videoSegmentStream.on("endedtimeline",_.trigger.bind(_,"endedtimeline")),_.h264.pipe(_.videoSegmentStream)),_.tracks.audio&&!_.audioSegmentStream&&(_.audioSegmentStream=new qa(_.tracks.audio,g),_.audioSegmentStream.on("data",function(L){_.trigger("data",{type:"audio",data:L})}),_.audioSegmentStream.on("done",_.trigger.bind(_,"done")),_.audioSegmentStream.on("partialdone",_.trigger.bind(_,"partialdone")),_.audioSegmentStream.on("endedtimeline",_.trigger.bind(_,"endedtimeline")),_.audioSegmentStream.on("timingInfo",_.trigger.bind(_,"audioTimingInfo")),_.adts.pipe(_.audioSegmentStream)),_.trigger("trackinfo",{hasAudio:!!_.tracks.audio,hasVideo:!!_.tracks.video})}}),_.captionStream.on("data",function(P){var A;_.tracks.video?A=_.tracks.video.timelineStartInfo.pts||0:A=0,P.startTime=y.metadataTsToSeconds(P.startPts,A,g.keepOriginalTimestamps),P.endTime=y.metadataTsToSeconds(P.endPts,A,g.keepOriginalTimestamps),_.trigger("caption",P)}),_=xi(_),_.metadataStream.on("data",_.trigger.bind(_,"id3Frame")),_},za=function(g){var _={type:"aac",tracks:{audio:null},metadataStream:new Pt.MetadataStream,aacStream:new Dr,audioRollover:new Pt.TimestampRolloverStream("audio"),timedMetadataRollover:new Pt.TimestampRolloverStream("timed-metadata"),adtsStream:new F(!0)};return _.headOfPipeline=_.aacStream,_.aacStream.pipe(_.audioRollover).pipe(_.adtsStream),_.aacStream.pipe(_.timedMetadataRollover).pipe(_.metadataStream),_.metadataStream.on("timestamp",function(P){_.aacStream.setTimestamp(P.timeStamp)}),_.aacStream.on("data",function(P){P.type!=="timed-metadata"&&P.type!=="audio"||_.audioSegmentStream||(_.tracks.audio=_.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:g.baseMediaDecodeTime},codec:"adts",type:"audio"},_.audioSegmentStream=new qa(_.tracks.audio,g),_.audioSegmentStream.on("data",function(A){_.trigger("data",{type:"audio",data:A})}),_.audioSegmentStream.on("partialdone",_.trigger.bind(_,"partialdone")),_.audioSegmentStream.on("done",_.trigger.bind(_,"done")),_.audioSegmentStream.on("endedtimeline",_.trigger.bind(_,"endedtimeline")),_.audioSegmentStream.on("timingInfo",_.trigger.bind(_,"audioTimingInfo")),_.adtsStream.pipe(_.audioSegmentStream),_.trigger("trackinfo",{hasAudio:!!_.tracks.audio,hasVideo:!!_.tracks.video}))}),_=xi(_),_.metadataStream.on("data",_.trigger.bind(_,"id3Frame")),_},Ta=function(g,_){g.on("data",_.trigger.bind(_,"data")),g.on("done",_.trigger.bind(_,"done")),g.on("partialdone",_.trigger.bind(_,"partialdone")),g.on("endedtimeline",_.trigger.bind(_,"endedtimeline")),g.on("audioTimingInfo",_.trigger.bind(_,"audioTimingInfo")),g.on("videoTimingInfo",_.trigger.bind(_,"videoTimingInfo")),g.on("trackinfo",_.trigger.bind(_,"trackinfo")),g.on("id3Frame",function(P){P.dispatchType=g.metadataStream.dispatchType,P.cueTime=y.videoTsToSeconds(P.pts),_.trigger("id3Frame",P)}),g.on("caption",function(P){_.trigger("caption",P)})},Pi=function j(g){var _=null,P=!0;g=g||{},j.prototype.init.call(this),g.baseMediaDecodeTime=g.baseMediaDecodeTime||0,this.push=function(A){if(P){var L=Ti(A);L&&(!_||_.type!=="aac")?(_=za(g),Ta(_,this)):!L&&(!_||_.type!=="ts")&&(_=Ci(g),Ta(_,this)),P=!1}_.headOfPipeline.push(A)},this.flush=function(){_&&(P=!0,_.headOfPipeline.flush())},this.partialFlush=function(){_&&_.headOfPipeline.partialFlush()},this.endTimeline=function(){_&&_.headOfPipeline.endTimeline()},this.reset=function(){_&&_.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(A){g.keepOriginalTimestamps||(g.baseMediaDecodeTime=A),_&&(_.tracks.audio&&(_.tracks.audio.timelineStartInfo.dts=void 0,_.tracks.audio.timelineStartInfo.pts=void 0,Gt.clearDtsInfo(_.tracks.audio),_.audioRollover&&_.audioRollover.discontinuity()),_.tracks.video&&(_.videoSegmentStream&&(_.videoSegmentStream.gopCache_=[]),_.tracks.video.timelineStartInfo.dts=void 0,_.tracks.video.timelineStartInfo.pts=void 0,Gt.clearDtsInfo(_.tracks.video)),_.timestampRollover&&_.timestampRollover.discontinuity())},this.setRemux=function(A){g.remux=A,_&&_.coalesceStream&&_.coalesceStream.setRemux(A)},this.setAudioAppendStart=function(A){!_||!_.tracks.audio||!_.audioSegmentStream||_.audioSegmentStream.setAudioAppendStart(A)},this.alignGopsWith=function(A){}};Pi.prototype=new r;var na=Pi,Xa={Transmuxer:na},xa=Math.pow(2,32),un=function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={version:g[0],flags:new Uint8Array(g.subarray(1,4)),references:[],referenceId:_.getUint32(4),timescale:_.getUint32(8)},A=12;P.version===0?(P.earliestPresentationTime=_.getUint32(A),P.firstOffset=_.getUint32(A+4),A+=8):(P.earliestPresentationTime=_.getUint32(A)*xa+_.getUint32(A+4),P.firstOffset=_.getUint32(A+8)*xa+_.getUint32(A+12),A+=16),A+=2;var L=_.getUint16(A);for(A+=2;L>0;A+=12,L--)P.references.push({referenceType:(g[A]&128)>>>7,referencedSize:_.getUint32(A)&2147483647,subsegmentDuration:_.getUint32(A+4),startsWithSap:!!(g[A+8]&128),sapType:(g[A+8]&112)>>>4,sapDeltaTime:_.getUint32(A+8)&268435455});return P},dn=un,Ai=Math.pow(2,32),rr,Ya,ur=function(g){return new Date(g*1e3-20828448e5)},bi=function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P=[],A,L;for(A=0;A+4<g.length;A+=L){if(L=_.getUint32(A),A+=4,L<=0){P.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(g[A]&31){case 1:P.push("slice_layer_without_partitioning_rbsp");break;case 5:P.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:P.push("sei_rbsp");break;case 7:P.push("seq_parameter_set_rbsp");break;case 8:P.push("pic_parameter_set_rbsp");break;case 9:P.push("access_unit_delimiter_rbsp");break;default:P.push("UNKNOWN NAL - "+g[A]&31);break}}return P},Er={avc1:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength);return{dataReferenceIndex:_.getUint16(6),width:_.getUint16(24),height:_.getUint16(26),horizresolution:_.getUint16(28)+_.getUint16(30)/16,vertresolution:_.getUint16(32)+_.getUint16(34)/16,frameCount:_.getUint16(40),depth:_.getUint16(74),config:rr(g.subarray(78,g.byteLength))}},avcC:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={configurationVersion:g[0],avcProfileIndication:g[1],profileCompatibility:g[2],avcLevelIndication:g[3],lengthSizeMinusOne:g[4]&3,sps:[],pps:[]},A=g[5]&31,L,N,Y,ne;for(Y=6,ne=0;ne<A;ne++)N=_.getUint16(Y),Y+=2,P.sps.push(new Uint8Array(g.subarray(Y,Y+N))),Y+=N;for(L=g[Y],Y++,ne=0;ne<L;ne++)N=_.getUint16(Y),Y+=2,P.pps.push(new Uint8Array(g.subarray(Y,Y+N))),Y+=N;return P},btrt:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength);return{bufferSizeDB:_.getUint32(0),maxBitrate:_.getUint32(4),avgBitrate:_.getUint32(8)}},edts:function(g){return{boxes:rr(g)}},elst:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={version:_.getUint8(0),flags:new Uint8Array(g.subarray(1,4)),edits:[]},A=_.getUint32(4),L;for(L=8;A;A--)P.version===0?(P.edits.push({segmentDuration:_.getUint32(L),mediaTime:_.getInt32(L+4),mediaRate:_.getUint16(L+8)+_.getUint16(L+10)/(256*256)}),L+=12):(P.edits.push({segmentDuration:_.getUint32(L)*Ai+_.getUint32(L+4),mediaTime:_.getUint32(L+8)*Ai+_.getUint32(L+12),mediaRate:_.getUint16(L+16)+_.getUint16(L+18)/(256*256)}),L+=20);return P},esds:function(g){return{version:g[0],flags:new Uint8Array(g.subarray(1,4)),esId:g[6]<<8|g[7],streamPriority:g[8]&31,decoderConfig:{objectProfileIndication:g[11],streamType:g[12]>>>2&63,bufferSize:g[13]<<16|g[14]<<8|g[15],maxBitrate:g[16]<<24|g[17]<<16|g[18]<<8|g[19],avgBitrate:g[20]<<24|g[21]<<16|g[22]<<8|g[23],decoderConfigDescriptor:{tag:g[24],length:g[25],audioObjectType:g[26]>>>3&31,samplingFrequencyIndex:(g[26]&7)<<1|g[27]>>>7&1,channelConfiguration:g[27]>>>3&15}}}},ftyp:function(g){for(var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={majorBrand:$t(g.subarray(0,4)),minorVersion:_.getUint32(4),compatibleBrands:[]},A=8;A<g.byteLength;)P.compatibleBrands.push($t(g.subarray(A,A+4))),A+=4;return P},dinf:function(g){return{boxes:rr(g)}},dref:function(g){return{version:g[0],flags:new Uint8Array(g.subarray(1,4)),dataReferences:rr(g.subarray(8))}},hdlr:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={version:_.getUint8(0),flags:new Uint8Array(g.subarray(1,4)),handlerType:$t(g.subarray(8,12)),name:""},A=8;for(A=24;A<g.byteLength;A++){if(g[A]===0){A++;break}P.name+=String.fromCharCode(g[A])}return P.name=decodeURIComponent(escape(P.name)),P},mdat:function(g){return{byteLength:g.byteLength,nals:bi(g)}},mdhd:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P=4,A,L={version:_.getUint8(0),flags:new Uint8Array(g.subarray(1,4)),language:""};return L.version===1?(P+=4,L.creationTime=ur(_.getUint32(P)),P+=8,L.modificationTime=ur(_.getUint32(P)),P+=4,L.timescale=_.getUint32(P),P+=8,L.duration=_.getUint32(P)):(L.creationTime=ur(_.getUint32(P)),P+=4,L.modificationTime=ur(_.getUint32(P)),P+=4,L.timescale=_.getUint32(P),P+=4,L.duration=_.getUint32(P)),P+=4,A=_.getUint16(P),L.language+=String.fromCharCode((A>>10)+96),L.language+=String.fromCharCode(((A&992)>>5)+96),L.language+=String.fromCharCode((A&31)+96),L},mdia:function(g){return{boxes:rr(g)}},mfhd:function(g){return{version:g[0],flags:new Uint8Array(g.subarray(1,4)),sequenceNumber:g[4]<<24|g[5]<<16|g[6]<<8|g[7]}},minf:function(g){return{boxes:rr(g)}},mp4a:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={dataReferenceIndex:_.getUint16(6),channelcount:_.getUint16(16),samplesize:_.getUint16(18),samplerate:_.getUint16(24)+_.getUint16(26)/65536};return g.byteLength>28&&(P.streamDescriptor=rr(g.subarray(28))[0]),P},moof:function(g){return{boxes:rr(g)}},moov:function(g){return{boxes:rr(g)}},mvex:function(g){return{boxes:rr(g)}},mvhd:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P=4,A={version:_.getUint8(0),flags:new Uint8Array(g.subarray(1,4))};return A.version===1?(P+=4,A.creationTime=ur(_.getUint32(P)),P+=8,A.modificationTime=ur(_.getUint32(P)),P+=4,A.timescale=_.getUint32(P),P+=8,A.duration=_.getUint32(P)):(A.creationTime=ur(_.getUint32(P)),P+=4,A.modificationTime=ur(_.getUint32(P)),P+=4,A.timescale=_.getUint32(P),P+=4,A.duration=_.getUint32(P)),P+=4,A.rate=_.getUint16(P)+_.getUint16(P+2)/16,P+=4,A.volume=_.getUint8(P)+_.getUint8(P+1)/8,P+=2,P+=2,P+=2*4,A.matrix=new Uint32Array(g.subarray(P,P+9*4)),P+=9*4,P+=6*4,A.nextTrackId=_.getUint32(P),A},pdin:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength);return{version:_.getUint8(0),flags:new Uint8Array(g.subarray(1,4)),rate:_.getUint32(4),initialDelay:_.getUint32(8)}},sdtp:function(g){var _={version:g[0],flags:new Uint8Array(g.subarray(1,4)),samples:[]},P;for(P=4;P<g.byteLength;P++)_.samples.push({dependsOn:(g[P]&48)>>4,isDependedOn:(g[P]&12)>>2,hasRedundancy:g[P]&3});return _},sidx:dn,smhd:function(g){return{version:g[0],flags:new Uint8Array(g.subarray(1,4)),balance:g[4]+g[5]/256}},stbl:function(g){return{boxes:rr(g)}},ctts:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={version:_.getUint8(0),flags:new Uint8Array(g.subarray(1,4)),compositionOffsets:[]},A=_.getUint32(4),L;for(L=8;A;L+=8,A--)P.compositionOffsets.push({sampleCount:_.getUint32(L),sampleOffset:_[P.version===0?"getUint32":"getInt32"](L+4)});return P},stss:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={version:_.getUint8(0),flags:new Uint8Array(g.subarray(1,4)),syncSamples:[]},A=_.getUint32(4),L;for(L=8;A;L+=4,A--)P.syncSamples.push(_.getUint32(L));return P},stco:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={version:g[0],flags:new Uint8Array(g.subarray(1,4)),chunkOffsets:[]},A=_.getUint32(4),L;for(L=8;A;L+=4,A--)P.chunkOffsets.push(_.getUint32(L));return P},stsc:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P=_.getUint32(4),A={version:g[0],flags:new Uint8Array(g.subarray(1,4)),sampleToChunks:[]},L;for(L=8;P;L+=12,P--)A.sampleToChunks.push({firstChunk:_.getUint32(L),samplesPerChunk:_.getUint32(L+4),sampleDescriptionIndex:_.getUint32(L+8)});return A},stsd:function(g){return{version:g[0],flags:new Uint8Array(g.subarray(1,4)),sampleDescriptions:rr(g.subarray(8))}},stsz:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={version:g[0],flags:new Uint8Array(g.subarray(1,4)),sampleSize:_.getUint32(4),entries:[]},A;for(A=12;A<g.byteLength;A+=4)P.entries.push(_.getUint32(A));return P},stts:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P={version:g[0],flags:new Uint8Array(g.subarray(1,4)),timeToSamples:[]},A=_.getUint32(4),L;for(L=8;A;L+=8,A--)P.timeToSamples.push({sampleCount:_.getUint32(L),sampleDelta:_.getUint32(L+4)});return P},styp:function(g){return Er.ftyp(g)},tfdt:Ze,tfhd:ge,tkhd:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength),P=4,A={version:_.getUint8(0),flags:new Uint8Array(g.subarray(1,4))};return A.version===1?(P+=4,A.creationTime=ur(_.getUint32(P)),P+=8,A.modificationTime=ur(_.getUint32(P)),P+=4,A.trackId=_.getUint32(P),P+=4,P+=8,A.duration=_.getUint32(P)):(A.creationTime=ur(_.getUint32(P)),P+=4,A.modificationTime=ur(_.getUint32(P)),P+=4,A.trackId=_.getUint32(P),P+=4,P+=4,A.duration=_.getUint32(P)),P+=4,P+=2*4,A.layer=_.getUint16(P),P+=2,A.alternateGroup=_.getUint16(P),P+=2,A.volume=_.getUint8(P)+_.getUint8(P+1)/8,P+=2,P+=2,A.matrix=new Uint32Array(g.subarray(P,P+9*4)),P+=9*4,A.width=_.getUint16(P)+_.getUint16(P+2)/65536,P+=4,A.height=_.getUint16(P)+_.getUint16(P+2)/65536,A},traf:function(g){return{boxes:rr(g)}},trak:function(g){return{boxes:rr(g)}},trex:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength);return{version:g[0],flags:new Uint8Array(g.subarray(1,4)),trackId:_.getUint32(4),defaultSampleDescriptionIndex:_.getUint32(8),defaultSampleDuration:_.getUint32(12),defaultSampleSize:_.getUint32(16),sampleDependsOn:g[20]&3,sampleIsDependedOn:(g[21]&192)>>6,sampleHasRedundancy:(g[21]&48)>>4,samplePaddingValue:(g[21]&14)>>1,sampleIsDifferenceSample:!!(g[21]&1),sampleDegradationPriority:_.getUint16(22)}},trun:$e,"url ":function(g){return{version:g[0],flags:new Uint8Array(g.subarray(1,4))}},vmhd:function(g){var _=new DataView(g.buffer,g.byteOffset,g.byteLength);return{version:g[0],flags:new Uint8Array(g.subarray(1,4)),graphicsmode:_.getUint16(4),opcolor:new Uint16Array([_.getUint16(6),_.getUint16(8),_.getUint16(10)])}}};rr=function(g){for(var _=0,P=[],A,L,N,Y,ne,ce=new ArrayBuffer(g.length),se=new Uint8Array(ce),pe=0;pe<g.length;++pe)se[pe]=g[pe];for(A=new DataView(ce);_<g.byteLength;)L=A.getUint32(_),N=$t(g.subarray(_+4,_+8)),Y=L>1?_+L:g.byteLength,ne=(Er[N]||function(Me){return{data:Me}})(g.subarray(_+8,Y)),ne.size=L,ne.type=N,P.push(ne),_=Y;return P},Ya=function(g,_){var P;return _=_||0,P=new Array(_*2+1).join(" "),g.map(function(A,L){return P+A.type+`
`+Object.keys(A).filter(function(N){return N!=="type"&&N!=="boxes"}).map(function(N){var Y=P+"  "+N+": ",ne=A[N];if(ne instanceof Uint8Array||ne instanceof Uint32Array){var ce=Array.prototype.slice.call(new Uint8Array(ne.buffer,ne.byteOffset,ne.byteLength)).map(function(se){return" "+("00"+se.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return ce?ce.length===1?Y+"<"+ce.join("").slice(1)+">":Y+`<
`+ce.map(function(se){return P+"  "+se}).join(`
`)+`
`+P+"  >":Y+"<>"}return Y+JSON.stringify(ne,null,2).split(`
`).map(function(se,pe){return pe===0?se:P+"  "+se}).join(`
`)}).join(`
`)+(A.boxes?`
`+Ya(A.boxes,_+1):"")}).join(`
`)};var hn={inspect:rr,textify:Ya,parseType:$t,findBox:Z,parseTraf:Er.traf,parseTfdt:Er.tfdt,parseHdlr:Er.hdlr,parseTfhd:Er.tfhd,parseTrun:Er.trun,parseSidx:Er.sidx},cn={8:"audio",9:"video",18:"metadata"},Ii=function(g){return"0x"+("00"+g.toString(16)).slice(-2).toUpperCase()},Ca=function(g){for(var _=[],P;g.byteLength>0;)P=0,_.push(Ii(g[P++])),g=g.subarray(P);return _.join(" ")},O=function(g,_){var P=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],A=g[1]&parseInt("01111111",2)<<16|g[2]<<8|g[3];return _=_||{},_.avcPacketType=P[g[0]],_.CompositionTime=g[1]&parseInt("10000000",2)?-A:A,g[0]===1?_.nalUnitTypeRaw=Ca(g.subarray(4,100)):_.data=Ca(g.subarray(4)),_},M=function(g,_){var P=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"],A=g[0]&parseInt("00001111",2);return _=_||{},_.frameType=P[(g[0]&parseInt("11110000",2))>>>4],_.codecID=A,A===7?O(g.subarray(1),_):_},h=function(g,_){var P=["AAC Sequence Header","AAC Raw"];return _=_||{},_.aacPacketType=P[g[0]],_.data=Ca(g.subarray(1)),_},p=function(g,_){var P=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"],A=["5.5-kHz","11-kHz","22-kHz","44-kHz"],L=(g[0]&parseInt("11110000",2))>>>4;return _=_||{},_.soundFormat=P[L],_.soundRate=A[(g[0]&parseInt("00001100",2))>>>2],_.soundSize=(g[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",_.soundType=g[0]&parseInt("00000001",2)?"Stereo":"Mono",L===10?h(g.subarray(1),_):_},S=function(g){return{tagType:cn[g[0]],dataSize:g[1]<<16|g[2]<<8|g[3],timestamp:g[7]<<24|g[4]<<16|g[5]<<8|g[6],streamID:g[8]<<16|g[9]<<8|g[10]}},T=function(g){var _=S(g);switch(g[0]){case 8:p(g.subarray(11),_);break;case 9:M(g.subarray(11),_);break}return _},C=function(g){var _=9,P,A=[],L;for(_+=4;_<g.byteLength;)P=g[_+1]<<16,P|=g[_+2]<<8,P|=g[_+3],P+=11,L=g.subarray(_,_+P),A.push(T(L)),_+=P+4;return A},v=function(g){return JSON.stringify(g,null,2)},x={inspectTag:T,inspect:C,textify:v},I=function(g){var _=g[1]&31;return _<<=8,_|=g[2],_},R=function(g){return!!(g[1]&64)},U=function(g){var _=0;return(g[3]&48)>>>4>1&&(_+=g[4]+1),_},G=function(g,_){var P=I(g);return P===0?"pat":P===_?"pmt":_?"pes":null},ie=function(g){var _=R(g),P=4+U(g);return _&&(P+=g[P]+1),(g[P+10]&31)<<8|g[P+11]},le=function(g){var _={},P=R(g),A=4+U(g);if(P&&(A+=g[A]+1),!!(g[A+5]&1)){var L,N,Y;L=(g[A+1]&15)<<8|g[A+2],N=3+L-4,Y=(g[A+10]&15)<<8|g[A+11];for(var ne=12+Y;ne<N;){var ce=A+ne;_[(g[ce+1]&31)<<8|g[ce+2]]=g[ce],ne+=((g[ce+3]&15)<<8|g[ce+4])+5}return _}},he=function(g,_){var P=I(g),A=_[P];switch(A){case zt.H264_STREAM_TYPE:return"video";case zt.ADTS_STREAM_TYPE:return"audio";case zt.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},Te=function(g){var _=R(g);if(!_)return null;var P=4+U(g);if(P>=g.byteLength)return null;var A=null,L;return L=g[P+7],L&192&&(A={},A.pts=(g[P+9]&14)<<27|(g[P+10]&255)<<20|(g[P+11]&254)<<12|(g[P+12]&255)<<5|(g[P+13]&254)>>>3,A.pts*=4,A.pts+=(g[P+13]&6)>>>1,A.dts=A.pts,L&64&&(A.dts=(g[P+14]&14)<<27|(g[P+15]&255)<<20|(g[P+16]&254)<<12|(g[P+17]&255)<<5|(g[P+18]&254)>>>3,A.dts*=4,A.dts+=(g[P+18]&6)>>>1)),A},Ee=function(g){switch(g){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},je=function(g){for(var _=4+U(g),P=g.subarray(_),A=0,L=0,N=!1,Y;L<P.byteLength-3;L++)if(P[L+2]===1){A=L+5;break}for(;A<P.byteLength;)switch(P[A]){case 0:if(P[A-1]!==0){A+=2;break}else if(P[A-2]!==0){A++;break}L+3!==A-2&&(Y=Ee(P[L+3]&31),Y==="slice_layer_without_partitioning_rbsp_idr"&&(N=!0));do A++;while(P[A]!==1&&A<P.length);L=A-2,A+=3;break;case 1:if(P[A-1]!==0||P[A-2]!==0){A+=3;break}Y=Ee(P[L+3]&31),Y==="slice_layer_without_partitioning_rbsp_idr"&&(N=!0),L=A-2,A+=3;break;default:A+=3;break}return P=P.subarray(L),A-=L,L=0,P&&P.byteLength>3&&(Y=Ee(P[L+3]&31),Y==="slice_layer_without_partitioning_rbsp_idr"&&(N=!0)),N},Ve={parseType:G,parsePat:ie,parsePmt:le,parsePayloadUnitStartIndicator:R,parsePesType:he,parsePesTime:Te,videoPacketContainsKeyFrame:je},Ne=ni.handleRollover,Re={};Re.ts=Ve,Re.aac=Hr;var He=y.ONE_SECOND_IN_TS,Le=188,Je=71,Ye=function(g,_){for(var P=0,A=Le,L,N;A<g.byteLength;){if(g[P]===Je&&g[A]===Je){switch(L=g.subarray(P,A),N=Re.ts.parseType(L,_.pid),N){case"pat":_.pid=Re.ts.parsePat(L);break;case"pmt":var Y=Re.ts.parsePmt(L);_.table=_.table||{},Object.keys(Y).forEach(function(ne){_.table[ne]=Y[ne]});break}P+=Le,A+=Le;continue}P++,A++}},ht=function(g,_,P){for(var A=0,L=Le,N,Y,ne,ce,se,pe=!1;L<=g.byteLength;){if(g[A]===Je&&(g[L]===Je||L===g.byteLength)){switch(N=g.subarray(A,L),Y=Re.ts.parseType(N,_.pid),Y){case"pes":ne=Re.ts.parsePesType(N,_.table),ce=Re.ts.parsePayloadUnitStartIndicator(N),ne==="audio"&&ce&&(se=Re.ts.parsePesTime(N),se&&(se.type="audio",P.audio.push(se),pe=!0));break}if(pe)break;A+=Le,L+=Le;continue}A++,L++}for(L=g.byteLength,A=L-Le,pe=!1;A>=0;){if(g[A]===Je&&(g[L]===Je||L===g.byteLength)){switch(N=g.subarray(A,L),Y=Re.ts.parseType(N,_.pid),Y){case"pes":ne=Re.ts.parsePesType(N,_.table),ce=Re.ts.parsePayloadUnitStartIndicator(N),ne==="audio"&&ce&&(se=Re.ts.parsePesTime(N),se&&(se.type="audio",P.audio.push(se),pe=!0));break}if(pe)break;A-=Le,L-=Le;continue}A--,L--}},pt=function(g,_,P){for(var A=0,L=Le,N,Y,ne,ce,se,pe,Me,qe,Qe=!1,We={data:[],size:0};L<g.byteLength;){if(g[A]===Je&&g[L]===Je){switch(N=g.subarray(A,L),Y=Re.ts.parseType(N,_.pid),Y){case"pes":if(ne=Re.ts.parsePesType(N,_.table),ce=Re.ts.parsePayloadUnitStartIndicator(N),ne==="video"&&(ce&&!Qe&&(se=Re.ts.parsePesTime(N),se&&(se.type="video",P.video.push(se),Qe=!0)),!P.firstKeyFrame)){if(ce&&We.size!==0){for(pe=new Uint8Array(We.size),Me=0;We.data.length;)qe=We.data.shift(),pe.set(qe,Me),Me+=qe.byteLength;if(Re.ts.videoPacketContainsKeyFrame(pe)){var dt=Re.ts.parsePesTime(pe);dt?(P.firstKeyFrame=dt,P.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}We.size=0}We.data.push(N),We.size+=N.byteLength}break}if(Qe&&P.firstKeyFrame)break;A+=Le,L+=Le;continue}A++,L++}for(L=g.byteLength,A=L-Le,Qe=!1;A>=0;){if(g[A]===Je&&g[L]===Je){switch(N=g.subarray(A,L),Y=Re.ts.parseType(N,_.pid),Y){case"pes":ne=Re.ts.parsePesType(N,_.table),ce=Re.ts.parsePayloadUnitStartIndicator(N),ne==="video"&&ce&&(se=Re.ts.parsePesTime(N),se&&(se.type="video",P.video.push(se),Qe=!0));break}if(Qe)break;A-=Le,L-=Le;continue}A--,L--}},kt=function(g,_){if(g.audio&&g.audio.length){var P=_;(typeof P>"u"||isNaN(P))&&(P=g.audio[0].dts),g.audio.forEach(function(N){N.dts=Ne(N.dts,P),N.pts=Ne(N.pts,P),N.dtsTime=N.dts/He,N.ptsTime=N.pts/He})}if(g.video&&g.video.length){var A=_;if((typeof A>"u"||isNaN(A))&&(A=g.video[0].dts),g.video.forEach(function(N){N.dts=Ne(N.dts,A),N.pts=Ne(N.pts,A),N.dtsTime=N.dts/He,N.ptsTime=N.pts/He}),g.firstKeyFrame){var L=g.firstKeyFrame;L.dts=Ne(L.dts,A),L.pts=Ne(L.pts,A),L.dtsTime=L.dts/He,L.ptsTime=L.pts/He}}},It=function(g){for(var _=!1,P=0,A=null,L=null,N=0,Y=0,ne;g.length-Y>=3;){var ce=Re.aac.parseType(g,Y);switch(ce){case"timed-metadata":if(g.length-Y<10){_=!0;break}if(N=Re.aac.parseId3TagSize(g,Y),N>g.length){_=!0;break}L===null&&(ne=g.subarray(Y,Y+N),L=Re.aac.parseAacTimestamp(ne)),Y+=N;break;case"audio":if(g.length-Y<7){_=!0;break}if(N=Re.aac.parseAdtsSize(g,Y),N>g.length){_=!0;break}A===null&&(ne=g.subarray(Y,Y+N),A=Re.aac.parseSampleRate(ne)),P++,Y+=N;break;default:Y++;break}if(_)return null}if(A===null||L===null)return null;var se=He/A,pe={audio:[{type:"audio",dts:L,pts:L},{type:"audio",dts:L+P*1024*se,pts:L+P*1024*se}]};return pe},_t=function(g){var _={pid:null,table:null},P={};Ye(g,_);for(var A in _.table)if(_.table.hasOwnProperty(A)){var L=_.table[A];switch(L){case zt.H264_STREAM_TYPE:P.video=[],pt(g,_,P),P.video.length===0&&delete P.video;break;case zt.ADTS_STREAM_TYPE:P.audio=[],ht(g,_,P),P.audio.length===0&&delete P.audio;break}}return P},Et=function(g,_){var P=Re.aac.isLikelyAacData(g),A;return P?A=It(g):A=_t(g),!A||!A.audio&&!A.video?null:(kt(A,_),A)},Dt={inspect:Et,parseAudioPes_:ht},Ft={codecs:te,mp4:Ga,flv:ki,mp2t:Ei,partial:Xa};Ft.mp4.tools=hn,Ft.flv.tools=x,Ft.mp2t.tools=Dt;var er=Ft;return er})});var xn=Mi((Sn,Tn)=>{(function(t){var r;typeof Sn=="object"?Tn.exports=t():typeof define=="function"&&define.amd?define(t):(typeof window<"u"?r=window:typeof global<"u"?r=global:typeof self<"u"&&(r=self),r.objectHash=t())})(function(){return function t(r,i,n){function s(u,m){if(!i[u]){if(!r[u]){var E=typeof Qa=="function"&&Qa;if(!m&&E)return E(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}m=i[u]={exports:{}},r[u][0].call(m.exports,function(y){var D=r[u][1][y];return s(D||y)},m,m.exports,t,r,i,n)}return i[u].exports}for(var o=typeof Qa=="function"&&Qa,l=0;l<n.length;l++)s(n[l]);return s}({1:[function(t,r,i){(function(n,s,o,l,u,m,E,y,D){"use strict";var w=t("crypto");function B(H,te){te=K(H,te);var W;return(W=te.algorithm!=="passthrough"?w.createHash(te.algorithm):new ee).write===void 0&&(W.write=W.update,W.end=W.update),re(te,W).dispatch(H),W.update||W.end(""),W.digest?W.digest(te.encoding==="buffer"?void 0:te.encoding):(H=W.read(),te.encoding!=="buffer"?H.toString(te.encoding):H)}(i=r.exports=B).sha1=function(H){return B(H)},i.keys=function(H){return B(H,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},i.MD5=function(H){return B(H,{algorithm:"md5",encoding:"hex"})},i.keysMD5=function(H){return B(H,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var F=w.getHashes?w.getHashes().slice():["sha1","md5"],V=(F.push("passthrough"),["buffer","hex","binary","base64"]);function K(H,te){var W={};if(W.algorithm=(te=te||{}).algorithm||"sha1",W.encoding=te.encoding||"hex",W.excludeValues=!!te.excludeValues,W.algorithm=W.algorithm.toLowerCase(),W.encoding=W.encoding.toLowerCase(),W.ignoreUnknown=te.ignoreUnknown===!0,W.respectType=te.respectType!==!1,W.respectFunctionNames=te.respectFunctionNames!==!1,W.respectFunctionProperties=te.respectFunctionProperties!==!1,W.unorderedArrays=te.unorderedArrays===!0,W.unorderedSets=te.unorderedSets!==!1,W.unorderedObjects=te.unorderedObjects!==!1,W.replacer=te.replacer||void 0,W.excludeKeys=te.excludeKeys||void 0,H===void 0)throw new Error("Object argument required.");for(var z=0;z<F.length;++z)F[z].toLowerCase()===W.algorithm.toLowerCase()&&(W.algorithm=F[z]);if(F.indexOf(W.algorithm)===-1)throw new Error('Algorithm "'+W.algorithm+'"  not supported. supported values: '+F.join(", "));if(V.indexOf(W.encoding)===-1&&W.algorithm!=="passthrough")throw new Error('Encoding "'+W.encoding+'"  not supported. supported values: '+V.join(", "));return W}function q(H){if(typeof H=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(H))!=null}function re(H,te,W){W=W||[];function z(X){return te.update?te.update(X,"utf8"):te.write(X,"utf8")}return{dispatch:function(X){return this["_"+((X=H.replacer?H.replacer(X):X)===null?"null":typeof X)](X)},_object:function(X){var Q,$=Object.prototype.toString.call(X),oe=/\[object (.*)\]/i.exec($);if(oe=(oe=oe?oe[1]:"unknown:["+$+"]").toLowerCase(),0<=($=W.indexOf(X)))return this.dispatch("[CIRCULAR:"+$+"]");if(W.push(X),o!==void 0&&o.isBuffer&&o.isBuffer(X))return z("buffer:"),z(X);if(oe==="object"||oe==="function"||oe==="asyncfunction")return $=Object.keys(X),H.unorderedObjects&&($=$.sort()),H.respectType===!1||q(X)||$.splice(0,0,"prototype","__proto__","constructor"),H.excludeKeys&&($=$.filter(function(ae){return!H.excludeKeys(ae)})),z("object:"+$.length+":"),Q=this,$.forEach(function(ae){Q.dispatch(ae),z(":"),H.excludeValues||Q.dispatch(X[ae]),z(",")});if(!this["_"+oe]){if(H.ignoreUnknown)return z("["+oe+"]");throw new Error('Unknown object type "'+oe+'"')}this["_"+oe](X)},_array:function(X,ae){ae=ae!==void 0?ae:H.unorderedArrays!==!1;var $=this;if(z("array:"+X.length+":"),!ae||X.length<=1)return X.forEach(function(_e){return $.dispatch(_e)});var oe=[],ae=X.map(function(_e){var ve=new ee,Pe=W.slice();return re(H,ve,Pe).dispatch(_e),oe=oe.concat(Pe.slice(W.length)),ve.read().toString()});return W=W.concat(oe),ae.sort(),this._array(ae,!1)},_date:function(X){return z("date:"+X.toJSON())},_symbol:function(X){return z("symbol:"+X.toString())},_error:function(X){return z("error:"+X.toString())},_boolean:function(X){return z("bool:"+X.toString())},_string:function(X){z("string:"+X.length+":"),z(X.toString())},_function:function(X){z("fn:"),q(X)?this.dispatch("[native]"):this.dispatch(X.toString()),H.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(X.name)),H.respectFunctionProperties&&this._object(X)},_number:function(X){return z("number:"+X.toString())},_xml:function(X){return z("xml:"+X.toString())},_null:function(){return z("Null")},_undefined:function(){return z("Undefined")},_regexp:function(X){return z("regex:"+X.toString())},_uint8array:function(X){return z("uint8array:"),this.dispatch(Array.prototype.slice.call(X))},_uint8clampedarray:function(X){return z("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(X))},_int8array:function(X){return z("int8array:"),this.dispatch(Array.prototype.slice.call(X))},_uint16array:function(X){return z("uint16array:"),this.dispatch(Array.prototype.slice.call(X))},_int16array:function(X){return z("int16array:"),this.dispatch(Array.prototype.slice.call(X))},_uint32array:function(X){return z("uint32array:"),this.dispatch(Array.prototype.slice.call(X))},_int32array:function(X){return z("int32array:"),this.dispatch(Array.prototype.slice.call(X))},_float32array:function(X){return z("float32array:"),this.dispatch(Array.prototype.slice.call(X))},_float64array:function(X){return z("float64array:"),this.dispatch(Array.prototype.slice.call(X))},_arraybuffer:function(X){return z("arraybuffer:"),this.dispatch(new Uint8Array(X))},_url:function(X){return z("url:"+X.toString())},_map:function(X){return z("map:"),X=Array.from(X),this._array(X,H.unorderedSets!==!1)},_set:function(X){return z("set:"),X=Array.from(X),this._array(X,H.unorderedSets!==!1)},_file:function(X){return z("file:"),this.dispatch([X.name,X.size,X.type,X.lastModfied])},_blob:function(){if(H.ignoreUnknown)return z("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return z("domwindow")},_bigint:function(X){return z("bigint:"+X.toString())},_process:function(){return z("process")},_timer:function(){return z("timer")},_pipe:function(){return z("pipe")},_tcp:function(){return z("tcp")},_udp:function(){return z("udp")},_tty:function(){return z("tty")},_statwatcher:function(){return z("statwatcher")},_securecontext:function(){return z("securecontext")},_connection:function(){return z("connection")},_zlib:function(){return z("zlib")},_context:function(){return z("context")},_nodescript:function(){return z("nodescript")},_httpparser:function(){return z("httpparser")},_dataview:function(){return z("dataview")},_signal:function(){return z("signal")},_fsevent:function(){return z("fsevent")},_tlswrap:function(){return z("tlswrap")}}}function ee(){return{buf:"",write:function(H){this.buf+=H},end:function(H){this.buf+=H},read:function(){return this.buf}}}i.writeToStream=function(H,te,W){return W===void 0&&(W=te,te={}),re(te=K(H,te),W).dispatch(H)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,r,i){(function(n,s,o,l,u,m,E,y,D){(function(w){"use strict";var B=typeof Uint8Array<"u"?Uint8Array:Array,F="+".charCodeAt(0),V="/".charCodeAt(0),K="0".charCodeAt(0),q="a".charCodeAt(0),re="A".charCodeAt(0),ee="-".charCodeAt(0),H="_".charCodeAt(0);function te(W){return W=W.charCodeAt(0),W===F||W===ee?62:W===V||W===H?63:W<K?-1:W<K+10?W-K+26+26:W<re+26?W-re:W<q+26?W-q+26:void 0}w.toByteArray=function(W){var z,X;if(0<W.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var Q=W.length,Q=W.charAt(Q-2)==="="?2:W.charAt(Q-1)==="="?1:0,$=new B(3*W.length/4-Q),oe=0<Q?W.length-4:W.length,ae=0;function _e(ve){$[ae++]=ve}for(z=0;z<oe;z+=4,0)_e((16711680&(X=te(W.charAt(z))<<18|te(W.charAt(z+1))<<12|te(W.charAt(z+2))<<6|te(W.charAt(z+3))))>>16),_e((65280&X)>>8),_e(255&X);return Q==2?_e(255&(X=te(W.charAt(z))<<2|te(W.charAt(z+1))>>4)):Q==1&&(_e((X=te(W.charAt(z))<<10|te(W.charAt(z+1))<<4|te(W.charAt(z+2))>>2)>>8&255),_e(255&X)),$},w.fromByteArray=function(W){var z,X,Q,$,oe=W.length%3,ae="";function _e(ve){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(ve)}for(z=0,Q=W.length-oe;z<Q;z+=3)X=(W[z]<<16)+(W[z+1]<<8)+W[z+2],ae+=_e(($=X)>>18&63)+_e($>>12&63)+_e($>>6&63)+_e(63&$);switch(oe){case 1:ae=(ae+=_e((X=W[W.length-1])>>2))+_e(X<<4&63)+"==";break;case 2:ae=(ae=(ae+=_e((X=(W[W.length-2]<<8)+W[W.length-1])>>10))+_e(X>>4&63))+_e(X<<2&63)+"="}return ae}})(i===void 0?this.base64js={}:i)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,r,i){(function(n,s,F,l,u,m,E,y,D){var w=t("base64-js"),B=t("ieee754");function F(J,ue,de){if(!(this instanceof F))return new F(J,ue,de);var Oe,Ue,Ke,at,ut=typeof J;if(ue==="base64"&&ut=="string")for(J=(at=J).trim?at.trim():at.replace(/^\s+|\s+$/g,"");J.length%4!=0;)J+="=";if(ut=="number")Oe=fe(J);else if(ut=="string")Oe=F.byteLength(J,ue);else{if(ut!="object")throw new Error("First argument needs to be a number, array or string.");Oe=fe(J.length)}if(F._useTypedArrays?Ue=F._augment(new Uint8Array(Oe)):((Ue=this).length=Oe,Ue._isBuffer=!0),F._useTypedArrays&&typeof J.byteLength=="number")Ue._set(J);else if(xe(at=J)||F.isBuffer(at)||at&&typeof at=="object"&&typeof at.length=="number")for(Ke=0;Ke<Oe;Ke++)F.isBuffer(J)?Ue[Ke]=J.readUInt8(Ke):Ue[Ke]=J[Ke];else if(ut=="string")Ue.write(J,0,ue);else if(ut=="number"&&!F._useTypedArrays&&!de)for(Ke=0;Ke<Oe;Ke++)Ue[Ke]=0;return Ue}function V(J,ue,de,Oe){return F._charsWritten=Xe(function(Ue){for(var Ke=[],at=0;at<Ue.length;at++)Ke.push(255&Ue.charCodeAt(at));return Ke}(ue),J,de,Oe)}function K(J,ue,de,Oe){return F._charsWritten=Xe(function(Ue){for(var Ke,at,ut=[],st=0;st<Ue.length;st++)at=Ue.charCodeAt(st),Ke=at>>8,at=at%256,ut.push(at),ut.push(Ke);return ut}(ue),J,de,Oe)}function q(J,ue,de){var Oe="";de=Math.min(J.length,de);for(var Ue=ue;Ue<de;Ue++)Oe+=String.fromCharCode(J[Ue]);return Oe}function re(J,ue,de,Ke){Ke||(Fe(typeof de=="boolean","missing or invalid endian"),Fe(ue!=null,"missing offset"),Fe(ue+1<J.length,"Trying to read beyond buffer length"));var Ue,Ke=J.length;if(!(Ke<=ue))return de?(Ue=J[ue],ue+1<Ke&&(Ue|=J[ue+1]<<8)):(Ue=J[ue]<<8,ue+1<Ke&&(Ue|=J[ue+1])),Ue}function ee(J,ue,de,Ke){Ke||(Fe(typeof de=="boolean","missing or invalid endian"),Fe(ue!=null,"missing offset"),Fe(ue+3<J.length,"Trying to read beyond buffer length"));var Ue,Ke=J.length;if(!(Ke<=ue))return de?(ue+2<Ke&&(Ue=J[ue+2]<<16),ue+1<Ke&&(Ue|=J[ue+1]<<8),Ue|=J[ue],ue+3<Ke&&(Ue+=J[ue+3]<<24>>>0)):(ue+1<Ke&&(Ue=J[ue+1]<<16),ue+2<Ke&&(Ue|=J[ue+2]<<8),ue+3<Ke&&(Ue|=J[ue+3]),Ue+=J[ue]<<24>>>0),Ue}function H(J,ue,de,Oe){if(Oe||(Fe(typeof de=="boolean","missing or invalid endian"),Fe(ue!=null,"missing offset"),Fe(ue+1<J.length,"Trying to read beyond buffer length")),!(J.length<=ue))return Oe=re(J,ue,de,!0),32768&Oe?-1*(65535-Oe+1):Oe}function te(J,ue,de,Oe){if(Oe||(Fe(typeof de=="boolean","missing or invalid endian"),Fe(ue!=null,"missing offset"),Fe(ue+3<J.length,"Trying to read beyond buffer length")),!(J.length<=ue))return Oe=ee(J,ue,de,!0),2147483648&Oe?-1*(4294967295-Oe+1):Oe}function W(J,ue,de,Oe){return Oe||(Fe(typeof de=="boolean","missing or invalid endian"),Fe(ue+3<J.length,"Trying to read beyond buffer length")),B.read(J,ue,de,23,4)}function z(J,ue,de,Oe){return Oe||(Fe(typeof de=="boolean","missing or invalid endian"),Fe(ue+7<J.length,"Trying to read beyond buffer length")),B.read(J,ue,de,52,8)}function X(J,ue,de,Oe,Ue){if(Ue||(Fe(ue!=null,"missing value"),Fe(typeof Oe=="boolean","missing or invalid endian"),Fe(de!=null,"missing offset"),Fe(de+1<J.length,"trying to write beyond buffer length"),tt(ue,65535)),Ue=J.length,!(Ue<=de))for(var Ke=0,at=Math.min(Ue-de,2);Ke<at;Ke++)J[de+Ke]=(ue&255<<8*(Oe?Ke:1-Ke))>>>8*(Oe?Ke:1-Ke)}function Q(J,ue,de,Oe,Ue){if(Ue||(Fe(ue!=null,"missing value"),Fe(typeof Oe=="boolean","missing or invalid endian"),Fe(de!=null,"missing offset"),Fe(de+3<J.length,"trying to write beyond buffer length"),tt(ue,4294967295)),Ue=J.length,!(Ue<=de))for(var Ke=0,at=Math.min(Ue-de,4);Ke<at;Ke++)J[de+Ke]=ue>>>8*(Oe?Ke:3-Ke)&255}function $(J,ue,de,Oe,Ue){Ue||(Fe(ue!=null,"missing value"),Fe(typeof Oe=="boolean","missing or invalid endian"),Fe(de!=null,"missing offset"),Fe(de+1<J.length,"Trying to write beyond buffer length"),nt(ue,32767,-32768)),J.length<=de||X(J,0<=ue?ue:65535+ue+1,de,Oe,Ue)}function oe(J,ue,de,Oe,Ue){Ue||(Fe(ue!=null,"missing value"),Fe(typeof Oe=="boolean","missing or invalid endian"),Fe(de!=null,"missing offset"),Fe(de+3<J.length,"Trying to write beyond buffer length"),nt(ue,2147483647,-2147483648)),J.length<=de||Q(J,0<=ue?ue:4294967295+ue+1,de,Oe,Ue)}function ae(J,ue,de,Oe,Ue){Ue||(Fe(ue!=null,"missing value"),Fe(typeof Oe=="boolean","missing or invalid endian"),Fe(de!=null,"missing offset"),Fe(de+3<J.length,"Trying to write beyond buffer length"),Be(ue,34028234663852886e22,-34028234663852886e22)),J.length<=de||B.write(J,ue,de,Oe,23,4)}function _e(J,ue,de,Oe,Ue){Ue||(Fe(ue!=null,"missing value"),Fe(typeof Oe=="boolean","missing or invalid endian"),Fe(de!=null,"missing offset"),Fe(de+7<J.length,"Trying to write beyond buffer length"),Be(ue,17976931348623157e292,-17976931348623157e292)),J.length<=de||B.write(J,ue,de,Oe,52,8)}i.Buffer=F,i.SlowBuffer=F,i.INSPECT_MAX_BYTES=50,F.poolSize=8192,F._useTypedArrays=function(){try{var J=new ArrayBuffer(0),ue=new Uint8Array(J);return ue.foo=function(){return 42},ue.foo()===42&&typeof ue.subarray=="function"}catch{return!1}}(),F.isEncoding=function(J){switch(String(J).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},F.isBuffer=function(J){return!(J==null||!J._isBuffer)},F.byteLength=function(J,ue){var de;switch(J+="",ue||"utf8"){case"hex":de=J.length/2;break;case"utf8":case"utf-8":de=De(J).length;break;case"ascii":case"binary":case"raw":de=J.length;break;case"base64":de=ke(J).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":de=2*J.length;break;default:throw new Error("Unknown encoding")}return de},F.concat=function(J,ue){if(Fe(xe(J),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),J.length===0)return new F(0);if(J.length===1)return J[0];if(typeof ue!="number")for(Ue=ue=0;Ue<J.length;Ue++)ue+=J[Ue].length;for(var de=new F(ue),Oe=0,Ue=0;Ue<J.length;Ue++){var Ke=J[Ue];Ke.copy(de,Oe),Oe+=Ke.length}return de},F.prototype.write=function(J,ue,de,Oe){isFinite(ue)?isFinite(de)||(Oe=de,de=void 0):(st=Oe,Oe=ue,ue=de,de=st),ue=Number(ue)||0;var Ue,Ke,at,ut,st=this.length-ue;switch((!de||st<(de=Number(de)))&&(de=st),Oe=String(Oe||"utf8").toLowerCase()){case"hex":Ue=function(ct,yt,Ct,vt){Ct=Number(Ct)||0;var ft=ct.length-Ct;(!vt||ft<(vt=Number(vt)))&&(vt=ft),Fe((ft=yt.length)%2==0,"Invalid hex string"),ft/2<vt&&(vt=ft/2);for(var Ut=0;Ut<vt;Ut++){var Nt=parseInt(yt.substr(2*Ut,2),16);Fe(!isNaN(Nt),"Invalid hex string"),ct[Ct+Ut]=Nt}return F._charsWritten=2*Ut,Ut}(this,J,ue,de);break;case"utf8":case"utf-8":Ke=this,at=ue,ut=de,Ue=F._charsWritten=Xe(De(J),Ke,at,ut);break;case"ascii":case"binary":Ue=V(this,J,ue,de);break;case"base64":Ke=this,at=ue,ut=de,Ue=F._charsWritten=Xe(ke(J),Ke,at,ut);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Ue=K(this,J,ue,de);break;default:throw new Error("Unknown encoding")}return Ue},F.prototype.toString=function(J,ue,de){var Oe,Ue,Ke,at,ut=this;if(J=String(J||"utf8").toLowerCase(),ue=Number(ue)||0,(de=de!==void 0?Number(de):ut.length)===ue)return"";switch(J){case"hex":Oe=function(st,ct,yt){var Ct=st.length;(!ct||ct<0)&&(ct=0),(!yt||yt<0||Ct<yt)&&(yt=Ct);for(var vt="",ft=ct;ft<yt;ft++)vt+=Ce(st[ft]);return vt}(ut,ue,de);break;case"utf8":case"utf-8":Oe=function(st,ct,yt){var Ct="",vt="";yt=Math.min(st.length,yt);for(var ft=ct;ft<yt;ft++)st[ft]<=127?(Ct+=et(vt)+String.fromCharCode(st[ft]),vt=""):vt+="%"+st[ft].toString(16);return Ct+et(vt)}(ut,ue,de);break;case"ascii":case"binary":Oe=q(ut,ue,de);break;case"base64":Ue=ut,at=de,Oe=(Ke=ue)===0&&at===Ue.length?w.fromByteArray(Ue):w.fromByteArray(Ue.slice(Ke,at));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Oe=function(st,ct,yt){for(var Ct=st.slice(ct,yt),vt="",ft=0;ft<Ct.length;ft+=2)vt+=String.fromCharCode(Ct[ft]+256*Ct[ft+1]);return vt}(ut,ue,de);break;default:throw new Error("Unknown encoding")}return Oe},F.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},F.prototype.copy=function(J,ue,de,Oe){if(ue=ue||0,(Oe=Oe||Oe===0?Oe:this.length)!==(de=de||0)&&J.length!==0&&this.length!==0){Fe(de<=Oe,"sourceEnd < sourceStart"),Fe(0<=ue&&ue<J.length,"targetStart out of bounds"),Fe(0<=de&&de<this.length,"sourceStart out of bounds"),Fe(0<=Oe&&Oe<=this.length,"sourceEnd out of bounds"),Oe>this.length&&(Oe=this.length);var Ue=(Oe=J.length-ue<Oe-de?J.length-ue+de:Oe)-de;if(Ue<100||!F._useTypedArrays)for(var Ke=0;Ke<Ue;Ke++)J[Ke+ue]=this[Ke+de];else J._set(this.subarray(de,de+Ue),ue)}},F.prototype.slice=function(J,ue){var de=this.length;if(J=Pe(J,de,0),ue=Pe(ue,de,de),F._useTypedArrays)return F._augment(this.subarray(J,ue));for(var Oe=ue-J,Ue=new F(Oe,void 0,!0),Ke=0;Ke<Oe;Ke++)Ue[Ke]=this[Ke+J];return Ue},F.prototype.get=function(J){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(J)},F.prototype.set=function(J,ue){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(J,ue)},F.prototype.readUInt8=function(J,ue){if(ue||(Fe(J!=null,"missing offset"),Fe(J<this.length,"Trying to read beyond buffer length")),!(J>=this.length))return this[J]},F.prototype.readUInt16LE=function(J,ue){return re(this,J,!0,ue)},F.prototype.readUInt16BE=function(J,ue){return re(this,J,!1,ue)},F.prototype.readUInt32LE=function(J,ue){return ee(this,J,!0,ue)},F.prototype.readUInt32BE=function(J,ue){return ee(this,J,!1,ue)},F.prototype.readInt8=function(J,ue){if(ue||(Fe(J!=null,"missing offset"),Fe(J<this.length,"Trying to read beyond buffer length")),!(J>=this.length))return 128&this[J]?-1*(255-this[J]+1):this[J]},F.prototype.readInt16LE=function(J,ue){return H(this,J,!0,ue)},F.prototype.readInt16BE=function(J,ue){return H(this,J,!1,ue)},F.prototype.readInt32LE=function(J,ue){return te(this,J,!0,ue)},F.prototype.readInt32BE=function(J,ue){return te(this,J,!1,ue)},F.prototype.readFloatLE=function(J,ue){return W(this,J,!0,ue)},F.prototype.readFloatBE=function(J,ue){return W(this,J,!1,ue)},F.prototype.readDoubleLE=function(J,ue){return z(this,J,!0,ue)},F.prototype.readDoubleBE=function(J,ue){return z(this,J,!1,ue)},F.prototype.writeUInt8=function(J,ue,de){de||(Fe(J!=null,"missing value"),Fe(ue!=null,"missing offset"),Fe(ue<this.length,"trying to write beyond buffer length"),tt(J,255)),ue>=this.length||(this[ue]=J)},F.prototype.writeUInt16LE=function(J,ue,de){X(this,J,ue,!0,de)},F.prototype.writeUInt16BE=function(J,ue,de){X(this,J,ue,!1,de)},F.prototype.writeUInt32LE=function(J,ue,de){Q(this,J,ue,!0,de)},F.prototype.writeUInt32BE=function(J,ue,de){Q(this,J,ue,!1,de)},F.prototype.writeInt8=function(J,ue,de){de||(Fe(J!=null,"missing value"),Fe(ue!=null,"missing offset"),Fe(ue<this.length,"Trying to write beyond buffer length"),nt(J,127,-128)),ue>=this.length||(0<=J?this.writeUInt8(J,ue,de):this.writeUInt8(255+J+1,ue,de))},F.prototype.writeInt16LE=function(J,ue,de){$(this,J,ue,!0,de)},F.prototype.writeInt16BE=function(J,ue,de){$(this,J,ue,!1,de)},F.prototype.writeInt32LE=function(J,ue,de){oe(this,J,ue,!0,de)},F.prototype.writeInt32BE=function(J,ue,de){oe(this,J,ue,!1,de)},F.prototype.writeFloatLE=function(J,ue,de){ae(this,J,ue,!0,de)},F.prototype.writeFloatBE=function(J,ue,de){ae(this,J,ue,!1,de)},F.prototype.writeDoubleLE=function(J,ue,de){_e(this,J,ue,!0,de)},F.prototype.writeDoubleBE=function(J,ue,de){_e(this,J,ue,!1,de)},F.prototype.fill=function(J,ue,de){if(ue=ue||0,de=de||this.length,Fe(typeof(J=typeof(J=J||0)=="string"?J.charCodeAt(0):J)=="number"&&!isNaN(J),"value is not a number"),Fe(ue<=de,"end < start"),de!==ue&&this.length!==0){Fe(0<=ue&&ue<this.length,"start out of bounds"),Fe(0<=de&&de<=this.length,"end out of bounds");for(var Oe=ue;Oe<de;Oe++)this[Oe]=J}},F.prototype.inspect=function(){for(var J=[],ue=this.length,de=0;de<ue;de++)if(J[de]=Ce(this[de]),de===i.INSPECT_MAX_BYTES){J[de+1]="...";break}return"<Buffer "+J.join(" ")+">"},F.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(F._useTypedArrays)return new F(this).buffer;for(var J=new Uint8Array(this.length),ue=0,de=J.length;ue<de;ue+=1)J[ue]=this[ue];return J.buffer};var ve=F.prototype;function Pe(J,ue,de){return typeof J!="number"?de:ue<=(J=~~J)?ue:0<=J||0<=(J+=ue)?J:0}function fe(J){return(J=~~Math.ceil(+J))<0?0:J}function xe(J){return(Array.isArray||function(ue){return Object.prototype.toString.call(ue)==="[object Array]"})(J)}function Ce(J){return J<16?"0"+J.toString(16):J.toString(16)}function De(J){for(var ue=[],de=0;de<J.length;de++){var Oe=J.charCodeAt(de);if(Oe<=127)ue.push(J.charCodeAt(de));else for(var Ue=de,Ke=(55296<=Oe&&Oe<=57343&&de++,encodeURIComponent(J.slice(Ue,de+1)).substr(1).split("%")),at=0;at<Ke.length;at++)ue.push(parseInt(Ke[at],16))}return ue}function ke(J){return w.toByteArray(J)}function Xe(J,ue,de,Oe){for(var Ue=0;Ue<Oe&&!(Ue+de>=ue.length||Ue>=J.length);Ue++)ue[Ue+de]=J[Ue];return Ue}function et(J){try{return decodeURIComponent(J)}catch{return String.fromCharCode(65533)}}function tt(J,ue){Fe(typeof J=="number","cannot write a non-number as a number"),Fe(0<=J,"specified a negative value for writing an unsigned value"),Fe(J<=ue,"value is larger than maximum value for type"),Fe(Math.floor(J)===J,"value has a fractional component")}function nt(J,ue,de){Fe(typeof J=="number","cannot write a non-number as a number"),Fe(J<=ue,"value larger than maximum allowed value"),Fe(de<=J,"value smaller than minimum allowed value"),Fe(Math.floor(J)===J,"value has a fractional component")}function Be(J,ue,de){Fe(typeof J=="number","cannot write a non-number as a number"),Fe(J<=ue,"value larger than maximum allowed value"),Fe(de<=J,"value smaller than minimum allowed value")}function Fe(J,ue){if(!J)throw new Error(ue||"Failed assertion")}F._augment=function(J){return J._isBuffer=!0,J._get=J.get,J._set=J.set,J.get=ve.get,J.set=ve.set,J.write=ve.write,J.toString=ve.toString,J.toLocaleString=ve.toString,J.toJSON=ve.toJSON,J.copy=ve.copy,J.slice=ve.slice,J.readUInt8=ve.readUInt8,J.readUInt16LE=ve.readUInt16LE,J.readUInt16BE=ve.readUInt16BE,J.readUInt32LE=ve.readUInt32LE,J.readUInt32BE=ve.readUInt32BE,J.readInt8=ve.readInt8,J.readInt16LE=ve.readInt16LE,J.readInt16BE=ve.readInt16BE,J.readInt32LE=ve.readInt32LE,J.readInt32BE=ve.readInt32BE,J.readFloatLE=ve.readFloatLE,J.readFloatBE=ve.readFloatBE,J.readDoubleLE=ve.readDoubleLE,J.readDoubleBE=ve.readDoubleBE,J.writeUInt8=ve.writeUInt8,J.writeUInt16LE=ve.writeUInt16LE,J.writeUInt16BE=ve.writeUInt16BE,J.writeUInt32LE=ve.writeUInt32LE,J.writeUInt32BE=ve.writeUInt32BE,J.writeInt8=ve.writeInt8,J.writeInt16LE=ve.writeInt16LE,J.writeInt16BE=ve.writeInt16BE,J.writeInt32LE=ve.writeInt32LE,J.writeInt32BE=ve.writeInt32BE,J.writeFloatLE=ve.writeFloatLE,J.writeFloatBE=ve.writeFloatBE,J.writeDoubleLE=ve.writeDoubleLE,J.writeDoubleBE=ve.writeDoubleBE,J.fill=ve.fill,J.inspect=ve.inspect,J.toArrayBuffer=ve.toArrayBuffer,J}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,r,i){(function(n,s,w,l,u,m,E,y,D){var w=t("buffer").Buffer,B=4,F=new w(B);F.fill(0),r.exports={hash:function(V,K,q,re){for(var ee=K(function(X,Q){X.length%B!=0&&($=X.length+(B-X.length%B),X=w.concat([X,F],$));for(var $,oe=[],ae=Q?X.readInt32BE:X.readInt32LE,_e=0;_e<X.length;_e+=B)oe.push(ae.call(X,_e));return oe}(V=w.isBuffer(V)?V:new w(V),re),8*V.length),K=re,H=new w(q),te=K?H.writeInt32BE:H.writeInt32LE,W=0;W<ee.length;W++)te.call(H,ee[W],4*W,!0);return H}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,r,i){(function(n,s,w,l,u,m,E,y,D){var w=t("buffer").Buffer,B=t("./sha"),F=t("./sha256"),V=t("./rng"),K={sha1:B,sha256:F,md5:t("./md5")},q=64,re=new w(q);function ee(X,Q){var $=K[X=X||"sha1"],oe=[];return $||H("algorithm:",X,"is not yet supported"),{update:function(ae){return w.isBuffer(ae)||(ae=new w(ae)),oe.push(ae),ae.length,this},digest:function(ae){var _e=w.concat(oe),_e=Q?function(ve,Pe,fe){w.isBuffer(Pe)||(Pe=new w(Pe)),w.isBuffer(fe)||(fe=new w(fe)),Pe.length>q?Pe=ve(Pe):Pe.length<q&&(Pe=w.concat([Pe,re],q));for(var xe=new w(q),Ce=new w(q),De=0;De<q;De++)xe[De]=54^Pe[De],Ce[De]=92^Pe[De];return fe=ve(w.concat([xe,fe])),ve(w.concat([Ce,fe]))}($,Q,_e):$(_e);return oe=null,ae?_e.toString(ae):_e}}}function H(){var X=[].slice.call(arguments).join(" ");throw new Error([X,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}re.fill(0),i.createHash=function(X){return ee(X)},i.createHmac=ee,i.randomBytes=function(X,Q){if(!Q||!Q.call)return new w(V(X));try{Q.call(this,void 0,new w(V(X)))}catch($){Q($)}};var te,W=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],z=function(X){i[X]=function(){H("sorry,",X,"is not implemented yet")}};for(te in W)z(W[te],te)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,r,i){(function(n,s,o,l,u,m,E,y,D){var w=t("./helpers");function B(H,te){H[te>>5]|=128<<te%32,H[14+(te+64>>>9<<4)]=te;for(var W=1732584193,z=-271733879,X=-1732584194,Q=271733878,$=0;$<H.length;$+=16){var oe=W,ae=z,_e=X,ve=Q,W=V(W,z,X,Q,H[$+0],7,-680876936),Q=V(Q,W,z,X,H[$+1],12,-389564586),X=V(X,Q,W,z,H[$+2],17,606105819),z=V(z,X,Q,W,H[$+3],22,-1044525330);W=V(W,z,X,Q,H[$+4],7,-176418897),Q=V(Q,W,z,X,H[$+5],12,1200080426),X=V(X,Q,W,z,H[$+6],17,-1473231341),z=V(z,X,Q,W,H[$+7],22,-45705983),W=V(W,z,X,Q,H[$+8],7,1770035416),Q=V(Q,W,z,X,H[$+9],12,-1958414417),X=V(X,Q,W,z,H[$+10],17,-42063),z=V(z,X,Q,W,H[$+11],22,-1990404162),W=V(W,z,X,Q,H[$+12],7,1804603682),Q=V(Q,W,z,X,H[$+13],12,-40341101),X=V(X,Q,W,z,H[$+14],17,-1502002290),W=K(W,z=V(z,X,Q,W,H[$+15],22,1236535329),X,Q,H[$+1],5,-165796510),Q=K(Q,W,z,X,H[$+6],9,-1069501632),X=K(X,Q,W,z,H[$+11],14,643717713),z=K(z,X,Q,W,H[$+0],20,-373897302),W=K(W,z,X,Q,H[$+5],5,-701558691),Q=K(Q,W,z,X,H[$+10],9,38016083),X=K(X,Q,W,z,H[$+15],14,-660478335),z=K(z,X,Q,W,H[$+4],20,-405537848),W=K(W,z,X,Q,H[$+9],5,568446438),Q=K(Q,W,z,X,H[$+14],9,-1019803690),X=K(X,Q,W,z,H[$+3],14,-187363961),z=K(z,X,Q,W,H[$+8],20,1163531501),W=K(W,z,X,Q,H[$+13],5,-1444681467),Q=K(Q,W,z,X,H[$+2],9,-51403784),X=K(X,Q,W,z,H[$+7],14,1735328473),W=q(W,z=K(z,X,Q,W,H[$+12],20,-1926607734),X,Q,H[$+5],4,-378558),Q=q(Q,W,z,X,H[$+8],11,-2022574463),X=q(X,Q,W,z,H[$+11],16,1839030562),z=q(z,X,Q,W,H[$+14],23,-35309556),W=q(W,z,X,Q,H[$+1],4,-1530992060),Q=q(Q,W,z,X,H[$+4],11,1272893353),X=q(X,Q,W,z,H[$+7],16,-155497632),z=q(z,X,Q,W,H[$+10],23,-1094730640),W=q(W,z,X,Q,H[$+13],4,681279174),Q=q(Q,W,z,X,H[$+0],11,-358537222),X=q(X,Q,W,z,H[$+3],16,-722521979),z=q(z,X,Q,W,H[$+6],23,76029189),W=q(W,z,X,Q,H[$+9],4,-640364487),Q=q(Q,W,z,X,H[$+12],11,-421815835),X=q(X,Q,W,z,H[$+15],16,530742520),W=re(W,z=q(z,X,Q,W,H[$+2],23,-995338651),X,Q,H[$+0],6,-198630844),Q=re(Q,W,z,X,H[$+7],10,1126891415),X=re(X,Q,W,z,H[$+14],15,-1416354905),z=re(z,X,Q,W,H[$+5],21,-57434055),W=re(W,z,X,Q,H[$+12],6,1700485571),Q=re(Q,W,z,X,H[$+3],10,-1894986606),X=re(X,Q,W,z,H[$+10],15,-1051523),z=re(z,X,Q,W,H[$+1],21,-2054922799),W=re(W,z,X,Q,H[$+8],6,1873313359),Q=re(Q,W,z,X,H[$+15],10,-30611744),X=re(X,Q,W,z,H[$+6],15,-1560198380),z=re(z,X,Q,W,H[$+13],21,1309151649),W=re(W,z,X,Q,H[$+4],6,-145523070),Q=re(Q,W,z,X,H[$+11],10,-1120210379),X=re(X,Q,W,z,H[$+2],15,718787259),z=re(z,X,Q,W,H[$+9],21,-343485551),W=ee(W,oe),z=ee(z,ae),X=ee(X,_e),Q=ee(Q,ve)}return Array(W,z,X,Q)}function F(H,te,W,z,X,Q){return ee((te=ee(ee(te,H),ee(z,Q)))<<X|te>>>32-X,W)}function V(H,te,W,z,X,Q,$){return F(te&W|~te&z,H,te,X,Q,$)}function K(H,te,W,z,X,Q,$){return F(te&z|W&~z,H,te,X,Q,$)}function q(H,te,W,z,X,Q,$){return F(te^W^z,H,te,X,Q,$)}function re(H,te,W,z,X,Q,$){return F(W^(te|~z),H,te,X,Q,$)}function ee(H,te){var W=(65535&H)+(65535&te);return(H>>16)+(te>>16)+(W>>16)<<16|65535&W}r.exports=function(H){return w.hash(H,B,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,r,i){(function(n,s,o,l,u,m,E,y,D){var w;r.exports=w||function(B){for(var F,V=new Array(B),K=0;K<B;K++)!(3&K)&&(F=4294967296*Math.random()),V[K]=F>>>((3&K)<<3)&255;return V}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,r,i){(function(n,s,o,l,u,m,E,y,D){var w=t("./helpers");function B(K,q){K[q>>5]|=128<<24-q%32,K[15+(q+64>>9<<4)]=q;for(var re,ee,H,te=Array(80),W=1732584193,z=-271733879,X=-1732584194,Q=271733878,$=-1009589776,oe=0;oe<K.length;oe+=16){for(var ae=W,_e=z,ve=X,Pe=Q,fe=$,xe=0;xe<80;xe++){te[xe]=xe<16?K[oe+xe]:V(te[xe-3]^te[xe-8]^te[xe-14]^te[xe-16],1);var Ce=F(F(V(W,5),(Ce=z,ee=X,H=Q,(re=xe)<20?Ce&ee|~Ce&H:!(re<40)&&re<60?Ce&ee|Ce&H|ee&H:Ce^ee^H)),F(F($,te[xe]),(re=xe)<20?1518500249:re<40?1859775393:re<60?-1894007588:-899497514)),$=Q,Q=X,X=V(z,30),z=W,W=Ce}W=F(W,ae),z=F(z,_e),X=F(X,ve),Q=F(Q,Pe),$=F($,fe)}return Array(W,z,X,Q,$)}function F(K,q){var re=(65535&K)+(65535&q);return(K>>16)+(q>>16)+(re>>16)<<16|65535&re}function V(K,q){return K<<q|K>>>32-q}r.exports=function(K){return w.hash(K,B,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,r,i){(function(n,s,o,l,u,m,E,y,D){function w(q,re){var ee=(65535&q)+(65535&re);return(q>>16)+(re>>16)+(ee>>16)<<16|65535&ee}function B(q,re){var ee,H=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),te=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),W=new Array(64);q[re>>5]|=128<<24-re%32,q[15+(re+64>>9<<4)]=re;for(var z,X,Q=0;Q<q.length;Q+=16){for(var $=te[0],oe=te[1],ae=te[2],_e=te[3],ve=te[4],Pe=te[5],fe=te[6],xe=te[7],Ce=0;Ce<64;Ce++)W[Ce]=Ce<16?q[Ce+Q]:w(w(w((X=W[Ce-2],V(X,17)^V(X,19)^K(X,10)),W[Ce-7]),(X=W[Ce-15],V(X,7)^V(X,18)^K(X,3))),W[Ce-16]),ee=w(w(w(w(xe,V(X=ve,6)^V(X,11)^V(X,25)),ve&Pe^~ve&fe),H[Ce]),W[Ce]),z=w(V(z=$,2)^V(z,13)^V(z,22),$&oe^$&ae^oe&ae),xe=fe,fe=Pe,Pe=ve,ve=w(_e,ee),_e=ae,ae=oe,oe=$,$=w(ee,z);te[0]=w($,te[0]),te[1]=w(oe,te[1]),te[2]=w(ae,te[2]),te[3]=w(_e,te[3]),te[4]=w(ve,te[4]),te[5]=w(Pe,te[5]),te[6]=w(fe,te[6]),te[7]=w(xe,te[7])}return te}var F=t("./helpers"),V=function(q,re){return q>>>re|q<<32-re},K=function(q,re){return q>>>re};r.exports=function(q){return F.hash(q,B,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,r,i){(function(n,s,o,l,u,m,E,y,D){i.read=function(w,B,F,V,Q){var q,re,ee=8*Q-V-1,H=(1<<ee)-1,te=H>>1,W=-7,z=F?Q-1:0,X=F?-1:1,Q=w[B+z];for(z+=X,q=Q&(1<<-W)-1,Q>>=-W,W+=ee;0<W;q=256*q+w[B+z],z+=X,W-=8);for(re=q&(1<<-W)-1,q>>=-W,W+=V;0<W;re=256*re+w[B+z],z+=X,W-=8);if(q===0)q=1-te;else{if(q===H)return re?NaN:1/0*(Q?-1:1);re+=Math.pow(2,V),q-=te}return(Q?-1:1)*re*Math.pow(2,q-V)},i.write=function(w,B,F,V,K,$){var re,ee,H=8*$-K-1,te=(1<<H)-1,W=te>>1,z=K===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=V?0:$-1,Q=V?1:-1,$=B<0||B===0&&1/B<0?1:0;for(B=Math.abs(B),isNaN(B)||B===1/0?(ee=isNaN(B)?1:0,re=te):(re=Math.floor(Math.log(B)/Math.LN2),B*(V=Math.pow(2,-re))<1&&(re--,V*=2),2<=(B+=1<=re+W?z/V:z*Math.pow(2,1-W))*V&&(re++,V/=2),te<=re+W?(ee=0,re=te):1<=re+W?(ee=(B*V-1)*Math.pow(2,K),re+=W):(ee=B*Math.pow(2,W-1)*Math.pow(2,K),re=0));8<=K;w[F+X]=255&ee,X+=Q,ee/=256,K-=8);for(re=re<<K|ee,H+=K;0<H;w[F+X]=255&re,X+=Q,re/=256,H-=8);w[F+X-Q]|=128*$}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,r,i){(function(n,s,o,l,u,m,E,y,D){var w,B,F;function V(){}(n=r.exports={}).nextTick=(B=typeof window<"u"&&window.setImmediate,F=typeof window<"u"&&window.postMessage&&window.addEventListener,B?function(K){return window.setImmediate(K)}:F?(w=[],window.addEventListener("message",function(K){var q=K.source;q!==window&&q!==null||K.data!=="process-tick"||(K.stopPropagation(),0<w.length&&w.shift()())},!0),function(K){w.push(K),window.postMessage("process-tick","*")}):function(K){setTimeout(K,0)}),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.on=V,n.addListener=V,n.once=V,n.off=V,n.removeListener=V,n.removeAllListeners=V,n.emit=V,n.binding=function(K){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(K){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})});var An=Mi((Za,yn)=>{typeof window<"u"&&function(t,r){typeof Za=="object"&&typeof yn=="object"?yn.exports=r():typeof define=="function"&&define.amd?define([],r):typeof Za=="object"?Za.Hls=r():t.Hls=r()}(Za,()=>(()=>{var t={21:(s,o,l)=>{"use strict";l.r(o),l.d(o,{default:()=>B});var u=function(){function F(V,K){this.subtle=void 0,this.aesIV=void 0,this.subtle=V,this.aesIV=K}return F.prototype.decrypt=function(V,K){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},K,V)},F}(),m=function(){function F(V,K){this.subtle=void 0,this.key=void 0,this.subtle=V,this.key=K}return F.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},F}(),E=l(145),y=function(){function F(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var V=F.prototype;return V.uint8ArrayToUint32Array_=function(K){for(var q=new DataView(K),re=new Uint32Array(4),ee=0;ee<4;ee++)re[ee]=q.getUint32(4*ee);return re},V.initTable=function(){var K=this.sBox,q=this.invSBox,re=this.subMix,ee=re[0],H=re[1],te=re[2],W=re[3],z=this.invSubMix,X=z[0],Q=z[1],$=z[2],oe=z[3],ae=new Uint32Array(256),_e=0,ve=0,Pe=0;for(Pe=0;Pe<256;Pe++)ae[Pe]=Pe<128?Pe<<1:Pe<<1^283;for(Pe=0;Pe<256;Pe++){var fe=ve^ve<<1^ve<<2^ve<<3^ve<<4;fe=fe>>>8^255&fe^99,K[_e]=fe,q[fe]=_e;var xe=ae[_e],Ce=ae[xe],De=ae[Ce],ke=257*ae[fe]^16843008*fe;ee[_e]=ke<<24|ke>>>8,H[_e]=ke<<16|ke>>>16,te[_e]=ke<<8|ke>>>24,W[_e]=ke,ke=16843009*De^65537*Ce^257*xe^16843008*_e,X[fe]=ke<<24|ke>>>8,Q[fe]=ke<<16|ke>>>16,$[fe]=ke<<8|ke>>>24,oe[fe]=ke,_e?(_e=xe^ae[ae[ae[De^xe]]],ve^=ae[ae[ve]]):_e=ve=1}},V.expandKey=function(K){for(var q=this.uint8ArrayToUint32Array_(K),re=!0,ee=0;ee<q.length&&re;)re=q[ee]===this.key[ee],ee++;if(!re){this.key=q;var H=this.keySize=q.length;if(H!==4&&H!==6&&H!==8)throw new Error("Invalid aes key size="+H);var te,W,z,X,Q=this.ksRows=4*(H+6+1),$=this.keySchedule=new Uint32Array(Q),oe=this.invKeySchedule=new Uint32Array(Q),ae=this.sBox,_e=this.rcon,ve=this.invSubMix,Pe=ve[0],fe=ve[1],xe=ve[2],Ce=ve[3];for(te=0;te<Q;te++)te<H?z=$[te]=q[te]:(X=z,te%H==0?(X=ae[(X=X<<8|X>>>24)>>>24]<<24|ae[X>>>16&255]<<16|ae[X>>>8&255]<<8|ae[255&X],X^=_e[te/H|0]<<24):H>6&&te%H==4&&(X=ae[X>>>24]<<24|ae[X>>>16&255]<<16|ae[X>>>8&255]<<8|ae[255&X]),$[te]=z=($[te-H]^X)>>>0);for(W=0;W<Q;W++)te=Q-W,X=3&W?$[te]:$[te-4],oe[W]=W<4||te<=4?X:Pe[ae[X>>>24]]^fe[ae[X>>>16&255]]^xe[ae[X>>>8&255]]^Ce[ae[255&X]],oe[W]=oe[W]>>>0}},V.networkToHostOrderSwap=function(K){return K<<24|(65280&K)<<8|(16711680&K)>>8|K>>>24},V.decrypt=function(K,q,re){for(var ee,H,te,W,z,X,Q,$,oe,ae,_e,ve,Pe,fe,xe=this.keySize+6,Ce=this.invKeySchedule,De=this.invSBox,ke=this.invSubMix,Xe=ke[0],et=ke[1],tt=ke[2],nt=ke[3],Be=this.uint8ArrayToUint32Array_(re),Fe=Be[0],J=Be[1],ue=Be[2],de=Be[3],Oe=new Int32Array(K),Ue=new Int32Array(Oe.length),Ke=this.networkToHostOrderSwap;q<Oe.length;){for(oe=Ke(Oe[q]),ae=Ke(Oe[q+1]),_e=Ke(Oe[q+2]),ve=Ke(Oe[q+3]),z=oe^Ce[0],X=ve^Ce[1],Q=_e^Ce[2],$=ae^Ce[3],Pe=4,fe=1;fe<xe;fe++)ee=Xe[z>>>24]^et[X>>16&255]^tt[Q>>8&255]^nt[255&$]^Ce[Pe],H=Xe[X>>>24]^et[Q>>16&255]^tt[$>>8&255]^nt[255&z]^Ce[Pe+1],te=Xe[Q>>>24]^et[$>>16&255]^tt[z>>8&255]^nt[255&X]^Ce[Pe+2],W=Xe[$>>>24]^et[z>>16&255]^tt[X>>8&255]^nt[255&Q]^Ce[Pe+3],z=ee,X=H,Q=te,$=W,Pe+=4;ee=De[z>>>24]<<24^De[X>>16&255]<<16^De[Q>>8&255]<<8^De[255&$]^Ce[Pe],H=De[X>>>24]<<24^De[Q>>16&255]<<16^De[$>>8&255]<<8^De[255&z]^Ce[Pe+1],te=De[Q>>>24]<<24^De[$>>16&255]<<16^De[z>>8&255]<<8^De[255&X]^Ce[Pe+2],W=De[$>>>24]<<24^De[z>>16&255]<<16^De[X>>8&255]<<8^De[255&Q]^Ce[Pe+3],Ue[q]=Ke(ee^Fe),Ue[q+1]=Ke(W^J),Ue[q+2]=Ke(te^ue),Ue[q+3]=Ke(H^de),Fe=oe,J=ae,ue=_e,de=ve,q+=4}return Ue.buffer},F}(),D=l(93),w=l(63),B=function(){function F(K,q,re){var ee=(re===void 0?{}:re).removePKCS7Padding,H=ee===void 0||ee;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=K,this.config=q,this.removePKCS7Padding=H,H)try{var te=self.crypto;te&&(this.subtle=te.subtle||te.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var V=F.prototype;return V.destroy=function(){this.observer=null},V.isSync=function(){return this.config.enableSoftwareAES},V.flush=function(){var K=this.currentResult;if(K){var q,re,ee,H=new Uint8Array(K);return this.reset(),this.removePKCS7Padding?(ee=(re=(q=H).byteLength)&&new DataView(q.buffer).getUint8(re-1))?(0,E.sliceUint8)(q,0,re-ee):q:H}this.reset()},V.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},V.decrypt=function(K,q,re,ee){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(K),q,re);var H=this.flush();H&&ee(H.buffer)}else this.webCryptoDecrypt(new Uint8Array(K),q,re).then(ee)},V.softwareDecrypt=function(K,q,re){var ee=this.currentIV,H=this.currentResult,te=this.remainderData;this.logOnce("JS AES decrypt"),te&&(K=(0,w.appendUint8Array)(te,K),this.remainderData=null);var W=this.getValidChunk(K);if(!W.length)return null;ee&&(re=ee);var z=this.softwareDecrypter;z||(z=this.softwareDecrypter=new y),z.expandKey(q);var X=H;return this.currentResult=z.decrypt(W.buffer,0,re),this.currentIV=(0,E.sliceUint8)(W,-16).buffer,X||null},V.webCryptoDecrypt=function(K,q,re){var ee=this,H=this.subtle;return this.key===q&&this.fastAesKey||(this.key=q,this.fastAesKey=new m(H,q)),this.fastAesKey.expandKey().then(function(te){return H?new u(H,re).decrypt(K.buffer,te):Promise.reject(new Error("web crypto not initialized"))}).catch(function(te){return ee.onWebCryptoError(te,K,q,re)})},V.onWebCryptoError=function(K,q,re,ee){return D.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",K),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(q,re,ee)},V.getValidChunk=function(K){var q=K,re=K.length-K.length%16;return re!==K.length&&(q=(0,E.sliceUint8)(K,0,re),this.remainderData=(0,E.sliceUint8)(K,re)),q},V.logOnce=function(K){this.logEnabled&&(D.logger.log("[decrypter.ts]: "+K),this.logEnabled=!1)},F}()},181:(s,o,l)=>{"use strict";l.r(o),l.d(o,{canParse:()=>w,decodeFrame:()=>q,getID3Data:()=>y,getID3Frames:()=>K,getTimeStamp:()=>B,isFooter:()=>E,isHeader:()=>m,isTimeStampFrame:()=>F,testables:()=>z,utf8ArrayToStr:()=>W});var u,m=function(Q,$){return $+10<=Q.length&&Q[$]===73&&Q[$+1]===68&&Q[$+2]===51&&Q[$+3]<255&&Q[$+4]<255&&Q[$+6]<128&&Q[$+7]<128&&Q[$+8]<128&&Q[$+9]<128},E=function(Q,$){return $+10<=Q.length&&Q[$]===51&&Q[$+1]===68&&Q[$+2]===73&&Q[$+3]<255&&Q[$+4]<255&&Q[$+6]<128&&Q[$+7]<128&&Q[$+8]<128&&Q[$+9]<128},y=function(Q,$){for(var oe=$,ae=0;m(Q,$);)ae+=10,ae+=D(Q,$+6),E(Q,$+10)&&(ae+=10),$+=ae;if(ae>0)return Q.subarray(oe,oe+ae)},D=function(Q,$){var oe=0;return oe=(127&Q[$])<<21,oe|=(127&Q[$+1])<<14,(oe|=(127&Q[$+2])<<7)|127&Q[$+3]},w=function(Q,$){return m(Q,$)&&D(Q,$+6)+10<=Q.length-$},B=function(Q){for(var $=K(Q),oe=0;oe<$.length;oe++){var ae=$[oe];if(F(ae))return te(ae)}},F=function(Q){return Q&&Q.key==="PRIV"&&Q.info==="com.apple.streaming.transportStreamTimestamp"},V=function(Q){var $=String.fromCharCode(Q[0],Q[1],Q[2],Q[3]),oe=D(Q,4);return{type:$,size:oe,data:Q.subarray(10,10+oe)}},K=function(Q){for(var $=0,oe=[];m(Q,$);){for(var ae=D(Q,$+6),_e=($+=10)+ae;$+8<_e;){var ve=V(Q.subarray($)),Pe=q(ve);Pe&&oe.push(Pe),$+=ve.size+10}E(Q,$)&&($+=10)}return oe},q=function(Q){return Q.type==="PRIV"?re(Q):Q.type[0]==="W"?H(Q):ee(Q)},re=function(Q){if(!(Q.size<2)){var $=W(Q.data,!0),oe=new Uint8Array(Q.data.subarray($.length+1));return{key:Q.type,info:$,data:oe.buffer}}},ee=function(Q){if(!(Q.size<2)){if(Q.type==="TXXX"){var $=1,oe=W(Q.data.subarray($),!0);$+=oe.length+1;var ae=W(Q.data.subarray($));return{key:Q.type,info:oe,data:ae}}var _e=W(Q.data.subarray(1));return{key:Q.type,data:_e}}},H=function(Q){if(Q.type==="WXXX"){if(Q.size<2)return;var $=1,oe=W(Q.data.subarray($),!0);$+=oe.length+1;var ae=W(Q.data.subarray($));return{key:Q.type,info:oe,data:ae}}var _e=W(Q.data);return{key:Q.type,data:_e}},te=function(Q){if(Q.data.byteLength===8){var $=new Uint8Array(Q.data),oe=1&$[3],ae=($[4]<<23)+($[5]<<15)+($[6]<<7)+$[7];return ae/=45,oe&&(ae+=4772185884e-2),Math.round(ae)}},W=function(Q,$){$===void 0&&($=!1);var oe=X();if(oe){var ae=oe.decode(Q);if($){var _e=ae.indexOf("\0");return _e!==-1?ae.substring(0,_e):ae}return ae.replace(/\0/g,"")}for(var ve,Pe,fe,xe=Q.length,Ce="",De=0;De<xe;){if((ve=Q[De++])===0&&$)return Ce;if(ve!==0&&ve!==3)switch(ve>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:Ce+=String.fromCharCode(ve);break;case 12:case 13:Pe=Q[De++],Ce+=String.fromCharCode((31&ve)<<6|63&Pe);break;case 14:Pe=Q[De++],fe=Q[De++],Ce+=String.fromCharCode((15&ve)<<12|(63&Pe)<<6|(63&fe)<<0)}}return Ce},z={decodeTextFrame:ee};function X(){return u||self.TextDecoder===void 0||(u=new self.TextDecoder("utf-8")),u}},182:(s,o,l)=>{"use strict";l.r(o),l.d(o,{default:()=>D});var u=l(544),m=l(851),E=l(93),y=l(729);function D(V){var K=new y.EventEmitter,q=function(re,ee){V.postMessage({event:re,data:ee})};K.on(m.Events.FRAG_DECRYPTED,q),K.on(m.Events.ERROR,q),V.addEventListener("message",function(re){var ee=re.data;switch(ee.cmd){case"init":var H=JSON.parse(ee.config);V.transmuxer=new u.default(K,ee.typeSupported,H,ee.vendor,ee.id),(0,E.enableLogs)(H.debug,ee.id),function(){var X=function($){E.logger[$]=function(oe){q("workerLog",{logType:$,message:oe})}};for(var Q in E.logger)X(Q)}(),q("init",null);break;case"configure":V.transmuxer.configure(ee.config);break;case"demux":var te=V.transmuxer.push(ee.data,ee.decryptdata,ee.chunkMeta,ee.state);(0,u.isPromise)(te)?te.then(function(X){w(V,X)}):w(V,te);break;case"flush":var W=ee.chunkMeta,z=V.transmuxer.flush(W);(0,u.isPromise)(z)?z.then(function(X){F(V,X,W)}):F(V,z,W)}})}function w(V,K){if(!((q=K.remuxResult).audio||q.video||q.text||q.id3||q.initSegment))return!1;var q,re=[],ee=K.remuxResult,H=ee.audio,te=ee.video;return H&&B(re,H),te&&B(re,te),V.postMessage({event:"transmuxComplete",data:K},re),!0}function B(V,K){K.data1&&V.push(K.data1.buffer),K.data2&&V.push(K.data2.buffer)}function F(V,K,q){K.reduce(function(re,ee){return w(V,ee)||re},!1)||V.postMessage({event:"transmuxComplete",data:K[0]}),V.postMessage({event:"flush",data:q})}},544:(s,o,l)=>{"use strict";l.r(o),l.d(o,{TransmuxConfig:()=>lr,TransmuxState:()=>$t,default:()=>sr,isPromise:()=>Qt});var u=l(851),m=l(973),E=l(21),y=l(965),D=l(181),w=l(856);function B(Ae,ye){return Ae===void 0&&(Ae=""),ye===void 0&&(ye=9e4),{type:Ae,id:-1,pid:-1,inputTimeScale:ye,sequenceNumber:-1,samples:[],dropped:0}}var F=l(63),V=l(145),K=function(){function Ae(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var ye=Ae.prototype;return ye.resetInitSegment=function(Z,me,ge,Se){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},ye.resetTimeStamp=function(Z){this.initPTS=Z,this.resetContiguity()},ye.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},ye.canParse=function(Z,me){return!1},ye.appendFrame=function(Z,me,ge){},ye.demux=function(Z,me){this.cachedData&&(Z=(0,F.appendUint8Array)(this.cachedData,Z),this.cachedData=null);var ge,Se=D.getID3Data(Z,0),be=Se?Se.length:0,we=this._audioTrack,$e=this._id3Track,ze=Se?D.getTimeStamp(Se):void 0,Ge=Z.length;for((this.basePTS===null||this.frameIndex===0&&(0,y.isFiniteNumber)(ze))&&(this.basePTS=q(ze,me,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),Se&&Se.length>0&&$e.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:Se,type:w.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});be<Ge;){if(this.canParse(Z,be)){var Ze=this.appendFrame(we,Z,be);Ze?(this.frameIndex++,this.lastPTS=Ze.sample.pts,ge=be+=Ze.length):be=Ge}else D.canParse(Z,be)?(Se=D.getID3Data(Z,be),$e.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:Se,type:w.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),ge=be+=Se.length):be++;if(be===Ge&&ge!==Ge){var it=(0,V.sliceUint8)(Z,ge);this.cachedData?this.cachedData=(0,F.appendUint8Array)(this.cachedData,it):this.cachedData=it}}return{audioTrack:we,videoTrack:B(),id3Track:$e,textTrack:B()}},ye.demuxSampleAes=function(Z,me,ge){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},ye.flush=function(Z){var me=this.cachedData;return me&&(this.cachedData=null,this.demux(me,0)),{audioTrack:this._audioTrack,videoTrack:B(),id3Track:this._id3Track,textTrack:B()}},ye.destroy=function(){},Ae}(),q=function(Ae,ye,Z){return(0,y.isFiniteNumber)(Ae)?90*Ae:9e4*ye+(Z||0)};let re=K;var ee=l(93);function H(Ae,ye){return Ae[ye]===255&&(246&Ae[ye+1])==240}function te(Ae,ye){return 1&Ae[ye+1]?7:9}function W(Ae,ye){return(3&Ae[ye+3])<<11|Ae[ye+4]<<3|(224&Ae[ye+5])>>>5}function z(Ae,ye){return ye+1<Ae.length&&H(Ae,ye)}function X(Ae,ye){if(z(Ae,ye)){var Z=te(Ae,ye);if(ye+Z>=Ae.length)return!1;var me=W(Ae,ye);if(me<=Z)return!1;var ge=ye+me;return ge===Ae.length||z(Ae,ge)}return!1}function Q(Ae,ye,Z,me,ge){if(!Ae.samplerate){var Se=function(be,we,$e,ze){var Ge,Ze,it,rt,ot=navigator.userAgent.toLowerCase(),gt=ze,St=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Ge=1+((192&we[$e+2])>>>6);var lt=(60&we[$e+2])>>>2;if(!(lt>St.length-1))return it=(1&we[$e+2])<<2,it|=(192&we[$e+3])>>>6,ee.logger.log("manifest codec:"+ze+", ADTS type:"+Ge+", samplingIndex:"+lt),/firefox/i.test(ot)?lt>=6?(Ge=5,rt=new Array(4),Ze=lt-3):(Ge=2,rt=new Array(2),Ze=lt):ot.indexOf("android")!==-1?(Ge=2,rt=new Array(2),Ze=lt):(Ge=5,rt=new Array(4),ze&&(ze.indexOf("mp4a.40.29")!==-1||ze.indexOf("mp4a.40.5")!==-1)||!ze&&lt>=6?Ze=lt-3:((ze&&ze.indexOf("mp4a.40.2")!==-1&&(lt>=6&&it===1||/vivaldi/i.test(ot))||!ze&&it===1)&&(Ge=2,rt=new Array(2)),Ze=lt)),rt[0]=Ge<<3,rt[0]|=(14&lt)>>1,rt[1]|=(1&lt)<<7,rt[1]|=it<<3,Ge===5&&(rt[1]|=(14&Ze)>>1,rt[2]=(1&Ze)<<7,rt[2]|=8,rt[3]=0),{config:rt,samplerate:St[lt],channelCount:it,codec:"mp4a.40."+Ge,manifestCodec:gt};be.trigger(u.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+lt})}(ye,Z,me,ge);if(!Se)return;Ae.config=Se.config,Ae.samplerate=Se.samplerate,Ae.channelCount=Se.channelCount,Ae.codec=Se.codec,Ae.manifestCodec=Se.manifestCodec,ee.logger.log("parsed codec:"+Ae.codec+", rate:"+Se.samplerate+", channels:"+Se.channelCount)}}function $(Ae){return 9216e4/Ae}function oe(Ae,ye,Z,me,ge){var Se,be=me+ge*$(Ae.samplerate),we=function(ot,gt){var St=te(ot,gt);if(gt+St<=ot.length){var lt=W(ot,gt)-St;if(lt>0)return{headerLength:St,frameLength:lt}}}(ye,Z);if(we){var $e=we.frameLength,ze=we.headerLength,Ge=ze+$e,Ze=Math.max(0,Z+Ge-ye.length);Ze?(Se=new Uint8Array(Ge-ze)).set(ye.subarray(Z+ze,ye.length),0):Se=ye.subarray(Z+ze,Z+Ge);var it={unit:Se,pts:be};return Ze||Ae.samples.push(it),{sample:it,length:Ge,missing:Ze}}var rt=ye.length-Z;return(Se=new Uint8Array(rt)).set(ye.subarray(Z,ye.length),0),{sample:{unit:Se,pts:be},length:rt,missing:-1}}function ae(Ae,ye){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Z,me){return Z.__proto__=me,Z},ae(Ae,ye)}let _e=function(Ae){var ye,Z;function me(Se,be){var we;return(we=Ae.call(this)||this).observer=void 0,we.config=void 0,we.observer=Se,we.config=be,we}Z=Ae,(ye=me).prototype=Object.create(Z.prototype),ye.prototype.constructor=ye,ae(ye,Z);var ge=me.prototype;return ge.resetInitSegment=function(Se,be,we,$e){Ae.prototype.resetInitSegment.call(this,Se,be,we,$e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:be,duration:$e,inputTimeScale:9e4,dropped:0}},me.probe=function(Se){if(!Se)return!1;for(var be=(D.getID3Data(Se,0)||[]).length,we=Se.length;be<we;be++)if(X(Se,be))return ee.logger.log("ADTS sync word found !"),!0;return!1},ge.canParse=function(Se,be){return function(we,$e){return function(ze,Ge){return Ge+5<ze.length}(we,$e)&&H(we,$e)&&W(we,$e)<=we.length-$e}(Se,be)},ge.appendFrame=function(Se,be,we){Q(Se,this.observer,be,we,Se.manifestCodec);var $e=oe(Se,be,we,this.basePTS,this.frameIndex);if($e&&$e.missing===0)return $e},me}(re);var ve=/\/emsg[-/]ID3/i;let Pe=function(){function Ae(Z,me){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=me}var ye=Ae.prototype;return ye.resetTimeStamp=function(){},ye.resetInitSegment=function(Z,me,ge,Se){var be=(0,F.parseInitSegment)(Z),we=this.videoTrack=B("video",1),$e=this.audioTrack=B("audio",1),ze=this.txtTrack=B("text",1);if(this.id3Track=B("id3",1),this.timeOffset=0,be.video){var Ge=be.video,Ze=Ge.id,it=Ge.timescale,rt=Ge.codec;we.id=Ze,we.timescale=ze.timescale=it,we.codec=rt}if(be.audio){var ot=be.audio,gt=ot.id,St=ot.timescale,lt=ot.codec;$e.id=gt,$e.timescale=St,$e.codec=lt}ze.id=F.RemuxerTrackIdConfig.text,we.sampleDuration=0,we.duration=$e.duration=Se},ye.resetContiguity=function(){},Ae.probe=function(Z){return Z=Z.length>16384?Z.subarray(0,16384):Z,(0,F.findBox)(Z,["moof"]).length>0},ye.demux=function(Z,me){this.timeOffset=me;var ge=Z,Se=this.videoTrack,be=this.txtTrack;if(this.config.progressive){this.remainderData&&(ge=(0,F.appendUint8Array)(this.remainderData,Z));var we=(0,F.segmentValidRange)(ge);this.remainderData=we.remainder,Se.samples=we.valid||new Uint8Array}else Se.samples=ge;var $e=this.extractID3Track(Se,me);return be.samples=(0,F.parseSamples)(me,Se),{videoTrack:Se,audioTrack:this.audioTrack,id3Track:$e,textTrack:this.txtTrack}},ye.flush=function(){var Z=this.timeOffset,me=this.videoTrack,ge=this.txtTrack;me.samples=this.remainderData||new Uint8Array,this.remainderData=null;var Se=this.extractID3Track(me,this.timeOffset);return ge.samples=(0,F.parseSamples)(Z,me),{videoTrack:me,audioTrack:B(),id3Track:Se,textTrack:B()}},ye.extractID3Track=function(Z,me){var ge=this.id3Track;if(Z.samples.length){var Se=(0,F.findBox)(Z.samples,["emsg"]);Se&&Se.forEach(function(be){var we=(0,F.parseEmsg)(be);if(ve.test(we.schemeIdUri)){var $e=(0,y.isFiniteNumber)(we.presentationTime)?we.presentationTime/we.timeScale:me+we.presentationTimeDelta/we.timeScale,ze=we.eventDuration===4294967295?Number.POSITIVE_INFINITY:we.eventDuration/we.timeScale;ze<=.001&&(ze=Number.POSITIVE_INFINITY);var Ge=we.payload;ge.samples.push({data:Ge,len:Ge.byteLength,dts:$e,pts:$e,type:w.MetadataSchema.emsg,duration:ze})}})}return ge},ye.demuxSampleAes=function(Z,me,ge){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},ye.destroy=function(){},Ae}();var fe=null,xe=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ce=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],De=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],ke=[0,1,1,4];function Xe(Ae,ye,Z,me,ge){if(!(Z+24>ye.length)){var Se=et(ye,Z);if(Se&&Z+Se.frameLength<=ye.length){var be=me+ge*(9e4*Se.samplesPerFrame/Se.sampleRate),we={unit:ye.subarray(Z,Z+Se.frameLength),pts:be,dts:be};return Ae.config=[],Ae.channelCount=Se.channelCount,Ae.samplerate=Se.sampleRate,Ae.samples.push(we),{sample:we,length:Se.frameLength,missing:0}}}}function et(Ae,ye){var Z=Ae[ye+1]>>3&3,me=Ae[ye+1]>>1&3,ge=Ae[ye+2]>>4&15,Se=Ae[ye+2]>>2&3;if(Z!==1&&ge!==0&&ge!==15&&Se!==3){var be=Ae[ye+2]>>1&1,we=Ae[ye+3]>>6,$e=1e3*xe[14*(Z===3?3-me:me===3?3:4)+ge-1],ze=Ce[3*(Z===3?0:Z===2?1:2)+Se],Ge=we===3?1:2,Ze=De[Z][me],it=ke[me],rt=8*Ze*it,ot=Math.floor(Ze*$e/ze+be)*it;if(fe===null){var gt=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);fe=gt?parseInt(gt[1]):0}return fe&&fe<=87&&me===2&&$e>=224e3&&we===0&&(Ae[ye+3]=128|Ae[ye+3]),{sampleRate:ze,channelCount:Ge,frameLength:ot,samplesPerFrame:rt}}}function tt(Ae,ye){return Ae[ye]===255&&(224&Ae[ye+1])==224&&(6&Ae[ye+1])!=0}function nt(Ae,ye){return ye+1<Ae.length&&tt(Ae,ye)}function Be(Ae,ye){if(ye+1<Ae.length&&tt(Ae,ye)){var Z=et(Ae,ye),me=4;Z!=null&&Z.frameLength&&(me=Z.frameLength);var ge=ye+me;return ge===Ae.length||nt(Ae,ge)}return!1}let Fe=function(){function Ae(Z){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=Z,this.bytesAvailable=Z.byteLength,this.word=0,this.bitsAvailable=0}var ye=Ae.prototype;return ye.loadWord=function(){var Z=this.data,me=this.bytesAvailable,ge=Z.byteLength-me,Se=new Uint8Array(4),be=Math.min(4,me);if(be===0)throw new Error("no bytes available");Se.set(Z.subarray(ge,ge+be)),this.word=new DataView(Se.buffer).getUint32(0),this.bitsAvailable=8*be,this.bytesAvailable-=be},ye.skipBits=function(Z){var me;this.bitsAvailable>Z?(this.word<<=Z,this.bitsAvailable-=Z):(Z-=this.bitsAvailable,Z-=(me=Z>>3)>>3,this.bytesAvailable-=me,this.loadWord(),this.word<<=Z,this.bitsAvailable-=Z)},ye.readBits=function(Z){var me=Math.min(this.bitsAvailable,Z),ge=this.word>>>32-me;return Z>32&&ee.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=me,this.bitsAvailable>0?this.word<<=me:this.bytesAvailable>0&&this.loadWord(),(me=Z-me)>0&&this.bitsAvailable?ge<<me|this.readBits(me):ge},ye.skipLZ=function(){var Z;for(Z=0;Z<this.bitsAvailable;++Z)if(this.word&2147483648>>>Z)return this.word<<=Z,this.bitsAvailable-=Z,Z;return this.loadWord(),Z+this.skipLZ()},ye.skipUEG=function(){this.skipBits(1+this.skipLZ())},ye.skipEG=function(){this.skipBits(1+this.skipLZ())},ye.readUEG=function(){var Z=this.skipLZ();return this.readBits(Z+1)-1},ye.readEG=function(){var Z=this.readUEG();return 1&Z?1+Z>>>1:-1*(Z>>>1)},ye.readBoolean=function(){return this.readBits(1)===1},ye.readUByte=function(){return this.readBits(8)},ye.readUShort=function(){return this.readBits(16)},ye.readUInt=function(){return this.readBits(32)},ye.skipScalingList=function(Z){for(var me=8,ge=8,Se=0;Se<Z;Se++)ge!==0&&(ge=(me+this.readEG()+256)%256),me=ge===0?me:ge},ye.readSPS=function(){var Z,me,ge,Se=0,be=0,we=0,$e=0,ze=this.readUByte.bind(this),Ge=this.readBits.bind(this),Ze=this.readUEG.bind(this),it=this.readBoolean.bind(this),rt=this.skipBits.bind(this),ot=this.skipEG.bind(this),gt=this.skipUEG.bind(this),St=this.skipScalingList.bind(this);ze();var lt=ze();if(Ge(5),rt(3),ze(),gt(),lt===100||lt===110||lt===122||lt===244||lt===44||lt===83||lt===86||lt===118||lt===128){var At=Ze();if(At===3&&rt(1),gt(),gt(),rt(1),it())for(me=At!==3?8:12,ge=0;ge<me;ge++)it()&&St(ge<6?16:64)}gt();var Ht=Ze();if(Ht===0)Ze();else if(Ht===1)for(rt(1),ot(),ot(),Z=Ze(),ge=0;ge<Z;ge++)ot();gt(),rt(1);var Vt=Ze(),Lt=Ze(),Jt=Ge(1);Jt===0&&rt(1),rt(1),it()&&(Se=Ze(),be=Ze(),we=Ze(),$e=Ze());var mt=[1,1];if(it()&&it())switch(ze()){case 1:mt=[1,1];break;case 2:mt=[12,11];break;case 3:mt=[10,11];break;case 4:mt=[16,11];break;case 5:mt=[40,33];break;case 6:mt=[24,11];break;case 7:mt=[20,11];break;case 8:mt=[32,11];break;case 9:mt=[80,33];break;case 10:mt=[18,11];break;case 11:mt=[15,11];break;case 12:mt=[64,33];break;case 13:mt=[160,99];break;case 14:mt=[4,3];break;case 15:mt=[3,2];break;case 16:mt=[2,1];break;case 255:mt=[ze()<<8|ze(),ze()<<8|ze()]}return{width:Math.ceil(16*(Vt+1)-2*Se-2*be),height:(2-Jt)*(Lt+1)*16-(Jt?2:4)*(we+$e),pixelRatio:mt}},ye.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},Ae}(),J=function(){function Ae(Z,me,ge){this.keyData=void 0,this.decrypter=void 0,this.keyData=ge,this.decrypter=new E.default(Z,me,{removePKCS7Padding:!1})}var ye=Ae.prototype;return ye.decryptBuffer=function(Z,me){this.decrypter.decrypt(Z,this.keyData.key.buffer,this.keyData.iv.buffer,me)},ye.decryptAacSample=function(Z,me,ge,Se){var be=Z[me].unit;if(!(be.length<=16)){var we=be.subarray(16,be.length-be.length%16),$e=we.buffer.slice(we.byteOffset,we.byteOffset+we.length),ze=this;this.decryptBuffer($e,function(Ge){var Ze=new Uint8Array(Ge);be.set(Ze,16),Se||ze.decryptAacSamples(Z,me+1,ge)})}},ye.decryptAacSamples=function(Z,me,ge){for(;;me++){if(me>=Z.length)return void ge();if(!(Z[me].unit.length<32)){var Se=this.decrypter.isSync();if(this.decryptAacSample(Z,me,ge,Se),!Se)return}}},ye.getAvcEncryptedData=function(Z){for(var me=16*Math.floor((Z.length-48)/160)+16,ge=new Int8Array(me),Se=0,be=32;be<Z.length-16;be+=160,Se+=16)ge.set(Z.subarray(be,be+16),Se);return ge},ye.getAvcDecryptedUnit=function(Z,me){for(var ge=new Uint8Array(me),Se=0,be=32;be<Z.length-16;be+=160,Se+=16)Z.set(ge.subarray(Se,Se+16),be);return Z},ye.decryptAvcSample=function(Z,me,ge,Se,be,we){var $e=(0,F.discardEPB)(be.data),ze=this.getAvcEncryptedData($e),Ge=this;this.decryptBuffer(ze.buffer,function(Ze){be.data=Ge.getAvcDecryptedUnit($e,Ze),we||Ge.decryptAvcSamples(Z,me,ge+1,Se)})},ye.decryptAvcSamples=function(Z,me,ge,Se){if(Z instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;me++,ge=0){if(me>=Z.length)return void Se();for(var be=Z[me].units;!(ge>=be.length);ge++){var we=be[ge];if(!(we.data.length<=48||we.type!==1&&we.type!==5)){var $e=this.decrypter.isSync();if(this.decryptAvcSample(Z,me,ge,Se,we,$e),!$e)return}}}},Ae}();function ue(){return ue=Object.assign?Object.assign.bind():function(Ae){for(var ye=1;ye<arguments.length;ye++){var Z=arguments[ye];for(var me in Z)Object.prototype.hasOwnProperty.call(Z,me)&&(Ae[me]=Z[me])}return Ae},ue.apply(this,arguments)}var de=188;function Oe(Ae,ye,Z,me){return{key:Ae,frame:!1,pts:ye,dts:Z,units:[],debug:me,length:0}}function Ue(Ae,ye){return(31&Ae[ye+10])<<8|Ae[ye+11]}function Ke(Ae,ye,Z,me){var ge={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},Se=ye+3+((15&Ae[ye+1])<<8|Ae[ye+2])-4;for(ye+=12+((15&Ae[ye+10])<<8|Ae[ye+11]);ye<Se;){var be=(31&Ae[ye+1])<<8|Ae[ye+2];switch(Ae[ye]){case 207:if(!me){ee.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:ge.audio===-1&&(ge.audio=be);break;case 21:ge.id3===-1&&(ge.id3=be);break;case 219:if(!me){ee.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:ge.avc===-1&&(ge.avc=be);break;case 3:case 4:Z.mpeg!==!0&&Z.mp3!==!0?ee.logger.log("MPEG audio found, not supported in this browser"):ge.audio===-1&&(ge.audio=be,ge.segmentCodec="mp3");break;case 36:ee.logger.warn("Unsupported HEVC stream type found")}ye+=5+((15&Ae[ye+3])<<8|Ae[ye+4])}return ge}function at(Ae){var ye,Z,me,ge,Se,be=0,we=Ae.data;if(!Ae||Ae.size===0)return null;for(;we[0].length<19&&we.length>1;){var $e=new Uint8Array(we[0].length+we[1].length);$e.set(we[0]),$e.set(we[1],we[0].length),we[0]=$e,we.splice(1,1)}if(((ye=we[0])[0]<<16)+(ye[1]<<8)+ye[2]===1){if((Z=(ye[4]<<8)+ye[5])&&Z>Ae.size-6)return null;var ze=ye[7];192&ze&&(ge=536870912*(14&ye[9])+4194304*(255&ye[10])+16384*(254&ye[11])+128*(255&ye[12])+(254&ye[13])/2,64&ze?ge-(Se=536870912*(14&ye[14])+4194304*(255&ye[15])+16384*(254&ye[16])+128*(255&ye[17])+(254&ye[18])/2)>54e5&&(ee.logger.warn(Math.round((ge-Se)/9e4)+"s delta between PTS and DTS, align them"),ge=Se):Se=ge);var Ge=(me=ye[8])+9;if(Ae.size<=Ge)return null;Ae.size-=Ge;for(var Ze=new Uint8Array(Ae.size),it=0,rt=we.length;it<rt;it++){var ot=(ye=we[it]).byteLength;if(Ge){if(Ge>ot){Ge-=ot;continue}ye=ye.subarray(Ge),ot-=Ge,Ge=0}Ze.set(ye,be),be+=ot}return Z&&(Z-=me+3),{data:Ze,pts:ge,dts:Se,len:Z}}return null}function ut(Ae,ye){if(Ae.units.length&&Ae.frame){if(Ae.pts===void 0){var Z=ye.samples,me=Z.length;if(!me)return void ye.dropped++;var ge=Z[me-1];Ae.pts=ge.pts,Ae.dts=ge.dts}ye.samples.push(Ae)}Ae.debug.length&&ee.logger.log(Ae.pts+"/"+Ae.dts+":"+Ae.debug)}let st=function(){function Ae(Z,me,ge){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=Z,this.config=me,this.typeSupported=ge}Ae.probe=function(Z){var me=Ae.syncOffset(Z);return me>0&&ee.logger.warn("MPEG2-TS detected but first sync word found @ offset "+me),me!==-1},Ae.syncOffset=function(Z){for(var me=Math.min(940,Z.length-376)+1,ge=0;ge<me;){if(Z[ge]===71&&Z[ge+de]===71)return ge;ge++}return-1},Ae.createTrack=function(Z,me){return{container:Z==="video"||Z==="audio"?"video/mp2t":void 0,type:Z,id:F.RemuxerTrackIdConfig[Z],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:Z==="audio"?me:void 0}};var ye=Ae.prototype;return ye.resetInitSegment=function(Z,me,ge,Se){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=Ae.createTrack("video"),this._audioTrack=Ae.createTrack("audio",Se),this._id3Track=Ae.createTrack("id3"),this._txtTrack=Ae.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=me,this.videoCodec=ge,this._duration=Se},ye.resetTimeStamp=function(){},ye.resetContiguity=function(){var Z=this._audioTrack,me=this._avcTrack,ge=this._id3Track;Z&&(Z.pesData=null),me&&(me.pesData=null),ge&&(ge.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},ye.demux=function(Z,me,ge,Se){var be;ge===void 0&&(ge=!1),Se===void 0&&(Se=!1),ge||(this.sampleAes=null);var we=this._avcTrack,$e=this._audioTrack,ze=this._id3Track,Ge=this._txtTrack,Ze=we.pid,it=we.pesData,rt=$e.pid,ot=ze.pid,gt=$e.pesData,St=ze.pesData,lt=null,At=this.pmtParsed,Ht=this._pmtId,Vt=Z.length;if(this.remainderData&&(Vt=(Z=(0,F.appendUint8Array)(this.remainderData,Z)).length,this.remainderData=null),Vt<de&&!Se)return this.remainderData=Z,{audioTrack:$e,videoTrack:we,id3Track:ze,textTrack:Ge};var Lt=Math.max(0,Ae.syncOffset(Z));(Vt-=(Vt-Lt)%de)<Z.byteLength&&!Se&&(this.remainderData=new Uint8Array(Z.buffer,Vt,Z.buffer.byteLength-Vt));for(var Jt=0,mt=Lt;mt<Vt;mt+=de)if(Z[mt]===71){var qt=!!(64&Z[mt+1]),cr=((31&Z[mt+1])<<8)+Z[mt+2],Kt=void 0;if((48&Z[mt+3])>>4>1){if((Kt=mt+5+Z[mt+4])===mt+de)continue}else Kt=mt+4;switch(cr){case Ze:qt&&(it&&(be=at(it))&&this.parseAVCPES(we,Ge,be,!1),it={data:[],size:0}),it&&(it.data.push(Z.subarray(Kt,mt+de)),it.size+=mt+de-Kt);break;case rt:if(qt){if(gt&&(be=at(gt)))switch($e.segmentCodec){case"aac":this.parseAACPES($e,be);break;case"mp3":this.parseMPEGPES($e,be)}gt={data:[],size:0}}gt&&(gt.data.push(Z.subarray(Kt,mt+de)),gt.size+=mt+de-Kt);break;case ot:qt&&(St&&(be=at(St))&&this.parseID3PES(ze,be),St={data:[],size:0}),St&&(St.data.push(Z.subarray(Kt,mt+de)),St.size+=mt+de-Kt);break;case 0:qt&&(Kt+=Z[Kt]+1),Ht=this._pmtId=Ue(Z,Kt);break;case Ht:qt&&(Kt+=Z[Kt]+1);var dr=Ke(Z,Kt,this.typeSupported,ge);(Ze=dr.avc)>0&&(we.pid=Ze),(rt=dr.audio)>0&&($e.pid=rt,$e.segmentCodec=dr.segmentCodec),(ot=dr.id3)>0&&(ze.pid=ot),lt===null||At||(ee.logger.log("unknown PID '"+lt+"' in TS found"),lt=null,mt=Lt-188),At=this.pmtParsed=!0;break;case 17:case 8191:break;default:lt=cr}}else Jt++;Jt>0&&this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Jt+" TS packet/s that do not start with 0x47"}),we.pesData=it,$e.pesData=gt,ze.pesData=St;var tr={audioTrack:$e,videoTrack:we,id3Track:ze,textTrack:Ge};return Se&&this.extractRemainingSamples(tr),tr},ye.flush=function(){var Z,me=this.remainderData;return this.remainderData=null,Z=me?this.demux(me,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(Z),this.sampleAes?this.decrypt(Z,this.sampleAes):Z},ye.extractRemainingSamples=function(Z){var me,ge=Z.audioTrack,Se=Z.videoTrack,be=Z.id3Track,we=Z.textTrack,$e=Se.pesData,ze=ge.pesData,Ge=be.pesData;if($e&&(me=at($e))?(this.parseAVCPES(Se,we,me,!0),Se.pesData=null):Se.pesData=$e,ze&&(me=at(ze))){switch(ge.segmentCodec){case"aac":this.parseAACPES(ge,me);break;case"mp3":this.parseMPEGPES(ge,me)}ge.pesData=null}else ze!=null&&ze.size&&ee.logger.log("last AAC PES packet truncated,might overlap between fragments"),ge.pesData=ze;Ge&&(me=at(Ge))?(this.parseID3PES(be,me),be.pesData=null):be.pesData=Ge},ye.demuxSampleAes=function(Z,me,ge){var Se=this.demux(Z,ge,!0,!this.config.progressive),be=this.sampleAes=new J(this.observer,this.config,me);return this.decrypt(Se,be)},ye.decrypt=function(Z,me){return new Promise(function(ge){var Se=Z.audioTrack,be=Z.videoTrack;Se.samples&&Se.segmentCodec==="aac"?me.decryptAacSamples(Se.samples,0,function(){be.samples?me.decryptAvcSamples(be.samples,0,0,function(){ge(Z)}):ge(Z)}):be.samples&&me.decryptAvcSamples(be.samples,0,0,function(){ge(Z)})})},ye.destroy=function(){this._duration=0},ye.parseAVCPES=function(Z,me,ge,Se){var be,we=this,$e=this.parseAVCNALu(Z,ge.data),ze=this.avcSample,Ge=!1;ge.data=null,ze&&$e.length&&!Z.audFound&&(ut(ze,Z),ze=this.avcSample=Oe(!1,ge.pts,ge.dts,"")),$e.forEach(function(Ze){switch(Ze.type){case 1:be=!0,ze||(ze=we.avcSample=Oe(!0,ge.pts,ge.dts,"")),ze.frame=!0;var it=Ze.data;if(Ge&&it.length>4){var rt=new Fe(it).readSliceType();rt!==2&&rt!==4&&rt!==7&&rt!==9||(ze.key=!0)}break;case 5:be=!0,ze||(ze=we.avcSample=Oe(!0,ge.pts,ge.dts,"")),ze.key=!0,ze.frame=!0;break;case 6:be=!0,(0,F.parseSEIMessageFromNALu)(Ze.data,1,ge.pts,me.samples);break;case 7:if(be=!0,Ge=!0,!Z.sps){var ot=new Fe(Ze.data).readSPS();Z.width=ot.width,Z.height=ot.height,Z.pixelRatio=ot.pixelRatio,Z.sps=[Ze.data],Z.duration=we._duration;for(var gt=Ze.data.subarray(1,4),St="avc1.",lt=0;lt<3;lt++){var At=gt[lt].toString(16);At.length<2&&(At="0"+At),St+=At}Z.codec=St}break;case 8:be=!0,Z.pps||(Z.pps=[Ze.data]);break;case 9:be=!1,Z.audFound=!0,ze&&ut(ze,Z),ze=we.avcSample=Oe(!1,ge.pts,ge.dts,"");break;case 12:be=!0;break;default:be=!1,ze&&(ze.debug+="unknown NAL "+Ze.type+" ")}ze&&be&&ze.units.push(Ze)}),Se&&ze&&(ut(ze,Z),this.avcSample=null)},ye.getLastNalUnit=function(Z){var me,ge,Se=this.avcSample;if(Se&&Se.units.length!==0||(Se=Z[Z.length-1]),(me=Se)!==null&&me!==void 0&&me.units){var be=Se.units;ge=be[be.length-1]}return ge},ye.parseAVCNALu=function(Z,me){var ge,Se,be=me.byteLength,we=Z.naluState||0,$e=we,ze=[],Ge=0,Ze=-1,it=0;for(we===-1&&(Ze=0,it=31&me[0],we=0,Ge=1);Ge<be;)if(ge=me[Ge++],we)if(we!==1)if(ge)if(ge===1){if(Ze>=0){var rt={data:me.subarray(Ze,Ge-we-1),type:it};ze.push(rt)}else{var ot=this.getLastNalUnit(Z.samples);if(ot&&($e&&Ge<=4-$e&&ot.state&&(ot.data=ot.data.subarray(0,ot.data.byteLength-$e)),(Se=Ge-we-1)>0)){var gt=new Uint8Array(ot.data.byteLength+Se);gt.set(ot.data,0),gt.set(me.subarray(0,Se),ot.data.byteLength),ot.data=gt,ot.state=0}}Ge<be?(Ze=Ge,it=31&me[Ge],we=0):we=-1}else we=0;else we=3;else we=ge?0:2;else we=ge?0:1;if(Ze>=0&&we>=0){var St={data:me.subarray(Ze,be),type:it,state:we};ze.push(St)}if(ze.length===0){var lt=this.getLastNalUnit(Z.samples);if(lt){var At=new Uint8Array(lt.data.byteLength+me.byteLength);At.set(lt.data,0),At.set(me,lt.data.byteLength),lt.data=At}}return Z.naluState=we,ze},ye.parseAACPES=function(Z,me){var ge,Se,be,we,$e,ze=0,Ge=this.aacOverFlow,Ze=me.data;if(Ge){this.aacOverFlow=null;var it=Ge.missing,rt=Ge.sample.unit.byteLength;if(it===-1){var ot=new Uint8Array(rt+Ze.byteLength);ot.set(Ge.sample.unit,0),ot.set(Ze,rt),Ze=ot}else{var gt=rt-it;Ge.sample.unit.set(Ze.subarray(0,it),gt),Z.samples.push(Ge.sample),ze=Ge.missing}}for(ge=ze,Se=Ze.length;ge<Se-1&&!z(Ze,ge);ge++);if(ge===ze||(ge<Se-1?(be="AAC PES did not start with ADTS header,offset:"+ge,we=!1):(be="no ADTS header found in AAC PES",we=!0),ee.logger.warn("parsing error:"+be),this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:we,reason:be}),!we)){if(Q(Z,this.observer,Ze,ge,this.audioCodec),me.pts!==void 0)$e=me.pts;else{if(!Ge)return void ee.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var St=$(Z.samplerate);$e=Ge.sample.pts+St}for(var lt,At=0;ge<Se;){if(ge+=(lt=oe(Z,Ze,ge,$e,At)).length,lt.missing){this.aacOverFlow=lt;break}for(At++;ge<Se-1&&!z(Ze,ge);ge++);}}},ye.parseMPEGPES=function(Z,me){var ge=me.data,Se=ge.length,be=0,we=0,$e=me.pts;if($e!==void 0)for(;we<Se;)if(nt(ge,we)){var ze=Xe(Z,ge,we,$e,be);if(!ze)break;we+=ze.length,be++}else we++;else ee.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},ye.parseID3PES=function(Z,me){if(me.pts!==void 0){var ge=ue({},me,{type:this._avcTrack?w.MetadataSchema.emsg:w.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});Z.samples.push(ge)}else ee.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},Ae}();function ct(Ae,ye){return ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Z,me){return Z.__proto__=me,Z},ct(Ae,ye)}let yt=function(Ae){var ye,Z;function me(){return Ae.apply(this,arguments)||this}Z=Ae,(ye=me).prototype=Object.create(Z.prototype),ye.prototype.constructor=ye,ct(ye,Z);var ge=me.prototype;return ge.resetInitSegment=function(Se,be,we,$e){Ae.prototype.resetInitSegment.call(this,Se,be,we,$e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:be,duration:$e,inputTimeScale:9e4,dropped:0}},me.probe=function(Se){if(!Se)return!1;for(var be=(D.getID3Data(Se,0)||[]).length,we=Se.length;be<we;be++)if(Be(Se,be))return ee.logger.log("MPEG Audio sync word found !"),!0;return!1},ge.canParse=function(Se,be){return function(we,$e){return tt(we,$e)&&4<=we.length-$e}(Se,be)},ge.appendFrame=function(Se,be,we){if(this.basePTS!==null)return Xe(Se,be,we,this.basePTS,this.frameIndex)},me}(re);var Ct=l(524),vt=l(923);function ft(Ae,ye){var Z=Ae?.codec;return Z&&Z.length>4?Z:Z==="hvc1"||Z==="hev1"?"hvc1.1.c.L120.90":Z==="av01"?"av01.0.04M.08":Z==="avc1"||ye===vt.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}let Ut=function(){function Ae(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var ye=Ae.prototype;return ye.destroy=function(){},ye.resetTimeStamp=function(Z){this.initPTS=Z,this.lastEndTime=null},ye.resetNextTimestamp=function(){this.lastEndTime=null},ye.resetInitSegment=function(Z,me,ge){this.audioCodec=me,this.videoCodec=ge,this.generateInitSegment(Z),this.emitInitSegment=!0},ye.generateInitSegment=function(Z){var me=this.audioCodec,ge=this.videoCodec;if(!Z||!Z.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var Se=this.initData=(0,F.parseInitSegment)(Z);me||(me=ft(Se.audio,vt.ElementaryStreamTypes.AUDIO)),ge||(ge=ft(Se.video,vt.ElementaryStreamTypes.VIDEO));var be={};Se.audio&&Se.video?be.audiovideo={container:"video/mp4",codec:me+","+ge,initSegment:Z,id:"main"}:Se.audio?be.audio={container:"audio/mp4",codec:me,initSegment:Z,id:"audio"}:Se.video?be.video={container:"video/mp4",codec:ge,initSegment:Z,id:"main"}:ee.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=be},ye.remux=function(Z,me,ge,Se,be){var we,$e=this.initPTS,ze=this.lastEndTime,Ge={audio:void 0,video:void 0,text:Se,id3:ge,initSegment:void 0};(0,y.isFiniteNumber)(ze)||(ze=this.lastEndTime=be||0);var Ze=me.samples;if(!Ze||!Ze.length)return Ge;var it={initPTS:void 0,timescale:1},rt=this.initData;if(rt&&rt.length||(this.generateInitSegment(Ze),rt=this.initData),!rt||!rt.length)return ee.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),Ge;this.emitInitSegment&&(it.tracks=this.initTracks,this.emitInitSegment=!1);var ot=(0,F.getStartDTS)(rt,Ze);(0,y.isFiniteNumber)($e)||(this.initPTS=it.initPTS=$e=ot-be);var gt=(0,F.getDuration)(Ze,rt),St=Z?ot-$e:ze,lt=St+gt;(0,F.offsetStartDTS)(rt,Ze,$e),gt>0?this.lastEndTime=lt:(ee.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var At=!!rt.audio,Ht=!!rt.video,Vt="";At&&(Vt+="audio"),Ht&&(Vt+="video");var Lt={data1:Ze,startPTS:St,startDTS:St,endPTS:lt,endDTS:lt,type:Vt,hasAudio:At,hasVideo:Ht,nb:1,dropped:0};Ge.audio=Lt.type==="audio"?Lt:void 0,Ge.video=Lt.type!=="audio"?Lt:void 0,Ge.initSegment=it;var Jt=(we=this.initPTS)!=null?we:0;return Ge.id3=(0,Ct.flushTextTrackMetadataCueSamples)(ge,be,Jt,Jt),Se.samples.length&&(Ge.text=(0,Ct.flushTextTrackUserdataCueSamples)(Se,be,Jt)),Ge},Ae}();var Nt;try{Nt=self.performance.now.bind(self.performance)}catch{ee.logger.debug("Unable to use Performance API on this environment"),Nt=self.Date.now}var bt=[{demux:st,remux:Ct.default},{demux:Pe,remux:Ut},{demux:_e,remux:Ct.default},{demux:yt,remux:Ct.default}],sr=function(){function Ae(Z,me,ge,Se,be){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=Z,this.typeSupported=me,this.config=ge,this.vendor=Se,this.id=be}var ye=Ae.prototype;return ye.configure=function(Z){this.transmuxConfig=Z,this.decrypter&&this.decrypter.reset()},ye.push=function(Z,me,ge,Se){var be=this,we=ge.transmuxing;we.executeStart=Nt();var $e=new Uint8Array(Z),ze=this.config,Ge=this.currentTransmuxState,Ze=this.transmuxConfig;Se&&(this.currentTransmuxState=Se);var it=Se||Ge,rt=it.contiguous,ot=it.discontinuity,gt=it.trackSwitch,St=it.accurateTimeOffset,lt=it.timeOffset,At=it.initSegmentChange,Ht=Ze.audioCodec,Vt=Ze.videoCodec,Lt=Ze.defaultInitPts,Jt=Ze.duration,mt=Ze.initSegmentData;(ot||gt||At)&&this.resetInitSegment(mt,Ht,Vt,Jt),(ot||At)&&this.resetInitialTimestamp(Lt),rt||this.resetContiguity();var qt=function(Pr,Wt){var pr=null;return Pr.byteLength>0&&Wt!=null&&Wt.key!=null&&Wt.iv!==null&&Wt.method!=null&&(pr=Wt),pr}($e,me);if(qt&&qt.method==="AES-128"){var cr=this.getDecrypter();if(!ze.enableSoftwareAES)return this.decryptionPromise=cr.webCryptoDecrypt($e,qt.key.buffer,qt.iv.buffer).then(function(Pr){var Wt=be.push(Pr,null,ge);return be.decryptionPromise=null,Wt}),this.decryptionPromise;var Kt=cr.softwareDecrypt($e,qt.key.buffer,qt.iv.buffer);if(!Kt)return we.executeEnd=Nt(),Yt(ge);$e=new Uint8Array(Kt)}this.needsProbing($e,ot,gt)&&this.configureTransmuxer($e,Ze);var dr=this.transmux($e,qt,lt,St,ge),tr=this.currentTransmuxState;return tr.contiguous=!0,tr.discontinuity=!1,tr.trackSwitch=!1,we.executeEnd=Nt(),dr},ye.flush=function(Z){var me=this,ge=Z.transmuxing;ge.executeStart=Nt();var Se=this.decrypter,be=this.currentTransmuxState,we=this.decryptionPromise;if(we)return we.then(function(){return me.flush(Z)});var $e=[],ze=be.timeOffset;if(Se){var Ge=Se.flush();Ge&&$e.push(this.push(Ge,null,Z))}var Ze=this.demuxer,it=this.remuxer;if(!Ze||!it)return this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),ge.executeEnd=Nt(),[Yt(Z)];var rt=Ze.flush(ze);return Qt(rt)?rt.then(function(ot){return me.flushRemux($e,ot,Z),$e}):(this.flushRemux($e,rt,Z),$e)},ye.flushRemux=function(Z,me,ge){var Se=me.audioTrack,be=me.videoTrack,we=me.id3Track,$e=me.textTrack,ze=this.currentTransmuxState,Ge=ze.accurateTimeOffset,Ze=ze.timeOffset;ee.logger.log("[transmuxer.ts]: Flushed fragment "+ge.sn+(ge.part>-1?" p: "+ge.part:"")+" of level "+ge.level);var it=this.remuxer.remux(Se,be,we,$e,Ze,Ge,!0,this.id);Z.push({remuxResult:it,chunkMeta:ge}),ge.transmuxing.executeEnd=Nt()},ye.resetInitialTimestamp=function(Z){var me=this.demuxer,ge=this.remuxer;me&&ge&&(me.resetTimeStamp(Z),ge.resetTimeStamp(Z))},ye.resetContiguity=function(){var Z=this.demuxer,me=this.remuxer;Z&&me&&(Z.resetContiguity(),me.resetNextTimestamp())},ye.resetInitSegment=function(Z,me,ge,Se){var be=this.demuxer,we=this.remuxer;be&&we&&(be.resetInitSegment(Z,me,ge,Se),we.resetInitSegment(Z,me,ge))},ye.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},ye.transmux=function(Z,me,ge,Se,be){return me&&me.method==="SAMPLE-AES"?this.transmuxSampleAes(Z,me,ge,Se,be):this.transmuxUnencrypted(Z,ge,Se,be)},ye.transmuxUnencrypted=function(Z,me,ge,Se){var be=this.demuxer.demux(Z,me,!1,!this.config.progressive),we=be.audioTrack,$e=be.videoTrack,ze=be.id3Track,Ge=be.textTrack;return{remuxResult:this.remuxer.remux(we,$e,ze,Ge,me,ge,!1,this.id),chunkMeta:Se}},ye.transmuxSampleAes=function(Z,me,ge,Se,be){var we=this;return this.demuxer.demuxSampleAes(Z,me,ge).then(function($e){return{remuxResult:we.remuxer.remux($e.audioTrack,$e.videoTrack,$e.id3Track,$e.textTrack,ge,Se,!1,we.id),chunkMeta:be}})},ye.configureTransmuxer=function(Z,me){for(var ge,Se=this.config,be=this.observer,we=this.typeSupported,$e=this.vendor,ze=me.audioCodec,Ge=me.defaultInitPts,Ze=me.duration,it=me.initSegmentData,rt=me.videoCodec,ot=0,gt=bt.length;ot<gt;ot++)if(bt[ot].demux.probe(Z)){ge=bt[ot];break}ge||(ee.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),ge={demux:Pe,remux:Ut});var St=this.demuxer,lt=this.remuxer,At=ge.remux,Ht=ge.demux;lt&&lt instanceof At||(this.remuxer=new At(be,Se,we,$e)),St&&St instanceof Ht||(this.demuxer=new Ht(be,Se,we),this.probe=Ht.probe),this.resetInitSegment(it,ze,rt,Ze),this.resetInitialTimestamp(Ge)},ye.needsProbing=function(Z,me,ge){return!this.demuxer||!this.remuxer||me||ge},ye.getDecrypter=function(){var Z=this.decrypter;return Z||(Z=this.decrypter=new E.default(this.observer,this.config)),Z},Ae}(),Yt=function(Ae){return{remuxResult:{},chunkMeta:Ae}};function Qt(Ae){return"then"in Ae&&Ae.then instanceof Function}var lr=function(Ae,ye,Z,me,ge){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=Ae,this.videoCodec=ye,this.initSegmentData=Z,this.duration=me,this.defaultInitPts=ge},$t=function(Ae,ye,Z,me,ge,Se){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=Ae,this.contiguous=ye,this.accurateTimeOffset=Z,this.trackSwitch=me,this.timeOffset=ge,this.initSegmentChange=Se}},973:(s,o,l)=>{"use strict";var u,m;l.r(o),l.d(o,{ErrorDetails:()=>m,ErrorTypes:()=>u}),function(E){E.NETWORK_ERROR="networkError",E.MEDIA_ERROR="mediaError",E.KEY_SYSTEM_ERROR="keySystemError",E.MUX_ERROR="muxError",E.OTHER_ERROR="otherError"}(u||(u={})),function(E){E.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",E.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",E.KEY_SYSTEM_NO_SESSION="keySystemNoSession",E.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",E.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",E.MANIFEST_LOAD_ERROR="manifestLoadError",E.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",E.MANIFEST_PARSING_ERROR="manifestParsingError",E.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",E.LEVEL_EMPTY_ERROR="levelEmptyError",E.LEVEL_LOAD_ERROR="levelLoadError",E.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",E.LEVEL_SWITCH_ERROR="levelSwitchError",E.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",E.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",E.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",E.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",E.FRAG_LOAD_ERROR="fragLoadError",E.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",E.FRAG_DECRYPT_ERROR="fragDecryptError",E.FRAG_PARSING_ERROR="fragParsingError",E.REMUX_ALLOC_ERROR="remuxAllocError",E.KEY_LOAD_ERROR="keyLoadError",E.KEY_LOAD_TIMEOUT="keyLoadTimeOut",E.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",E.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",E.BUFFER_APPEND_ERROR="bufferAppendError",E.BUFFER_APPENDING_ERROR="bufferAppendingError",E.BUFFER_STALLED_ERROR="bufferStalledError",E.BUFFER_FULL_ERROR="bufferFullError",E.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",E.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",E.INTERNAL_EXCEPTION="internalException",E.INTERNAL_ABORTED="aborted",E.UNKNOWN="unknown"}(m||(m={}))},851:(s,o,l)=>{"use strict";var u;l.r(o),l.d(o,{Events:()=>u}),function(m){m.MEDIA_ATTACHING="hlsMediaAttaching",m.MEDIA_ATTACHED="hlsMediaAttached",m.MEDIA_DETACHING="hlsMediaDetaching",m.MEDIA_DETACHED="hlsMediaDetached",m.BUFFER_RESET="hlsBufferReset",m.BUFFER_CODECS="hlsBufferCodecs",m.BUFFER_CREATED="hlsBufferCreated",m.BUFFER_APPENDING="hlsBufferAppending",m.BUFFER_APPENDED="hlsBufferAppended",m.BUFFER_EOS="hlsBufferEos",m.BUFFER_FLUSHING="hlsBufferFlushing",m.BUFFER_FLUSHED="hlsBufferFlushed",m.MANIFEST_LOADING="hlsManifestLoading",m.MANIFEST_LOADED="hlsManifestLoaded",m.MANIFEST_PARSED="hlsManifestParsed",m.LEVEL_SWITCHING="hlsLevelSwitching",m.LEVEL_SWITCHED="hlsLevelSwitched",m.LEVEL_LOADING="hlsLevelLoading",m.LEVEL_LOADED="hlsLevelLoaded",m.LEVEL_UPDATED="hlsLevelUpdated",m.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",m.LEVELS_UPDATED="hlsLevelsUpdated",m.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",m.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",m.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",m.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",m.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",m.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",m.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",m.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",m.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",m.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",m.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",m.CUES_PARSED="hlsCuesParsed",m.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",m.INIT_PTS_FOUND="hlsInitPtsFound",m.FRAG_LOADING="hlsFragLoading",m.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",m.FRAG_LOADED="hlsFragLoaded",m.FRAG_DECRYPTED="hlsFragDecrypted",m.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",m.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",m.FRAG_PARSING_METADATA="hlsFragParsingMetadata",m.FRAG_PARSED="hlsFragParsed",m.FRAG_BUFFERED="hlsFragBuffered",m.FRAG_CHANGED="hlsFragChanged",m.FPS_DROP="hlsFpsDrop",m.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",m.ERROR="hlsError",m.DESTROYING="hlsDestroying",m.KEY_LOADING="hlsKeyLoading",m.KEY_LOADED="hlsKeyLoaded",m.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",m.BACK_BUFFER_REACHED="hlsBackBufferReached"}(u||(u={}))},817:(s,o,l)=>{"use strict";l.r(o),l.d(o,{default:()=>Ca});var u,m=l(945),E=l(965),y=l(851),D=l(973),w=l(93),B=l(63),F=/^(\d+)x(\d+)$/,V=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,K=function(){function O(h){for(var p in typeof h=="string"&&(h=O.parseAttrList(h)),h)h.hasOwnProperty(p)&&(this[p]=h[p])}var M=O.prototype;return M.decimalInteger=function(h){var p=parseInt(this[h],10);return p>Number.MAX_SAFE_INTEGER?1/0:p},M.hexadecimalInteger=function(h){if(this[h]){var p=(this[h]||"0x").slice(2);p=(1&p.length?"0":"")+p;for(var S=new Uint8Array(p.length/2),T=0;T<p.length/2;T++)S[T]=parseInt(p.slice(2*T,2*T+2),16);return S}return null},M.hexadecimalIntegerAsNumber=function(h){var p=parseInt(this[h],16);return p>Number.MAX_SAFE_INTEGER?1/0:p},M.decimalFloatingPoint=function(h){return parseFloat(this[h])},M.optionalFloat=function(h,p){var S=this[h];return S?parseFloat(S):p},M.enumeratedString=function(h){return this[h]},M.bool=function(h){return this[h]==="YES"},M.decimalResolution=function(h){var p=F.exec(this[h]);if(p!==null)return{width:parseInt(p[1],10),height:parseInt(p[2],10)}},O.parseAttrList=function(h){var p,S={};for(V.lastIndex=0;(p=V.exec(h))!==null;){var T=p[2];T.indexOf('"')===0&&T.lastIndexOf('"')===T.length-1&&(T=T.slice(1,-1)),S[p[1]]=T}return S},O}();function q(){return q=Object.assign?Object.assign.bind():function(O){for(var M=1;M<arguments.length;M++){var h=arguments[M];for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(O[p]=h[p])}return O},q.apply(this,arguments)}function re(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}(function(O){O.ID="ID",O.CLASS="CLASS",O.START_DATE="START-DATE",O.DURATION="DURATION",O.END_DATE="END-DATE",O.END_ON_NEXT="END-ON-NEXT",O.PLANNED_DURATION="PLANNED-DURATION",O.SCTE35_OUT="SCTE35-OUT",O.SCTE35_IN="SCTE35-IN"})(u||(u={}));var ee=function(){function O(p,S){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,S){var T=S.attr;for(var C in T)if(Object.prototype.hasOwnProperty.call(p,C)&&p[C]!==T[C]){w.logger.warn('DATERANGE tag attribute: "'+C+'" does not match for tags with ID: "'+p.ID+'"'),this._badValueForSameId=C;break}p=q(new K({}),T,p)}if(this.attr=p,this._startDate=new Date(p[u.START_DATE]),u.END_DATE in this.attr){var v=new Date(this.attr[u.END_DATE]);(0,E.isFiniteNumber)(v.getTime())&&(this._endDate=v)}}var M,h;return M=O,(h=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var p=this.duration;return p!==null?new Date(this._startDate.getTime()+1e3*p):null}},{key:"duration",get:function(){if(u.DURATION in this.attr){var p=this.attr.decimalFloatingPoint(u.DURATION);if((0,E.isFiniteNumber)(p))return p}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return u.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(u.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(u.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,E.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&re(M.prototype,h),Object.defineProperty(M,"prototype",{writable:!1}),O}(),H=l(923);function te(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}var W=function(){function O(p){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=p}var M,h;return O.prototype.reloaded=function(p){if(!p)return this.advanced=!0,void(this.updated=!0);var S=this.lastPartSn-p.lastPartSn,T=this.lastPartIndex-p.lastPartIndex;this.updated=this.endSN!==p.endSN||!!T||!!S,this.advanced=this.endSN>p.endSN||S>0||S===0&&T>0,this.updated||this.advanced?this.misses=Math.floor(.6*p.misses):this.misses=p.misses+1,this.availabilityDelay=p.availabilityDelay},M=O,(h=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,E.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var p=this.driftEndTime-this.driftStartTime;return p>0?1e3*(this.driftEnd-this.driftStart)/p:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var p;return(p=this.fragments)!==null&&p!==void 0&&p.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&te(M.prototype,h),Object.defineProperty(M,"prototype",{writable:!1}),O}(),z=l(960),X={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function Q(O,M){return MediaSource.isTypeSupported((M||"video")+'/mp4;codecs="'+O+'"')}var $=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,oe=/#EXT-X-MEDIA:(.*)/g,ae=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),_e=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),ve=/\.(mp4|m4s|m4v|m4a)$/i,Pe=function(){function O(){}return O.findGroup=function(M,h){for(var p=0;p<M.length;p++){var S=M[p];if(S.id===h)return S}},O.convertAVC1ToAVCOTI=function(M){var h=M.split(".");if(h.length>2){var p=h.shift()+".";return(p+=parseInt(h.shift()).toString(16))+("000"+parseInt(h.shift()).toString(16)).slice(-4)}return M},O.resolve=function(M,h){return m.buildAbsoluteURL(h,M,{alwaysNormalize:!0})},O.parseMasterPlaylist=function(M,h){var p,S=[],T=[],C={},v=!1;for($.lastIndex=0;(p=$.exec(M))!=null;)if(p[1]){var x,I=new K(p[1]),R={attrs:I,bitrate:I.decimalInteger("AVERAGE-BANDWIDTH")||I.decimalInteger("BANDWIDTH"),name:I.NAME,url:O.resolve(p[2],h)},U=I.decimalResolution("RESOLUTION");U&&(R.width=U.width,R.height=U.height),fe((I.CODECS||"").split(/[ ,]+/).filter(function(ie){return ie}),R),R.videoCodec&&R.videoCodec.indexOf("avc1")!==-1&&(R.videoCodec=O.convertAVC1ToAVCOTI(R.videoCodec)),(x=R.unknownCodecs)!==null&&x!==void 0&&x.length||T.push(R),S.push(R)}else if(p[3]){var G=new K(p[3]);G["DATA-ID"]&&(v=!0,C[G["DATA-ID"]]=G)}return{levels:T.length>0&&T.length<S.length?T:S,sessionData:v?C:null}},O.parseMasterPlaylistMedia=function(M,h,p,S){var T;S===void 0&&(S=[]);var C=[],v=0;for(oe.lastIndex=0;(T=oe.exec(M))!==null;){var x=new K(T[1]);if(x.TYPE===p){var I={attrs:x,bitrate:0,id:v++,groupId:x["GROUP-ID"],instreamId:x["INSTREAM-ID"],name:x.NAME||x.LANGUAGE||"",type:p,default:x.bool("DEFAULT"),autoselect:x.bool("AUTOSELECT"),forced:x.bool("FORCED"),lang:x.LANGUAGE,url:x.URI?O.resolve(x.URI,h):""};if(S.length){var R=O.findGroup(S,I.groupId)||S[0];xe(I,R,"audioCodec"),xe(I,R,"textCodec")}C.push(I)}}return C},O.parseLevelPlaylist=function(M,h,p,S,T){var C,v,x,I=new W(h),R=I.fragments,U=null,G=0,ie=0,le=0,he=0,Te=null,Ee=new H.Fragment(S,h),je=-1,Ve=!1;for(ae.lastIndex=0,I.m3u8=M;(C=ae.exec(M))!==null;){Ve&&(Ve=!1,(Ee=new H.Fragment(S,h)).start=le,Ee.sn=G,Ee.cc=he,Ee.level=p,U&&(Ee.initSegment=U,Ee.rawProgramDateTime=U.rawProgramDateTime,U.rawProgramDateTime=null));var Ne=C[1];if(Ne){Ee.duration=parseFloat(Ne);var Re=(" "+C[2]).slice(1);Ee.title=Re||null,Ee.tagList.push(Re?["INF",Ne,Re]:["INF",Ne])}else if(C[3])(0,E.isFiniteNumber)(Ee.duration)&&(Ee.start=le,x&&(Ee.levelkey=x),Ee.sn=G,Ee.level=p,Ee.cc=he,Ee.urlId=T,R.push(Ee),Ee.relurl=(" "+C[3]).slice(1),Ce(Ee,Te),Te=Ee,le+=Ee.duration,G++,ie=0,Ve=!0);else if(C[4]){var He=(" "+C[4]).slice(1);Te?Ee.setByteRange(He,Te):Ee.setByteRange(He)}else if(C[5])Ee.rawProgramDateTime=(" "+C[5]).slice(1),Ee.tagList.push(["PROGRAM-DATE-TIME",Ee.rawProgramDateTime]),je===-1&&(je=R.length);else{if(!(C=C[0].match(_e))){w.logger.warn("No matches on slow regex match for level playlist!");continue}for(v=1;v<C.length&&C[v]===void 0;v++);var Le=(" "+C[v]).slice(1),Je=(" "+C[v+1]).slice(1),Ye=C[v+2]?(" "+C[v+2]).slice(1):"";switch(Le){case"PLAYLIST-TYPE":I.type=Je.toUpperCase();break;case"MEDIA-SEQUENCE":G=I.startSN=parseInt(Je);break;case"SKIP":var ht=new K(Je),pt=ht.decimalInteger("SKIPPED-SEGMENTS");if((0,E.isFiniteNumber)(pt)){I.skippedSegments=pt;for(var kt=pt;kt--;)R.unshift(null);G+=pt}var It=ht.enumeratedString("RECENTLY-REMOVED-DATERANGES");It&&(I.recentlyRemovedDateranges=It.split("	"));break;case"TARGETDURATION":I.targetduration=parseFloat(Je);break;case"VERSION":I.version=parseInt(Je);break;case"EXTM3U":break;case"ENDLIST":I.live=!1;break;case"#":(Je||Ye)&&Ee.tagList.push(Ye?[Je,Ye]:[Je]);break;case"DISCONTINUITY":he++,Ee.tagList.push(["DIS"]);break;case"GAP":Ee.tagList.push([Le]);break;case"BITRATE":Ee.tagList.push([Le,Je]);break;case"DATERANGE":var _t=new K(Je),Et=new ee(_t,I.dateRanges[_t.ID]);Et.isValid||I.skippedSegments?I.dateRanges[Et.id]=Et:w.logger.warn('Ignoring invalid DATERANGE tag: "'+Je+'"'),Ee.tagList.push(["EXT-X-DATERANGE",Je]);break;case"DISCONTINUITY-SEQUENCE":he=parseInt(Je);break;case"KEY":var Dt,Ft=new K(Je),er=Ft.enumeratedString("METHOD"),j=Ft.URI,g=Ft.hexadecimalInteger("IV"),_=Ft.enumeratedString("KEYFORMATVERSIONS"),P=Ft.enumeratedString("KEYID"),A=(Dt=Ft.enumeratedString("KEYFORMAT"))!=null?Dt:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(A)>-1){w.logger.warn("Keyformat "+A+" is not supported from the manifest");continue}if(A!=="identity")continue;er&&(x=z.LevelKey.fromURL(h,j),j&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(er)>=0&&(x.method=er,x.keyFormat=A,P&&(x.keyID=P),_&&(x.keyFormatVersions=_),x.iv=g));break;case"START":var L=new K(Je).decimalFloatingPoint("TIME-OFFSET");(0,E.isFiniteNumber)(L)&&(I.startTimeOffset=L);break;case"MAP":var N=new K(Je);if(Ee.duration){var Y=new H.Fragment(S,h);De(Y,N,p,x),U=Y,Ee.initSegment=U,U.rawProgramDateTime&&!Ee.rawProgramDateTime&&(Ee.rawProgramDateTime=U.rawProgramDateTime)}else De(Ee,N,p,x),U=Ee,Ve=!0;break;case"SERVER-CONTROL":var ne=new K(Je);I.canBlockReload=ne.bool("CAN-BLOCK-RELOAD"),I.canSkipUntil=ne.optionalFloat("CAN-SKIP-UNTIL",0),I.canSkipDateRanges=I.canSkipUntil>0&&ne.bool("CAN-SKIP-DATERANGES"),I.partHoldBack=ne.optionalFloat("PART-HOLD-BACK",0),I.holdBack=ne.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var ce=new K(Je);I.partTarget=ce.decimalFloatingPoint("PART-TARGET");break;case"PART":var se=I.partList;se||(se=I.partList=[]);var pe=ie>0?se[se.length-1]:void 0,Me=ie++,qe=new H.Part(new K(Je),Ee,h,Me,pe);se.push(qe),Ee.duration+=qe.duration;break;case"PRELOAD-HINT":var Qe=new K(Je);I.preloadHint=Qe;break;case"RENDITION-REPORT":var We=new K(Je);I.renditionReports=I.renditionReports||[],I.renditionReports.push(We);break;default:w.logger.warn("line parsed but not handled: "+C)}}}Te&&!Te.relurl?(R.pop(),le-=Te.duration,I.partList&&(I.fragmentHint=Te)):I.partList&&(Ce(Ee,Te),Ee.cc=he,I.fragmentHint=Ee);var dt=R.length,Rt=R[0],Bt=R[dt-1];if((le+=I.skippedSegments*I.targetduration)>0&&dt&&Bt){I.averagetargetduration=le/dt;var xr=Bt.sn;I.endSN=xr!=="initSegment"?xr:0,Rt&&(I.startCC=Rt.cc,Rt.initSegment||I.fragments.every(function(Or){return Or.relurl&&(qr=Or.relurl,ve.test((zr=(Ur=m.parseURL(qr))===null||Ur===void 0?void 0:Ur.path)!=null?zr:""));var qr,zr,Ur})&&(w.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(Ee=new H.Fragment(S,h)).relurl=Bt.relurl,Ee.level=p,Ee.sn="initSegment",Rt.initSegment=Ee,I.needSidxRanges=!0))}else I.endSN=0,I.startCC=0;return I.fragmentHint&&(le+=I.fragmentHint.duration),I.totalduration=le,I.endCC=he,je>0&&function(Or,qr){for(var zr=Or[qr],Ur=qr;Ur--;){var Xr=Or[Ur];if(!Xr)return;Xr.programDateTime=zr.programDateTime-1e3*Xr.duration,zr=Xr}}(R,je),I},O}();function fe(O,M){["video","audio","text"].forEach(function(h){var p=O.filter(function(T){return function(C,v){var x=X[v];return!!x&&x[C.slice(0,4)]===!0}(T,h)});if(p.length){var S=p.filter(function(T){return T.lastIndexOf("avc1",0)===0||T.lastIndexOf("mp4a",0)===0});M[h+"Codec"]=S.length>0?S[0]:p[0],O=O.filter(function(T){return p.indexOf(T)===-1})}}),M.unknownCodecs=O}function xe(O,M,h){var p=M[h];p&&(O[h]=p)}function Ce(O,M){O.rawProgramDateTime?O.programDateTime=Date.parse(O.rawProgramDateTime):M!=null&&M.programDateTime&&(O.programDateTime=M.endProgramDateTime),(0,E.isFiniteNumber)(O.programDateTime)||(O.programDateTime=null,O.rawProgramDateTime=null)}function De(O,M,h,p){O.relurl=M.URI,M.BYTERANGE&&O.setByteRange(M.BYTERANGE),O.level=h,O.sn="initSegment",p&&(O.levelkey=p),O.initSegment=null}var ke=l(308);function Xe(O,M){var h=O.url;return h!==void 0&&h.indexOf("data:")!==0||(h=M.url),h}let et=function(){function O(h){this.hls=void 0,this.loaders=Object.create(null),this.hls=h,this.registerListeners()}var M=O.prototype;return M.startLoad=function(h){},M.stopLoad=function(){this.destroyInternalLoaders()},M.registerListeners=function(){var h=this.hls;h.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),h.on(y.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),h.on(y.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},M.unregisterListeners=function(){var h=this.hls;h.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(y.Events.LEVEL_LOADING,this.onLevelLoading,this),h.off(y.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),h.off(y.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},M.createInternalLoader=function(h){var p=this.hls.config,S=p.pLoader,T=p.loader,C=new(S||T)(p);return h.loader=C,this.loaders[h.type]=C,C},M.getInternalLoader=function(h){return this.loaders[h.type]},M.resetInternalLoader=function(h){this.loaders[h]&&delete this.loaders[h]},M.destroyInternalLoaders=function(){for(var h in this.loaders){var p=this.loaders[h];p&&p.destroy(),this.resetInternalLoader(h)}},M.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},M.onManifestLoading=function(h,p){var S=p.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:ke.PlaylistContextType.MANIFEST,url:S,deliveryDirectives:null})},M.onLevelLoading=function(h,p){var S=p.id,T=p.level,C=p.url,v=p.deliveryDirectives;this.load({id:S,groupId:null,level:T,responseType:"text",type:ke.PlaylistContextType.LEVEL,url:C,deliveryDirectives:v})},M.onAudioTrackLoading=function(h,p){var S=p.id,T=p.groupId,C=p.url,v=p.deliveryDirectives;this.load({id:S,groupId:T,level:null,responseType:"text",type:ke.PlaylistContextType.AUDIO_TRACK,url:C,deliveryDirectives:v})},M.onSubtitleTrackLoading=function(h,p){var S=p.id,T=p.groupId,C=p.url,v=p.deliveryDirectives;this.load({id:S,groupId:T,level:null,responseType:"text",type:ke.PlaylistContextType.SUBTITLE_TRACK,url:C,deliveryDirectives:v})},M.load=function(h){var p,S,T,C,v,x,I=this.hls.config,R=this.getInternalLoader(h);if(R){var U=R.context;if(U&&U.url===h.url)return void w.logger.trace("[playlist-loader]: playlist request ongoing");w.logger.log("[playlist-loader]: aborting previous loader for type: "+h.type),R.abort()}switch(h.type){case ke.PlaylistContextType.MANIFEST:S=I.manifestLoadingMaxRetry,T=I.manifestLoadingTimeOut,C=I.manifestLoadingRetryDelay,v=I.manifestLoadingMaxRetryTimeout;break;case ke.PlaylistContextType.LEVEL:case ke.PlaylistContextType.AUDIO_TRACK:case ke.PlaylistContextType.SUBTITLE_TRACK:S=0,T=I.levelLoadingTimeOut;break;default:S=I.levelLoadingMaxRetry,T=I.levelLoadingTimeOut,C=I.levelLoadingRetryDelay,v=I.levelLoadingMaxRetryTimeout}if(R=this.createInternalLoader(h),(p=h.deliveryDirectives)!==null&&p!==void 0&&p.part&&(h.type===ke.PlaylistContextType.LEVEL&&h.level!==null?x=this.hls.levels[h.level].details:h.type===ke.PlaylistContextType.AUDIO_TRACK&&h.id!==null?x=this.hls.audioTracks[h.id].details:h.type===ke.PlaylistContextType.SUBTITLE_TRACK&&h.id!==null&&(x=this.hls.subtitleTracks[h.id].details),x)){var G=x.partTarget,ie=x.targetduration;G&&ie&&(T=Math.min(1e3*Math.max(3*G,.8*ie),T))}var le={timeout:T,maxRetry:S,retryDelay:C,maxRetryDelay:v,highWaterMark:0},he={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};R.load(h,le,he)},M.loadsuccess=function(h,p,S,T){if(T===void 0&&(T=null),S.isSidxRequest)return this.handleSidxRequest(h,S),void this.handlePlaylistLoaded(h,p,S,T);this.resetInternalLoader(S.type);var C=h.data;C.indexOf("#EXTM3U")===0?(p.parsing.start=performance.now(),C.indexOf("#EXTINF:")>0||C.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(h,p,S,T):this.handleMasterPlaylist(h,p,S,T)):this.handleManifestParsingError(h,S,"no EXTM3U delimiter",T)},M.loaderror=function(h,p,S){S===void 0&&(S=null),this.handleNetworkError(p,S,!1,h)},M.loadtimeout=function(h,p,S){S===void 0&&(S=null),this.handleNetworkError(p,S,!0)},M.handleMasterPlaylist=function(h,p,S,T){var C=this.hls,v=h.data,x=Xe(h,S),I=Pe.parseMasterPlaylist(v,x),R=I.levels,U=I.sessionData;if(R.length){var G=R.map(function(Ee){return{id:Ee.attrs.AUDIO,audioCodec:Ee.audioCodec}}),ie=R.map(function(Ee){return{id:Ee.attrs.SUBTITLES,textCodec:Ee.textCodec}}),le=Pe.parseMasterPlaylistMedia(v,x,"AUDIO",G),he=Pe.parseMasterPlaylistMedia(v,x,"SUBTITLES",ie),Te=Pe.parseMasterPlaylistMedia(v,x,"CLOSED-CAPTIONS");le.length&&(le.some(function(Ee){return!Ee.url})||!R[0].audioCodec||R[0].attrs.AUDIO||(w.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),le.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new K({}),bitrate:0,url:""}))),C.trigger(y.Events.MANIFEST_LOADED,{levels:R,audioTracks:le,subtitles:he,captions:Te,url:x,stats:p,networkDetails:T,sessionData:U})}else this.handleManifestParsingError(h,S,"no level found in manifest",T)},M.handleTrackOrLevelPlaylist=function(h,p,S,T){var C=this.hls,v=S.id,x=S.level,I=S.type,R=Xe(h,S),U=(0,E.isFiniteNumber)(v)?v:0,G=(0,E.isFiniteNumber)(x)?x:U,ie=function(je){switch(je.type){case ke.PlaylistContextType.AUDIO_TRACK:return ke.PlaylistLevelType.AUDIO;case ke.PlaylistContextType.SUBTITLE_TRACK:return ke.PlaylistLevelType.SUBTITLE;default:return ke.PlaylistLevelType.MAIN}}(S),le=Pe.parseLevelPlaylist(h.data,R,G,ie,U);if(le.fragments.length){if(I===ke.PlaylistContextType.MANIFEST){var he={attrs:new K({}),bitrate:0,details:le,name:"",url:R};C.trigger(y.Events.MANIFEST_LOADED,{levels:[he],audioTracks:[],url:R,stats:p,networkDetails:T,sessionData:null})}if(p.parsing.end=performance.now(),le.needSidxRanges){var Te,Ee=(Te=le.fragments[0].initSegment)===null||Te===void 0?void 0:Te.url;this.load({url:Ee,isSidxRequest:!0,type:I,level:x,levelDetails:le,id:v,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else S.levelDetails=le,this.handlePlaylistLoaded(h,p,S,T)}else C.trigger(y.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:R,reason:"no fragments found in level",level:typeof S.level=="number"?S.level:void 0})},M.handleSidxRequest=function(h,p){var S=new Uint8Array(h.data),T=(0,B.findBox)(S,["sidx"])[0];if(T){var C=(0,B.parseSegmentIndex)(T);if(C){var v=C.references,x=p.levelDetails;v.forEach(function(I,R){var U=I.info,G=x.fragments[R];if(G.byteRange.length===0&&G.setByteRange(String(1+U.end-U.start)+"@"+String(U.start)),G.initSegment){var ie=(0,B.findBox)(S,["moov"])[0],le=ie?ie.length:null;G.initSegment.setByteRange(String(le)+"@0")}})}}},M.handleManifestParsingError=function(h,p,S,T){this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:p.type===ke.PlaylistContextType.MANIFEST,url:h.url,reason:S,response:h,context:p,networkDetails:T})},M.handleNetworkError=function(h,p,S,T){S===void 0&&(S=!1),w.logger.warn("[playlist-loader]: A network "+(S?"timeout":"error")+" occurred while loading "+h.type+" level: "+h.level+" id: "+h.id+' group-id: "'+h.groupId+'"');var C=D.ErrorDetails.UNKNOWN,v=!1,x=this.getInternalLoader(h);switch(h.type){case ke.PlaylistContextType.MANIFEST:C=S?D.ErrorDetails.MANIFEST_LOAD_TIMEOUT:D.ErrorDetails.MANIFEST_LOAD_ERROR,v=!0;break;case ke.PlaylistContextType.LEVEL:C=S?D.ErrorDetails.LEVEL_LOAD_TIMEOUT:D.ErrorDetails.LEVEL_LOAD_ERROR,v=!1;break;case ke.PlaylistContextType.AUDIO_TRACK:C=S?D.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,v=!1;break;case ke.PlaylistContextType.SUBTITLE_TRACK:C=S?D.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:D.ErrorDetails.SUBTITLE_LOAD_ERROR,v=!1}x&&this.resetInternalLoader(h.type);var I={type:D.ErrorTypes.NETWORK_ERROR,details:C,fatal:v,url:h.url,loader:x,context:h,networkDetails:p};T&&(I.response=T),this.hls.trigger(y.Events.ERROR,I)},M.handlePlaylistLoaded=function(h,p,S,T){var C=S.type,v=S.level,x=S.id,I=S.groupId,R=S.loader,U=S.levelDetails,G=S.deliveryDirectives;if(U!=null&&U.targetduration){if(R)switch(U.live&&(R.getCacheAge&&(U.ageHeader=R.getCacheAge()||0),R.getCacheAge&&!isNaN(U.ageHeader)||(U.ageHeader=0)),C){case ke.PlaylistContextType.MANIFEST:case ke.PlaylistContextType.LEVEL:this.hls.trigger(y.Events.LEVEL_LOADED,{details:U,level:v||0,id:x||0,stats:p,networkDetails:T,deliveryDirectives:G});break;case ke.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(y.Events.AUDIO_TRACK_LOADED,{details:U,id:x||0,groupId:I||"",stats:p,networkDetails:T,deliveryDirectives:G});break;case ke.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(y.Events.SUBTITLE_TRACK_LOADED,{details:U,id:x||0,groupId:I||"",stats:p,networkDetails:T,deliveryDirectives:G})}}else this.handleManifestParsingError(h,S,"invalid target duration",T)},O}();var tt=function(){function O(h){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=h,this.registerListeners()}var M=O.prototype;return M.startLoad=function(h){},M.stopLoad=function(){this.destroyInternalLoaders()},M.registerListeners=function(){this.hls.on(y.Events.KEY_LOADING,this.onKeyLoading,this)},M.unregisterListeners=function(){this.hls.off(y.Events.KEY_LOADING,this.onKeyLoading)},M.destroyInternalLoaders=function(){for(var h in this.loaders){var p=this.loaders[h];p&&p.destroy()}this.loaders={}},M.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},M.onKeyLoading=function(h,p){var S=p.frag,T=S.type,C=this.loaders[T];if(S.decryptdata){var v=S.decryptdata.uri;if(v!==this.decrypturl||this.decryptkey===null){var x=this.hls.config;if(C&&(w.logger.warn("abort previous key loader for type:"+T),C.abort()),!v)return void w.logger.warn("key uri is falsy");var I=x.loader,R=S.loader=this.loaders[T]=new I(x);this.decrypturl=v,this.decryptkey=null;var U={url:v,frag:S,responseType:"arraybuffer"},G={timeout:x.fragLoadingTimeOut,maxRetry:0,retryDelay:x.fragLoadingRetryDelay,maxRetryDelay:x.fragLoadingMaxRetryTimeout,highWaterMark:0},ie={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};R.load(U,G,ie)}else this.decryptkey&&(S.decryptdata.key=this.decryptkey,this.hls.trigger(y.Events.KEY_LOADED,{frag:S}))}else w.logger.warn("Missing decryption data on fragment in onKeyLoading")},M.loadsuccess=function(h,p,S){var T=S.frag;T.decryptdata?(this.decryptkey=T.decryptdata.key=new Uint8Array(h.data),T.loader=null,delete this.loaders[T.type],this.hls.trigger(y.Events.KEY_LOADED,{frag:T})):w.logger.error("after key load, decryptdata unset")},M.loaderror=function(h,p){var S=p.frag,T=S.loader;T&&T.abort(),delete this.loaders[S.type],this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:S,response:h})},M.loadtimeout=function(h,p){var S=p.frag,T=S.loader;T&&T.abort(),delete this.loaders[S.type],this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:S})},O}();function nt(O,M){var h;try{h=new Event("addtrack")}catch{(h=document.createEvent("Event")).initEvent("addtrack",!1,!1)}h.track=O,M.dispatchEvent(h)}function Be(O,M){var h=O.mode;if(h==="disabled"&&(O.mode="hidden"),O.cues&&!O.cues.getCueById(M.id))try{if(O.addCue(M),!O.cues.getCueById(M.id))throw new Error("addCue is failed for: "+M)}catch(S){w.logger.debug("[texttrack-utils]: "+S);var p=new self.TextTrackCue(M.startTime,M.endTime,M.text);p.id=M.id,O.addCue(p)}h==="disabled"&&(O.mode=h)}function Fe(O){var M=O.mode;if(M==="disabled"&&(O.mode="hidden"),O.cues)for(var h=O.cues.length;h--;)O.removeCue(O.cues[h]);M==="disabled"&&(O.mode=M)}function J(O,M,h,p){var S=O.mode;if(S==="disabled"&&(O.mode="hidden"),O.cues&&O.cues.length>0)for(var T=function(v,x,I){var R=[],U=function(he,Te){if(Te<he[0].startTime)return 0;var Ee=he.length-1;if(Te>he[Ee].endTime)return-1;for(var je=0,Ve=Ee;je<=Ve;){var Ne=Math.floor((Ve+je)/2);if(Te<he[Ne].startTime)Ve=Ne-1;else{if(!(Te>he[Ne].startTime&&je<Ee))return Ne;je=Ne+1}}return he[je].startTime-Te<Te-he[Ve].startTime?je:Ve}(v,x);if(U>-1)for(var G=U,ie=v.length;G<ie;G++){var le=v[G];if(le.startTime>=x&&le.endTime<=I)R.push(le);else if(le.startTime>I)return R}return R}(O.cues,M,h),C=0;C<T.length;C++)p&&!p(T[C])||O.removeCue(T[C]);S==="disabled"&&(O.mode=S)}var ue=l(181),de=l(856);function Oe(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var Ue=function(){var O=Oe();try{new O(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Ke(O,M){return O.getTime()/1e3-M}let at=function(){function O(h){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=h,this._registerListeners()}var M=O.prototype;return M.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},M._registerListeners=function(){var h=this.hls;h.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(y.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),h.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),h.on(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},M._unregisterListeners=function(){var h=this.hls;h.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(y.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),h.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),h.off(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},M.onMediaAttached=function(h,p){this.media=p.media},M.onMediaDetaching=function(){this.id3Track&&(Fe(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},M.onManifestLoading=function(){this.dateRangeCuesAppended={}},M.createTrack=function(h){var p=this.getID3Track(h.textTracks);return p.mode="hidden",p},M.getID3Track=function(h){if(this.media){for(var p=0;p<h.length;p++){var S=h[p];if(S.kind==="metadata"&&S.label==="id3")return nt(S,this.media),S}return this.media.addTextTrack("metadata","id3")}},M.onFragParsingMetadata=function(h,p){if(this.media){var S=this.hls.config,T=S.enableEmsgMetadataCues,C=S.enableID3MetadataCues;if(T||C){p.frag;var v=p.samples;p.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var x=Oe(),I=0;I<v.length;I++){var R=v[I].type;if((R!==de.MetadataSchema.emsg||T)&&C){var U=ue.getID3Frames(v[I].data);if(U){var G=v[I].pts,ie=G+v[I].duration;ie>Ue&&(ie=Ue),ie-G<=0&&(ie=G+.25);for(var le=0;le<U.length;le++){var he=U[le];if(!ue.isTimeStampFrame(he)){this.updateId3CueEnds(G);var Te=new x(G,ie,"");Te.value=he,R&&(Te.type=R),this.id3Track.addCue(Te)}}}}}}}},M.updateId3CueEnds=function(h){var p,S=(p=this.id3Track)===null||p===void 0?void 0:p.cues;if(S)for(var T=S.length;T--;){var C=S[T];C.startTime<h&&C.endTime===Ue&&(C.endTime=h)}},M.onBufferFlushing=function(h,p){var S=p.startOffset,T=p.endOffset,C=p.type,v=this.id3Track,x=this.hls;if(x){var I=x.config,R=I.enableEmsgMetadataCues,U=I.enableID3MetadataCues;v&&(R||U)&&J(v,S,T,C==="audio"?function(G){return G.type===de.MetadataSchema.audioId3&&U}:C==="video"?function(G){return G.type===de.MetadataSchema.emsg&&R}:function(G){return G.type===de.MetadataSchema.audioId3&&U||G.type===de.MetadataSchema.emsg&&R})}},M.onLevelUpdated=function(h,p){var S=this,T=p.details;if(this.media&&T.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var C=this.dateRangeCuesAppended,v=this.id3Track,x=T.dateRanges,I=Object.keys(x);if(v)for(var R=Object.keys(C).filter(function(je){return!I.includes(je)}),U=function(je){var Ve=R[je];Object.keys(C[Ve].cues).forEach(function(Ne){v.removeCue(C[Ve].cues[Ne])}),delete C[Ve]},G=R.length;G--;)U(G);var ie=T.fragments[T.fragments.length-1];if(I.length!==0&&(0,E.isFiniteNumber)(ie?.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var le=ie.programDateTime/1e3-ie.start,he=Oe(),Te=function(je){var Ve=I[je],Ne=x[Ve],Re=C[Ve],He=Re?.cues||{},Le=Re?.durationKnown||!1,Je=Ke(Ne.startDate,le),Ye=Ue,ht=Ne.endDate;if(ht)Ye=Ke(ht,le),Le=!0;else if(Ne.endOnNext&&!Le){var pt=I.reduce(function(er,j){var g=x[j];return g.class===Ne.class&&g.id!==j&&g.startDate>Ne.startDate&&er.push(g),er},[]).sort(function(er,j){return er.startDate.getTime()-j.startDate.getTime()})[0];pt&&(Ye=Ke(pt.startDate,le),Le=!0)}for(var kt,It=Object.keys(Ne.attr),_t=0;_t<It.length;_t++){var Et=It[_t];if(Et!==u.ID&&Et!==u.CLASS&&Et!==u.START_DATE&&Et!==u.DURATION&&Et!==u.END_DATE&&Et!==u.END_ON_NEXT){var Dt=He[Et];if(Dt)Le&&!Re.durationKnown&&(Dt.endTime=Ye);else{var Ft=Ne.attr[Et];Dt=new he(Je,Ye,""),Et!==u.SCTE35_OUT&&Et!==u.SCTE35_IN||(kt=Ft,Ft=Uint8Array.from(kt.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),Dt.value={key:Et,data:Ft},Dt.type=de.MetadataSchema.dateRange,S.id3Track.addCue(Dt),He[Et]=Dt}}}C[Ve]={cues:He,dateRange:Ne,durationKnown:Le}},Ee=0;Ee<I.length;Ee++)Te(Ee)}}},O}();function ut(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}var st,ct=function(){function O(S){var T=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return T.timeupdate()},this.hls=S,this.config=S.config,this.registerListeners()}var M,h,p=O.prototype;return p.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},p.registerListeners=function(){this.hls.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(y.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){this.hls.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(y.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(y.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(y.Events.ERROR,this.onError)},p.onMediaAttached=function(S,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},p.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},p.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},p.onLevelUpdated=function(S,T){var C=T.details;this.levelDetails=C,C.advanced&&this.timeupdate(),!C.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},p.onError=function(S,T){T.details===D.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,w.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},p.timeupdate=function(){var S=this.media,T=this.levelDetails;if(S&&T){this.currentTime=S.currentTime;var C=this.computeLatency();if(C!==null){this._latency=C;var v=this.config,x=v.lowLatencyMode,I=v.maxLiveSyncPlaybackRate;if(x&&I!==1){var R=this.targetLatency;if(R!==null){var U=C-R,G=U<Math.min(this.maxLatency,R+T.targetduration);if(T.live&&G&&U>.05&&this.forwardBufferLength>1){var ie=Math.min(2,Math.max(1,I)),le=Math.round(2/(1+Math.exp(-.75*U-this.edgeStalled))*20)/20;S.playbackRate=Math.min(ie,Math.max(1,le))}else S.playbackRate!==1&&S.playbackRate!==0&&(S.playbackRate=1)}}}}},p.estimateLiveEdge=function(){var S=this.levelDetails;return S===null?null:S.edge+S.age},p.computeLatency=function(){var S=this.estimateLiveEdge();return S===null?null:S-this.currentTime},M=O,(h=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var S=this.config,T=this.levelDetails;return S.liveMaxLatencyDuration!==void 0?S.liveMaxLatencyDuration:T?S.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var S=this.levelDetails;if(S===null)return null;var T=S.holdBack,C=S.partHoldBack,v=S.targetduration,x=this.config,I=x.liveSyncDuration,R=x.liveSyncDurationCount,U=x.lowLatencyMode,G=this.hls.userConfig,ie=U&&C||T;(G.liveSyncDuration||G.liveSyncDurationCount||ie===0)&&(ie=I!==void 0?I:R*v);var le=v;return ie+Math.min(1*this.stallCount,le)}},{key:"liveSyncPosition",get:function(){var S=this.estimateLiveEdge(),T=this.targetLatency,C=this.levelDetails;if(S===null||T===null||C===null)return null;var v=C.edge,x=S-T-this.edgeStalled,I=v-C.totalduration,R=v-(this.config.lowLatencyMode&&C.partTarget||C.targetduration);return Math.min(Math.max(I,x),R)}},{key:"drift",get:function(){var S=this.levelDetails;return S===null?1:S.drift}},{key:"edgeStalled",get:function(){var S=this.levelDetails;if(S===null)return 0;var T=3*(this.config.lowLatencyMode&&S.partTarget||S.targetduration);return Math.max(S.age-T,0)}},{key:"forwardBufferLength",get:function(){var S=this.media,T=this.levelDetails;if(!S||!T)return 0;var C=S.buffered.length;return(C?S.buffered.end(C-1):T.edge)-this.currentTime}}])&&ut(M.prototype,h),Object.defineProperty(M,"prototype",{writable:!1}),O}();function yt(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}(function(O){O.No="",O.Yes="YES",O.v2="v2"})(st||(st={}));var Ct=function(){function O(M,h,p){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=M,this.part=h,this.skip=p}return O.prototype.addDirectives=function(M){var h=new self.URL(M);return this.msn!==void 0&&h.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&h.searchParams.set("_HLS_part",this.part.toString()),this.skip&&h.searchParams.set("_HLS_skip",this.skip),h.toString()},O}(),vt=function(){function O(p){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[p.url],this.attrs=p.attrs,this.bitrate=p.bitrate,p.details&&(this.details=p.details),this.id=p.id||0,this.name=p.name,this.width=p.width||0,this.height=p.height||0,this.audioCodec=p.audioCodec,this.videoCodec=p.videoCodec,this.unknownCodecs=p.unknownCodecs,this.codecSet=[p.videoCodec,p.audioCodec].filter(function(S){return S}).join(",").replace(/\.[^.,]+/g,"")}var M,h;return M=O,(h=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(p){var S=p%this.url.length;this._urlId!==S&&(this.details=void 0,this._urlId=S)}}])&&yt(M.prototype,h),Object.defineProperty(M,"prototype",{writable:!1}),O}();function ft(){return ft=Object.assign?Object.assign.bind():function(O){for(var M=1;M<arguments.length;M++){var h=arguments[M];for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(O[p]=h[p])}return O},ft.apply(this,arguments)}function Ut(O,M,h){switch(M){case"audio":O.audioGroupIds||(O.audioGroupIds=[]),O.audioGroupIds.push(h);break;case"text":O.textGroupIds||(O.textGroupIds=[]),O.textGroupIds.push(h)}}function Nt(O){var M={};O.forEach(function(h){var p=h.groupId||"";h.id=M[p]=M[p]||0,M[p]++})}function bt(O,M){var h=M.startPTS;if((0,E.isFiniteNumber)(h)){var p,S=0;M.sn>O.sn?(S=h-O.start,p=O):(S=O.start-h,p=M),p.duration!==S&&(p.duration=S)}else M.sn>O.sn?O.cc===M.cc&&O.minEndPTS?M.start=O.start+(O.minEndPTS-O.start):M.start=O.start+O.duration:M.start=Math.max(O.start-M.duration,0)}function sr(O,M,h,p,S,T){p-h<=0&&(w.logger.warn("Fragment should have a positive duration",M),p=h+M.duration,T=S+M.duration);var C=h,v=p,x=M.startPTS,I=M.endPTS;if((0,E.isFiniteNumber)(x)){var R=Math.abs(x-h);(0,E.isFiniteNumber)(M.deltaPTS)?M.deltaPTS=Math.max(R,M.deltaPTS):M.deltaPTS=R,C=Math.max(h,x),h=Math.min(h,x),S=Math.min(S,M.startDTS),v=Math.min(p,I),p=Math.max(p,I),T=Math.max(T,M.endDTS)}M.duration=p-h;var U=h-M.start;M.appendedPTS=p,M.start=M.startPTS=h,M.maxStartPTS=C,M.startDTS=S,M.endPTS=p,M.minEndPTS=v,M.endDTS=T;var G,ie=M.sn;if(!O||ie<O.startSN||ie>O.endSN)return 0;var le=ie-O.startSN,he=O.fragments;for(he[le]=M,G=le;G>0;G--)bt(he[G],he[G-1]);for(G=le;G<he.length-1;G++)bt(he[G],he[G+1]);return O.fragmentHint&&bt(he[he.length-1],O.fragmentHint),O.PTSKnown=O.alignedSliding=!0,U}function Yt(O,M){var h=M.startSN+M.skippedSegments-O.startSN,p=O.fragments;h<0||h>=p.length||Qt(M,p[h].start)}function Qt(O,M){if(M){for(var h=O.fragments,p=O.skippedSegments;p<h.length;p++)h[p].start+=M;O.fragmentHint&&(O.fragmentHint.start+=M)}}var lr=function(){function O(h,p){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=w.logger.log.bind(w.logger,p+":"),this.warn=w.logger.warn.bind(w.logger,p+":"),this.hls=h}var M=O.prototype;return M.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},M.onError=function(h,p){p.fatal&&p.type===D.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},M.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},M.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},M.stopLoad=function(){this.canLoad=!1,this.clearTimer()},M.switchParams=function(h,p){var S=p?.renditionReports;if(S)for(var T=0;T<S.length;T++){var C=S[T],v=""+C.URI;if(v===h.slice(-v.length)){var x=parseInt(C["LAST-MSN"]),I=parseInt(C["LAST-PART"]);if(p&&this.hls.config.lowLatencyMode){var R=Math.min(p.age-p.partTarget,p.targetduration);I!==void 0&&R>p.partTarget&&(I+=1)}if((0,E.isFiniteNumber)(x))return new Ct(x,(0,E.isFiniteNumber)(I)?I:void 0,st.No)}}},M.loadPlaylist=function(h){},M.shouldLoadTrack=function(h){return this.canLoad&&h&&!!h.url&&(!h.details||h.details.live)},M.playlistLoaded=function(h,p,S){var T=this,C=p.details,v=p.stats,x=v.loading.end?Math.max(0,self.performance.now()-v.loading.end):0;if(C.advancedDateTime=Date.now()-x,C.live||S!=null&&S.live){if(C.reloaded(S),S&&this.log("live playlist "+h+" "+(C.advanced?"REFRESHED "+C.lastPartSn+"-"+C.lastPartIndex:"MISSED")),S&&C.fragments.length>0&&function(He,Le){for(var Je=null,Ye=He.fragments,ht=Ye.length-1;ht>=0;ht--){var pt=Ye[ht].initSegment;if(pt){Je=pt;break}}He.fragmentHint&&delete He.fragmentHint.endPTS;var kt,It,_t,Et,Dt,Ft=0;if(function(A,L,N){for(var Y=L.skippedSegments,ne=Math.max(A.startSN,L.startSN)-L.startSN,ce=(A.fragmentHint?1:0)+(Y?L.endSN:Math.min(A.endSN,L.endSN))-L.startSN,se=L.startSN-A.startSN,pe=L.fragmentHint?L.fragments.concat(L.fragmentHint):L.fragments,Me=A.fragmentHint?A.fragments.concat(A.fragmentHint):A.fragments,qe=ne;qe<=ce;qe++){var Qe=Me[se+qe],We=pe[qe];Y&&!We&&qe<Y&&(We=L.fragments[qe]=Qe),Qe&&We&&N(Qe,We)}}(He,Le,function(A,L){A.relurl&&(Ft=A.cc-L.cc),(0,E.isFiniteNumber)(A.startPTS)&&(0,E.isFiniteNumber)(A.endPTS)&&(L.start=L.startPTS=A.startPTS,L.startDTS=A.startDTS,L.appendedPTS=A.appendedPTS,L.maxStartPTS=A.maxStartPTS,L.endPTS=A.endPTS,L.endDTS=A.endDTS,L.minEndPTS=A.minEndPTS,L.duration=A.endPTS-A.startPTS,L.duration&&(kt=L),Le.PTSKnown=Le.alignedSliding=!0),L.elementaryStreams=A.elementaryStreams,L.loader=A.loader,L.stats=A.stats,L.urlId=A.urlId,A.initSegment&&(L.initSegment=A.initSegment,Je=A.initSegment)}),Je&&(Le.fragmentHint?Le.fragments.concat(Le.fragmentHint):Le.fragments).forEach(function(A){var L;A.initSegment&&A.initSegment.relurl!==((L=Je)===null||L===void 0?void 0:L.relurl)||(A.initSegment=Je)}),Le.skippedSegments)if(Le.deltaUpdateFailed=Le.fragments.some(function(A){return!A}),Le.deltaUpdateFailed){w.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var er=Le.skippedSegments;er--;)Le.fragments.shift();Le.startSN=Le.fragments[0].sn,Le.startCC=Le.fragments[0].cc}else Le.canSkipDateRanges&&(Le.dateRanges=(It=He.dateRanges,_t=Le.dateRanges,Et=Le.recentlyRemovedDateranges,Dt=ft({},It),Et&&Et.forEach(function(A){delete Dt[A]}),Object.keys(_t).forEach(function(A){var L=new ee(_t[A].attr,Dt[A]);L.isValid?Dt[A]=L:w.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(_t[A].attr)+'"')}),Dt));var j=Le.fragments;if(Ft){w.logger.warn("discontinuity sliding from playlist, take drift into account");for(var g=0;g<j.length;g++)j[g].cc+=Ft}Le.skippedSegments&&(Le.startCC=Le.fragments[0].cc),function(A,L,N){if(A&&L)for(var Y=0,ne=0,ce=A.length;ne<=ce;ne++){var se=A[ne],pe=L[ne+Y];se&&pe&&se.index===pe.index&&se.fragment.sn===pe.fragment.sn?(Me=se,(qe=pe).elementaryStreams=Me.elementaryStreams,qe.stats=Me.stats):Y--}var Me,qe}(He.partList,Le.partList),kt?sr(Le,kt,kt.startPTS,kt.endPTS,kt.startDTS,kt.endDTS):Yt(He,Le),j.length&&(Le.totalduration=Le.edge-j[0].start),Le.driftStartTime=He.driftStartTime,Le.driftStart=He.driftStart;var _=Le.advancedDateTime;if(Le.advanced&&_){var P=Le.edge;Le.driftStart||(Le.driftStartTime=_,Le.driftStart=P),Le.driftEndTime=_,Le.driftEnd=P}else Le.driftEndTime=He.driftEndTime,Le.driftEnd=He.driftEnd,Le.advancedDateTime=He.advancedDateTime}(S,C),!this.canLoad||!C.live)return;var I,R=void 0,U=void 0;if(C.canBlockReload&&C.endSN&&C.advanced){var G=this.hls.config.lowLatencyMode,ie=C.lastPartSn,le=C.endSN,he=C.lastPartIndex,Te=ie===le;he!==-1?(R=Te?le+1:ie,U=Te?G?0:he:he+1):R=le+1;var Ee=C.age,je=Ee+C.ageHeader,Ve=Math.min(je-C.partTarget,1.5*C.targetduration);if(Ve>0){if(S&&Ve>S.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+S.tuneInGoal+" to: "+Ve+" with playlist age: "+C.age),Ve=0;else{var Ne=Math.floor(Ve/C.targetduration);R+=Ne,U!==void 0&&(U+=Math.round(Ve%C.targetduration/C.partTarget)),this.log("CDN Tune-in age: "+C.ageHeader+"s last advanced "+Ee.toFixed(2)+"s goal: "+Ve+" skip sn "+Ne+" to part "+U)}C.tuneInGoal=Ve}if(I=this.getDeliveryDirectives(C,p.deliveryDirectives,R,U),G||!Te)return void this.loadPlaylist(I)}else I=this.getDeliveryDirectives(C,p.deliveryDirectives,R,U);var Re=function(He,Le){var Je,Ye=1e3*He.levelTargetDuration,ht=Ye/2,pt=He.age,kt=pt>0&&pt<3*Ye,It=Le.loading.end-Le.loading.start,_t=He.availabilityDelay;if(He.updated===!1)if(kt){var Et=333*He.misses;Je=Math.max(Math.min(ht,2*It),Et),He.availabilityDelay=(He.availabilityDelay||0)+Je}else Je=ht;else kt?(_t=Math.min(_t||Ye/2,pt),He.availabilityDelay=_t,Je=_t+Ye-pt):Je=Ye-It;return Math.round(Je)}(C,v);R!==void 0&&C.canBlockReload&&(Re-=C.partTarget||1),this.log("reload live playlist "+h+" in "+Math.round(Re)+" ms"),this.timer=self.setTimeout(function(){return T.loadPlaylist(I)},Re)}else this.clearTimer()},M.getDeliveryDirectives=function(h,p,S,T){var C=function(v,x){var I=v.canSkipUntil,R=v.canSkipDateRanges,U=v.endSN;return I&&(x!==void 0?x-U:0)<I?R?st.v2:st.Yes:st.No}(h,S);return p!=null&&p.skip&&h.deltaUpdateFailed&&(S=p.msn,T=p.part,C=st.No),new Ct(S,T,C)},M.retryLoadingOrFail=function(h){var p,S=this,T=this.hls.config,C=this.retryCount<T.levelLoadingMaxRetry;if(C)if(this.retryCount++,h.details.indexOf("LoadTimeOut")>-1&&(p=h.context)!==null&&p!==void 0&&p.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+h.details+'"'),this.loadPlaylist();else{var v=Math.min(Math.pow(2,this.retryCount)*T.levelLoadingRetryDelay,T.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return S.loadPlaylist()},v),this.warn("retry playlist loading #"+this.retryCount+" in "+v+' ms after "'+h.details+'"')}else this.warn('cannot recover from error "'+h.details+'"'),this.clearTimer(),h.fatal=!0;return C},O}();function $t(){return $t=Object.assign?Object.assign.bind():function(O){for(var M=1;M<arguments.length;M++){var h=arguments[M];for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(O[p]=h[p])}return O},$t.apply(this,arguments)}function Ae(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}function ye(O,M){return ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,p){return h.__proto__=p,h},ye(O,M)}var Z,me=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),ge=function(O){var M,h;function p(v){var x;return(x=O.call(this,v,"[level-controller]")||this)._levels=[],x._firstLevel=-1,x._startLevel=void 0,x.currentLevelIndex=-1,x.manualLevelIndex=-1,x.onParsedComplete=void 0,x._registerListeners(),x}h=O,(M=p).prototype=Object.create(h.prototype),M.prototype.constructor=M,ye(M,h);var S,T,C=p.prototype;return C._registerListeners=function(){var v=this.hls;v.on(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),v.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),v.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),v.on(y.Events.ERROR,this.onError,this)},C._unregisterListeners=function(){var v=this.hls;v.off(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),v.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),v.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),v.off(y.Events.ERROR,this.onError,this)},C.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,O.prototype.destroy.call(this)},C.startLoad=function(){this._levels.forEach(function(v){v.loadError=0}),O.prototype.startLoad.call(this)},C.onManifestLoaded=function(v,x){var I,R,U=[],G=[],ie=[],le={},he=!1,Te=!1,Ee=!1;if(x.levels.forEach(function(Re){var He=Re.attrs;he=he||!(!Re.width||!Re.height),Te=Te||!!Re.videoCodec,Ee=Ee||!!Re.audioCodec,me&&Re.audioCodec&&Re.audioCodec.indexOf("mp4a.40.34")!==-1&&(Re.audioCodec=void 0);var Le=Re.bitrate+"-"+Re.attrs.RESOLUTION+"-"+Re.attrs.CODECS;(R=le[Le])?R.url.push(Re.url):(R=new vt(Re),le[Le]=R,U.push(R)),He&&(He.AUDIO&&Ut(R,"audio",He.AUDIO),He.SUBTITLES&&Ut(R,"text",He.SUBTITLES))}),(he||Te)&&Ee&&(U=U.filter(function(Re){var He=Re.videoCodec,Le=Re.width,Je=Re.height;return!!He||!(!Le||!Je)})),U=U.filter(function(Re){var He=Re.audioCodec,Le=Re.videoCodec;return(!He||Q(He,"audio"))&&(!Le||Q(Le,"video"))}),x.audioTracks&&Nt(G=x.audioTracks.filter(function(Re){return!Re.audioCodec||Q(Re.audioCodec,"audio")})),x.subtitles&&Nt(ie=x.subtitles),U.length>0){I=U[0].bitrate,U.sort(function(Re,He){return Re.bitrate-He.bitrate}),this._levels=U;for(var je=0;je<U.length;je++)if(U[je].bitrate===I){this._firstLevel=je,this.log("manifest loaded, "+U.length+" level(s) found, first bitrate: "+I);break}var Ve=Ee&&!Te,Ne={levels:U,audioTracks:G,subtitleTracks:ie,firstLevel:this._firstLevel,stats:x.stats,audio:Ee,video:Te,altAudio:!Ve&&G.some(function(Re){return!!Re.url})};this.hls.trigger(y.Events.MANIFEST_PARSED,Ne),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:x.url,reason:"no level with compatible codecs found in manifest"})},C.onError=function(v,x){var I;if(O.prototype.onError.call(this,v,x),!x.fatal){var R=x.context,U=this._levels[this.currentLevelIndex];if(R&&(R.type===ke.PlaylistContextType.AUDIO_TRACK&&U.audioGroupIds&&R.groupId===U.audioGroupIds[U.urlId]||R.type===ke.PlaylistContextType.SUBTITLE_TRACK&&U.textGroupIds&&R.groupId===U.textGroupIds[U.urlId]))this.redundantFailover(this.currentLevelIndex);else{var G,ie=!1,le=!0;switch(x.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:if(x.frag){var he=x.frag.type===ke.PlaylistLevelType.MAIN?x.frag.level:this.currentLevelIndex,Te=this._levels[he];Te?(Te.fragmentError++,Te.fragmentError>this.hls.config.fragLoadingMaxRetry&&(G=he)):G=he}break;case D.ErrorDetails.LEVEL_LOAD_ERROR:case D.ErrorDetails.LEVEL_LOAD_TIMEOUT:R&&(R.deliveryDirectives&&(le=!1),G=R.level),ie=!0;break;case D.ErrorDetails.REMUX_ALLOC_ERROR:G=(I=x.level)!=null?I:this.currentLevelIndex,ie=!0}G!==void 0&&this.recoverLevel(x,G,ie,le)}}},C.recoverLevel=function(v,x,I,R){var U=v.details,G=this._levels[x];if(G.loadError++,I){if(!this.retryLoadingOrFail(v))return void(this.currentLevelIndex=-1);v.levelRetry=!0}if(R){var ie=G.url.length;if(ie>1&&G.loadError<ie)v.levelRetry=!0,this.redundantFailover(x);else if(this.manualLevelIndex===-1){for(var le=-1,he=this._levels,Te=he.length;Te--;){var Ee=(Te+this.currentLevelIndex)%he.length;if(Ee!==this.currentLevelIndex&&he[Ee].loadError===0){le=Ee;break}}le>-1&&this.currentLevelIndex!==le&&(this.warn(U+": switch to "+le),v.levelRetry=!0,this.hls.nextAutoLevel=le)}}},C.redundantFailover=function(v){var x=this._levels[v],I=x.url.length;if(I>1){var R=(x.urlId+1)%I;this.warn("Switching to redundant URL-id "+R),this._levels.forEach(function(U){U.urlId=R}),this.level=v}},C.onFragLoaded=function(v,x){var I=x.frag;if(I!==void 0&&I.type===ke.PlaylistLevelType.MAIN){var R=this._levels[I.level];R!==void 0&&(R.fragmentError=0,R.loadError=0)}},C.onLevelLoaded=function(v,x){var I,R,U=x.level,G=x.details,ie=this._levels[U];if(!ie)return this.warn("Invalid level index "+U),void((R=x.deliveryDirectives)!==null&&R!==void 0&&R.skip&&(G.deltaUpdateFailed=!0));U===this.currentLevelIndex?(ie.fragmentError===0&&(ie.loadError=0,this.retryCount=0),this.playlistLoaded(U,x,ie.details)):(I=x.deliveryDirectives)!==null&&I!==void 0&&I.skip&&(G.deltaUpdateFailed=!0)},C.onAudioTrackSwitched=function(v,x){var I=this.hls.levels[this.currentLevelIndex];if(I&&I.audioGroupIds){for(var R=-1,U=this.hls.audioTracks[x.id].groupId,G=0;G<I.audioGroupIds.length;G++)if(I.audioGroupIds[G]===U){R=G;break}R!==I.urlId&&(I.urlId=R,this.startLoad())}},C.loadPlaylist=function(v){var x=this.currentLevelIndex,I=this._levels[x];if(this.canLoad&&I&&I.url.length>0){var R=I.urlId,U=I.url[R];if(v)try{U=v.addDirectives(U)}catch(G){this.warn("Could not construct new URL with HLS Delivery Directives: "+G)}this.log("Attempt loading level index "+x+(v?" at sn "+v.msn+" part "+v.part:"")+" with URL-id "+R+" "+U),this.clearTimer(),this.hls.trigger(y.Events.LEVEL_LOADING,{url:U,level:x,id:R,deliveryDirectives:v||null})}},C.removeLevel=function(v,x){var I=function(U,G){return G!==x},R=this._levels.filter(function(U,G){return G!==v||U.url.length>1&&x!==void 0&&(U.url=U.url.filter(I),U.audioGroupIds&&(U.audioGroupIds=U.audioGroupIds.filter(I)),U.textGroupIds&&(U.textGroupIds=U.textGroupIds.filter(I)),U.urlId=0,!0)}).map(function(U,G){var ie=U.details;return ie!=null&&ie.fragments&&ie.fragments.forEach(function(le){le.level=G}),U});this._levels=R,this.hls.trigger(y.Events.LEVELS_UPDATED,{levels:R})},S=p,(T=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(v){var x,I=this._levels;if(I.length!==0&&(this.currentLevelIndex!==v||(x=I[v])===null||x===void 0||!x.details)){if(v<0||v>=I.length){var R=v<0;if(this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.LEVEL_SWITCH_ERROR,level:v,fatal:R,reason:"invalid level idx"}),R)return;v=Math.min(v,I.length-1)}this.clearTimer();var U=this.currentLevelIndex,G=I[U],ie=I[v];this.log("switching to level "+v+" from "+U),this.currentLevelIndex=v;var le=$t({},ie,{level:v,maxBitrate:ie.maxBitrate,uri:ie.uri,urlId:ie.urlId});delete le._urlId,this.hls.trigger(y.Events.LEVEL_SWITCHING,le);var he=ie.details;if(!he||he.live){var Te=this.switchParams(ie.uri,G?.details);this.loadPlaylist(Te)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(v){this.manualLevelIndex=v,this._startLevel===void 0&&(this._startLevel=v),v!==-1&&(this.level=v)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(v){this._firstLevel=v}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var v=this.hls.config.startLevel;return v!==void 0?v:this._firstLevel}return this._startLevel},set:function(v){this._startLevel=v}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(v){this.level=v,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=v)}}])&&Ae(S.prototype,T),Object.defineProperty(S,"prototype",{writable:!1}),p}(lr);(function(O){O.NOT_LOADED="NOT_LOADED",O.APPENDING="APPENDING",O.PARTIAL="PARTIAL",O.OK="OK"})(Z||(Z={}));var Se=function(){function O(h){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=h,this._registerListeners()}var M=O.prototype;return M._registerListeners=function(){var h=this.hls;h.on(y.Events.BUFFER_APPENDED,this.onBufferAppended,this),h.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),h.on(y.Events.FRAG_LOADED,this.onFragLoaded,this)},M._unregisterListeners=function(){var h=this.hls;h.off(y.Events.BUFFER_APPENDED,this.onBufferAppended,this),h.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),h.off(y.Events.FRAG_LOADED,this.onFragLoaded,this)},M.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},M.getAppendedFrag=function(h,p){if(p===ke.PlaylistLevelType.MAIN){var S=this.activeFragment,T=this.activeParts;if(!S)return null;if(T)for(var C=T.length;C--;){var v=T[C],x=v?v.end:S.appendedPTS;if(v.start<=h&&x!==void 0&&h<=x)return C>9&&(this.activeParts=T.slice(C-9)),v}else if(S.start<=h&&S.appendedPTS!==void 0&&h<=S.appendedPTS)return S}return this.getBufferedFrag(h,p)},M.getBufferedFrag=function(h,p){for(var S=this.fragments,T=Object.keys(S),C=T.length;C--;){var v=S[T[C]];if(v?.body.type===p&&v.buffered){var x=v.body;if(x.start<=h&&h<=x.end)return x}}return null},M.detectEvictedFragments=function(h,p,S){var T=this;Object.keys(this.fragments).forEach(function(C){var v=T.fragments[C];if(v)if(v.buffered){var x=v.range[h];x&&x.time.some(function(I){var R=!T.isTimeBuffered(I.startPTS,I.endPTS,p);return R&&T.removeFragment(v.body),R})}else v.body.type===S&&T.removeFragment(v.body)})},M.detectPartialFragments=function(h){var p=this,S=this.timeRanges,T=h.frag,C=h.part;if(S&&T.sn!=="initSegment"){var v=we(T),x=this.fragments[v];x&&(Object.keys(S).forEach(function(I){var R=T.elementaryStreams[I];if(R){var U=S[I],G=C!==null||R.partial===!0;x.range[I]=p.getBufferedTimes(T,C,G,U)}}),x.loaded=null,Object.keys(x.range).length?x.buffered=!0:this.removeFragment(x.body))}},M.fragBuffered=function(h){var p=we(h),S=this.fragments[p];S&&(S.loaded=null,S.buffered=!0)},M.getBufferedTimes=function(h,p,S,T){for(var C={time:[],partial:S},v=p?p.start:h.start,x=p?p.end:h.end,I=h.minEndPTS||x,R=h.maxStartPTS||v,U=0;U<T.length;U++){var G=T.start(U)-this.bufferPadding,ie=T.end(U)+this.bufferPadding;if(R>=G&&I<=ie){C.time.push({startPTS:Math.max(v,T.start(U)),endPTS:Math.min(x,T.end(U))});break}if(v<ie&&x>G)C.partial=!0,C.time.push({startPTS:Math.max(v,T.start(U)),endPTS:Math.min(x,T.end(U))});else if(x<=G)break}return C},M.getPartialFragment=function(h){var p,S,T,C=null,v=0,x=this.bufferPadding,I=this.fragments;return Object.keys(I).forEach(function(R){var U=I[R];U&&be(U)&&(S=U.body.start-x,T=U.body.end+x,h>=S&&h<=T&&(p=Math.min(h-S,T-h),v<=p&&(C=U.body,v=p)))}),C},M.getState=function(h){var p=we(h),S=this.fragments[p];return S?S.buffered?be(S)?Z.PARTIAL:Z.OK:Z.APPENDING:Z.NOT_LOADED},M.isTimeBuffered=function(h,p,S){for(var T,C,v=0;v<S.length;v++){if(T=S.start(v)-this.bufferPadding,C=S.end(v)+this.bufferPadding,h>=T&&p<=C)return!0;if(p<=T)return!1}return!1},M.onFragLoaded=function(h,p){var S=p.frag,T=p.part;if(S.sn!=="initSegment"&&!S.bitrateTest&&!T){var C=we(S);this.fragments[C]={body:S,loaded:p,buffered:!1,range:Object.create(null)}}},M.onBufferAppended=function(h,p){var S=this,T=p.frag,C=p.part,v=p.timeRanges;if(T.type===ke.PlaylistLevelType.MAIN)if(this.activeFragment=T,C){var x=this.activeParts;x||(this.activeParts=x=[]),x.push(C)}else this.activeParts=null;this.timeRanges=v,Object.keys(v).forEach(function(I){var R=v[I];if(S.detectEvictedFragments(I,R),!C)for(var U=0;U<R.length;U++)T.appendedPTS=Math.max(R.end(U),T.appendedPTS||0)})},M.onFragBuffered=function(h,p){this.detectPartialFragments(p)},M.hasFragment=function(h){var p=we(h);return!!this.fragments[p]},M.removeFragmentsInRange=function(h,p,S){var T=this;Object.keys(this.fragments).forEach(function(C){var v=T.fragments[C];if(v&&v.buffered){var x=v.body;x.type===S&&x.start<p&&x.end>h&&T.removeFragment(x)}})},M.removeFragment=function(h){var p=we(h);h.stats.loaded=0,h.clearElementaryStreamInfo(),delete this.fragments[p]},M.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},O}();function be(O){var M,h;return O.buffered&&(((M=O.range.video)===null||M===void 0?void 0:M.partial)||((h=O.range.audio)===null||h===void 0?void 0:h.partial))}function we(O){return O.type+"_"+O.level+"_"+O.urlId+"_"+O.sn}var $e=function(){function O(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var M=O.prototype;return M.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},M.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},M.onHandlerDestroyed=function(){},M.hasInterval=function(){return!!this._tickInterval},M.hasNextTick=function(){return!!this._tickTimer},M.setInterval=function(h){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,h),!0)},M.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},M.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},M.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},M.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},M.doTick=function(){},O}(),ze={length:0,start:function(){return 0},end:function(){return 0}},Ge=function(){function O(){}return O.isBuffered=function(M,h){try{if(M){for(var p=O.getBuffered(M),S=0;S<p.length;S++)if(h>=p.start(S)&&h<=p.end(S))return!0}}catch{}return!1},O.bufferInfo=function(M,h,p){try{if(M){var S,T=O.getBuffered(M),C=[];for(S=0;S<T.length;S++)C.push({start:T.start(S),end:T.end(S)});return this.bufferedInfo(C,h,p)}}catch{}return{len:0,start:h,end:h,nextStart:void 0}},O.bufferedInfo=function(M,h,p){h=Math.max(0,h),M.sort(function(he,Te){return he.start-Te.start||Te.end-he.end});var S=[];if(p)for(var T=0;T<M.length;T++){var C=S.length;if(C){var v=S[C-1].end;M[T].start-v<p?M[T].end>v&&(S[C-1].end=M[T].end):S.push(M[T])}else S.push(M[T])}else S=M;for(var x,I=0,R=h,U=h,G=0;G<S.length;G++){var ie=S[G].start,le=S[G].end;if(h+p>=ie&&h<le)R=ie,I=(U=le)-h;else if(h+p<ie){x=ie;break}}return{len:I,start:R||0,end:U||0,nextStart:x}},O.getBuffered=function(M){try{return M.buffered}catch(h){return w.logger.log("failed to get media.buffered",h),ze}},O}(),Ze=function(O,M,h,p,S,T){p===void 0&&(p=0),S===void 0&&(S=-1),T===void 0&&(T=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=O,this.sn=M,this.id=h,this.size=p,this.part=S,this.partial=T};function it(O,M){for(var h=null,p=0,S=O.length;p<S;p++){var T=O[p];if(T&&T.cc===M){h=T;break}}return h}function rt(O,M){if(O){var h=O.start+M;O.start=O.startPTS=h,O.endPTS=h+O.duration}}function ot(O,M){for(var h=M.fragments,p=0,S=h.length;p<S;p++)rt(h[p],O);M.fragmentHint&&rt(M.fragmentHint,O),M.alignedSliding=!0}function gt(O,M){if(O.hasProgramDateTime&&M.hasProgramDateTime){var h=O.fragments,p=M.fragments;if(h.length&&p.length){var S=p[Math.round(p.length/2)-1],T=it(h,S.cc)||h[Math.round(h.length/2)-1],C=S.programDateTime,v=T.programDateTime;C!==null&&v!==null&&ot((v-C)/1e3-(T.start-S.start),O)}}}let St=function(O,M){for(var h=0,p=O.length-1,S=null,T=null;h<=p;){var C=M(T=O[S=(h+p)/2|0]);if(C>0)h=S+1;else{if(!(C<0))return T;p=S-1}}return null};function lt(O,M,h,p){h===void 0&&(h=0),p===void 0&&(p=0);var S=null;return O?S=M[O.sn-M[0].sn+1]||null:h===0&&M[0].start===0&&(S=M[0]),S&&At(h,p,S)===0?S:St(M,At.bind(null,h,p))||S}function At(O,M,h){O===void 0&&(O=0),M===void 0&&(M=0);var p=Math.min(M,h.duration+(h.deltaPTS?h.deltaPTS:0));return h.start+h.duration-p<=O?1:h.start-p>O&&h.start?-1:0}function Ht(O,M,h){var p=1e3*Math.min(M,h.duration+(h.deltaPTS?h.deltaPTS:0));return(h.endProgramDateTime||0)-p>O}function Vt(O){var M=typeof Map=="function"?new Map:void 0;return Vt=function(h){if(h===null||(p=h,Function.toString.call(p).indexOf("[native code]")===-1))return h;var p;if(typeof h!="function")throw new TypeError("Super expression must either be null or a function");if(M!==void 0){if(M.has(h))return M.get(h);M.set(h,S)}function S(){return Lt(h,arguments,qt(this).constructor)}return S.prototype=Object.create(h.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),mt(S,h)},Vt(O)}function Lt(O,M,h){return Lt=Jt()?Reflect.construct.bind():function(p,S,T){var C=[null];C.push.apply(C,S);var v=new(Function.bind.apply(p,C));return T&&mt(v,T.prototype),v},Lt.apply(null,arguments)}function Jt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function mt(O,M){return mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,p){return h.__proto__=p,h},mt(O,M)}function qt(O){return qt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(M){return M.__proto__||Object.getPrototypeOf(M)},qt(O)}var cr=Math.pow(2,17),Kt=function(){function O(h){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=h}var M=O.prototype;return M.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},M.abort=function(){this.loader&&this.loader.abort()},M.load=function(h,p){var S=this,T=h.url;if(!T)return Promise.reject(new tr({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,networkDetails:null},"Fragment does not have a "+(T?"part list":"url")));this.abort();var C=this.config,v=C.fLoader,x=C.loader;return new Promise(function(I,R){S.loader&&S.loader.destroy();var U=S.loader=h.loader=v?new v(C):new x(C),G=dr(h),ie={timeout:C.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:C.fragLoadingMaxRetryTimeout,highWaterMark:h.sn==="initSegment"?1/0:cr};h.stats=U.stats,U.load(G,ie,{onSuccess:function(le,he,Te,Ee){S.resetLoader(h,U),I({frag:h,part:null,payload:le.data,networkDetails:Ee})},onError:function(le,he,Te){S.resetLoader(h,U),R(new tr({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,response:le,networkDetails:Te}))},onAbort:function(le,he,Te){S.resetLoader(h,U),R(new tr({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,networkDetails:Te}))},onTimeout:function(le,he,Te){S.resetLoader(h,U),R(new tr({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,networkDetails:Te}))},onProgress:function(le,he,Te,Ee){p&&p({frag:h,part:null,payload:Te,networkDetails:Ee})}})})},M.loadPart=function(h,p,S){var T=this;this.abort();var C=this.config,v=C.fLoader,x=C.loader;return new Promise(function(I,R){T.loader&&T.loader.destroy();var U=T.loader=h.loader=v?new v(C):new x(C),G=dr(h,p),ie={timeout:C.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:C.fragLoadingMaxRetryTimeout,highWaterMark:cr};p.stats=U.stats,U.load(G,ie,{onSuccess:function(le,he,Te,Ee){T.resetLoader(h,U),T.updateStatsFromPart(h,p);var je={frag:h,part:p,payload:le.data,networkDetails:Ee};S(je),I(je)},onError:function(le,he,Te){T.resetLoader(h,U),R(new tr({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,part:p,response:le,networkDetails:Te}))},onAbort:function(le,he,Te){h.stats.aborted=p.stats.aborted,T.resetLoader(h,U),R(new tr({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,part:p,networkDetails:Te}))},onTimeout:function(le,he,Te){T.resetLoader(h,U),R(new tr({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,part:p,networkDetails:Te}))}})})},M.updateStatsFromPart=function(h,p){var S=h.stats,T=p.stats,C=T.total;if(S.loaded+=T.loaded,C){var v=Math.round(h.duration/p.duration),x=Math.min(Math.round(S.loaded/C),v),I=(v-x)*Math.round(S.loaded/x);S.total=S.loaded+I}else S.total=Math.max(S.loaded,S.total);var R=S.loading,U=T.loading;R.start?R.first+=U.first-U.start:(R.start=U.start,R.first=U.first),R.end=U.end},M.resetLoader=function(h,p){h.loader=null,this.loader===p&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),p.destroy()},O}();function dr(O,M){M===void 0&&(M=null);var h=M||O,p={frag:O,part:M,responseType:"arraybuffer",url:h.url,headers:{},rangeStart:0,rangeEnd:0},S=h.byteRangeStartOffset,T=h.byteRangeEndOffset;return(0,E.isFiniteNumber)(S)&&(0,E.isFiniteNumber)(T)&&(p.rangeStart=S,p.rangeEnd=T),p}var tr=function(O){var M,h;function p(S){for(var T,C=arguments.length,v=new Array(C>1?C-1:0),x=1;x<C;x++)v[x-1]=arguments[x];return(T=O.call.apply(O,[this].concat(v))||this).data=void 0,T.data=S,T}return h=O,(M=p).prototype=Object.create(h.prototype),M.prototype.constructor=M,mt(M,h),p}(Vt(Error)),Pr=l(21);let Wt=function(O){for(var M="",h=O.length,p=0;p<h;p++)M+="["+O.start(p).toFixed(3)+","+O.end(p).toFixed(3)+"]";return M};function pr(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}function la(O){if(O===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O}function Mt(O,M){return Mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,p){return h.__proto__=p,h},Mt(O,M)}var gr="STOPPED",Tt="IDLE",ba="KEY_LOADING",Nr="FRAG_LOADING",Fr="FRAG_LOADING_WAITING_RETRY",ua="WAITING_TRACK",mr="PARSING",Qr="PARSED",fr="ENDED",Ar="ERROR",Jr="WAITING_INIT_PTS",Br="WAITING_LEVEL",Ia=function(O){var M,h;function p(v,x,I){var R;return(R=O.call(this)||this).hls=void 0,R.fragPrevious=null,R.fragCurrent=null,R.fragmentTracker=void 0,R.transmuxer=null,R._state=gr,R.media=null,R.mediaBuffer=null,R.config=void 0,R.bitrateTest=!1,R.lastCurrentTime=0,R.nextLoadPosition=0,R.startPosition=0,R.loadedmetadata=!1,R.fragLoadError=0,R.retryDate=0,R.levels=null,R.fragmentLoader=void 0,R.levelLastLoaded=null,R.startFragRequested=!1,R.decrypter=void 0,R.initPTS=[],R.onvseeking=null,R.onvended=null,R.logPrefix="",R.log=void 0,R.warn=void 0,R.logPrefix=I,R.log=w.logger.log.bind(w.logger,I+":"),R.warn=w.logger.warn.bind(w.logger,I+":"),R.hls=v,R.fragmentLoader=new Kt(v.config),R.fragmentTracker=x,R.config=v.config,R.decrypter=new Pr.default(v,v.config),v.on(y.Events.KEY_LOADED,R.onKeyLoaded,la(R)),v.on(y.Events.LEVEL_SWITCHING,R.onLevelSwitching,la(R)),R}h=O,(M=p).prototype=Object.create(h.prototype),M.prototype.constructor=M,Mt(M,h);var S,T,C=p.prototype;return C.doTick=function(){this.onTickEnd()},C.onTickEnd=function(){},C.startLoad=function(v){},C.stopLoad=function(){this.fragmentLoader.abort();var v=this.fragCurrent;v&&this.fragmentTracker.removeFragment(v),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=gr},C._streamEnded=function(v,x){var I=this.fragCurrent,R=this.fragmentTracker;if(!x.live&&I&&this.media&&I.sn>=x.endSN&&!v.nextStart){var U=x.partList;if(U!=null&&U.length){var G=U[U.length-1];return Ge.isBuffered(this.media,G.start+G.duration/2)}var ie=R.getState(I);return ie===Z.PARTIAL||ie===Z.OK}return!1},C.onMediaAttached=function(v,x){var I=this.media=this.mediaBuffer=x.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var R=this.config;this.levels&&R.autoStartLoad&&this.state===gr&&this.startLoad(R.startPosition)},C.onMediaDetaching=function(){var v=this.media;v!=null&&v.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),v&&this.onvseeking&&this.onvended&&(v.removeEventListener("seeking",this.onvseeking),v.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},C.onMediaSeeking=function(){var v=this.config,x=this.fragCurrent,I=this.media,R=this.mediaBuffer,U=this.state,G=I?I.currentTime:0,ie=Ge.bufferInfo(R||I,G,v.maxBufferHole);if(this.log("media seeking to "+((0,E.isFiniteNumber)(G)?G.toFixed(3):G)+", state: "+U),U===fr)this.resetLoadingState();else if(x){var le=v.maxFragLookUpTolerance,he=x.start-le,Te=x.start+x.duration+le;if(!ie.len||Te<ie.start||he>ie.end){var Ee=G>Te;(G<he||Ee)&&(Ee&&x.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),x.loader.abort()),this.resetLoadingState())}}I&&(this.lastCurrentTime=G),this.loadedmetadata||ie.len||(this.nextLoadPosition=this.startPosition=G),this.tickImmediate()},C.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},C.onKeyLoaded=function(v,x){if(this.state===ba&&x.frag===this.fragCurrent&&this.levels){this.state=Tt;var I=this.levels[x.frag.level].details;I&&this.loadFragment(x.frag,I,x.frag.start)}},C.onLevelSwitching=function(v,x){this.fragLoadError=0},C.onHandlerDestroying=function(){this.stopLoad(),O.prototype.onHandlerDestroying.call(this)},C.onHandlerDestroyed=function(){this.state=gr,this.hls.off(y.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(y.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,O.prototype.onHandlerDestroyed.call(this)},C.loadKey=function(v,x){this.log("Loading key for "+v.sn+" of ["+x.startSN+"-"+x.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level),this.state=ba,this.fragCurrent=v,this.hls.trigger(y.Events.KEY_LOADING,{frag:v})},C.loadFragment=function(v,x,I){this._loadFragForPlayback(v,x,I)},C._loadFragForPlayback=function(v,x,I){var R=this;this._doFragLoad(v,x,I,function(U){if(R.fragContextChanged(v))return R.warn("Fragment "+v.sn+(U.part?" p: "+U.part.index:"")+" of level "+v.level+" was dropped during download."),void R.fragmentTracker.removeFragment(v);v.stats.chunkCount++,R._handleFragmentLoadProgress(U)}).then(function(U){if(U){R.fragLoadError=0;var G=R.state;R.fragContextChanged(v)?(G===Nr||!R.fragCurrent&&G===mr)&&(R.fragmentTracker.removeFragment(v),R.state=Tt):("payload"in U&&(R.log("Loaded fragment "+v.sn+" of level "+v.level),R.hls.trigger(y.Events.FRAG_LOADED,U)),R._handleFragmentLoadComplete(U))}}).catch(function(U){R.state!==gr&&R.state!==Ar&&(R.warn(U),R.resetFragmentLoading(v))})},C.flushMainBuffer=function(v,x,I){if(I===void 0&&(I=null),v-x){var R={startOffset:v,endOffset:x,type:I};this.fragLoadError=0,this.hls.trigger(y.Events.BUFFER_FLUSHING,R)}},C._loadInitSegment=function(v){var x=this;this._doFragLoad(v).then(function(I){if(!I||x.fragContextChanged(v)||!x.levels)throw new Error("init load aborted");return I}).then(function(I){var R=x.hls,U=I.payload,G=v.decryptdata;if(U&&U.byteLength>0&&G&&G.key&&G.iv&&G.method==="AES-128"){var ie=self.performance.now();return x.decrypter.webCryptoDecrypt(new Uint8Array(U),G.key.buffer,G.iv.buffer).then(function(le){var he=self.performance.now();return R.trigger(y.Events.FRAG_DECRYPTED,{frag:v,payload:le,stats:{tstart:ie,tdecrypt:he}}),I.payload=le,I})}return I}).then(function(I){var R=x.fragCurrent,U=x.hls,G=x.levels;if(!G)throw new Error("init load aborted, missing levels");G[v.level].details;var ie=v.stats;x.state=Tt,x.fragLoadError=0,v.data=new Uint8Array(I.payload),ie.parsing.start=ie.buffering.start=self.performance.now(),ie.parsing.end=ie.buffering.end=self.performance.now(),I.frag===R&&U.trigger(y.Events.FRAG_BUFFERED,{stats:ie,frag:R,part:null,id:v.type}),x.tick()}).catch(function(I){x.state!==gr&&x.state!==Ar&&(x.warn(I),x.resetFragmentLoading(v))})},C.fragContextChanged=function(v){var x=this.fragCurrent;return!v||!x||v.level!==x.level||v.sn!==x.sn||v.urlId!==x.urlId},C.fragBufferedComplete=function(v,x){var I,R,U=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+v.type+" sn: "+v.sn+(x?" part: "+x.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level+" "+(U?Wt(Ge.getBuffered(U)):"(detached)")),this.state=Tt,U&&(!this.loadedmetadata&&v.type==ke.PlaylistLevelType.MAIN&&U.buffered.length&&((I=this.fragCurrent)===null||I===void 0?void 0:I.sn)===((R=this.fragPrevious)===null||R===void 0?void 0:R.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},C.seekToStartPos=function(){},C._handleFragmentLoadComplete=function(v){var x=this.transmuxer;if(x){var I=v.frag,R=v.part,U=v.partsLoaded,G=!U||U.length===0||U.some(function(le){return!le}),ie=new Ze(I.level,I.sn,I.stats.chunkCount+1,0,R?R.index:-1,!G);x.flush(ie)}},C._handleFragmentLoadProgress=function(v){},C._doFragLoad=function(v,x,I,R){var U=this;if(I===void 0&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(v.start,I||0),this.config.lowLatencyMode&&x){var G=x.partList;if(G&&R){I>v.end&&x.fragmentHint&&(v=x.fragmentHint);var ie=this.getNextPart(G,v,I);if(ie>-1){var le=G[ie];return this.log("Loading part sn: "+v.sn+" p: "+le.index+" cc: "+v.cc+" of playlist ["+x.startSN+"-"+x.endSN+"] parts [0-"+ie+"-"+(G.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(I.toFixed(3))),this.nextLoadPosition=le.start+le.duration,this.state=Nr,this.hls.trigger(y.Events.FRAG_LOADING,{frag:v,part:G[ie],targetBufferTime:I}),this.doFragPartsLoad(v,G,ie,R).catch(function(he){return U.handleFragLoadError(he)})}if(!v.url||this.loadedEndOfParts(G,I))return Promise.resolve(null)}}return this.log("Loading fragment "+v.sn+" cc: "+v.cc+" "+(x?"of ["+x.startSN+"-"+x.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(I.toFixed(3))),(0,E.isFiniteNumber)(v.sn)&&!this.bitrateTest&&(this.nextLoadPosition=v.start+v.duration),this.state=Nr,this.hls.trigger(y.Events.FRAG_LOADING,{frag:v,targetBufferTime:I}),this.fragmentLoader.load(v,R).catch(function(he){return U.handleFragLoadError(he)})},C.doFragPartsLoad=function(v,x,I,R){var U=this;return new Promise(function(G,ie){var le=[];(function he(Te){var Ee=x[Te];U.fragmentLoader.loadPart(v,Ee,R).then(function(je){le[Ee.index]=je;var Ve=je.part;U.hls.trigger(y.Events.FRAG_LOADED,je);var Ne=x[Te+1];if(!Ne||Ne.fragment!==v)return G({frag:v,part:Ve,partsLoaded:le});he(Te+1)}).catch(ie)})(I)})},C.handleFragLoadError=function(v){var x=v.data;return x&&x.details===D.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(x.frag,x.part):this.hls.trigger(y.Events.ERROR,x),null},C._handleTransmuxerFlush=function(v){var x=this.getCurrentContext(v);if(x&&this.state===mr){var I=x.frag,R=x.part,U=x.level,G=self.performance.now();I.stats.parsing.end=G,R&&(R.stats.parsing.end=G),this.updateLevelTiming(I,R,U,v.partial)}else this.fragCurrent||(this.state=Tt)},C.getCurrentContext=function(v){var x=this.levels,I=v.level,R=v.sn,U=v.part;if(!x||!x[I])return this.warn("Levels object was unset while buffering fragment "+R+" of level "+I+". The current chunk will not be buffered."),null;var G=x[I],ie=U>-1?function(he,Te,Ee){if(!he||!he.details)return null;var je=he.details.partList;if(je)for(var Ve=je.length;Ve--;){var Ne=je[Ve];if(Ne.index===Ee&&Ne.fragment.sn===Te)return Ne}return null}(G,R,U):null,le=ie?ie.fragment:function(he,Te,Ee){if(!he||!he.details)return null;var je=he.details,Ve=je.fragments[Te-je.startSN];return Ve||((Ve=je.fragmentHint)&&Ve.sn===Te?Ve:Te<je.startSN&&Ee&&Ee.sn===Te?Ee:null)}(G,R,this.fragCurrent);return le?{frag:le,part:ie,level:G}:null},C.bufferFragmentData=function(v,x,I,R){if(v&&this.state===mr){var U=v.data1,G=v.data2,ie=U;if(U&&G&&(ie=(0,B.appendUint8Array)(U,G)),ie&&ie.length){var le={type:v.type,frag:x,part:I,chunkMeta:R,parent:x.type,data:ie};this.hls.trigger(y.Events.BUFFER_APPENDING,le),v.dropped&&v.independent&&!I&&this.flushBufferGap(x)}}},C.flushBufferGap=function(v){var x=this.media;if(x)if(Ge.isBuffered(x,x.currentTime)){var I=x.currentTime,R=Ge.bufferInfo(x,I,0),U=v.duration,G=Math.min(2*this.config.maxFragLookUpTolerance,.25*U),ie=Math.max(Math.min(v.start-G,R.end-G),I+G);v.start-ie>G&&this.flushMainBuffer(ie,v.start)}else this.flushMainBuffer(0,v.start)},C.getFwdBufferInfo=function(v,x){var I=this.config,R=this.getLoadPosition();if(!(0,E.isFiniteNumber)(R))return null;var U=Ge.bufferInfo(v,R,I.maxBufferHole);if(U.len===0&&U.nextStart!==void 0){var G=this.fragmentTracker.getBufferedFrag(R,x);if(G&&U.nextStart<G.end)return Ge.bufferInfo(v,R,Math.max(U.nextStart,I.maxBufferHole))}return U},C.getMaxBufferLength=function(v){var x,I=this.config;return x=v?Math.max(8*I.maxBufferSize/v,I.maxBufferLength):I.maxBufferLength,Math.min(x,I.maxMaxBufferLength)},C.reduceMaxBufferLength=function(v){var x=this.config,I=v||x.maxBufferLength;return x.maxMaxBufferLength>=I&&(x.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+x.maxMaxBufferLength+"s"),!0)},C.getNextFragment=function(v,x){var I=x.fragments,R=I.length;if(!R)return null;var U,G=this.config,ie=I[0].start;if(x.live){var le=G.initialLiveManifestSize;if(R<le)return this.warn("Not enough fragments to start playback (have: "+R+", need: "+le+")"),null;x.PTSKnown||this.startFragRequested||this.startPosition!==-1||(U=this.getInitialLiveFragment(x,I),this.startPosition=U?this.hls.liveSyncPosition||U.start:v)}else v<=ie&&(U=I[0]);if(!U){var he=G.lowLatencyMode?x.partEnd:x.fragmentEnd;U=this.getFragmentAtPosition(v,he,x)}return this.mapToInitFragWhenRequired(U)},C.mapToInitFragWhenRequired=function(v){return v==null||!v.initSegment||v!=null&&v.initSegment.data||this.bitrateTest?v:v.initSegment},C.getNextPart=function(v,x,I){for(var R=-1,U=!1,G=!0,ie=0,le=v.length;ie<le;ie++){var he=v[ie];if(G=G&&!he.independent,R>-1&&I<he.start)break;var Te=he.loaded;!Te&&(U||he.independent||G)&&he.fragment===x&&(R=ie),U=Te}return R},C.loadedEndOfParts=function(v,x){var I=v[v.length-1];return I&&x>I.start&&I.loaded},C.getInitialLiveFragment=function(v,x){var I=this.fragPrevious,R=null;if(I){if(v.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),R=function(le,he,Te){if(he===null||!Array.isArray(le)||!le.length||!(0,E.isFiniteNumber)(he)||he<(le[0].programDateTime||0)||he>=(le[le.length-1].endProgramDateTime||0))return null;Te=Te||0;for(var Ee=0;Ee<le.length;++Ee){var je=le[Ee];if(Ht(he,Te,je))return je}return null}(x,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!R){var U=I.sn+1;if(U>=v.startSN&&U<=v.endSN){var G=x[U-v.startSN];I.cc===G.cc&&(R=G,this.log("Live playlist, switching playlist, load frag with next SN: "+R.sn))}R||(R=function(le,he){return St(le,function(Te){return Te.cc<he?1:Te.cc>he?-1:0})}(x,I.cc),R&&this.log("Live playlist, switching playlist, load frag with same CC: "+R.sn))}}else{var ie=this.hls.liveSyncPosition;ie!==null&&(R=this.getFragmentAtPosition(ie,this.bitrateTest?v.fragmentEnd:v.edge,v))}return R},C.getFragmentAtPosition=function(v,x,I){var R,U=this.config,G=this.fragPrevious,ie=I.fragments,le=I.endSN,he=I.fragmentHint,Te=U.maxFragLookUpTolerance,Ee=!!(U.lowLatencyMode&&I.partList&&he);if(Ee&&he&&!this.bitrateTest&&(ie=ie.concat(he),le=he.sn),R=v<x?lt(G,ie,v,v>x-Te?0:Te):ie[ie.length-1]){var je=R.sn-I.startSN;if(this.fragmentTracker.getState(R)===Z.OK&&(G=R),G&&R.sn===G.sn&&!Ee&&G&&R.level===G.level){var Ve=ie[je+1];R.sn<le&&this.fragmentTracker.getState(Ve)!==Z.OK?(this.log("SN "+R.sn+" just loaded, load next one: "+Ve.sn),R=Ve):R=null}}return R},C.synchronizeToLiveEdge=function(v){var x=this.config,I=this.media;if(I){var R=this.hls.liveSyncPosition,U=I.currentTime,G=v.fragments[0].start,ie=v.edge,le=U>=G-x.maxFragLookUpTolerance&&U<=ie;if(R!==null&&I.duration>R&&(U<R||!le)){var he=x.liveMaxLatencyDuration!==void 0?x.liveMaxLatencyDuration:x.liveMaxLatencyDurationCount*v.targetduration;(!le&&I.readyState<4||U<ie-he)&&(this.loadedmetadata||(this.nextLoadPosition=R),I.readyState&&(this.warn("Playback: "+U.toFixed(3)+" is located too far from the end of live sliding playlist: "+ie+", reset currentTime to : "+R.toFixed(3)),I.currentTime=R))}}},C.alignPlaylists=function(v,x){var I=this.levels,R=this.levelLastLoaded,U=this.fragPrevious,G=R!==null?I[R]:null,ie=v.fragments.length;if(!ie)return this.warn("No fragments in live playlist"),0;var le=v.fragments[0].start,he=!x,Te=v.alignedSliding&&(0,E.isFiniteNumber)(le);if(he||!Te&&!le){(function(je,Ve,Ne){Ve&&(function(Re,He,Le){if(function(Ye,ht,pt){return!(!ht.details||!(pt.endCC>pt.startCC||Ye&&Ye.cc<pt.startCC))}(Re,Le,He)){var Je=function(Ye,ht,pt){pt===void 0&&(pt=0);var kt=Ye.fragments,It=ht.fragments;if(It.length&&kt.length){var _t=it(kt,It[0].cc);if(_t&&(!_t||_t.startPTS))return _t;w.logger.log("No frag in previous level to align on")}else w.logger.log("No fragments to align")}(Le.details,He);Je&&(0,E.isFiniteNumber)(Je.start)&&(w.logger.log("Adjusting PTS using last level due to CC increase within current level "+He.url),ot(Je.start,He))}}(je,Ne,Ve),!Ne.alignedSliding&&Ve.details&&function(Re,He){if(He.fragments.length&&Re.hasProgramDateTime&&He.hasProgramDateTime){var Le=He.fragments[0].programDateTime,Je=Re.fragments[0].programDateTime,Ye=(Je-Le)/1e3+He.fragments[0].start;Ye&&(0,E.isFiniteNumber)(Ye)&&(w.logger.log("Adjusting PTS using programDateTime delta "+(Je-Le)+"ms, sliding:"+Ye.toFixed(3)+" "+Re.url+" "),ot(Ye,Re))}}(Ne,Ve.details),Ne.alignedSliding||!Ve.details||Ne.skippedSegments||Yt(Ve.details,Ne))})(U,G,v);var Ee=v.fragments[0].start;return this.log("Live playlist sliding: "+Ee.toFixed(2)+" start-sn: "+(x?x.startSN:"na")+"->"+v.startSN+" prev-sn: "+(U?U.sn:"na")+" fragments: "+ie),Ee}return le},C.waitForCdnTuneIn=function(v){return v.live&&v.canBlockReload&&v.partTarget&&v.tuneInGoal>Math.max(v.partHoldBack,3*v.partTarget)},C.setStartPosition=function(v,x){var I=this.startPosition;if(I<x&&(I=-1),I===-1||this.lastCurrentTime===-1){var R=v.startTimeOffset;(0,E.isFiniteNumber)(R)?(I=x+R,R<0&&(I+=v.totalduration),I=Math.min(Math.max(x,I),x+v.totalduration),this.log("Start time offset "+R+" found in playlist, adjust startPosition to "+I),this.startPosition=I):v.live?I=this.hls.liveSyncPosition||x:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},C.getLoadPosition=function(){var v=this.media,x=0;return this.loadedmetadata&&v?x=v.currentTime:this.nextLoadPosition&&(x=this.nextLoadPosition),x},C.handleFragLoadAborted=function(v,x){this.transmuxer&&v.sn!=="initSegment"&&v.stats.aborted&&(this.warn("Fragment "+v.sn+(x?" part"+x.index:"")+" of level "+v.level+" was aborted"),this.resetFragmentLoading(v))},C.resetFragmentLoading=function(v){this.fragCurrent&&(this.fragContextChanged(v)||this.state===Fr)||(this.state=Tt)},C.onFragmentOrKeyLoadError=function(v,x){if(!x.fatal){var I=x.frag;if(I&&I.type===v){this.fragCurrent;var R=this.config;if(this.fragLoadError+1<=R.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var U=Math.min(Math.pow(2,this.fragLoadError)*R.fragLoadingRetryDelay,R.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+v+" "+I.level+" failed to load, retrying in "+U+"ms"),this.retryDate=self.performance.now()+U,this.fragLoadError++,this.state=Fr}else x.levelRetry?(v===ke.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=Tt):(w.logger.error(x.details+" reaches max retry, redispatch as fatal ..."),x.fatal=!0,this.hls.stopLoad(),this.state=Ar)}}},C.afterBufferFlushed=function(v,x,I){if(v){var R=Ge.getBuffered(v);this.fragmentTracker.detectEvictedFragments(x,R,I),this.state===fr&&this.resetLoadingState()}},C.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=Tt},C.resetStartWhenNotLoaded=function(v){if(!this.loadedmetadata){this.startFragRequested=!1;var x=this.levels?this.levels[v].details:null;x!=null&&x.live?(this.startPosition=-1,this.setStartPosition(x,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},C.updateLevelTiming=function(v,x,I,R){var U=this,G=I.details;Object.keys(v.elementaryStreams).reduce(function(ie,le){var he=v.elementaryStreams[le];if(he){var Te=he.endPTS-he.startPTS;if(Te<=0)return U.warn("Could not parse fragment "+v.sn+" "+le+" duration reliably ("+Te+")"),ie||!1;var Ee=R?0:sr(G,v,he.startPTS,he.endPTS,he.startDTS,he.endDTS);return U.hls.trigger(y.Events.LEVEL_PTS_UPDATED,{details:G,level:I,drift:Ee,type:le,frag:v,start:he.startPTS,end:he.endPTS}),!0}return ie},!1)||(this.warn("Found no media in fragment "+v.sn+" of level "+I.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=Qr,this.hls.trigger(y.Events.FRAG_PARSED,{frag:v,part:x})},C.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},S=p,(T=[{key:"state",get:function(){return this._state},set:function(v){var x=this._state;x!==v&&(this._state=v,this.log(x+"->"+v))}}])&&pr(S.prototype,T),Object.defineProperty(S,"prototype",{writable:!1}),p}($e);function Gt(){return self.MediaSource||self.WebKitMediaSource}function Ma(){return self.SourceBuffer||self.WebKitSourceBuffer}var wa=function(){var O=ENTRY_MODULE,M={},h=function S(T){var C=M[T];if(C!==void 0)return C.exports;var v=M[T]={exports:{}};return O[T].call(v.exports,v,v.exports,S),v.exports};h.m=O,h.n=function(S){var T=S&&S.__esModule?function(){return S.default}:function(){return S};return h.d(T,{a:T}),T},h.d=function(S,T){for(var C in T)h.o(T,C)&&!h.o(S,C)&&Object.defineProperty(S,C,{enumerable:!0,get:T[C]})},h.o=function(S,T){return Object.prototype.hasOwnProperty.call(S,T)},h.r=function(S){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(S,"__esModule",{value:!0})};var p=h(ENTRY_MODULE);return p.default||p}.toString().split("ENTRY_MODULE"),ei="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function ti(O){return(O+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function Vi(O,M,h){var p={};p[h]=[];var S=M.toString().replace(/^"[^"]+"/,"function"),T=S.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||S.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!T)return p;for(var C,v=T[1],x=new RegExp("(\\\\n|\\W)"+ti(v)+ei,"g");C=x.exec(S);)C[3]!=="dll-reference"&&p[h].push(C[3]);for(x=new RegExp("\\("+ti(v)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+ei,"g");C=x.exec(S);)O[C[2]]||(p[h].push(C[1]),O[C[2]]=l(C[1]).m),p[C[2]]=p[C[2]]||[],p[C[2]].push(C[4]);for(var I,R=Object.keys(p),U=0;U<R.length;U++)for(var G=0;G<p[R[U]].length;G++)I=p[R[U]][G],isNaN(1*I)||(p[R[U]][G]=1*p[R[U]][G]);return p}function Gi(O){return Object.keys(O).reduce(function(M,h){return M||O[h].length>0},!1)}function $r(O,M,h,p){var S=O[p].map(function(T){return'"'+T+'": '+M[p][T].toString().replace(/^"[^"]+"/,"function")}).join(",");return wa[0]+"{"+S+"}"+wa[1]+'"'+h+'"'+wa[2]}var Zt=l(544),ri=l(729),Da=Gt()||{isTypeSupported:function(){return!1}},Zr=function(){function O(h,p,S,T){var C=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var v=h.config;this.hls=h,this.id=p,this.useWorker=!!v.enableWorker,this.onTransmuxComplete=S,this.onFlush=T;var x=function(G,ie){(ie=ie||{}).frag=C.frag,ie.id=C.id,C.hls.trigger(G,ie)};this.observer=new ri.EventEmitter,this.observer.on(y.Events.FRAG_DECRYPTED,x),this.observer.on(y.Events.ERROR,x);var I={mp4:Da.isTypeSupported("video/mp4"),mpeg:Da.isTypeSupported("audio/mpeg"),mp3:Da.isTypeSupported('audio/mp4; codecs="mp3"')},R=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){var U;w.logger.log("demuxing in webworker");try{U=this.worker=function(G,ie){ie=ie||{};var le={main:l.m},he=ie.all?{main:Object.keys(le.main)}:function(Ne,Re){for(var He={main:[Re]},Le={main:[]},Je={main:{}};Gi(He);)for(var Ye=Object.keys(He),ht=0;ht<Ye.length;ht++){var pt=Ye[ht],kt=He[pt].pop();if(Je[pt]=Je[pt]||{},!Je[pt][kt]&&Ne[pt][kt]){Je[pt][kt]=!0,Le[pt]=Le[pt]||[],Le[pt].push(kt);for(var It=Vi(Ne,Ne[pt][kt],pt),_t=Object.keys(It),Et=0;Et<_t.length;Et++)He[_t[Et]]=He[_t[Et]]||[],He[_t[Et]]=He[_t[Et]].concat(It[_t[Et]])}}return Le}(le,G),Te="";Object.keys(he).filter(function(Ne){return Ne!=="main"}).forEach(function(Ne){for(var Re=0;he[Ne][Re];)Re++;he[Ne].push(Re),le[Ne][Re]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",Te=Te+"var "+Ne+" = ("+$r(he,le,Re,modules)+`)();
`}),Te=Te+"new (("+$r(he,le,G,"main")+")())(self);";var Ee=new window.Blob([Te],{type:"text/javascript"}),je=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(Ee),Ve=new window.Worker(je);return Ve.objectURL=je,Ve}(182),this.onwmsg=this.onWorkerMessage.bind(this),U.addEventListener("message",this.onwmsg),U.onerror=function(G){C.useWorker=!1,w.logger.warn("Exception in webworker, fallback to inline"),C.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(G.message+"  ("+G.filename+":"+G.lineno+")")})},U.postMessage({cmd:"init",typeSupported:I,vendor:R,id:p,config:JSON.stringify(v)})}catch(G){w.logger.warn("Error in worker:",G),w.logger.error("Error while initializing DemuxerWorker, fallback to inline"),U&&self.URL.revokeObjectURL(U.objectURL),this.transmuxer=new Zt.default(this.observer,I,v,R,p),this.worker=null}}else this.transmuxer=new Zt.default(this.observer,I,v,R,p)}var M=O.prototype;return M.destroy=function(){var h=this.worker;if(h)h.removeEventListener("message",this.onwmsg),h.terminate(),this.worker=null,this.onwmsg=void 0;else{var p=this.transmuxer;p&&(p.destroy(),this.transmuxer=null)}var S=this.observer;S&&S.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},M.push=function(h,p,S,T,C,v,x,I,R,U){var G,ie,le=this;R.transmuxing.start=self.performance.now();var he=this.transmuxer,Te=this.worker,Ee=v?v.start:C.start,je=C.decryptdata,Ve=this.frag,Ne=!(Ve&&C.cc===Ve.cc),Re=!(Ve&&R.level===Ve.level),He=Ve?R.sn-Ve.sn:-1,Le=this.part?R.part-this.part.index:-1,Je=He===0&&R.id>1&&R.id===Ve?.stats.chunkCount,Ye=!Re&&(He===1||He===0&&(Le===1||Je&&Le<=0)),ht=self.performance.now();(Re||He||C.stats.parsing.start===0)&&(C.stats.parsing.start=ht),!v||!Le&&Ye||(v.stats.parsing.start=ht);var pt=!(Ve&&((G=C.initSegment)===null||G===void 0?void 0:G.url)===((ie=Ve.initSegment)===null||ie===void 0?void 0:ie.url)),kt=new Zt.TransmuxState(Ne,Ye,I,Re,Ee,pt);if(!Ye||Ne||pt){w.logger.log("[transmuxer-interface, "+C.type+"]: Starting new transmux session for sn: "+R.sn+" p: "+R.part+" level: "+R.level+" id: "+R.id+`
        discontinuity: `+Ne+`
        trackSwitch: `+Re+`
        contiguous: `+Ye+`
        accurateTimeOffset: `+I+`
        timeOffset: `+Ee+`
        initSegmentChange: `+pt);var It=new Zt.TransmuxConfig(S,T,p,x,U);this.configureTransmuxer(It)}if(this.frag=C,this.part=v,Te)Te.postMessage({cmd:"demux",data:h,decryptdata:je,chunkMeta:R,state:kt},h instanceof ArrayBuffer?[h]:[]);else if(he){var _t=he.push(h,je,R,kt);(0,Zt.isPromise)(_t)?_t.then(function(Et){le.handleTransmuxComplete(Et)}):this.handleTransmuxComplete(_t)}},M.flush=function(h){var p=this;h.transmuxing.start=self.performance.now();var S=this.transmuxer,T=this.worker;if(T)T.postMessage({cmd:"flush",chunkMeta:h});else if(S){var C=S.flush(h);(0,Zt.isPromise)(C)?C.then(function(v){p.handleFlushResult(v,h)}):this.handleFlushResult(C,h)}},M.handleFlushResult=function(h,p){var S=this;h.forEach(function(T){S.handleTransmuxComplete(T)}),this.onFlush(p)},M.onWorkerMessage=function(h){var p=h.data,S=this.hls;switch(p.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(p.data);break;case"flush":this.onFlush(p.data);break;case"workerLog":w.logger[p.data.logType]&&w.logger[p.data.logType](p.data.message);break;default:p.data=p.data||{},p.data.frag=this.frag,p.data.id=this.id,S.trigger(p.event,p.data)}},M.configureTransmuxer=function(h){var p=this.worker,S=this.transmuxer;p?p.postMessage({cmd:"configure",config:h}):S&&S.configure(h)},M.handleTransmuxComplete=function(h){h.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(h)},O}(),_r=function(){function O(h,p,S,T){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=h,this.media=p,this.fragmentTracker=S,this.hls=T}var M=O.prototype;return M.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},M.poll=function(h,p){var S=this.config,T=this.media,C=this.stalled;if(T!==null){var v=T.currentTime,x=T.seeking,I=this.seeking&&!x,R=!this.seeking&&x;if(this.seeking=x,v===h){if((R||I)&&(this.stalled=null),!(T.paused&&!x||T.ended||T.playbackRate===0)&&Ge.getBuffered(T).length){var U=Ge.bufferInfo(T,v,0),G=U.len>0,ie=U.nextStart||0;if(G||ie){if(x){var le=U.len>2,he=!ie||p&&p.start<=v||ie-v>2&&!this.fragmentTracker.getPartialFragment(v);if(le||he)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var Te,Ee=Math.max(ie,U.start||0)-v,je=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,Ve=!(je==null||(Te=je.details)===null||Te===void 0)&&Te.live?2*je.details.targetduration:2;if(Ee>0&&Ee<=Ve)return void this._trySkipBufferHole(null)}var Ne=self.performance.now();if(C!==null){var Re=Ne-C;if(x||!(Re>=250)||(this._reportStall(U),this.media)){var He=Ge.bufferInfo(T,v,S.maxBufferHole);this._tryFixBufferStall(He,Re)}}else this.stalled=Ne}}}else if(this.moved=!0,C!==null){if(this.stallReported){var Le=self.performance.now()-C;w.logger.warn("playback not stuck anymore @"+v+", after "+Math.round(Le)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},M._tryFixBufferStall=function(h,p){var S=this.config,T=this.fragmentTracker,C=this.media;if(C!==null){var v=C.currentTime,x=T.getPartialFragment(v);if(x&&(this._trySkipBufferHole(x)||!this.media))return;h.len>S.maxBufferHole&&p>1e3*S.highBufferWatchdogPeriod&&(w.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},M._reportStall=function(h){var p=this.hls,S=this.media;!this.stallReported&&S&&(this.stallReported=!0,w.logger.warn("Playback stalling at @"+S.currentTime+" due to low buffer ("+JSON.stringify(h)+")"),p.trigger(y.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h.len}))},M._trySkipBufferHole=function(h){var p=this.config,S=this.hls,T=this.media;if(T===null)return 0;for(var C=T.currentTime,v=0,x=Ge.getBuffered(T),I=0;I<x.length;I++){var R=x.start(I);if(C+p.maxBufferHole>=v&&C<R){var U=Math.max(R+.05,T.currentTime+.1);return w.logger.warn("skipping hole, adjusting currentTime from "+C+" to "+U),this.moved=!0,this.stalled=null,T.currentTime=U,h&&S.trigger(y.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+C+" to "+U,frag:h}),U}v=x.end(I)}return 0},M._tryNudgeBuffer=function(){var h=this.config,p=this.hls,S=this.media,T=this.nudgeRetry;if(S!==null){var C=S.currentTime;if(this.nudgeRetry++,T<h.nudgeMaxRetry){var v=C+(T+1)*h.nudgeOffset;w.logger.warn("Nudging 'currentTime' from "+C+" to "+v),S.currentTime=v,p.trigger(y.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else w.logger.error("Playhead still not moving while enough data buffered @"+C+" after "+h.nudgeMaxRetry+" nudges"),p.trigger(y.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},O}();function da(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}function Ot(O,M){return Ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,p){return h.__proto__=p,h},Ot(O,M)}var Hi=function(O){var M,h;function p(v,x){var I;return(I=O.call(this,v,x,"[stream-controller]")||this).audioCodecSwap=!1,I.gapController=null,I.level=-1,I._forceStartLoad=!1,I.altAudio=!1,I.audioOnly=!1,I.fragPlaying=null,I.onvplaying=null,I.onvseeked=null,I.fragLastKbps=0,I.couldBacktrack=!1,I.backtrackFragment=null,I.audioCodecSwitch=!1,I.videoBuffer=null,I._registerListeners(),I}h=O,(M=p).prototype=Object.create(h.prototype),M.prototype.constructor=M,Ot(M,h);var S,T,C=p.prototype;return C._registerListeners=function(){var v=this.hls;v.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),v.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),v.on(y.Events.ERROR,this.onError,this),v.on(y.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),v.on(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),v.on(y.Events.BUFFER_CREATED,this.onBufferCreated,this),v.on(y.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),v.on(y.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),v.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C._unregisterListeners=function(){var v=this.hls;v.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),v.off(y.Events.ERROR,this.onError,this),v.off(y.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),v.off(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),v.off(y.Events.BUFFER_CREATED,this.onBufferCreated,this),v.off(y.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),v.off(y.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),v.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},C.startLoad=function(v){if(this.levels){var x=this.lastCurrentTime,I=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var R=I.startLevel;R===-1&&(I.config.testBandwidth&&this.levels.length>1?(R=0,this.bitrateTest=!0):R=I.nextAutoLevel),this.level=I.nextLoadLevel=R,this.loadedmetadata=!1}x>0&&v===-1&&(this.log("Override startPosition with lastCurrentTime @"+x.toFixed(3)),v=x),this.state=Tt,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=v,this.tick()}else this._forceStartLoad=!0,this.state=gr},C.stopLoad=function(){this._forceStartLoad=!1,O.prototype.stopLoad.call(this)},C.doTick=function(){switch(this.state){case Tt:this.doTickIdle();break;case Br:var v,x=this.levels,I=this.level,R=x==null||(v=x[I])===null||v===void 0?void 0:v.details;if(R&&(!R.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(R))break;this.state=Tt;break}break;case Fr:var U,G=self.performance.now(),ie=this.retryDate;(!ie||G>=ie||(U=this.media)!==null&&U!==void 0&&U.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=Tt)}this.onTickEnd()},C.onTickEnd=function(){O.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},C.doTickIdle=function(){var v,x,I=this.hls,R=this.levelLastLoaded,U=this.levels,G=this.media,ie=I.config,le=I.nextLoadLevel;if(R!==null&&(G||!this.startFragRequested&&ie.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&U&&U[le]){var he=U[le];this.level=I.nextLoadLevel=le;var Te=he.details;if(!Te||this.state===Br||Te.live&&this.levelLastLoaded!==le)this.state=Br;else{var Ee=this.getMainFwdBufferInfo();if(Ee!==null&&!(Ee.len>=this.getMaxBufferLength(he.maxBitrate))){if(this._streamEnded(Ee,Te)){var je={};return this.altAudio&&(je.type="video"),this.hls.trigger(y.Events.BUFFER_EOS,je),void(this.state=fr)}this.backtrackFragment&&this.backtrackFragment.start>Ee.end&&(this.backtrackFragment=null);var Ve=this.backtrackFragment?this.backtrackFragment.start:Ee.end,Ne=this.getNextFragment(Ve,Te);if(this.couldBacktrack&&!this.fragPrevious&&Ne&&Ne.sn!=="initSegment"&&this.fragmentTracker.getState(Ne)!==Z.OK){var Re,He=((Re=this.backtrackFragment)!=null?Re:Ne).sn-Te.startSN,Le=Te.fragments[He-1];Le&&Ne.cc===Le.cc&&(Ne=Le,this.fragmentTracker.removeFragment(Le))}else this.backtrackFragment&&Ee.len&&(this.backtrackFragment=null);if(Ne&&this.fragmentTracker.getState(Ne)===Z.OK&&this.nextLoadPosition>Ve){var Je=this.audioOnly&&!this.altAudio?H.ElementaryStreamTypes.AUDIO:H.ElementaryStreamTypes.VIDEO;G&&this.afterBufferFlushed(G,Je,ke.PlaylistLevelType.MAIN),Ne=this.getNextFragment(this.nextLoadPosition,Te)}Ne&&(!Ne.initSegment||Ne.initSegment.data||this.bitrateTest||(Ne=Ne.initSegment),((v=Ne.decryptdata)===null||v===void 0?void 0:v.keyFormat)!=="identity"||(x=Ne.decryptdata)!==null&&x!==void 0&&x.key?this.loadFragment(Ne,Te,Ve):this.loadKey(Ne,Te))}}}},C.loadFragment=function(v,x,I){var R,U=this.fragmentTracker.getState(v);this.fragCurrent=v,U===Z.NOT_LOADED?v.sn==="initSegment"?this._loadInitSegment(v):this.bitrateTest?(this.log("Fragment "+v.sn+" of level "+v.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(v)):(this.startFragRequested=!0,O.prototype.loadFragment.call(this,v,x,I)):U===Z.APPENDING?this.reduceMaxBufferLength(v.duration)&&this.fragmentTracker.removeFragment(v):((R=this.media)===null||R===void 0?void 0:R.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},C.getAppendedFrag=function(v){var x=this.fragmentTracker.getAppendedFrag(v,ke.PlaylistLevelType.MAIN);return x&&"fragment"in x?x.fragment:x},C.getBufferedFrag=function(v){return this.fragmentTracker.getBufferedFrag(v,ke.PlaylistLevelType.MAIN)},C.followingBufferedFrag=function(v){return v?this.getBufferedFrag(v.end+.5):null},C.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},C.nextLevelSwitch=function(){var v=this.levels,x=this.media;if(x!=null&&x.readyState){var I,R=this.getAppendedFrag(x.currentTime);if(R&&R.start>1&&this.flushMainBuffer(0,R.start-1),!x.paused&&v){var U=v[this.hls.nextLoadLevel],G=this.fragLastKbps;I=G&&this.fragCurrent?this.fragCurrent.duration*U.maxBitrate/(1e3*G)+1:0}else I=0;var ie=this.getBufferedFrag(x.currentTime+I);if(ie){var le=this.followingBufferedFrag(ie);if(le){this.abortCurrentFrag();var he=le.maxStartPTS?le.maxStartPTS:le.start,Te=le.duration,Ee=Math.max(ie.end,he+Math.min(Math.max(Te-this.config.maxFragLookUpTolerance,.5*Te),.75*Te));this.flushMainBuffer(Ee,Number.POSITIVE_INFINITY)}}}},C.abortCurrentFrag=function(){var v=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,v!=null&&v.loader&&v.loader.abort(),this.state){case ba:case Nr:case Fr:case mr:case Qr:this.state=Tt}this.nextLoadPosition=this.getLoadPosition()},C.flushMainBuffer=function(v,x){O.prototype.flushMainBuffer.call(this,v,x,this.altAudio?"video":null)},C.onMediaAttached=function(v,x){O.prototype.onMediaAttached.call(this,v,x);var I=x.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),I.addEventListener("playing",this.onvplaying),I.addEventListener("seeked",this.onvseeked),this.gapController=new _r(this.config,I,this.fragmentTracker,this.hls)},C.onMediaDetaching=function(){var v=this.media;v&&this.onvplaying&&this.onvseeked&&(v.removeEventListener("playing",this.onvplaying),v.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),O.prototype.onMediaDetaching.call(this)},C.onMediaPlaying=function(){this.tick()},C.onMediaSeeked=function(){var v=this.media,x=v?v.currentTime:null;(0,E.isFiniteNumber)(x)&&this.log("Media seeked to "+x.toFixed(3)),this.tick()},C.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},C.onManifestParsed=function(v,x){var I,R,U,G=!1,ie=!1;x.levels.forEach(function(le){(I=le.audioCodec)&&(I.indexOf("mp4a.40.2")!==-1&&(G=!0),I.indexOf("mp4a.40.5")!==-1&&(ie=!0))}),this.audioCodecSwitch=G&&ie&&typeof((U=Ma())==null||(R=U.prototype)===null||R===void 0?void 0:R.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=x.levels,this.startFragRequested=!1},C.onLevelLoading=function(v,x){var I=this.levels;if(I&&this.state===Tt){var R=I[x.level];(!R.details||R.details.live&&this.levelLastLoaded!==x.level||this.waitForCdnTuneIn(R.details))&&(this.state=Br)}},C.onLevelLoaded=function(v,x){var I,R=this.levels,U=x.level,G=x.details,ie=G.totalduration;if(R){this.log("Level "+U+" loaded ["+G.startSN+","+G.endSN+"], cc ["+G.startCC+", "+G.endCC+"] duration:"+ie);var le=this.fragCurrent;!le||this.state!==Nr&&this.state!==Fr||le.level!==x.level&&le.loader&&(this.state=Tt,this.backtrackFragment=null,le.loader.abort());var he=R[U],Te=0;if(G.live||(I=he.details)!==null&&I!==void 0&&I.live){if(G.fragments[0]||(G.deltaUpdateFailed=!0),G.deltaUpdateFailed)return;Te=this.alignPlaylists(G,he.details)}if(he.details=G,this.levelLastLoaded=U,this.hls.trigger(y.Events.LEVEL_UPDATED,{details:G,level:U}),this.state===Br){if(this.waitForCdnTuneIn(G))return;this.state=Tt}this.startFragRequested?G.live&&this.synchronizeToLiveEdge(G):this.setStartPosition(G,Te),this.tick()}else this.warn("Levels were reset while loading level "+U)},C._handleFragmentLoadProgress=function(v){var x,I=v.frag,R=v.part,U=v.payload,G=this.levels;if(G){var ie=G[I.level],le=ie.details;if(le){var he=ie.videoCodec,Te=le.PTSKnown||!le.live,Ee=(x=I.initSegment)===null||x===void 0?void 0:x.data,je=this._getAudioCodec(ie),Ve=this.transmuxer=this.transmuxer||new Zr(this.hls,ke.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),Ne=R?R.index:-1,Re=Ne!==-1,He=new Ze(I.level,I.sn,I.stats.chunkCount,U.byteLength,Ne,Re),Le=this.initPTS[I.cc];Ve.push(U,Ee,je,he,I,R,le.totalduration,Te,He,Le)}else this.warn("Dropping fragment "+I.sn+" of level "+I.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+I.sn+" of level "+I.level+" will not be buffered")},C.onAudioTrackSwitching=function(v,x){var I=this.altAudio,R=!!x.url,U=x.id;if(!R){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var G=this.fragCurrent;G!=null&&G.loader&&(this.log("Switching to main audio track, cancel main fragment load"),G.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var ie=this.hls;I&&ie.trigger(y.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),ie.trigger(y.Events.AUDIO_TRACK_SWITCHED,{id:U})}},C.onAudioTrackSwitched=function(v,x){var I=x.id,R=!!this.hls.audioTracks[I].url;if(R){var U=this.videoBuffer;U&&this.mediaBuffer!==U&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=U)}this.altAudio=R,this.tick()},C.onBufferCreated=function(v,x){var I,R,U=x.tracks,G=!1;for(var ie in U){var le=U[ie];if(le.id==="main"){if(R=ie,I=le,ie==="video"){var he=U[ie];he&&(this.videoBuffer=he.buffer)}}else G=!0}G&&I?(this.log("Alternate track found, use "+R+".buffered to schedule main fragment loading"),this.mediaBuffer=I.buffer):this.mediaBuffer=this.media},C.onFragBuffered=function(v,x){var I=x.frag,R=x.part;if(!I||I.type===ke.PlaylistLevelType.MAIN){if(this.fragContextChanged(I))return this.warn("Fragment "+I.sn+(R?" p: "+R.index:"")+" of level "+I.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Qr&&(this.state=Tt));var U=R?R.stats:I.stats;this.fragLastKbps=Math.round(8*U.total/(U.buffering.end-U.loading.first)),I.sn!=="initSegment"&&(this.fragPrevious=I),this.fragBufferedComplete(I,R)}},C.onError=function(v,x){switch(x.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ke.PlaylistLevelType.MAIN,x);break;case D.ErrorDetails.LEVEL_LOAD_ERROR:case D.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==Ar&&(x.fatal?(this.warn(""+x.details),this.state=Ar):x.levelRetry||this.state!==Br||(this.state=Tt));break;case D.ErrorDetails.BUFFER_FULL_ERROR:if(x.parent==="main"&&(this.state===mr||this.state===Qr)){var I=!0,R=this.getFwdBufferInfo(this.media,ke.PlaylistLevelType.MAIN);R&&R.len>.5&&(I=!this.reduceMaxBufferLength(R.len)),I&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},C.checkBuffer=function(){var v=this.media,x=this.gapController;if(v&&x&&v.readyState){if(this.loadedmetadata||!Ge.getBuffered(v).length){var I=this.state!==Tt?this.fragCurrent:null;x.poll(this.lastCurrentTime,I)}this.lastCurrentTime=v.currentTime}},C.onFragLoadEmergencyAborted=function(){this.state=Tt,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},C.onBufferFlushed=function(v,x){var I=x.type;if(I!==H.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var R=(I===H.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(R,I,ke.PlaylistLevelType.MAIN)}},C.onLevelsUpdated=function(v,x){this.levels=x.levels},C.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},C.seekToStartPos=function(){var v=this.media;if(v){var x=v.currentTime,I=this.startPosition;if(I>=0&&x<I){if(v.seeking)return void this.log("could not seek to "+I+", already seeking at "+x);var R=Ge.getBuffered(v),U=(R.length?R.start(0):0)-I;U>0&&(U<this.config.maxBufferHole||U<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+U+" to match buffer start"),I+=U,this.startPosition=I),this.log("seek to target start position "+I+" from current time "+x),v.currentTime=I}}},C._getAudioCodec=function(v){var x=this.config.defaultAudioCodec||v.audioCodec;return this.audioCodecSwap&&x&&(this.log("Swapping audio codec"),x=x.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),x},C._loadBitrateTestFrag=function(v){var x=this;v.bitrateTest=!0,this._doFragLoad(v).then(function(I){var R=x.hls;if(I&&!R.nextLoadLevel&&!x.fragContextChanged(v)){x.fragLoadError=0,x.state=Tt,x.startFragRequested=!1,x.bitrateTest=!1;var U=v.stats;U.parsing.start=U.parsing.end=U.buffering.start=U.buffering.end=self.performance.now(),R.trigger(y.Events.FRAG_LOADED,I),v.bitrateTest=!1}})},C._handleTransmuxComplete=function(v){var x,I="main",R=this.hls,U=v.remuxResult,G=v.chunkMeta,ie=this.getCurrentContext(G);if(!ie)return this.warn("The loading context changed while buffering fragment "+G.sn+" of level "+G.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(G.level);var le=ie.frag,he=ie.part,Te=ie.level,Ee=U.video,je=U.text,Ve=U.id3,Ne=U.initSegment,Re=Te.details,He=this.altAudio?void 0:U.audio;if(!this.fragContextChanged(le)){if(this.state=mr,Ne){Ne.tracks&&(this._bufferInitSegment(Te,Ne.tracks,le,G),R.trigger(y.Events.FRAG_PARSING_INIT_SEGMENT,{frag:le,id:I,tracks:Ne.tracks}));var Le=Ne.initPTS,Je=Ne.timescale;(0,E.isFiniteNumber)(Le)&&(this.initPTS[le.cc]=Le,R.trigger(y.Events.INIT_PTS_FOUND,{frag:le,id:I,initPTS:Le,timescale:Je}))}if(Ee&&U.independent!==!1){if(Re){var Ye=Ee.startPTS,ht=Ee.endPTS,pt=Ee.startDTS,kt=Ee.endDTS;if(he)he.elementaryStreams[Ee.type]={startPTS:Ye,endPTS:ht,startDTS:pt,endDTS:kt};else if(Ee.firstKeyFrame&&Ee.independent&&(this.couldBacktrack=!0),Ee.dropped&&Ee.independent){var It=this.getMainFwdBufferInfo();if((It?It.end:this.getLoadPosition())+this.config.maxBufferHole<(Ee.firstKeyFramePTS?Ee.firstKeyFramePTS:Ye)-this.config.maxBufferHole)return void this.backtrack(le);le.setElementaryStreamInfo(Ee.type,le.start,ht,le.start,kt,!0)}le.setElementaryStreamInfo(Ee.type,Ye,ht,pt,kt),this.backtrackFragment&&(this.backtrackFragment=le),this.bufferFragmentData(Ee,le,he,G)}}else if(U.independent===!1)return void this.backtrack(le);if(He){var _t=He.startPTS,Et=He.endPTS,Dt=He.startDTS,Ft=He.endDTS;he&&(he.elementaryStreams[H.ElementaryStreamTypes.AUDIO]={startPTS:_t,endPTS:Et,startDTS:Dt,endDTS:Ft}),le.setElementaryStreamInfo(H.ElementaryStreamTypes.AUDIO,_t,Et,Dt,Ft),this.bufferFragmentData(He,le,he,G)}if(Re&&Ve!=null&&(x=Ve.samples)!==null&&x!==void 0&&x.length){var er={id:I,frag:le,details:Re,samples:Ve.samples};R.trigger(y.Events.FRAG_PARSING_METADATA,er)}if(Re&&je){var j={id:I,frag:le,details:Re,samples:je.samples};R.trigger(y.Events.FRAG_PARSING_USERDATA,j)}}},C._bufferInitSegment=function(v,x,I,R){var U=this;if(this.state===mr){this.audioOnly=!!x.audio&&!x.video,this.altAudio&&!this.audioOnly&&delete x.audio;var G=x.audio,ie=x.video,le=x.audiovideo;if(G){var he=v.audioCodec,Te=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(he&&(he=he.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),G.metadata.channelCount!==1&&Te.indexOf("firefox")===-1&&(he="mp4a.40.5")),Te.indexOf("android")!==-1&&G.container!=="audio/mpeg"&&(he="mp4a.40.2",this.log("Android: force audio codec to "+he)),v.audioCodec&&v.audioCodec!==he&&this.log('Swapping manifest audio codec "'+v.audioCodec+'" for "'+he+'"'),G.levelCodec=he,G.id="main",this.log("Init audio buffer, container:"+G.container+", codecs[selected/level/parsed]=["+(he||"")+"/"+(v.audioCodec||"")+"/"+G.codec+"]")}ie&&(ie.levelCodec=v.videoCodec,ie.id="main",this.log("Init video buffer, container:"+ie.container+", codecs[level/parsed]=["+(v.videoCodec||"")+"/"+ie.codec+"]")),le&&this.log("Init audiovideo buffer, container:"+le.container+", codecs[level/parsed]=["+(v.attrs.CODECS||"")+"/"+le.codec+"]"),this.hls.trigger(y.Events.BUFFER_CODECS,x),Object.keys(x).forEach(function(Ee){var je=x[Ee].initSegment;je!=null&&je.byteLength&&U.hls.trigger(y.Events.BUFFER_APPENDING,{type:Ee,data:je,frag:I,part:null,chunkMeta:R,parent:I.type})}),this.tick()}},C.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,ke.PlaylistLevelType.MAIN)},C.backtrack=function(v){this.couldBacktrack=!0,this.backtrackFragment=v,this.resetTransmuxer(),this.flushBufferGap(v),this.fragmentTracker.removeFragment(v),this.fragPrevious=null,this.nextLoadPosition=v.start,this.state=Tt},C.checkFragmentChanged=function(){var v=this.media,x=null;if(v&&v.readyState>1&&v.seeking===!1){var I=v.currentTime;if(Ge.isBuffered(v,I)?x=this.getAppendedFrag(I):Ge.isBuffered(v,I+.1)&&(x=this.getAppendedFrag(I+.1)),x){this.backtrackFragment=null;var R=this.fragPlaying,U=x.level;R&&x.sn===R.sn&&R.level===U&&x.urlId===R.urlId||(this.hls.trigger(y.Events.FRAG_CHANGED,{frag:x}),R&&R.level===U||this.hls.trigger(y.Events.LEVEL_SWITCHED,{level:U}),this.fragPlaying=x)}}},S=p,(T=[{key:"nextLevel",get:function(){var v=this.nextBufferedFrag;return v?v.level:-1}},{key:"currentFrag",get:function(){var v=this.media;return v?this.fragPlaying||this.getAppendedFrag(v.currentTime):null}},{key:"currentProgramDateTime",get:function(){var v=this.media;if(v){var x=v.currentTime,I=this.currentFrag;if(I&&(0,E.isFiniteNumber)(x)&&(0,E.isFiniteNumber)(I.programDateTime)){var R=I.programDateTime+1e3*(x-I.start);return new Date(R)}}return null}},{key:"currentLevel",get:function(){var v=this.currentFrag;return v?v.level:-1}},{key:"nextBufferedFrag",get:function(){var v=this.currentFrag;return v?this.followingBufferedFrag(v):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&da(S.prototype,T),Object.defineProperty(S,"prototype",{writable:!1}),p}(Ia);let br=function(){function O(h,p,S){p===void 0&&(p=0),S===void 0&&(S=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=h,this.alpha_=h?Math.exp(Math.log(.5)/h):0,this.estimate_=p,this.totalWeight_=S}var M=O.prototype;return M.sample=function(h,p){var S=Math.pow(this.alpha_,h);this.estimate_=p*(1-S)+S*this.estimate_,this.totalWeight_+=h},M.getTotalWeight=function(){return this.totalWeight_},M.getEstimate=function(){if(this.alpha_){var h=1-Math.pow(this.alpha_,this.totalWeight_);if(h)return this.estimate_/h}return this.estimate_},O}(),ha=function(){function O(h,p,S){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=S,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new br(h),this.fast_=new br(p)}var M=O.prototype;return M.update=function(h,p){var S=this.slow_,T=this.fast_;this.slow_.halfLife!==h&&(this.slow_=new br(h,S.getEstimate(),S.getTotalWeight())),this.fast_.halfLife!==p&&(this.fast_=new br(p,T.getEstimate(),T.getTotalWeight()))},M.sample=function(h,p){var S=(h=Math.max(h,this.minDelayMs_))/1e3,T=8*p/S;this.fast_.sample(S,T),this.slow_.sample(S,T)},M.canEstimate=function(){var h=this.fast_;return h&&h.getTotalWeight()>=this.minWeight_},M.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},M.destroy=function(){},O}();function Ki(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}let Ir=function(){function O(S){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=S;var T=S.config;this.bwEstimator=new ha(T.abrEwmaSlowVoD,T.abrEwmaFastVoD,T.abrEwmaDefaultEstimate),this.registerListeners()}var M,h,p=O.prototype;return p.registerListeners=function(){var S=this.hls;S.on(y.Events.FRAG_LOADING,this.onFragLoading,this),S.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),S.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),S.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),S.on(y.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){var S=this.hls;S.off(y.Events.FRAG_LOADING,this.onFragLoading,this),S.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),S.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),S.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),S.off(y.Events.ERROR,this.onError,this)},p.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},p.onFragLoading=function(S,T){var C,v=T.frag;v.type===ke.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=v,this.partCurrent=(C=T.part)!=null?C:null,this.timer=self.setInterval(this.onCheck,100)))},p.onLevelLoaded=function(S,T){var C=this.hls.config;T.details.live?this.bwEstimator.update(C.abrEwmaSlowLive,C.abrEwmaFastLive):this.bwEstimator.update(C.abrEwmaSlowVoD,C.abrEwmaFastVoD)},p._abandonRulesCheck=function(){var S=this.fragCurrent,T=this.partCurrent,C=this.hls,v=C.autoLevelEnabled,x=(C.config,C.media);if(S&&x){var I=T?T.stats:S.stats,R=T?T.duration:S.duration;if(I.aborted||I.loaded&&I.loaded===I.total||S.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(v&&!x.paused&&x.playbackRate&&x.readyState){var U=C.mainForwardBufferInfo;if(U!==null){var G=performance.now()-I.loading.start,ie=Math.abs(x.playbackRate);if(!(G<=500*R/ie)){var le=I.loaded&&I.loading.first,he=this.bwEstimator.getEstimate(),Te=C.levels,Ee=C.minAutoLevel,je=Te[S.level],Ve=I.total||Math.max(I.loaded,Math.round(R*je.maxBitrate/8)),Ne=le?1e3*I.loaded/G:0,Re=Ne?(Ve-I.loaded)/Ne:8*Ve/he,He=U.len/ie;if(!(Re<=He)){var Le,Je=Number.POSITIVE_INFINITY;for(Le=S.level-1;Le>Ee;Le--){var Ye=Te[Le].maxBitrate;if((Je=Ne?R*Ye/(6.4*Ne):R*Ye/he)<He)break}Je>=Re||(w.logger.warn("Fragment "+S.sn+(T?" part "+T.index:"")+" of level "+S.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+Le+`
      Current BW estimate: `+((0,E.isFiniteNumber)(he)?(he/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+Re.toFixed(3)+` s
      Estimated load time for the next fragment: `+Je.toFixed(3)+` s
      Time to underbuffer: `+He.toFixed(3)+" s"),C.nextLoadLevel=Le,le&&this.bwEstimator.sample(G,I.loaded),this.clearTimer(),S.loader&&(this.fragCurrent=this.partCurrent=null,S.loader.abort()),C.trigger(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:S,part:T,stats:I}))}}}}}},p.onFragLoaded=function(S,T){var C=T.frag,v=T.part;if(C.type===ke.PlaylistLevelType.MAIN&&(0,E.isFiniteNumber)(C.sn)){var x=v?v.stats:C.stats,I=v?v.duration:C.duration;if(this.clearTimer(),this.lastLoadedFragLevel=C.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var R=this.hls.levels[C.level],U=(R.loaded?R.loaded.bytes:0)+x.loaded,G=(R.loaded?R.loaded.duration:0)+I;R.loaded={bytes:U,duration:G},R.realBitrate=Math.round(8*U/G)}if(C.bitrateTest){var ie={stats:x,frag:C,part:v,id:C.type};this.onFragBuffered(y.Events.FRAG_BUFFERED,ie)}}},p.onFragBuffered=function(S,T){var C=T.frag,v=T.part,x=v?v.stats:C.stats;if(!x.aborted&&C.type===ke.PlaylistLevelType.MAIN&&C.sn!=="initSegment"){var I=x.parsing.end-x.loading.start;this.bwEstimator.sample(I,x.loaded),x.bwEstimate=this.bwEstimator.getEstimate(),C.bitrateTest?this.bitrateTestDelay=I/1e3:this.bitrateTestDelay=0}},p.onError=function(S,T){switch(T.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},p.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},p.getNextABRAutoLevel=function(){var S=this.fragCurrent,T=this.partCurrent,C=this.hls,v=C.maxAutoLevel,x=C.config,I=C.minAutoLevel,R=C.media,U=T?T.duration:S?S.duration:0,G=(R&&R.currentTime,R&&R.playbackRate!==0?Math.abs(R.playbackRate):1),ie=this.bwEstimator?this.bwEstimator.getEstimate():x.abrEwmaDefaultEstimate,le=C.mainForwardBufferInfo,he=(le?le.len:0)/G,Te=this.findBestLevel(ie,I,v,he,x.abrBandWidthFactor,x.abrBandWidthUpFactor);if(Te>=0)return Te;w.logger.trace((he?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var Ee=U?Math.min(U,x.maxStarvationDelay):x.maxStarvationDelay,je=x.abrBandWidthFactor,Ve=x.abrBandWidthUpFactor;if(!he){var Ne=this.bitrateTestDelay;Ne&&(Ee=(U?Math.min(U,x.maxLoadingDelay):x.maxLoadingDelay)-Ne,w.logger.trace("bitrate test took "+Math.round(1e3*Ne)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*Ee)+" ms"),je=Ve=1)}return Te=this.findBestLevel(ie,I,v,he+Ee,je,Ve),Math.max(Te,0)},p.findBestLevel=function(S,T,C,v,x,I){for(var R,U=this.fragCurrent,G=this.partCurrent,ie=this.lastLoadedFragLevel,le=this.hls.levels,he=le[ie],Te=!(he==null||(R=he.details)===null||R===void 0||!R.live),Ee=he?.codecSet,je=G?G.duration:U?U.duration:0,Ve=C;Ve>=T;Ve--){var Ne=le[Ve];if(Ne&&(!Ee||Ne.codecSet===Ee)){var Re,He=Ne.details,Le=(G?He?.partTarget:He?.averagetargetduration)||je;Re=Ve<=ie?x*S:I*S;var Je=le[Ve].maxBitrate,Ye=Je*Le/Re;if(w.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+Ve+"/"+Math.round(Re)+"/"+Je+"/"+Le+"/"+v+"/"+Ye),Re>Je&&(Ye===0||!(0,E.isFiniteNumber)(Ye)||Te&&!this.bitrateTestDelay||Ye<v))return Ve}}return-1},M=O,(h=[{key:"nextAutoLevel",get:function(){var S=this._nextAutoLevel,T=this.bwEstimator;if(S!==-1&&!T.canEstimate())return S;var C=this.getNextABRAutoLevel();return S!==-1&&this.hls.levels[C].loadError?S:(S!==-1&&(C=Math.min(S,C)),C)},set:function(S){this._nextAutoLevel=S}}])&&Ki(M.prototype,h),Object.defineProperty(M,"prototype",{writable:!1}),O}();var jt=function(){function O(){this.chunks=[],this.dataLength=0}var M=O.prototype;return M.push=function(h){this.chunks.push(h),this.dataLength+=h.length},M.flush=function(){var h,p=this.chunks,S=this.dataLength;return p.length?(h=p.length===1?p[0]:function(T,C){for(var v=new Uint8Array(C),x=0,I=0;I<T.length;I++){var R=T[I];v.set(R,x),x+=R.length}return v}(p,S),this.reset(),h):new Uint8Array(0)},M.reset=function(){this.chunks.length=0,this.dataLength=0},O}();function Mr(){return Mr=Object.assign?Object.assign.bind():function(O){for(var M=1;M<arguments.length;M++){var h=arguments[M];for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(O[p]=h[p])}return O},Mr.apply(this,arguments)}function zt(O,M){return zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,p){return h.__proto__=p,h},zt(O,M)}var Wi=function(O){var M,h;function p(T,C){var v;return(v=O.call(this,T,C,"[audio-stream-controller]")||this).videoBuffer=null,v.videoTrackCC=-1,v.waitingVideoCC=-1,v.audioSwitch=!1,v.trackId=-1,v.waitingData=null,v.mainDetails=null,v.bufferFlushed=!1,v.cachedTrackLoadedData=null,v._registerListeners(),v}h=O,(M=p).prototype=Object.create(h.prototype),M.prototype.constructor=M,zt(M,h);var S=p.prototype;return S.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},S._registerListeners=function(){var T=this.hls;T.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),T.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),T.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),T.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),T.on(y.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),T.on(y.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),T.on(y.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),T.on(y.Events.ERROR,this.onError,this),T.on(y.Events.BUFFER_RESET,this.onBufferReset,this),T.on(y.Events.BUFFER_CREATED,this.onBufferCreated,this),T.on(y.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),T.on(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),T.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},S._unregisterListeners=function(){var T=this.hls;T.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),T.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),T.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),T.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),T.off(y.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),T.off(y.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),T.off(y.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),T.off(y.Events.ERROR,this.onError,this),T.off(y.Events.BUFFER_RESET,this.onBufferReset,this),T.off(y.Events.BUFFER_CREATED,this.onBufferCreated,this),T.off(y.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),T.off(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),T.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},S.onInitPtsFound=function(T,C){var v=C.frag,x=C.id,I=C.initPTS;if(x==="main"){var R=v.cc;this.initPTS[v.cc]=I,this.log("InitPTS for cc: "+R+" found from main: "+I),this.videoTrackCC=R,this.state===Jr&&this.tick()}},S.startLoad=function(T){if(!this.levels)return this.startPosition=T,void(this.state=gr);var C=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,C>0&&T===-1?(this.log("Override startPosition with lastCurrentTime @"+C.toFixed(3)),T=C,this.state=Tt):(this.loadedmetadata=!1,this.state=ua),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=T,this.tick()},S.doTick=function(){switch(this.state){case Tt:this.doTickIdle();break;case ua:var T,C=this.levels,v=this.trackId,x=C==null||(T=C[v])===null||T===void 0?void 0:T.details;if(x){if(this.waitForCdnTuneIn(x))break;this.state=Jr}break;case Fr:var I,R=performance.now(),U=this.retryDate;(!U||R>=U||(I=this.media)!==null&&I!==void 0&&I.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Tt);break;case Jr:var G=this.waitingData;if(G){var ie=G.frag,le=G.part,he=G.cache,Te=G.complete;if(this.initPTS[ie.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=Nr;var Ee={frag:ie,part:le,payload:he.flush(),networkDetails:null};this._handleFragmentLoadProgress(Ee),Te&&O.prototype._handleFragmentLoadComplete.call(this,Ee)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+ie.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var je=this.getLoadPosition(),Ve=Ge.bufferInfo(this.mediaBuffer,je,this.config.maxBufferHole);At(Ve.end,this.config.maxFragLookUpTolerance,ie)<0&&(this.log("Waiting fragment cc ("+ie.cc+") @ "+ie.start+" cancelled because another fragment at "+Ve.end+" is needed"),this.clearWaitingFragment())}}else this.state=Tt}this.onTickEnd()},S.clearWaitingFragment=function(){var T=this.waitingData;T&&(this.fragmentTracker.removeFragment(T.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Tt)},S.resetLoadingState=function(){this.clearWaitingFragment(),O.prototype.resetLoadingState.call(this)},S.onTickEnd=function(){var T=this.media;T&&T.readyState&&(this.lastCurrentTime=T.currentTime)},S.doTickIdle=function(){var T,C,v=this.hls,x=this.levels,I=this.media,R=this.trackId,U=v.config;if(x&&x[R]&&(I||!this.startFragRequested&&U.startFragPrefetch)){var G=x[R].details;if(!G||G.live&&this.levelLastLoaded!==R||this.waitForCdnTuneIn(G))this.state=ua;else{var ie=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&ie&&(this.bufferFlushed=!1,this.afterBufferFlushed(ie,H.ElementaryStreamTypes.AUDIO,ke.PlaylistLevelType.AUDIO));var le=this.getFwdBufferInfo(ie,ke.PlaylistLevelType.AUDIO);if(le!==null){var he=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,ke.PlaylistLevelType.MAIN),Te=le.len,Ee=this.getMaxBufferLength(he?.len),je=this.audioSwitch;if(!(Te>=Ee)||je){if(!je&&this._streamEnded(le,G))return v.trigger(y.Events.BUFFER_EOS,{type:"audio"}),void(this.state=fr);var Ve=G.fragments[0].start,Ne=le.end;if(je&&I){var Re=this.getLoadPosition();Ne=Re,G.PTSKnown&&Re<Ve&&(le.end>Ve||le.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),I.currentTime=Ve+.05)}if(!(he&&Ne>he.end+G.targetduration)&&(he&&he.len||!le.len)){var He=this.getNextFragment(Ne,G);He?((T=He.decryptdata)===null||T===void 0?void 0:T.keyFormat)!=="identity"||(C=He.decryptdata)!==null&&C!==void 0&&C.key?this.loadFragment(He,G,Ne):this.loadKey(He,G):this.bufferFlushed=!0}}}}}},S.getMaxBufferLength=function(T){var C=O.prototype.getMaxBufferLength.call(this);return T?Math.max(C,T):C},S.onMediaDetaching=function(){this.videoBuffer=null,O.prototype.onMediaDetaching.call(this)},S.onAudioTracksUpdated=function(T,C){var v=C.audioTracks;this.resetTransmuxer(),this.levels=v.map(function(x){return new vt(x)})},S.onAudioTrackSwitching=function(T,C){var v=!!C.url;this.trackId=C.id;var x=this.fragCurrent;x!=null&&x.loader&&x.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),v?this.setInterval(100):this.resetTransmuxer(),v?(this.audioSwitch=!0,this.state=Tt):this.state=gr,this.tick()},S.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},S.onLevelLoaded=function(T,C){this.mainDetails=C.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(y.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},S.onAudioTrackLoaded=function(T,C){var v;if(this.mainDetails!=null){var x=this.levels,I=C.details,R=C.id;if(x){this.log("Track "+R+" loaded ["+I.startSN+","+I.endSN+"],duration:"+I.totalduration);var U=x[R],G=0;if(I.live||(v=U.details)!==null&&v!==void 0&&v.live){var ie=this.mainDetails;if(I.fragments[0]||(I.deltaUpdateFailed=!0),I.deltaUpdateFailed||!ie)return;!U.details&&I.hasProgramDateTime&&ie.hasProgramDateTime?(gt(I,ie),G=I.fragments[0].start):G=this.alignPlaylists(I,U.details)}U.details=I,this.levelLastLoaded=R,this.startFragRequested||!this.mainDetails&&I.live||this.setStartPosition(U.details,G),this.state!==ua||this.waitForCdnTuneIn(I)||(this.state=Tt),this.tick()}else this.warn("Audio tracks were reset while loading level "+R)}else this.cachedTrackLoadedData=C},S._handleFragmentLoadProgress=function(T){var C,v=T.frag,x=T.part,I=T.payload,R=this.config,U=this.trackId,G=this.levels;if(G){var ie=G[U],le=ie.details,he=R.defaultAudioCodec||ie.audioCodec||"mp4a.40.2",Te=this.transmuxer;Te||(Te=this.transmuxer=new Zr(this.hls,ke.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var Ee=this.initPTS[v.cc],je=(C=v.initSegment)===null||C===void 0?void 0:C.data;if(Ee!==void 0){var Ve=x?x.index:-1,Ne=Ve!==-1,Re=new Ze(v.level,v.sn,v.stats.chunkCount,I.byteLength,Ve,Ne);Te.push(I,je,he,"",v,x,le.totalduration,!1,Re,Ee)}else this.log("Unknown video PTS for cc "+v.cc+", waiting for video PTS before demuxing audio frag "+v.sn+" of ["+le.startSN+" ,"+le.endSN+"],track "+U),(this.waitingData=this.waitingData||{frag:v,part:x,cache:new jt,complete:!1}).cache.push(new Uint8Array(I)),this.waitingVideoCC=this.videoTrackCC,this.state=Jr}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+v.sn+" of level "+v.level+" will not be buffered")},S._handleFragmentLoadComplete=function(T){this.waitingData?this.waitingData.complete=!0:O.prototype._handleFragmentLoadComplete.call(this,T)},S.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},S.onBufferCreated=function(T,C){var v=C.tracks.audio;v&&(this.mediaBuffer=v.buffer||null),C.tracks.video&&(this.videoBuffer=C.tracks.video.buffer||null)},S.onFragBuffered=function(T,C){var v,x=C.frag,I=C.part;x.type===ke.PlaylistLevelType.AUDIO?this.fragContextChanged(x)?this.warn("Fragment "+x.sn+(I?" p: "+I.index:"")+" of level "+x.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(x.sn!=="initSegment"&&(this.fragPrevious=x,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(y.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(x,I)):this.loadedmetadata||x.type!==ke.PlaylistLevelType.MAIN||(v=this.videoBuffer||this.media)!==null&&v!==void 0&&v.buffered.length&&(this.loadedmetadata=!0)},S.onError=function(T,C){switch(C.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ke.PlaylistLevelType.AUDIO,C);break;case D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case D.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==Ar&&this.state!==gr&&(this.state=C.fatal?Ar:Tt,this.warn(C.details+" while loading frag, switching to "+this.state+" state"));break;case D.ErrorDetails.BUFFER_FULL_ERROR:if(C.parent==="audio"&&(this.state===mr||this.state===Qr)){var v=!0,x=this.getFwdBufferInfo(this.mediaBuffer,ke.PlaylistLevelType.AUDIO);x&&x.len>.5&&(v=!this.reduceMaxBufferLength(x.len)),v&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,O.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},S.onBufferFlushed=function(T,C){C.type===H.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},S._handleTransmuxComplete=function(T){var C,v="audio",x=this.hls,I=T.remuxResult,R=T.chunkMeta,U=this.getCurrentContext(R);if(!U)return this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(R.level);var G=U.frag,ie=U.part,le=U.level.details,he=I.audio,Te=I.text,Ee=I.id3,je=I.initSegment;if(!this.fragContextChanged(G)&&le){if(this.state=mr,this.audioSwitch&&he&&this.completeAudioSwitch(),je!=null&&je.tracks&&(this._bufferInitSegment(je.tracks,G,R),x.trigger(y.Events.FRAG_PARSING_INIT_SEGMENT,{frag:G,id:v,tracks:je.tracks})),he){var Ve=he.startPTS,Ne=he.endPTS,Re=he.startDTS,He=he.endDTS;ie&&(ie.elementaryStreams[H.ElementaryStreamTypes.AUDIO]={startPTS:Ve,endPTS:Ne,startDTS:Re,endDTS:He}),G.setElementaryStreamInfo(H.ElementaryStreamTypes.AUDIO,Ve,Ne,Re,He),this.bufferFragmentData(he,G,ie,R)}if(Ee!=null&&(C=Ee.samples)!==null&&C!==void 0&&C.length){var Le=Mr({id:v,frag:G,details:le},Ee);x.trigger(y.Events.FRAG_PARSING_METADATA,Le)}if(Te){var Je=Mr({id:v,frag:G,details:le},Te);x.trigger(y.Events.FRAG_PARSING_USERDATA,Je)}}},S._bufferInitSegment=function(T,C,v){if(this.state===mr){T.video&&delete T.video;var x=T.audio;if(x){x.levelCodec=x.codec,x.id="audio",this.log("Init audio buffer, container:"+x.container+", codecs[parsed]=["+x.codec+"]"),this.hls.trigger(y.Events.BUFFER_CODECS,T);var I=x.initSegment;if(I!=null&&I.byteLength){var R={type:"audio",frag:C,part:null,chunkMeta:v,parent:C.type,data:I};this.hls.trigger(y.Events.BUFFER_APPENDING,R)}this.tick()}}},S.loadFragment=function(T,C,v){var x=this.fragmentTracker.getState(T);this.fragCurrent=T,(this.audioSwitch||x===Z.NOT_LOADED||x===Z.PARTIAL)&&(T.sn==="initSegment"?this._loadInitSegment(T):C.live&&!(0,E.isFiniteNumber)(this.initPTS[T.cc])?(this.log("Waiting for video PTS in continuity counter "+T.cc+" of live stream before loading audio fragment "+T.sn+" of level "+this.trackId),this.state=Jr):(this.startFragRequested=!0,O.prototype.loadFragment.call(this,T,C,v)))},S.completeAudioSwitch=function(){var T=this.hls,C=this.media,v=this.trackId;C&&(this.log("Switching audio track : flushing all audio"),O.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,T.trigger(y.Events.AUDIO_TRACK_SWITCHED,{id:v})},p}(Ia);let qi=Wi;function ai(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}function ea(O,M){return ea=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,p){return h.__proto__=p,h},ea(O,M)}let ii=function(O){var M,h;function p(v){var x;return(x=O.call(this,v,"[audio-track-controller]")||this).tracks=[],x.groupId=null,x.tracksInGroup=[],x.trackId=-1,x.trackName="",x.selectDefaultTrack=!0,x.registerListeners(),x}h=O,(M=p).prototype=Object.create(h.prototype),M.prototype.constructor=M,ea(M,h);var S,T,C=p.prototype;return C.registerListeners=function(){var v=this.hls;v.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),v.on(y.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),v.on(y.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),v.on(y.Events.ERROR,this.onError,this)},C.unregisterListeners=function(){var v=this.hls;v.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.off(y.Events.LEVEL_LOADING,this.onLevelLoading,this),v.off(y.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),v.off(y.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),v.off(y.Events.ERROR,this.onError,this)},C.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,O.prototype.destroy.call(this)},C.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},C.onManifestParsed=function(v,x){this.tracks=x.audioTracks||[]},C.onAudioTrackLoaded=function(v,x){var I=x.id,R=x.details,U=this.tracksInGroup[I];if(U){var G=U.details;U.details=x.details,this.log("audioTrack "+I+" loaded ["+R.startSN+"-"+R.endSN+"]"),I===this.trackId&&(this.retryCount=0,this.playlistLoaded(I,x,G))}else this.warn("Invalid audio track id "+I)},C.onLevelLoading=function(v,x){this.switchLevel(x.level)},C.onLevelSwitching=function(v,x){this.switchLevel(x.level)},C.switchLevel=function(v){var x=this.hls.levels[v];if(x!=null&&x.audioGroupIds){var I=x.audioGroupIds[x.urlId];if(this.groupId!==I){this.groupId=I;var R=this.tracks.filter(function(G){return!I||G.groupId===I});this.selectDefaultTrack&&!R.some(function(G){return G.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=R;var U={audioTracks:R};this.log("Updating audio tracks, "+R.length+' track(s) found in "'+I+'" group-id'),this.hls.trigger(y.Events.AUDIO_TRACKS_UPDATED,U),this.selectInitialTrack()}}},C.onError=function(v,x){O.prototype.onError.call(this,v,x),!x.fatal&&x.context&&x.context.type===ke.PlaylistContextType.AUDIO_TRACK&&x.context.id===this.trackId&&x.context.groupId===this.groupId&&this.retryLoadingOrFail(x)},C.setAudioTrack=function(v){var x=this.tracksInGroup;if(v<0||v>=x.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var I=x[this.trackId];this.log("Now switching to audio-track index "+v);var R=x[v],U=R.id,G=R.groupId,ie=G===void 0?"":G,le=R.name,he=R.type,Te=R.url;if(this.trackId=v,this.trackName=le,this.selectDefaultTrack=!1,this.hls.trigger(y.Events.AUDIO_TRACK_SWITCHING,{id:U,groupId:ie,name:le,type:he,url:Te}),!R.details||R.details.live){var Ee=this.switchParams(R.url,I?.details);this.loadPlaylist(Ee)}}},C.selectInitialTrack=function(){this.tracksInGroup;var v=this.trackName,x=this.findTrackId(v)||this.findTrackId();x!==-1?this.setAudioTrack(x):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},C.findTrackId=function(v){for(var x=this.tracksInGroup,I=0;I<x.length;I++){var R=x[I];if((!this.selectDefaultTrack||R.default)&&(!v||v===R.name))return R.id}return-1},C.loadPlaylist=function(v){var x=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(x)){var I=x.id,R=x.groupId,U=x.url;if(v)try{U=v.addDirectives(U)}catch(G){this.warn("Could not construct new URL with HLS Delivery Directives: "+G)}this.log("loading audio-track playlist for id: "+I),this.clearTimer(),this.hls.trigger(y.Events.AUDIO_TRACK_LOADING,{url:U,id:I,groupId:R,deliveryDirectives:v||null})}},S=p,(T=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(v){this.selectDefaultTrack=!1,this.setAudioTrack(v)}}])&&ai(S.prototype,T),Object.defineProperty(S,"prototype",{writable:!1}),p}(lr);function ni(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}function ca(O,M){return ca=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,p){return h.__proto__=p,h},ca(O,M)}var pa=function(O){var M,h;function p(v,x){var I;return(I=O.call(this,v,x,"[subtitle-stream-controller]")||this).levels=[],I.currentTrackId=-1,I.tracksBuffered=[],I.mainDetails=null,I._registerListeners(),I}h=O,(M=p).prototype=Object.create(h.prototype),M.prototype.constructor=M,ca(M,h);var S,T,C=p.prototype;return C.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},C._registerListeners=function(){var v=this.hls;v.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(y.Events.ERROR,this.onError,this),v.on(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.on(y.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.on(y.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.on(y.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),v.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C._unregisterListeners=function(){var v=this.hls;v.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(y.Events.ERROR,this.onError,this),v.off(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.off(y.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.off(y.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.off(y.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),v.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C.startLoad=function(v){this.stopLoad(),this.state=Tt,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=v,this.tick()},C.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},C.onLevelLoaded=function(v,x){this.mainDetails=x.details},C.onSubtitleFragProcessed=function(v,x){var I=x.frag,R=x.success;if(this.fragPrevious=I,this.state=Tt,R){var U=this.tracksBuffered[this.currentTrackId];if(U){for(var G,ie=I.start,le=0;le<U.length;le++)if(ie>=U[le].start&&ie<=U[le].end){G=U[le];break}var he=I.start+I.duration;G?G.end=he:(G={start:ie,end:he},U.push(G)),this.fragmentTracker.fragBuffered(I)}}},C.onBufferFlushing=function(v,x){var I=x.startOffset,R=x.endOffset;if(I===0&&R!==Number.POSITIVE_INFINITY){var U=this.currentTrackId,G=this.levels;if(!G.length||!G[U]||!G[U].details)return;var ie=R-G[U].details.targetduration;if(ie<=0)return;x.endOffsetSubtitles=Math.max(0,ie),this.tracksBuffered.forEach(function(le){for(var he=0;he<le.length;)if(le[he].end<=ie)le.shift();else{if(!(le[he].start<ie))break;le[he].start=ie,he++}}),this.fragmentTracker.removeFragmentsInRange(I,ie,ke.PlaylistLevelType.SUBTITLE)}},C.onFragBuffered=function(v,x){var I;this.loadedmetadata||x.frag.type!==ke.PlaylistLevelType.MAIN||(I=this.media)!==null&&I!==void 0&&I.buffered.length&&(this.loadedmetadata=!0)},C.onError=function(v,x){var I,R=x.frag;R&&R.type===ke.PlaylistLevelType.SUBTITLE&&((I=this.fragCurrent)!==null&&I!==void 0&&I.loader&&this.fragCurrent.loader.abort(),this.state=Tt)},C.onSubtitleTracksUpdated=function(v,x){var I=this,R=x.subtitleTracks;this.tracksBuffered=[],this.levels=R.map(function(U){return new vt(U)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(U){I.tracksBuffered[U.id]=[]}),this.mediaBuffer=null},C.onSubtitleTrackSwitch=function(v,x){if(this.currentTrackId=x.id,this.levels.length&&this.currentTrackId!==-1){var I=this.levels[this.currentTrackId];I!=null&&I.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,I&&this.setInterval(500)}else this.clearInterval()},C.onSubtitleTrackLoaded=function(v,x){var I,R=x.details,U=x.id,G=this.currentTrackId,ie=this.levels;if(ie.length){var le=ie[G];if(!(U>=ie.length||U!==G)&&le){this.mediaBuffer=this.mediaBufferTimeRanges;var he=0;if(R.live||(I=le.details)!==null&&I!==void 0&&I.live){var Te=this.mainDetails;if(R.deltaUpdateFailed||!Te)return;var Ee=Te.fragments[0];le.details?(he=this.alignPlaylists(R,le.details))===0&&Ee&&Qt(R,he=Ee.start):R.hasProgramDateTime&&Te.hasProgramDateTime?(gt(R,Te),he=R.fragments[0].start):Ee&&Qt(R,he=Ee.start)}le.details=R,this.levelLastLoaded=U,this.startFragRequested||!this.mainDetails&&R.live||this.setStartPosition(le.details,he),this.tick(),R.live&&!this.fragCurrent&&this.media&&this.state===Tt&&(lt(null,R.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),le.details=void 0))}}},C._handleFragmentLoadComplete=function(v){var x=v.frag,I=v.payload,R=x.decryptdata,U=this.hls;if(!this.fragContextChanged(x)&&I&&I.byteLength>0&&R&&R.key&&R.iv&&R.method==="AES-128"){var G=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(I),R.key.buffer,R.iv.buffer).then(function(ie){var le=performance.now();U.trigger(y.Events.FRAG_DECRYPTED,{frag:x,payload:ie,stats:{tstart:G,tdecrypt:le}})})}},C.doTick=function(){if(this.media){if(this.state===Tt){var v=this.currentTrackId,x=this.levels;if(!x.length||!x[v]||!x[v].details)return;var I=x[v].details,R=I.targetduration,U=this.config,G=this.getLoadPosition(),ie=Ge.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],G-R,U.maxBufferHole),le=ie.end,he=ie.len,Te=this.getFwdBufferInfo(this.media,ke.PlaylistLevelType.MAIN);if(he>this.getMaxBufferLength(Te?.len)+R)return;var Ee,je=I.fragments,Ve=je.length,Ne=I.edge,Re=this.fragPrevious;if(le<Ne){var He=U.maxFragLookUpTolerance;!(Ee=lt(Re,je,Math.max(je[0].start,le),He))&&Re&&Re.start<je[0].start&&(Ee=je[0])}else Ee=je[Ve-1];if(!(Ee=this.mapToInitFragWhenRequired(Ee))||this.fragmentTracker.getState(Ee)!==Z.NOT_LOADED)return;Ee.encrypted?this.loadKey(Ee,I):this.loadFragment(Ee,I,le)}}else this.state=Tt},C.getMaxBufferLength=function(v){var x=O.prototype.getMaxBufferLength.call(this);return v?Math.max(x,v):x},C.loadFragment=function(v,x,I){this.fragCurrent=v,v.sn==="initSegment"?this._loadInitSegment(v):(this.startFragRequested=!0,O.prototype.loadFragment.call(this,v,x,I))},S=p,(T=[{key:"mediaBufferTimeRanges",get:function(){return new zi(this.tracksBuffered[this.currentTrackId]||[])}}])&&ni(S.prototype,T),Object.defineProperty(S,"prototype",{writable:!1}),p}(Ia),zi=function(O){this.buffered=void 0;var M=function(h,p,S){if((p>>>=0)>S-1)throw new DOMException("Failed to execute '"+h+"' on 'TimeRanges': The index provided ("+p+") is greater than the maximum bound ("+S+")");return O[p][h]};this.buffered={get length(){return O.length},end:function(h){return M("end",h,O.length)},start:function(h){return M("start",h,O.length)}}};function fa(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}function ga(O,M){return ga=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,p){return h.__proto__=p,h},ga(O,M)}function jr(O){for(var M=[],h=0;h<O.length;h++){var p=O[h];p.kind==="subtitles"&&p.label&&M.push(O[h])}return M}let Xi=function(O){var M,h;function p(v){var x;return(x=O.call(this,v,"[subtitle-track-controller]")||this).media=null,x.tracks=[],x.groupId=null,x.tracksInGroup=[],x.trackId=-1,x.selectDefaultTrack=!0,x.queuedDefaultTrack=-1,x.trackChangeListener=function(){return x.onTextTracksChanged()},x.asyncPollTrackChange=function(){return x.pollTrackChange(0)},x.useTextTrackPolling=!1,x.subtitlePollingInterval=-1,x._subtitleDisplay=!0,x.registerListeners(),x}h=O,(M=p).prototype=Object.create(h.prototype),M.prototype.constructor=M,ga(M,h);var S,T,C=p.prototype;return C.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,O.prototype.destroy.call(this)},C.registerListeners=function(){var v=this.hls;v.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),v.on(y.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),v.on(y.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.on(y.Events.ERROR,this.onError,this)},C.unregisterListeners=function(){var v=this.hls;v.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.off(y.Events.LEVEL_LOADING,this.onLevelLoading,this),v.off(y.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),v.off(y.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.off(y.Events.ERROR,this.onError,this)},C.onMediaAttached=function(v,x){this.media=x.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},C.pollTrackChange=function(v){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,v)},C.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),jr(this.media.textTracks).forEach(function(v){Fe(v)}),this.subtitleTrack=-1,this.media=null)},C.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},C.onManifestParsed=function(v,x){this.tracks=x.subtitleTracks},C.onSubtitleTrackLoaded=function(v,x){var I=x.id,R=x.details,U=this.trackId,G=this.tracksInGroup[U];if(G){var ie=G.details;G.details=x.details,this.log("subtitle track "+I+" loaded ["+R.startSN+"-"+R.endSN+"]"),I===this.trackId&&(this.retryCount=0,this.playlistLoaded(I,x,ie))}else this.warn("Invalid subtitle track id "+I)},C.onLevelLoading=function(v,x){this.switchLevel(x.level)},C.onLevelSwitching=function(v,x){this.switchLevel(x.level)},C.switchLevel=function(v){var x=this.hls.levels[v];if(x!=null&&x.textGroupIds){var I=x.textGroupIds[x.urlId];if(this.groupId!==I){var R=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,U=this.tracks.filter(function(le){return!I||le.groupId===I});this.tracksInGroup=U;var G=this.findTrackId(R?.name)||this.findTrackId();this.groupId=I;var ie={subtitleTracks:U};this.log("Updating subtitle tracks, "+U.length+' track(s) found in "'+I+'" group-id'),this.hls.trigger(y.Events.SUBTITLE_TRACKS_UPDATED,ie),G!==-1&&this.setSubtitleTrack(G,R)}}},C.findTrackId=function(v){for(var x=this.tracksInGroup,I=0;I<x.length;I++){var R=x[I];if((!this.selectDefaultTrack||R.default)&&(!v||v===R.name))return R.id}return-1},C.onError=function(v,x){O.prototype.onError.call(this,v,x),!x.fatal&&x.context&&x.context.type===ke.PlaylistContextType.SUBTITLE_TRACK&&x.context.id===this.trackId&&x.context.groupId===this.groupId&&this.retryLoadingOrFail(x)},C.loadPlaylist=function(v){var x=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(x)){var I=x.id,R=x.groupId,U=x.url;if(v)try{U=v.addDirectives(U)}catch(G){this.warn("Could not construct new URL with HLS Delivery Directives: "+G)}this.log("Loading subtitle playlist for id "+I),this.hls.trigger(y.Events.SUBTITLE_TRACK_LOADING,{url:U,id:I,groupId:R,deliveryDirectives:v||null})}},C.toggleTrackModes=function(v){var x=this,I=this.media,R=this.trackId;if(I){var U=jr(I.textTracks),G=U.filter(function(he){return he.groupId===x.groupId});if(v===-1)[].slice.call(U).forEach(function(he){he.mode="disabled"});else{var ie=G[R];ie&&(ie.mode="disabled")}var le=G[v];le&&(le.mode=this.subtitleDisplay?"showing":"hidden")}},C.setSubtitleTrack=function(v,x){var I,R=this.tracksInGroup;if(this.media){if(this.trackId!==v&&this.toggleTrackModes(v),!(this.trackId===v&&(v===-1||(I=R[v])!==null&&I!==void 0&&I.details)||v<-1||v>=R.length)){this.clearTimer();var U=R[v];if(this.log("Switching to subtitle track "+v),this.trackId=v,U){var G=U.id,ie=U.groupId,le=ie===void 0?"":ie,he=U.name,Te=U.type,Ee=U.url;this.hls.trigger(y.Events.SUBTITLE_TRACK_SWITCH,{id:G,groupId:le,name:he,type:Te,url:Ee});var je=this.switchParams(U.url,x?.details);this.loadPlaylist(je)}else this.hls.trigger(y.Events.SUBTITLE_TRACK_SWITCH,{id:v})}}else this.queuedDefaultTrack=v},C.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var v=-1,x=jr(this.media.textTracks),I=0;I<x.length;I++)if(x[I].mode==="hidden")v=I;else if(x[I].mode==="showing"){v=I;break}this.subtitleTrack!==v&&(this.subtitleTrack=v)}},S=p,(T=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(v){this._subtitleDisplay=v,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(v){this.selectDefaultTrack=!1;var x=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(v,x)}}])&&fa(S.prototype,T),Object.defineProperty(S,"prototype",{writable:!1}),p}(lr);var xt,ma=function(){function O(h){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=h}var M=O.prototype;return M.append=function(h,p){var S=this.queues[p];S.push(h),S.length===1&&this.buffers[p]&&this.executeNext(p)},M.insertAbort=function(h,p){this.queues[p].unshift(h),this.executeNext(p)},M.appendBlocker=function(h){var p,S=new Promise(function(C){p=C}),T={execute:p,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(T,h),S},M.executeNext=function(h){var p=this.buffers,S=this.queues,T=p[h],C=S[h];if(C.length){var v=C[0];try{v.execute()}catch(x){w.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),v.onError(x),T&&T.updating||(C.shift(),this.executeNext(h))}}},M.shiftAndExecuteNext=function(h){this.queues[h].shift(),this.executeNext(h)},M.current=function(h){return this.queues[h][0]},O}(),Vr=Gt(),ta=/([ha]vc.)(?:\.[^.,]+)+/,Gr=function(){function O(h){var p=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var S=p.hls,T=p.media,C=p.mediaSource;w.logger.log("[buffer-controller]: Media source opened"),T&&(p.updateMediaElementDuration(),S.trigger(y.Events.MEDIA_ATTACHED,{media:T})),C&&C.removeEventListener("sourceopen",p._onMediaSourceOpen),p.checkPendingTracks()},this._onMediaSourceClose=function(){w.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){w.logger.log("[buffer-controller]: Media source ended")},this.hls=h,this._initSourceBuffer(),this.registerListeners()}var M=O.prototype;return M.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},M.destroy=function(){this.unregisterListeners(),this.details=null},M.registerListeners=function(){var h=this.hls;h.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.on(y.Events.BUFFER_RESET,this.onBufferReset,this),h.on(y.Events.BUFFER_APPENDING,this.onBufferAppending,this),h.on(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),h.on(y.Events.BUFFER_EOS,this.onBufferEos,this),h.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),h.on(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),h.on(y.Events.FRAG_PARSED,this.onFragParsed,this),h.on(y.Events.FRAG_CHANGED,this.onFragChanged,this)},M.unregisterListeners=function(){var h=this.hls;h.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.off(y.Events.BUFFER_RESET,this.onBufferReset,this),h.off(y.Events.BUFFER_APPENDING,this.onBufferAppending,this),h.off(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),h.off(y.Events.BUFFER_EOS,this.onBufferEos,this),h.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),h.off(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),h.off(y.Events.FRAG_PARSED,this.onFragParsed,this),h.off(y.Events.FRAG_CHANGED,this.onFragChanged,this)},M._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new ma(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},M.onManifestParsed=function(h,p){var S=2;(p.audio&&!p.video||!p.altAudio)&&(S=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=S,this.details=null,w.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},M.onMediaAttaching=function(h,p){var S=this.media=p.media;if(S&&Vr){var T=this.mediaSource=new Vr;T.addEventListener("sourceopen",this._onMediaSourceOpen),T.addEventListener("sourceended",this._onMediaSourceEnded),T.addEventListener("sourceclose",this._onMediaSourceClose),S.src=self.URL.createObjectURL(T),this._objectUrl=S.src}},M.onMediaDetaching=function(){var h=this.media,p=this.mediaSource,S=this._objectUrl;if(p){if(w.logger.log("[buffer-controller]: media source detaching"),p.readyState==="open")try{p.endOfStream()}catch(T){w.logger.warn("[buffer-controller]: onMediaDetaching: "+T.message+" while calling endOfStream")}this.onBufferReset(),p.removeEventListener("sourceopen",this._onMediaSourceOpen),p.removeEventListener("sourceended",this._onMediaSourceEnded),p.removeEventListener("sourceclose",this._onMediaSourceClose),h&&(S&&self.URL.revokeObjectURL(S),h.src===S?(h.removeAttribute("src"),h.load()):w.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(y.Events.MEDIA_DETACHED,void 0)},M.onBufferReset=function(){var h=this;this.getSourceBufferTypes().forEach(function(p){var S=h.sourceBuffer[p];try{S&&(h.removeBufferListeners(p),h.mediaSource&&h.mediaSource.removeSourceBuffer(S),h.sourceBuffer[p]=void 0)}catch(T){w.logger.warn("[buffer-controller]: Failed to reset the "+p+" buffer",T)}}),this._initSourceBuffer()},M.onBufferCodecs=function(h,p){var S=this,T=this.getSourceBufferTypes().length;Object.keys(p).forEach(function(C){if(T){var v=S.tracks[C];if(v&&typeof v.buffer.changeType=="function"){var x=p[C],I=x.id,R=x.codec,U=x.levelCodec,G=x.container,ie=x.metadata,le=(v.levelCodec||v.codec).replace(ta,"$1"),he=(U||R).replace(ta,"$1");if(le!==he){var Te=G+";codecs="+(U||R);S.appendChangeType(C,Te),w.logger.log("[buffer-controller]: switching codec "+le+" to "+he),S.tracks[C]={buffer:v.buffer,codec:R,container:G,levelCodec:U,metadata:ie,id:I}}}}else S.pendingTracks[C]=p[C]}),T||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},M.appendChangeType=function(h,p){var S=this,T=this.operationQueue,C={execute:function(){var v=S.sourceBuffer[h];v&&(w.logger.log("[buffer-controller]: changing "+h+" sourceBuffer type to "+p),v.changeType(p)),T.shiftAndExecuteNext(h)},onStart:function(){},onComplete:function(){},onError:function(v){w.logger.warn("[buffer-controller]: Failed to change "+h+" SourceBuffer type",v)}};T.append(C,h)},M.onBufferAppending=function(h,p){var S=this,T=this.hls,C=this.operationQueue,v=this.tracks,x=p.data,I=p.type,R=p.frag,U=p.part,G=p.chunkMeta,ie=G.buffering[I],le=self.performance.now();ie.start=le;var he=R.stats.buffering,Te=U?U.stats.buffering:null;he.start===0&&(he.start=le),Te&&Te.start===0&&(Te.start=le);var Ee=v.audio,je=I==="audio"&&G.id===1&&Ee?.container==="audio/mpeg",Ve={execute:function(){if(ie.executeStart=self.performance.now(),je){var Ne=S.sourceBuffer[I];if(Ne){var Re=R.start-Ne.timestampOffset;Math.abs(Re)>=.1&&(w.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+R.start+" (delta: "+Re+") sn: "+R.sn+")"),Ne.timestampOffset=R.start)}}S.appendExecutor(x,I)},onStart:function(){},onComplete:function(){var Ne=self.performance.now();ie.executeEnd=ie.end=Ne,he.first===0&&(he.first=Ne),Te&&Te.first===0&&(Te.first=Ne);var Re=S.sourceBuffer,He={};for(var Le in Re)He[Le]=Ge.getBuffered(Re[Le]);S.appendError=0,S.hls.trigger(y.Events.BUFFER_APPENDED,{type:I,frag:R,part:U,chunkMeta:G,parent:R.type,timeRanges:He})},onError:function(Ne){w.logger.error("[buffer-controller]: Error encountered while trying to append to the "+I+" SourceBuffer",Ne);var Re={type:D.ErrorTypes.MEDIA_ERROR,parent:R.type,details:D.ErrorDetails.BUFFER_APPEND_ERROR,err:Ne,fatal:!1};Ne.code===DOMException.QUOTA_EXCEEDED_ERR?Re.details=D.ErrorDetails.BUFFER_FULL_ERROR:(S.appendError++,Re.details=D.ErrorDetails.BUFFER_APPEND_ERROR,S.appendError>T.config.appendErrorMaxRetry&&(w.logger.error("[buffer-controller]: Failed "+T.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),Re.fatal=!0,T.stopLoad())),T.trigger(y.Events.ERROR,Re)}};C.append(Ve,I)},M.onBufferFlushing=function(h,p){var S=this,T=this.operationQueue,C=function(v){return{execute:S.removeExecutor.bind(S,v,p.startOffset,p.endOffset),onStart:function(){},onComplete:function(){S.hls.trigger(y.Events.BUFFER_FLUSHED,{type:v})},onError:function(x){w.logger.warn("[buffer-controller]: Failed to remove from "+v+" SourceBuffer",x)}}};p.type?T.append(C(p.type),p.type):this.getSourceBufferTypes().forEach(function(v){T.append(C(v),v)})},M.onFragParsed=function(h,p){var S=this,T=p.frag,C=p.part,v=[],x=C?C.elementaryStreams:T.elementaryStreams;x[H.ElementaryStreamTypes.AUDIOVIDEO]?v.push("audiovideo"):(x[H.ElementaryStreamTypes.AUDIO]&&v.push("audio"),x[H.ElementaryStreamTypes.VIDEO]&&v.push("video")),v.length===0&&w.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+T.type+" level: "+T.level+" sn: "+T.sn),this.blockBuffers(function(){var I=self.performance.now();T.stats.buffering.end=I,C&&(C.stats.buffering.end=I);var R=C?C.stats:T.stats;S.hls.trigger(y.Events.FRAG_BUFFERED,{frag:T,part:C,stats:R,id:T.type})},v)},M.onFragChanged=function(h,p){this.flushBackBuffer()},M.onBufferEos=function(h,p){var S=this;this.getSourceBufferTypes().reduce(function(T,C){var v=S.sourceBuffer[C];return p.type&&p.type!==C||v&&!v.ended&&(v.ended=!0,w.logger.log("[buffer-controller]: "+C+" sourceBuffer now EOS")),T&&!(v&&!v.ended)},!0)&&this.blockBuffers(function(){var T=S.mediaSource;T&&T.readyState==="open"&&T.endOfStream()})},M.onLevelUpdated=function(h,p){var S=p.details;S.fragments.length&&(this.details=S,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},M.flushBackBuffer=function(){var h=this.hls,p=this.details,S=this.media,T=this.sourceBuffer;if(S&&p!==null){var C=this.getSourceBufferTypes();if(C.length){var v=p.live&&h.config.liveBackBufferLength!==null?h.config.liveBackBufferLength:h.config.backBufferLength;if((0,E.isFiniteNumber)(v)&&!(v<0)){var x=S.currentTime,I=p.levelTargetDuration,R=Math.max(v,I),U=Math.floor(x/I)*I-R;C.forEach(function(G){var ie=T[G];if(ie){var le=Ge.getBuffered(ie);le.length>0&&U>le.start(0)&&(h.trigger(y.Events.BACK_BUFFER_REACHED,{bufferEnd:U}),p.live&&h.trigger(y.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:U}),h.trigger(y.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:U,type:G}))}})}}}},M.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var h=this.details,p=this.hls,S=this.media,T=this.mediaSource,C=h.fragments[0].start+h.totalduration,v=S.duration,x=(0,E.isFiniteNumber)(T.duration)?T.duration:0;h.live&&p.config.liveDurationInfinity?(w.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),T.duration=1/0,this.updateSeekableRange(h)):(C>x&&C>v||!(0,E.isFiniteNumber)(v))&&(w.logger.log("[buffer-controller]: Updating Media Source duration to "+C.toFixed(3)),T.duration=C)}},M.updateSeekableRange=function(h){var p=this.mediaSource,S=h.fragments;if(S.length&&h.live&&p!=null&&p.setLiveSeekableRange){var T=Math.max(0,S[0].start),C=Math.max(T,T+h.totalduration);p.setLiveSeekableRange(T,C)}},M.checkPendingTracks=function(){var h=this.bufferCodecEventsExpected,p=this.operationQueue,S=this.pendingTracks,T=Object.keys(S).length;if(T&&!h||T===2){this.createSourceBuffers(S),this.pendingTracks={};var C=this.getSourceBufferTypes();if(C.length===0)return void this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});C.forEach(function(v){p.executeNext(v)})}},M.createSourceBuffers=function(h){var p=this.sourceBuffer,S=this.mediaSource;if(!S)throw Error("createSourceBuffers called when mediaSource was null");var T=0;for(var C in h)if(!p[C]){var v=h[C];if(!v)throw Error("source buffer exists for track "+C+", however track does not");var x=v.levelCodec||v.codec,I=v.container+";codecs="+x;w.logger.log("[buffer-controller]: creating sourceBuffer("+I+")");try{var R=p[C]=S.addSourceBuffer(I),U=C;this.addBufferListener(U,"updatestart",this._onSBUpdateStart),this.addBufferListener(U,"updateend",this._onSBUpdateEnd),this.addBufferListener(U,"error",this._onSBUpdateError),this.tracks[C]={buffer:R,codec:x,container:v.container,levelCodec:v.levelCodec,metadata:v.metadata,id:v.id},T++}catch(G){w.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+G.message),this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:G,mimeType:I})}}T&&this.hls.trigger(y.Events.BUFFER_CREATED,{tracks:this.tracks})},M._onSBUpdateStart=function(h){this.operationQueue.current(h).onStart()},M._onSBUpdateEnd=function(h){var p=this.operationQueue;p.current(h).onComplete(),p.shiftAndExecuteNext(h)},M._onSBUpdateError=function(h,p){w.logger.error("[buffer-controller]: "+h+" SourceBuffer error",p),this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var S=this.operationQueue.current(h);S&&S.onError(p)},M.removeExecutor=function(h,p,S){var T=this.media,C=this.mediaSource,v=this.operationQueue,x=this.sourceBuffer[h];if(!T||!C||!x)return w.logger.warn("[buffer-controller]: Attempting to remove from the "+h+" SourceBuffer, but it does not exist"),void v.shiftAndExecuteNext(h);var I=(0,E.isFiniteNumber)(T.duration)?T.duration:1/0,R=(0,E.isFiniteNumber)(C.duration)?C.duration:1/0,U=Math.max(0,p),G=Math.min(S,I,R);G>U?(w.logger.log("[buffer-controller]: Removing ["+U+","+G+"] from the "+h+" SourceBuffer"),x.remove(U,G)):v.shiftAndExecuteNext(h)},M.appendExecutor=function(h,p){var S=this.operationQueue,T=this.sourceBuffer[p];if(!T)return w.logger.warn("[buffer-controller]: Attempting to append to the "+p+" SourceBuffer, but it does not exist"),void S.shiftAndExecuteNext(p);T.ended=!1,T.appendBuffer(h)},M.blockBuffers=function(h,p){var S=this;if(p===void 0&&(p=this.getSourceBufferTypes()),!p.length)return w.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(h);var T=this.operationQueue,C=p.map(function(v){return T.appendBlocker(v)});Promise.all(C).then(function(){h(),p.forEach(function(v){var x=S.sourceBuffer[v];x&&x.updating||T.shiftAndExecuteNext(v)})})},M.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},M.addBufferListener=function(h,p,S){var T=this.sourceBuffer[h];if(T){var C=S.bind(this,h);this.listeners[h].push({event:p,listener:C}),T.addEventListener(p,C)}},M.removeBufferListeners=function(h){var p=this.sourceBuffer[h];p&&this.listeners[h].forEach(function(S){p.removeEventListener(S.event,S.listener)})},O}(),ya={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ra=function(O){var M=O;return ya.hasOwnProperty(O)&&(M=ya[O]),String.fromCharCode(M)},kr=15,Pt=100,Yi={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},si={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Qi={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ji={25:2,26:4,29:6,30:8,31:10,27:13,28:15},oi=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(O){O[O.ERROR=0]="ERROR",O[O.TEXT=1]="TEXT",O[O.WARNING=2]="WARNING",O[O.INFO=2]="INFO",O[O.DEBUG=3]="DEBUG",O[O.DATA=3]="DATA"})(xt||(xt={}));var Zi=function(){function O(){this.time=null,this.verboseLevel=xt.ERROR}return O.prototype.log=function(M,h){this.verboseLevel>=M&&w.logger.log(this.time+" ["+M+"] "+h)},O}(),wr=function(O){for(var M=[],h=0;h<O.length;h++)M.push(O[h].toString(16));return M},li=function(){function O(h,p,S,T,C){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=h||"white",this.underline=p||!1,this.italics=S||!1,this.background=T||"black",this.flash=C||!1}var M=O.prototype;return M.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},M.setStyles=function(h){for(var p=["foreground","underline","italics","background","flash"],S=0;S<p.length;S++){var T=p[S];h.hasOwnProperty(T)&&(this[T]=h[T])}},M.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},M.equals=function(h){return this.foreground===h.foreground&&this.underline===h.underline&&this.italics===h.italics&&this.background===h.background&&this.flash===h.flash},M.copy=function(h){this.foreground=h.foreground,this.underline=h.underline,this.italics=h.italics,this.background=h.background,this.flash=h.flash},M.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},O}(),en=function(){function O(h,p,S,T,C,v){this.uchar=void 0,this.penState=void 0,this.uchar=h||" ",this.penState=new li(p,S,T,C,v)}var M=O.prototype;return M.reset=function(){this.uchar=" ",this.penState.reset()},M.setChar=function(h,p){this.uchar=h,this.penState.copy(p)},M.setPenState=function(h){this.penState.copy(h)},M.equals=function(h){return this.uchar===h.uchar&&this.penState.equals(h.penState)},M.copy=function(h){this.uchar=h.uchar,this.penState.copy(h.penState)},M.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},O}(),tn=function(){function O(h){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var p=0;p<Pt;p++)this.chars.push(new en);this.logger=h,this.pos=0,this.currPenState=new li}var M=O.prototype;return M.equals=function(h){for(var p=!0,S=0;S<Pt;S++)if(!this.chars[S].equals(h.chars[S])){p=!1;break}return p},M.copy=function(h){for(var p=0;p<Pt;p++)this.chars[p].copy(h.chars[p])},M.isEmpty=function(){for(var h=!0,p=0;p<Pt;p++)if(!this.chars[p].isEmpty()){h=!1;break}return h},M.setCursor=function(h){this.pos!==h&&(this.pos=h),this.pos<0?(this.logger.log(xt.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>Pt&&(this.logger.log(xt.DEBUG,"Too large cursor position "+this.pos),this.pos=Pt)},M.moveCursor=function(h){var p=this.pos+h;if(h>1)for(var S=this.pos+1;S<p+1;S++)this.chars[S].setPenState(this.currPenState);this.setCursor(p)},M.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},M.insertChar=function(h){h>=144&&this.backSpace();var p=Ra(h);this.pos>=Pt?this.logger.log(xt.ERROR,"Cannot insert "+h.toString(16)+" ("+p+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(p,this.currPenState),this.moveCursor(1))},M.clearFromPos=function(h){var p;for(p=h;p<Pt;p++)this.chars[p].reset()},M.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},M.clearToEndOfRow=function(){this.clearFromPos(this.pos)},M.getTextString=function(){for(var h=[],p=!0,S=0;S<Pt;S++){var T=this.chars[S].uchar;T!==" "&&(p=!1),h.push(T)}return p?"":h.join("")},M.setPenStyles=function(h){this.currPenState.setStyles(h),this.chars[this.pos].setPenState(this.currPenState)},O}(),La=function(){function O(h){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var p=0;p<kr;p++)this.rows.push(new tn(h));this.logger=h,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var M=O.prototype;return M.reset=function(){for(var h=0;h<kr;h++)this.rows[h].clear();this.currRow=14},M.equals=function(h){for(var p=!0,S=0;S<kr;S++)if(!this.rows[S].equals(h.rows[S])){p=!1;break}return p},M.copy=function(h){for(var p=0;p<kr;p++)this.rows[p].copy(h.rows[p])},M.isEmpty=function(){for(var h=!0,p=0;p<kr;p++)if(!this.rows[p].isEmpty()){h=!1;break}return h},M.backSpace=function(){this.rows[this.currRow].backSpace()},M.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},M.insertChar=function(h){this.rows[this.currRow].insertChar(h)},M.setPen=function(h){this.rows[this.currRow].setPenStyles(h)},M.moveCursor=function(h){this.rows[this.currRow].moveCursor(h)},M.setCursor=function(h){this.logger.log(xt.INFO,"setCursor: "+h),this.rows[this.currRow].setCursor(h)},M.setPAC=function(h){this.logger.log(xt.INFO,"pacData = "+JSON.stringify(h));var p=h.row-1;if(this.nrRollUpRows&&p<this.nrRollUpRows-1&&(p=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==p){for(var S=0;S<kr;S++)this.rows[S].clear();var T=this.currRow+1-this.nrRollUpRows,C=this.lastOutputScreen;if(C){var v=C.rows[T].cueStartTime,x=this.logger.time;if(v&&x!==null&&v<x)for(var I=0;I<this.nrRollUpRows;I++)this.rows[p-this.nrRollUpRows+I+1].copy(C.rows[T+I])}}this.currRow=p;var R=this.rows[this.currRow];if(h.indent!==null){var U=h.indent,G=Math.max(U-1,0);R.setCursor(h.indent),h.color=R.chars[G].penState.foreground}var ie={foreground:h.color,underline:h.underline,italics:h.italics,background:"black",flash:!1};this.setPen(ie)},M.setBkgData=function(h){this.logger.log(xt.INFO,"bkgData = "+JSON.stringify(h)),this.backSpace(),this.setPen(h),this.insertChar(32)},M.setRollUpRows=function(h){this.nrRollUpRows=h},M.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(xt.TEXT,this.getDisplayText());var h=this.currRow+1-this.nrRollUpRows,p=this.rows.splice(h,1)[0];p.clear(),this.rows.splice(this.currRow,0,p),this.logger.log(xt.INFO,"Rolling up")}else this.logger.log(xt.DEBUG,"roll_up but nrRollUpRows not set yet")},M.getDisplayText=function(h){h=h||!1;for(var p=[],S="",T=-1,C=0;C<kr;C++){var v=this.rows[C].getTextString();v&&(T=C+1,h?p.push("Row "+T+": '"+v+"'"):p.push(v.trim()))}return p.length>0&&(S=h?"["+p.join(" | ")+"]":p.join(`
`)),S},M.getTextAndFormat=function(){return this.rows},O}(),Hr=function(){function O(h,p,S){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=h,this.outputFilter=p,this.mode=null,this.verbose=0,this.displayedMemory=new La(S),this.nonDisplayedMemory=new La(S),this.lastOutputScreen=new La(S),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=S}var M=O.prototype;return M.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},M.getHandler=function(){return this.outputFilter},M.setHandler=function(h){this.outputFilter=h},M.setPAC=function(h){this.writeScreen.setPAC(h)},M.setBkgData=function(h){this.writeScreen.setBkgData(h)},M.setMode=function(h){h!==this.mode&&(this.mode=h,this.logger.log(xt.INFO,"MODE="+h),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=h)},M.insertChars=function(h){for(var p=0;p<h.length;p++)this.writeScreen.insertChar(h[p]);var S=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(xt.INFO,S+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(xt.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},M.ccRCL=function(){this.logger.log(xt.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},M.ccBS=function(){this.logger.log(xt.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},M.ccAOF=function(){},M.ccAON=function(){},M.ccDER=function(){this.logger.log(xt.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},M.ccRU=function(h){this.logger.log(xt.INFO,"RU("+h+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(h)},M.ccFON=function(){this.logger.log(xt.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},M.ccRDC=function(){this.logger.log(xt.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},M.ccTR=function(){this.logger.log(xt.INFO,"TR"),this.setMode("MODE_TEXT")},M.ccRTD=function(){this.logger.log(xt.INFO,"RTD"),this.setMode("MODE_TEXT")},M.ccEDM=function(){this.logger.log(xt.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},M.ccCR=function(){this.logger.log(xt.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},M.ccENM=function(){this.logger.log(xt.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},M.ccEOC=function(){if(this.logger.log(xt.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var h=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=h,this.writeScreen=this.nonDisplayedMemory,this.logger.log(xt.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},M.ccTO=function(h){this.logger.log(xt.INFO,"TO("+h+") - Tab Offset"),this.writeScreen.moveCursor(h)},M.ccMIDROW=function(h){var p={flash:!1};if(p.underline=h%2==1,p.italics=h>=46,p.italics)p.foreground="white";else{var S=Math.floor(h/2)-16;p.foreground=["white","green","blue","cyan","red","yellow","magenta"][S]}this.logger.log(xt.INFO,"MIDROW: "+JSON.stringify(p)),this.writeScreen.setPen(p)},M.outputDataUpdate=function(h){h===void 0&&(h=!1);var p=this.logger.time;p!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,p,this.lastOutputScreen),h&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:p):this.cueStartTime=p,this.lastOutputScreen.copy(this.displayedMemory))},M.cueSplitAtTime=function(h){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,h,this.displayedMemory),this.cueStartTime=h))},O}(),va=function(){function O(h,p,S){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var T=new Zi;this.channels=[null,new Hr(h,p,T),new Hr(h+1,S,T)],this.cmdHistory={a:null,b:null},this.logger=T}var M=O.prototype;return M.getHandler=function(h){return this.channels[h].getHandler()},M.setHandler=function(h,p){this.channels[h].setHandler(p)},M.addData=function(h,p){var S,T,C,v=!1;this.logger.time=h;for(var x=0;x<p.length;x+=2)if(T=127&p[x],C=127&p[x+1],T!==0||C!==0){if(this.logger.log(xt.DATA,"["+wr([p[x],p[x+1]])+"] -> ("+wr([T,C])+")"),(S=this.parseCmd(T,C))||(S=this.parseMidrow(T,C)),S||(S=this.parsePAC(T,C)),S||(S=this.parseBackgroundAttributes(T,C)),!S&&(v=this.parseChars(T,C))){var I=this.currentChannel;I&&I>0?this.channels[I].insertChars(v):this.logger.log(xt.WARNING,"No channel found yet. TEXT-MODE?")}S||v||this.logger.log(xt.WARNING,"Couldn't parse cleaned data "+wr([T,C])+" orig: "+wr([p[x],p[x+1]]))}},M.parseCmd=function(h,p){var S=this.cmdHistory;if(!((h===20||h===28||h===21||h===29)&&p>=32&&p<=47||(h===23||h===31)&&p>=33&&p<=35))return!1;if(ui(h,p,S))return Dr(null,null,S),this.logger.log(xt.DEBUG,"Repeated command ("+wr([h,p])+") is dropped"),!0;var T=h===20||h===21||h===23?1:2,C=this.channels[T];return h===20||h===21||h===28||h===29?p===32?C.ccRCL():p===33?C.ccBS():p===34?C.ccAOF():p===35?C.ccAON():p===36?C.ccDER():p===37?C.ccRU(2):p===38?C.ccRU(3):p===39?C.ccRU(4):p===40?C.ccFON():p===41?C.ccRDC():p===42?C.ccTR():p===43?C.ccRTD():p===44?C.ccEDM():p===45?C.ccCR():p===46?C.ccENM():p===47&&C.ccEOC():C.ccTO(p-32),Dr(h,p,S),this.currentChannel=T,!0},M.parseMidrow=function(h,p){var S=0;if((h===17||h===25)&&p>=32&&p<=47){if((S=h===17?1:2)!==this.currentChannel)return this.logger.log(xt.ERROR,"Mismatch channel in midrow parsing"),!1;var T=this.channels[S];return!!T&&(T.ccMIDROW(p),this.logger.log(xt.DEBUG,"MIDROW ("+wr([h,p])+")"),!0)}return!1},M.parsePAC=function(h,p){var S,T=this.cmdHistory;if(!((h>=17&&h<=23||h>=25&&h<=31)&&p>=64&&p<=127||(h===16||h===24)&&p>=64&&p<=95))return!1;if(ui(h,p,T))return Dr(null,null,T),!0;var C=h<=23?1:2;S=p>=64&&p<=95?C===1?Yi[h]:Qi[h]:C===1?si[h]:Ji[h];var v=this.channels[C];return!!v&&(v.setPAC(this.interpretPAC(S,p)),Dr(h,p,T),this.currentChannel=C,!0)},M.interpretPAC=function(h,p){var S,T={color:null,italics:!1,indent:null,underline:!1,row:h};return S=p>95?p-96:p-64,T.underline=(1&S)==1,S<=13?T.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(S/2)]:S<=15?(T.italics=!0,T.color="white"):T.indent=4*Math.floor((S-16)/2),T},M.parseChars=function(h,p){var S,T,C=null,v=null;if(h>=25?(S=2,v=h-8):(S=1,v=h),v>=17&&v<=19?(T=v===17?p+80:v===18?p+112:p+144,this.logger.log(xt.INFO,"Special char '"+Ra(T)+"' in channel "+S),C=[T]):h>=32&&h<=127&&(C=p===0?[h]:[h,p]),C){var x=wr(C);this.logger.log(xt.DEBUG,"Char codes =  "+x.join(",")),Dr(h,p,this.cmdHistory)}return C},M.parseBackgroundAttributes=function(h,p){var S;if(!((h===16||h===24)&&p>=32&&p<=47||(h===23||h===31)&&p>=45&&p<=47))return!1;var T={};h===16||h===24?(S=Math.floor((p-32)/2),T.background=oi[S],p%2==1&&(T.background=T.background+"_semi")):p===45?T.background="transparent":(T.foreground="black",p===47&&(T.underline=!0));var C=h<=23?1:2;return this.channels[C].setBkgData(T),Dr(h,p,this.cmdHistory),!0},M.reset=function(){for(var h=0;h<Object.keys(this.channels).length;h++){var p=this.channels[h];p&&p.reset()}this.cmdHistory={a:null,b:null}},M.cueSplitAtTime=function(h){for(var p=0;p<this.channels.length;p++){var S=this.channels[p];S&&S.cueSplitAtTime(h)}},O}();function Dr(O,M,h){h.a=O,h.b=M}function ui(O,M,h){return h.a===O&&h.b===M}let ra=va;var _a=function(){function O(h,p){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=h,this.trackName=p}var M=O.prototype;return M.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},M.newCue=function(h,p,S){(this.startTime===null||this.startTime>h)&&(this.startTime=h),this.endTime=p,this.screen=S,this.timelineController.createCaptionsTrack(this.trackName)},M.reset=function(){this.cueRanges=[],this.startTime=null},O}();let Kr=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var O=["","lr","rl"],M=["start","middle","end","left","right"];function h(C,v){if(typeof v!="string"||!Array.isArray(C))return!1;var x=v.toLowerCase();return!!~C.indexOf(x)&&x}function p(C){return h(M,C)}function S(C){for(var v=arguments.length,x=new Array(v>1?v-1:0),I=1;I<v;I++)x[I-1]=arguments[I];for(var R=1;R<arguments.length;R++){var U=arguments[R];for(var G in U)C[G]=U[G]}return C}function T(C,v,x){var I=this,R={enumerable:!0};I.hasBeenReset=!1;var U="",G=!1,ie=C,le=v,he=x,Te=null,Ee="",je=!0,Ve="auto",Ne="start",Re=50,He="middle",Le=50,Je="middle";Object.defineProperty(I,"id",S({},R,{get:function(){return U},set:function(Ye){U=""+Ye}})),Object.defineProperty(I,"pauseOnExit",S({},R,{get:function(){return G},set:function(Ye){G=!!Ye}})),Object.defineProperty(I,"startTime",S({},R,{get:function(){return ie},set:function(Ye){if(typeof Ye!="number")throw new TypeError("Start time must be set to a number.");ie=Ye,this.hasBeenReset=!0}})),Object.defineProperty(I,"endTime",S({},R,{get:function(){return le},set:function(Ye){if(typeof Ye!="number")throw new TypeError("End time must be set to a number.");le=Ye,this.hasBeenReset=!0}})),Object.defineProperty(I,"text",S({},R,{get:function(){return he},set:function(Ye){he=""+Ye,this.hasBeenReset=!0}})),Object.defineProperty(I,"region",S({},R,{get:function(){return Te},set:function(Ye){Te=Ye,this.hasBeenReset=!0}})),Object.defineProperty(I,"vertical",S({},R,{get:function(){return Ee},set:function(Ye){var ht=function(pt){return h(O,pt)}(Ye);if(ht===!1)throw new SyntaxError("An invalid or illegal string was specified.");Ee=ht,this.hasBeenReset=!0}})),Object.defineProperty(I,"snapToLines",S({},R,{get:function(){return je},set:function(Ye){je=!!Ye,this.hasBeenReset=!0}})),Object.defineProperty(I,"line",S({},R,{get:function(){return Ve},set:function(Ye){if(typeof Ye!="number"&&Ye!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");Ve=Ye,this.hasBeenReset=!0}})),Object.defineProperty(I,"lineAlign",S({},R,{get:function(){return Ne},set:function(Ye){var ht=p(Ye);if(!ht)throw new SyntaxError("An invalid or illegal string was specified.");Ne=ht,this.hasBeenReset=!0}})),Object.defineProperty(I,"position",S({},R,{get:function(){return Re},set:function(Ye){if(Ye<0||Ye>100)throw new Error("Position must be between 0 and 100.");Re=Ye,this.hasBeenReset=!0}})),Object.defineProperty(I,"positionAlign",S({},R,{get:function(){return He},set:function(Ye){var ht=p(Ye);if(!ht)throw new SyntaxError("An invalid or illegal string was specified.");He=ht,this.hasBeenReset=!0}})),Object.defineProperty(I,"size",S({},R,{get:function(){return Le},set:function(Ye){if(Ye<0||Ye>100)throw new Error("Size must be between 0 and 100.");Le=Ye,this.hasBeenReset=!0}})),Object.defineProperty(I,"align",S({},R,{get:function(){return Je},set:function(Ye){var ht=p(Ye);if(!ht)throw new SyntaxError("An invalid or illegal string was specified.");Je=ht,this.hasBeenReset=!0}})),I.displayState=void 0}return T.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},T}();var rn=function(){function O(){}return O.prototype.decode=function(M,h){if(!M)return"";if(typeof M!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(M))},O}();function di(O){function M(p,S,T,C){return 3600*(0|p)+60*(0|S)+(0|T)+parseFloat(C||0)}var h=O.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return h?parseFloat(h[2])>59?M(h[2],h[3],0,h[4]):M(h[1],h[2],h[3],h[4]):null}var an=function(){function O(){this.values=Object.create(null)}var M=O.prototype;return M.set=function(h,p){this.get(h)||p===""||(this.values[h]=p)},M.get=function(h,p,S){return S?this.has(h)?this.values[h]:p[S]:this.has(h)?this.values[h]:p},M.has=function(h){return h in this.values},M.alt=function(h,p,S){for(var T=0;T<S.length;++T)if(p===S[T]){this.set(h,p);break}},M.integer=function(h,p){/^-?\d+$/.test(p)&&this.set(h,parseInt(p,10))},M.percent=function(h,p){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(p)){var S=parseFloat(p);if(S>=0&&S<=100)return this.set(h,S),!0}return!1},O}();function Wr(O,M,h,p){var S=p?O.split(p):[O];for(var T in S)if(typeof S[T]=="string"){var C=S[T].split(h);C.length===2&&M(C[0],C[1])}}var Sr=new Kr(0,0,""),Rr=Sr.align==="middle"?"middle":"center";function Lr(O,M,h){var p=O;function S(){var C=di(O);if(C===null)throw new Error("Malformed timestamp: "+p);return O=O.replace(/^[^\sa-zA-Z-]+/,""),C}function T(){O=O.replace(/^\s+/,"")}if(T(),M.startTime=S(),T(),O.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+p);O=O.slice(3),T(),M.endTime=S(),T(),function(C,v){var x=new an;Wr(C,function(U,G){var ie;switch(U){case"region":for(var le=h.length-1;le>=0;le--)if(h[le].id===G){x.set(U,h[le].region);break}break;case"vertical":x.alt(U,G,["rl","lr"]);break;case"line":ie=G.split(","),x.integer(U,ie[0]),x.percent(U,ie[0])&&x.set("snapToLines",!1),x.alt(U,ie[0],["auto"]),ie.length===2&&x.alt("lineAlign",ie[1],["start",Rr,"end"]);break;case"position":ie=G.split(","),x.percent(U,ie[0]),ie.length===2&&x.alt("positionAlign",ie[1],["start",Rr,"end","line-left","line-right","auto"]);break;case"size":x.percent(U,G);break;case"align":x.alt(U,G,["start",Rr,"end","left","right"])}},/:/,/\s/),v.region=x.get("region",null),v.vertical=x.get("vertical","");var I=x.get("line","auto");I==="auto"&&Sr.line===-1&&(I=-1),v.line=I,v.lineAlign=x.get("lineAlign","start"),v.snapToLines=x.get("snapToLines",!0),v.size=x.get("size",100),v.align=x.get("align",Rr);var R=x.get("position","auto");R==="auto"&&Sr.position===50&&(R=v.align==="start"||v.align==="left"?0:v.align==="end"||v.align==="right"?100:50),v.position=R}(O,M)}function hi(O){return O.replace(/<br(?: \/)?>/gi,`
`)}var ci=function(){function O(){this.state="INITIAL",this.buffer="",this.decoder=new rn,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var M=O.prototype;return M.parse=function(h){var p=this;function S(){var I=p.buffer,R=0;for(I=hi(I);R<I.length&&I[R]!=="\r"&&I[R]!==`
`;)++R;var U=I.slice(0,R);return I[R]==="\r"&&++R,I[R]===`
`&&++R,p.buffer=I.slice(R),U}h&&(p.buffer+=p.decoder.decode(h,{stream:!0}));try{var T="";if(p.state==="INITIAL"){if(!/\r\n|\n/.test(p.buffer))return this;var C=(T=S()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!C||!C[0])throw new Error("Malformed WebVTT signature.");p.state="HEADER"}for(var v=!1;p.buffer;){if(!/\r\n|\n/.test(p.buffer))return this;switch(v?v=!1:T=S(),p.state){case"HEADER":/:/.test(T)?Wr(T,function(I,R){},/:/):T||(p.state="ID");continue;case"NOTE":T||(p.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(T)){p.state="NOTE";break}if(!T)continue;if(p.cue=new Kr(0,0,""),p.state="CUE",T.indexOf("-->")===-1){p.cue.id=T;continue}case"CUE":if(!p.cue){p.state="BADCUE";continue}try{Lr(T,p.cue,p.regionList)}catch{p.cue=null,p.state="BADCUE";continue}p.state="CUETEXT";continue;case"CUETEXT":var x=T.indexOf("-->")!==-1;if(!T||x&&(v=!0)){p.oncue&&p.cue&&p.oncue(p.cue),p.cue=null,p.state="ID";continue}if(p.cue===null)continue;p.cue.text&&(p.cue.text+=`
`),p.cue.text+=T;continue;case"BADCUE":T||(p.state="ID")}}}catch{p.state==="CUETEXT"&&p.cue&&p.oncue&&p.oncue(p.cue),p.cue=null,p.state=p.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},M.flush=function(){var h=this;try{if((h.cue||h.state==="HEADER")&&(h.buffer+=`

`,h.parse()),h.state==="INITIAL"||h.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(p){h.onparsingerror&&h.onparsingerror(p)}return h.onflush&&h.onflush(),this},O}(),Oa=l(673),Ua=l(524),Na=/\r\n|\n\r|\n|\r/g,Fa=function(O,M,h){return h===void 0&&(h=0),O.slice(h,h+M.length)===M},Ba=function(O){for(var M=5381,h=O.length;h;)M=33*M^O.charCodeAt(--h);return(M>>>0).toString()};function $a(O,M,h){return Ba(O.toString())+Ba(M.toString())+Ba(h)}function ja(){return ja=Object.assign?Object.assign.bind():function(O){for(var M=1;M<arguments.length;M++){var h=arguments[M];for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(O[p]=h[p])}return O},ja.apply(this,arguments)}var Va="stpp.ttml.im1t",pi=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,fi=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,nn={left:"start",center:"center",right:"end",start:"start",end:"end"};function gi(O,M,h,p,S){var T=(0,B.findBox)(new Uint8Array(O),["mdat"]);if(T.length!==0){var C=T.map(function(x){return(0,ue.utf8ArrayToStr)(x)}),v=(0,Oa.toTimescaleFromScale)(M,1,h);try{C.forEach(function(x){return p(function(I,R){var U=new DOMParser().parseFromString(I,"text/xml").getElementsByTagName("tt")[0];if(!U)throw new Error("Invalid ttml");var G={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},ie=Object.keys(G).reduce(function(je,Ve){return je[Ve]=U.getAttribute("ttp:"+Ve)||G[Ve],je},{}),le=U.getAttribute("xml:space")!=="preserve",he=wt(Ga(U,"styling","style")),Te=wt(Ga(U,"layout","region")),Ee=Ga(U,"body","[begin]");return[].map.call(Ee,function(je){var Ve=ar(je,le);if(!Ve||!je.hasAttribute("begin"))return null;var Ne=Ha(je.getAttribute("begin"),ie),Re=Ha(je.getAttribute("dur"),ie),He=Ha(je.getAttribute("end"),ie);if(Ne===null)throw mi(je);if(He===null){if(Re===null)throw mi(je);He=Ne+Re}var Le=new Kr(Ne-R,He-R,Ve);Le.id=$a(Le.startTime,Le.endTime,Le.text);var Je=Te[je.getAttribute("region")],Ye=he[je.getAttribute("style")];Le.position=10,Le.size=80;var ht=function(It,_t,Et){var Dt="http://www.w3.org/ns/ttml#styling",Ft=null,er=It!=null&&It.hasAttribute("style")?It.getAttribute("style"):null;return er&&Et.hasOwnProperty(er)&&(Ft=Et[er]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(j,g){var _=aa(_t,Dt,g)||aa(It,Dt,g)||aa(Ft,Dt,g);return _&&(j[g]=_),j},{})}(Je,Ye,he),pt=ht.textAlign;if(pt){var kt=nn[pt];kt&&(Le.lineAlign=kt),Le.align=pt}return ja(Le,ht),Le}).filter(function(je){return je!==null})}(x,v))})}catch(x){S(x)}}else S(new Error("Could not parse IMSC1 mdat"))}function Ga(O,M,h){var p=O.getElementsByTagName(M)[0];return p?[].slice.call(p.querySelectorAll(h)):[]}function wt(O){return O.reduce(function(M,h){var p=h.getAttribute("xml:id");return p&&(M[p]=h),M},{})}function ar(O,M){return[].slice.call(O.childNodes).reduce(function(h,p,S){var T;return p.nodeName==="br"&&S?h+`
`:(T=p.childNodes)!==null&&T!==void 0&&T.length?ar(p,M):M?h+p.textContent.trim().replace(/\s+/g," "):h+p.textContent},"")}function aa(O,M,h){return O&&O.hasAttributeNS(M,h)?O.getAttributeNS(M,h):null}function mi(O){return new Error("Could not parse ttml timestamp "+O)}function Ha(O,M){if(!O)return null;var h=di(O);return h===null&&(pi.test(O)?h=function(p,S){var T=pi.exec(p),C=(0|T[4])+(0|T[5])/S.subFrameRate;return 3600*(0|T[1])+60*(0|T[2])+(0|T[3])+C/S.frameRate}(O,M):fi.test(O)&&(h=function(p,S){var T=fi.exec(p),C=Number(T[1]);switch(T[2]){case"h":return 3600*C;case"m":return 60*C;case"ms":return 1e3*C;case"f":return C/S.frameRate;case"t":return C/S.tickRate}return C}(O,M))),h}var yi=function(){function O(h){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=h,this.config=h.config,this.Cues=h.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var p=new _a(this,"textTrack1"),S=new _a(this,"textTrack2"),T=new _a(this,"textTrack3"),C=new _a(this,"textTrack4");this.cea608Parser1=new ra(1,p,S),this.cea608Parser2=new ra(3,T,C)}h.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.on(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.on(y.Events.FRAG_LOADING,this.onFragLoading,this),h.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),h.on(y.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),h.on(y.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),h.on(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),h.on(y.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),h.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var M=O.prototype;return M.destroy=function(){var h=this.hls;h.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.off(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.off(y.Events.FRAG_LOADING,this.onFragLoading,this),h.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),h.off(y.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),h.off(y.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),h.off(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),h.off(y.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),h.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},M.addCues=function(h,p,S,T,C){for(var v,x,I,R,U=!1,G=C.length;G--;){var ie=C[G],le=(v=ie[0],x=ie[1],I=p,R=S,Math.min(x,R)-Math.max(v,I));if(le>=0&&(ie[0]=Math.min(ie[0],p),ie[1]=Math.max(ie[1],S),U=!0,le/(S-p)>.5))return}if(U||C.push([p,S]),this.config.renderTextTracksNatively){var he=this.captionsTracks[h];this.Cues.newCue(he,p,S,T)}else{var Te=this.Cues.newCue(null,p,S,T);this.hls.trigger(y.Events.CUES_PARSED,{type:"captions",cues:Te,track:h})}},M.onInitPtsFound=function(h,p){var S=this,T=p.frag,C=p.id,v=p.initPTS,x=p.timescale,I=this.unparsedVttFrags;C==="main"&&(this.initPTS[T.cc]=v,this.timescale[T.cc]=x),I.length&&(this.unparsedVttFrags=[],I.forEach(function(R){S.onFragLoaded(y.Events.FRAG_LOADED,R)}))},M.getExistingTrack=function(h){var p=this.media;if(p)for(var S=0;S<p.textTracks.length;S++){var T=p.textTracks[S];if(T[h])return T}return null},M.createCaptionsTrack=function(h){this.config.renderTextTracksNatively?this.createNativeTrack(h):this.createNonNativeTrack(h)},M.createNativeTrack=function(h){if(!this.captionsTracks[h]){var p=this.captionsProperties,S=this.captionsTracks,T=this.media,C=p[h],v=C.label,x=C.languageCode,I=this.getExistingTrack(h);if(I)S[h]=I,Fe(S[h]),nt(S[h],T);else{var R=this.createTextTrack("captions",v,x);R&&(R[h]=!0,S[h]=R)}}},M.createNonNativeTrack=function(h){if(!this.nonNativeCaptionsTracks[h]){var p=this.captionsProperties[h];if(p){var S={_id:h,label:p.label,kind:"captions",default:!!p.media&&!!p.media.default,closedCaptions:p.media};this.nonNativeCaptionsTracks[h]=S,this.hls.trigger(y.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[S]})}}},M.createTextTrack=function(h,p,S){var T=this.media;if(T)return T.addTextTrack(h,p,S)},M.onMediaAttaching=function(h,p){this.media=p.media,this._cleanTracks()},M.onMediaDetaching=function(){var h=this.captionsTracks;Object.keys(h).forEach(function(p){Fe(h[p]),delete h[p]}),this.nonNativeCaptionsTracks={}},M.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},M._cleanTracks=function(){var h=this.media;if(h){var p=h.textTracks;if(p)for(var S=0;S<p.length;S++)Fe(p[S])}},M.onSubtitleTracksUpdated=function(h,p){var S=this;this.textTracks=[];var T=p.subtitleTracks||[],C=T.some(function(R){return R.textCodec===Va});if(this.config.enableWebVTT||C&&this.config.enableIMSC1){var v=this.tracks&&T&&this.tracks.length===T.length;if(this.tracks=T||[],this.config.renderTextTracksNatively){var x=this.media?this.media.textTracks:[];this.tracks.forEach(function(R,U){var G;if(U<x.length){for(var ie=null,le=0;le<x.length;le++)if(sn(x[le],R)){ie=x[le];break}ie&&(G=ie)}if(G)Fe(G);else{var he=S._captionsOrSubtitlesFromCharacteristics(R);(G=S.createTextTrack(he,R.name,R.lang))&&(G.mode="disabled")}G&&(G.groupId=R.groupId,S.textTracks.push(G))})}else if(!v&&this.tracks&&this.tracks.length){var I=this.tracks.map(function(R){return{label:R.name,kind:R.type.toLowerCase(),default:R.default,subtitleTrack:R}});this.hls.trigger(y.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:I})}}},M._captionsOrSubtitlesFromCharacteristics=function(h){var p;if((p=h.attrs)!==null&&p!==void 0&&p.CHARACTERISTICS){var S=/transcribes-spoken-dialog/gi.test(h.attrs.CHARACTERISTICS),T=/describes-music-and-sound/gi.test(h.attrs.CHARACTERISTICS);if(S&&T)return"captions"}return"subtitles"},M.onManifestLoaded=function(h,p){var S=this;this.config.enableCEA708Captions&&p.captions&&p.captions.forEach(function(T){var C=/(?:CC|SERVICE)([1-4])/.exec(T.instreamId);if(C){var v="textTrack"+C[1],x=S.captionsProperties[v];x&&(x.label=T.name,T.lang&&(x.languageCode=T.lang),x.media=T)}})},M.closedCaptionsForLevel=function(h){var p=this.hls.levels[h.level];return p?.attrs["CLOSED-CAPTIONS"]},M.onFragLoading=function(h,p){var S=this.cea608Parser1,T=this.cea608Parser2,C=this.lastSn,v=this.lastPartIndex;if(this.enabled&&S&&T&&p.frag.type===ke.PlaylistLevelType.MAIN){var x,I,R=p.frag.sn,U=(x=p==null||(I=p.part)===null||I===void 0?void 0:I.index)!=null?x:-1;R===C+1||R===C&&U===v+1||(S.reset(),T.reset()),this.lastSn=R,this.lastPartIndex=U}},M.onFragLoaded=function(h,p){var S=p.frag,T=p.payload,C=this.initPTS,v=this.unparsedVttFrags;if(S.type===ke.PlaylistLevelType.SUBTITLE)if(T.byteLength){if(!(0,E.isFiniteNumber)(C[S.cc]))return v.push(p),void(C.length&&this.hls.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:S,error:new Error("Missing initial subtitle PTS")}));var x=S.decryptdata,I="stats"in p;if(x==null||x.key==null||x.method!=="AES-128"||I){var R=this.tracks[S.level],U=this.vttCCs;U[S.cc]||(U[S.cc]={start:S.start,prevCC:this.prevCC,new:!0},this.prevCC=S.cc),R&&R.textCodec===Va?this._parseIMSC1(S,T):this._parseVTTs(S,T,U)}}else this.hls.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:S,error:new Error("Empty subtitle payload")})},M._parseIMSC1=function(h,p){var S=this,T=this.hls;gi(p,this.initPTS[h.cc],this.timescale[h.cc],function(C){S._appendCues(C,h.level),T.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:h})},function(C){w.logger.log("Failed to parse IMSC1: "+C),T.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h,error:C})})},M._parseVTTs=function(h,p,S){var T,C=this,v=this.hls;(function(x,I,R,U,G,ie,le,he){var Te,Ee=new ci,je=(0,ue.utf8ArrayToStr)(new Uint8Array(x)).trim().replace(Na,`
`).split(`
`),Ve=[],Ne=(0,Oa.toMpegTsClockFromTimescale)(I,R),Re="00:00.000",He=0,Le=0,Je=!0;Ee.oncue=function(Ye){var ht=U[G],pt=U.ccOffset,kt=(He-Ne)/9e4;ht!=null&&ht.new&&(Le!==void 0?pt=U.ccOffset=ht.start:function(Dt,Ft,er){var j=Dt[Ft],g=Dt[j.prevCC];if(!g||!g.new&&j.new)return Dt.ccOffset=Dt.presentationOffset=j.start,void(j.new=!1);for(;(_=g)!==null&&_!==void 0&&_.new;){var _;Dt.ccOffset+=j.start-g.start,j.new=!1,g=Dt[(j=g).prevCC]}Dt.presentationOffset=er}(U,G,kt)),kt&&(pt=kt-U.presentationOffset);var It=Ye.endTime-Ye.startTime,_t=(0,Ua.normalizePts)(9e4*(Ye.startTime+pt-Le),9e4*ie)/9e4;Ye.startTime=Math.max(_t,0),Ye.endTime=Math.max(_t+It,0);var Et=Ye.text.trim();Ye.text=decodeURIComponent(encodeURIComponent(Et)),Ye.id||(Ye.id=$a(Ye.startTime,Ye.endTime,Et)),Ye.endTime>0&&Ve.push(Ye)},Ee.onparsingerror=function(Ye){Te=Ye},Ee.onflush=function(){Te?he(Te):le(Ve)},je.forEach(function(Ye){if(Je){if(Fa(Ye,"X-TIMESTAMP-MAP=")){Je=!1,Ye.slice(16).split(",").forEach(function(ht){Fa(ht,"LOCAL:")?Re=ht.slice(6):Fa(ht,"MPEGTS:")&&(He=parseInt(ht.slice(7)))});try{Le=function(ht){var pt=parseInt(ht.slice(-3)),kt=parseInt(ht.slice(-6,-4)),It=parseInt(ht.slice(-9,-7)),_t=ht.length>9?parseInt(ht.substring(0,ht.indexOf(":"))):0;if(!((0,E.isFiniteNumber)(pt)&&(0,E.isFiniteNumber)(kt)&&(0,E.isFiniteNumber)(It)&&(0,E.isFiniteNumber)(_t)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+ht);return pt+=1e3*kt,(pt+=6e4*It)+36e5*_t}(Re)/1e3}catch(ht){Te=ht}return}Ye===""&&(Je=!1)}Ee.parse(Ye+`
`)}),Ee.flush()})((T=h.initSegment)!==null&&T!==void 0&&T.data?(0,B.appendUint8Array)(h.initSegment.data,new Uint8Array(p)):p,this.initPTS[h.cc],this.timescale[h.cc],S,h.cc,h.start,function(x){C._appendCues(x,h.level),v.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:h})},function(x){C._fallbackToIMSC1(h,p),w.logger.log("Failed to parse VTT cue: "+x),v.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h,error:x})})},M._fallbackToIMSC1=function(h,p){var S=this,T=this.tracks[h.level];T.textCodec||gi(p,this.initPTS[h.cc],this.timescale[h.cc],function(){T.textCodec=Va,S._parseIMSC1(h,p)},function(){T.textCodec="wvtt"})},M._appendCues=function(h,p){var S=this.hls;if(this.config.renderTextTracksNatively){var T=this.textTracks[p];if(!T||T.mode==="disabled")return;h.forEach(function(x){return Be(T,x)})}else{var C=this.tracks[p];if(!C)return;var v=C.default?"default":"subtitles"+p;S.trigger(y.Events.CUES_PARSED,{type:"subtitles",cues:h,track:v})}},M.onFragDecrypted=function(h,p){var S=p.frag;if(S.type===ke.PlaylistLevelType.SUBTITLE){if(!(0,E.isFiniteNumber)(this.initPTS[S.cc]))return void this.unparsedVttFrags.push(p);this.onFragLoaded(y.Events.FRAG_LOADED,p)}},M.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},M.onFragParsingUserdata=function(h,p){var S=this.cea608Parser1,T=this.cea608Parser2;if(this.enabled&&S&&T){var C=p.frag,v=p.samples;if(C.type!==ke.PlaylistLevelType.MAIN||this.closedCaptionsForLevel(C)!=="NONE")for(var x=0;x<v.length;x++){var I=v[x].bytes;if(I){var R=this.extractCea608Data(I);S.addData(v[x].pts,R[0]),T.addData(v[x].pts,R[1])}}}},M.onBufferFlushing=function(h,p){var S=p.startOffset,T=p.endOffset,C=p.endOffsetSubtitles,v=p.type,x=this.media;if(x&&!(x.currentTime<T)){if(!v||v==="video"){var I=this.captionsTracks;Object.keys(I).forEach(function(U){return J(I[U],S,T)})}if(this.config.renderTextTracksNatively&&S===0&&C!==void 0){var R=this.textTracks;Object.keys(R).forEach(function(U){return J(R[U],S,C)})}}},M.extractCea608Data=function(h){for(var p=[[],[]],S=31&h[0],T=2,C=0;C<S;C++){var v=h[T++],x=127&h[T++],I=127&h[T++];if((x!==0||I!==0)&&4&v){var R=3&v;R!==0&&R!==1||(p[R].push(x),p[R].push(I))}}return p},O}();function sn(O,M){return O&&O.label===M.name&&!(O.textTrack1||O.textTrack2)}function ka(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}let Ea=function(){function O(S){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=S,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var M,h,p=O.prototype;return p.setStreamController=function(S){this.streamController=S},p.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},p.registerListeners=function(){var S=this.hls;S.on(y.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),S.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),S.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),S.on(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),S.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},p.unregisterListener=function(){var S=this.hls;S.off(y.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),S.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),S.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),S.off(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),S.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},p.onFpsDropLevelCapping=function(S,T){O.isLevelAllowed(T.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(T.droppedLevel)},p.onMediaAttaching=function(S,T){this.media=T.media instanceof HTMLVideoElement?T.media:null},p.onManifestParsed=function(S,T){var C=this.hls;this.restrictedLevels=[],this.firstLevel=T.firstLevel,C.config.capLevelToPlayerSize&&T.video&&this.startCapping()},p.onBufferCodecs=function(S,T){this.hls.config.capLevelToPlayerSize&&T.video&&this.startCapping()},p.onMediaDetaching=function(){this.stopCapping()},p.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var S=this.hls.levels;if(S.length){var T=this.hls;T.autoLevelCapping=this.getMaxLevel(S.length-1),T.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=T.autoLevelCapping}}},p.getMaxLevel=function(S){var T=this,C=this.hls.levels;if(!C.length)return-1;var v=C.filter(function(x,I){return O.isLevelAllowed(I,T.restrictedLevels)&&I<=S});return this.clientRect=null,O.getMaxLevelByMediaSize(v,this.mediaWidth,this.mediaHeight)},p.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},p.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},p.getDimensions=function(){if(this.clientRect)return this.clientRect;var S=this.media,T={width:0,height:0};if(S){var C=S.getBoundingClientRect();T.width=C.width,T.height=C.height,T.width||T.height||(T.width=C.right-C.left||S.width||0,T.height=C.bottom-C.top||S.height||0)}return this.clientRect=T,T},O.isLevelAllowed=function(S,T){return T===void 0&&(T=[]),T.indexOf(S)===-1},O.getMaxLevelByMediaSize=function(S,T,C){if(!S||!S.length)return-1;for(var v,x,I=S.length-1,R=0;R<S.length;R+=1){var U=S[R];if((U.width>=T||U.height>=C)&&(v=U,!(x=S[R+1])||v.width!==x.width||v.height!==x.height)){I=R;break}}return I},M=O,(h=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var S=1;if(!this.hls.config.ignoreDevicePixelRatio)try{S=self.devicePixelRatio}catch{}return S}}])&&ka(M.prototype,h),Object.defineProperty(M,"prototype",{writable:!1}),O}(),Sa=function(){function O(h){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=h,this.registerListeners()}var M=O.prototype;return M.setStreamController=function(h){this.streamController=h},M.registerListeners=function(){this.hls.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},M.unregisterListeners=function(){this.hls.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching)},M.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},M.onMediaAttaching=function(h,p){var S=this.hls.config;if(S.capLevelOnFPSDrop){var T=p.media instanceof self.HTMLVideoElement?p.media:null;this.media=T,T&&typeof T.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},M.checkFPS=function(h,p,S){var T=performance.now();if(p){if(this.lastTime){var C=T-this.lastTime,v=S-this.lastDroppedFrames,x=p-this.lastDecodedFrames,I=1e3*v/C,R=this.hls;if(R.trigger(y.Events.FPS_DROP,{currentDropped:v,currentDecoded:x,totalDroppedFrames:S}),I>0&&v>R.config.fpsDroppedMonitoringThreshold*x){var U=R.currentLevel;w.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+U),U>0&&(R.autoLevelCapping===-1||R.autoLevelCapping>=U)&&(U-=1,R.trigger(y.Events.FPS_DROP_LEVEL_CAPPING,{level:U,droppedLevel:R.currentLevel}),R.autoLevelCapping=U,this.streamController.nextLevelSwitch())}}this.lastTime=T,this.lastDroppedFrames=S,this.lastDecodedFrames=p}},M.checkFPSInterval=function(){var h=this.media;if(h)if(this.isVideoPlaybackQualityAvailable){var p=h.getVideoPlaybackQuality();this.checkFPS(h,p.totalVideoFrames,p.droppedVideoFrames)}else this.checkFPS(h,h.webkitDecodedFrameCount,h.webkitDroppedFrameCount)},O}();var Tr;(function(O){O.WIDEVINE="com.widevine.alpha",O.PLAYREADY="com.microsoft.playready"})(Tr||(Tr={}));var vi=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function _i(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}let on=function(){function O(S){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=S,this._config=S.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var M,h,p=O.prototype;return p.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},p._registerListeners=function(){this.hls.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this)},p._unregisterListeners=function(){this.hls.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this)},p.getLicenseServerUrl=function(S){switch(S){case Tr.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+S+'"')},p._attemptKeySystemAccess=function(S,T,C){var v=this,x=function(R,U,G,ie){if(R===Tr.WIDEVINE)return function(le,he,Te){var Ee={audioCapabilities:[],videoCapabilities:[]};return le.forEach(function(je){Ee.audioCapabilities.push({contentType:'audio/mp4; codecs="'+je+'"',robustness:Te.audioRobustness||""})}),he.forEach(function(je){Ee.videoCapabilities.push({contentType:'video/mp4; codecs="'+je+'"',robustness:Te.videoRobustness||""})}),[Ee]}(U,G,ie);throw new Error("Unknown key-system: "+R)}(S,T,C,this._drmSystemOptions);w.logger.log("Requesting encrypted media key-system access");var I=this.requestMediaKeySystemAccess(S,x);this.mediaKeysPromise=I.then(function(R){return v._onMediaKeySystemAccessObtained(S,R)}),I.catch(function(R){w.logger.error('Failed to obtain key-system "'+S+'" access:',R)})},p._onMediaKeySystemAccessObtained=function(S,T){var C=this;w.logger.log('Access for key-system "'+S+'" obtained');var v={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:T,mediaKeySystemDomain:S};this._mediaKeysList.push(v);var x=Promise.resolve().then(function(){return T.createMediaKeys()}).then(function(I){return v.mediaKeys=I,w.logger.log('Media-keys created for key-system "'+S+'"'),C._onMediaKeysCreated(),I});return x.catch(function(I){w.logger.error("Failed to create media-keys:",I)}),x},p._onMediaKeysCreated=function(){var S=this;this._mediaKeysList.forEach(function(T){T.mediaKeysSession||(T.mediaKeysSession=T.mediaKeys.createSession(),S._onNewMediaKeySession(T.mediaKeysSession))})},p._onNewMediaKeySession=function(S){var T=this;w.logger.log("New key-system session "+S.sessionId),S.addEventListener("message",function(C){T._onKeySessionMessage(S,C.message)},!1)},p._onKeySessionMessage=function(S,T){w.logger.log("Got EME message event, creating license request"),this._requestLicense(T,function(C){w.logger.log("Received license data (length: "+(C&&C.byteLength)+"), updating key-session"),S.update(C).catch(function(v){w.logger.warn("Updating key-session failed: "+v)})})},p.onMediaEncrypted=function(S){var T=this;if(w.logger.log('Media is encrypted using "'+S.initDataType+'" init data type'),!this.mediaKeysPromise)return w.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var C=function(v){T._media&&(T._attemptSetMediaKeys(v),T._generateRequestWithPreferredKeySession(S.initDataType,S.initData))};this.mediaKeysPromise.then(C).catch(C)},p._attemptSetMediaKeys=function(S){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var T=this._mediaKeysList[0];if(!T||!T.mediaKeys)return w.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});w.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(T.mediaKeys),this._hasSetMediaKeys=!0}},p._generateRequestWithPreferredKeySession=function(S,T){var C=this,v=this._mediaKeysList[0];if(!v)return w.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(v.mediaKeysSessionInitialized)w.logger.warn("Key-Session already initialized but requested again");else{var x=v.mediaKeysSession;if(!x)return w.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!T)return w.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});w.logger.log('Generating key-session request for "'+S+'" init data type'),v.mediaKeysSessionInitialized=!0,x.generateRequest(S,T).then(function(){w.logger.debug("Key-session generation succeeded")}).catch(function(I){w.logger.error("Error generating key-session request:",I),C.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},p._createLicenseXhr=function(S,T,C){var v=new XMLHttpRequest;v.responseType="arraybuffer",v.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,v,S,T,C);var x=this._licenseXhrSetup;if(x)try{x.call(this.hls,v,S),x=void 0}catch(I){w.logger.error(I)}try{v.readyState||v.open("POST",S,!0),x&&x.call(this.hls,v,S)}catch(I){throw new Error("issue setting up KeySystem license XHR "+I)}return v},p._onLicenseRequestReadyStageChange=function(S,T,C,v){if(S.readyState===4)if(S.status===200){this._requestLicenseFailureCount=0,w.logger.log("License request succeeded");var x=S.response,I=this._licenseResponseCallback;if(I)try{x=I.call(this.hls,S,T)}catch(U){w.logger.error(U)}v(x)}else{if(w.logger.error("License Request XHR failed ("+T+"). Status: "+S.status+" ("+S.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var R=3-this._requestLicenseFailureCount+1;w.logger.warn("Retrying license request, "+R+" attempts left"),this._requestLicense(C,v)}},p._generateLicenseRequestChallenge=function(S,T){if(S.mediaKeySystemDomain===Tr.WIDEVINE)return T;throw new Error("unsupported key-system: "+S.mediaKeySystemDomain)},p._requestLicense=function(S,T){w.logger.log("Requesting content license for key-system");var C=this._mediaKeysList[0];if(!C)return w.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var v=this.getLicenseServerUrl(C.mediaKeySystemDomain),x=this._createLicenseXhr(v,S,T);w.logger.log("Sending license request to URL: "+v);var I=this._generateLicenseRequestChallenge(C,S);x.send(I)}catch(R){w.logger.error("Failure requesting DRM license: "+R),this.hls.trigger(y.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},p.onMediaAttached=function(S,T){if(this._emeEnabled){var C=T.media;this._media=C,C.addEventListener("encrypted",this._onMediaEncrypted)}},p.onMediaDetached=function(){var S=this._media,T=this._mediaKeysList;S&&(S.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(T.map(function(C){if(C.mediaKeysSession)return C.mediaKeysSession.close().catch(function(){})})).then(function(){return S.setMediaKeys(null)}).catch(function(){}))},p.onManifestParsed=function(S,T){if(this._emeEnabled){var C=T.levels.map(function(x){return x.audioCodec}).filter(function(x){return!!x}),v=T.levels.map(function(x){return x.videoCodec}).filter(function(x){return!!x});this._attemptKeySystemAccess(Tr.WIDEVINE,C,v)}},M=O,(h=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&_i(M.prototype,h),Object.defineProperty(M,"prototype",{writable:!1}),O}();var ir,Ka,ki;function Ei(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}function Si(O,M,h){return M&&Ei(O.prototype,M),h&&Ei(O,h),Object.defineProperty(O,"prototype",{writable:!1}),O}function Wa(O,M){var h=typeof Symbol<"u"&&O[Symbol.iterator]||O["@@iterator"];if(h)return(h=h.call(O)).next.bind(h);if(Array.isArray(O)||(h=function(S,T){if(S){if(typeof S=="string")return qa(S,T);var C=Object.prototype.toString.call(S).slice(8,-1);return C==="Object"&&S.constructor&&(C=S.constructor.name),C==="Map"||C==="Set"?Array.from(S):C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C)?qa(S,T):void 0}}(O))||M&&O&&typeof O.length=="number"){h&&(O=h);var p=0;return function(){return p>=O.length?{done:!0}:{done:!1,value:O[p++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qa(O,M){(M==null||M>O.length)&&(M=O.length);for(var h=0,p=new Array(M);h<M;h++)p[h]=O[h];return p}function ia(){return ia=Object.assign?Object.assign.bind():function(O){for(var M=1;M<arguments.length;M++){var h=arguments[M];for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(O[p]=h[p])}return O},ia.apply(this,arguments)}(function(O){O.MANIFEST="m",O.AUDIO="a",O.VIDEO="v",O.MUXED="av",O.INIT="i",O.CAPTION="c",O.TIMED_TEXT="tt",O.KEY="k",O.OTHER="o"})(ir||(ir={})),function(O){O.DASH="d",O.HLS="h",O.SMOOTH="s",O.OTHER="o"}(Ka||(Ka={})),function(O){O.VOD="v",O.LIVE="l"}(ki||(ki={}));var ln=function(){function O(h){var p=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){p.initialized&&(p.starved=!0),p.buffering=!0},this.onPlaying=function(){p.initialized||(p.initialized=!0),p.buffering=!1},this.applyPlaylistData=function(C){try{p.apply(C,{ot:ir.MANIFEST,su:!p.initialized})}catch(v){w.logger.warn("Could not generate manifest CMCD data.",v)}},this.applyFragmentData=function(C){try{var v=C.frag,x=p.hls.levels[v.level],I=p.getObjectType(v),R={d:1e3*v.duration,ot:I};I!==ir.VIDEO&&I!==ir.AUDIO&&I!=ir.MUXED||(R.br=x.bitrate/1e3,R.tb=p.getTopBandwidth(I)/1e3,R.bl=p.getBufferLength(I)),p.apply(C,R)}catch(U){w.logger.warn("Could not generate segment CMCD data.",U)}},this.hls=h;var S=this.config=h.config,T=S.cmcd;T!=null&&(S.pLoader=this.createPlaylistLoader(),S.fLoader=this.createFragmentLoader(),this.sid=T.sessionId||O.uuid(),this.cid=T.contentId,this.useHeaders=T.useHeaders===!0,this.registerListeners())}var M=O.prototype;return M.registerListeners=function(){var h=this.hls;h.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.on(y.Events.MEDIA_DETACHED,this.onMediaDetached,this),h.on(y.Events.BUFFER_CREATED,this.onBufferCreated,this)},M.unregisterListeners=function(){var h=this.hls;h.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.off(y.Events.MEDIA_DETACHED,this.onMediaDetached,this),h.off(y.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},M.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},M.onMediaAttached=function(h,p){this.media=p.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},M.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},M.onBufferCreated=function(h,p){var S,T;this.audioBuffer=(S=p.tracks.audio)===null||S===void 0?void 0:S.buffer,this.videoBuffer=(T=p.tracks.video)===null||T===void 0?void 0:T.buffer},M.createData=function(){var h;return{v:1,sf:Ka.HLS,sid:this.sid,cid:this.cid,pr:(h=this.media)===null||h===void 0?void 0:h.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},M.apply=function(h,p){p===void 0&&(p={}),ia(p,this.createData());var S=p.ot===ir.INIT||p.ot===ir.VIDEO||p.ot===ir.MUXED;if(this.starved&&S&&(p.bs=!0,p.su=!0,this.starved=!1),p.su==null&&(p.su=this.buffering),this.useHeaders){var T=O.toHeaders(p);if(!Object.keys(T).length)return;h.headers||(h.headers={}),ia(h.headers,T)}else{var C=O.toQuery(p);if(!C)return;h.url=O.appendQueryToUri(h.url,C)}},M.getObjectType=function(h){var p=h.type;return p==="subtitle"?ir.TIMED_TEXT:h.sn==="initSegment"?ir.INIT:p==="audio"?ir.AUDIO:p==="main"?this.hls.audioTracks.length?ir.VIDEO:ir.MUXED:void 0},M.getTopBandwidth=function(h){var p,S=0,T=this.hls;if(h===ir.AUDIO)p=T.audioTracks;else{var C=T.maxAutoLevel,v=C>-1?C+1:T.levels.length;p=T.levels.slice(0,v)}for(var x,I=Wa(p);!(x=I()).done;){var R=x.value;R.bitrate>S&&(S=R.bitrate)}return S>0?S:NaN},M.getBufferLength=function(h){var p=this.hls.media,S=h===ir.AUDIO?this.audioBuffer:this.videoBuffer;return S&&p?1e3*Ge.bufferInfo(S,p.currentTime,this.config.maxBufferHole).len:NaN},M.createPlaylistLoader=function(){var h=this.config.pLoader,p=this.applyPlaylistData,S=h||this.config.loader;return function(){function T(v){this.loader=void 0,this.loader=new S(v)}var C=T.prototype;return C.destroy=function(){this.loader.destroy()},C.abort=function(){this.loader.abort()},C.load=function(v,x,I){p(v),this.loader.load(v,x,I)},Si(T,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),T}()},M.createFragmentLoader=function(){var h=this.config.fLoader,p=this.applyFragmentData,S=h||this.config.loader;return function(){function T(v){this.loader=void 0,this.loader=new S(v)}var C=T.prototype;return C.destroy=function(){this.loader.destroy()},C.abort=function(){this.loader.abort()},C.load=function(v,x,I){p(v),this.loader.load(v,x,I)},Si(T,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),T}()},O.uuid=function(){var h=URL.createObjectURL(new Blob),p=h.toString();return URL.revokeObjectURL(h),p.slice(p.lastIndexOf("/")+1)},O.serialize=function(h){for(var p,S=[],T=function(he){return!Number.isNaN(he)&&he!=null&&he!==""&&he!==!1},C=function(he){return Math.round(he)},v=function(he){return 100*C(he/100)},x={br:C,d:C,bl:v,dl:v,mtp:v,nor:function(he){return encodeURIComponent(he)},rtp:v,tb:C},I=Wa(Object.keys(h||{}).sort());!(p=I()).done;){var R=p.value,U=h[R];if(T(U)&&!(R==="v"&&U===1||R=="pr"&&U===1)){var G=x[R];G&&(U=G(U));var ie,le=typeof U;ie=R==="ot"||R==="sf"||R==="st"?R+"="+U:le==="boolean"?R:le==="number"?R+"="+U:R+"="+JSON.stringify(U),S.push(ie)}}return S.join(",")},O.toHeaders=function(h){for(var p={},S=["Object","Request","Session","Status"],T=[{},{},{},{}],C={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},v=0,x=Object.keys(h);v<x.length;v++){var I=x[v];T[C[I]!=null?C[I]:1][I]=h[I]}for(var R=0;R<T.length;R++){var U=O.serialize(T[R]);U&&(p["CMCD-"+S[R]]=U)}return p},O.toQuery=function(h){return"CMCD="+encodeURIComponent(O.serialize(h))},O.appendQueryToUri=function(h,p){if(!p)return h;var S=h.includes("?")?"&":"?";return""+h+S+p},O}(),Ti=l(408),xi=/^age:\s*[\d.]+\s*$/m;let Ci=function(){function O(h){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=h?h.xhrSetup:null,this.stats=new Ti.LoadStats,this.retryDelay=0}var M=O.prototype;return M.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},M.abortInternal=function(){var h=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),h&&(h.onreadystatechange=null,h.onprogress=null,h.readyState!==4&&(this.stats.aborted=!0,h.abort()))},M.abort=function(){var h;this.abortInternal(),(h=this.callbacks)!==null&&h!==void 0&&h.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},M.load=function(h,p,S){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=h,this.config=p,this.callbacks=S,this.retryDelay=p.retryDelay,this.loadInternal()},M.loadInternal=function(){var h=this.config,p=this.context;if(h){var S=this.loader=new self.XMLHttpRequest,T=this.stats;T.loading.first=0,T.loaded=0;var C=this.xhrSetup;try{if(C)try{C(S,p.url)}catch{S.open("GET",p.url,!0),C(S,p.url)}S.readyState||S.open("GET",p.url,!0);var v=this.context.headers;if(v)for(var x in v)S.setRequestHeader(x,v[x])}catch(I){return void this.callbacks.onError({code:S.status,text:I.message},p,S)}p.rangeEnd&&S.setRequestHeader("Range","bytes="+p.rangeStart+"-"+(p.rangeEnd-1)),S.onreadystatechange=this.readystatechange.bind(this),S.onprogress=this.loadprogress.bind(this),S.responseType=p.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),h.timeout),S.send()}},M.readystatechange=function(){var h=this.context,p=this.loader,S=this.stats;if(h&&p){var T=p.readyState,C=this.config;if(!S.aborted&&T>=2)if(self.clearTimeout(this.requestTimeout),S.loading.first===0&&(S.loading.first=Math.max(self.performance.now(),S.loading.start)),T===4){p.onreadystatechange=null,p.onprogress=null;var v=p.status,x=p.responseType==="arraybuffer";if(v>=200&&v<300&&(x&&p.response||p.responseText!==null)){var I,R;if(S.loading.end=Math.max(self.performance.now(),S.loading.first),R=x?(I=p.response).byteLength:(I=p.responseText).length,S.loaded=S.total=R,!this.callbacks)return;var U=this.callbacks.onProgress;if(U&&U(S,h,I,p),!this.callbacks)return;var G={url:p.responseURL,data:I};this.callbacks.onSuccess(G,S,h,p)}else S.retry>=C.maxRetry||v>=400&&v<499?(w.logger.error(v+" while loading "+h.url),this.callbacks.onError({code:v,text:p.statusText},h,p)):(w.logger.warn(v+" while loading "+h.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,C.maxRetryDelay),S.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),C.timeout)}},M.loadtimeout=function(){w.logger.warn("timeout while loading "+this.context.url);var h=this.callbacks;h&&(this.abortInternal(),h.onTimeout(this.stats,this.context,this.loader))},M.loadprogress=function(h){var p=this.stats;p.loaded=h.loaded,h.lengthComputable&&(p.total=h.total)},M.getCacheAge=function(){var h=null;if(this.loader&&xi.test(this.loader.getAllResponseHeaders())){var p=this.loader.getResponseHeader("age");h=p?parseFloat(p):null}return h},O}();function za(O){var M=typeof Map=="function"?new Map:void 0;return za=function(h){if(h===null||(p=h,Function.toString.call(p).indexOf("[native code]")===-1))return h;var p;if(typeof h!="function")throw new TypeError("Super expression must either be null or a function");if(M!==void 0){if(M.has(h))return M.get(h);M.set(h,S)}function S(){return Ta(h,arguments,Xa(this).constructor)}return S.prototype=Object.create(h.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),na(S,h)},za(O)}function Ta(O,M,h){return Ta=Pi()?Reflect.construct.bind():function(p,S,T){var C=[null];C.push.apply(C,S);var v=new(Function.bind.apply(p,C));return T&&na(v,T.prototype),v},Ta.apply(null,arguments)}function Pi(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function na(O,M){return na=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,p){return h.__proto__=p,h},na(O,M)}function Xa(O){return Xa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(M){return M.__proto__||Object.getPrototypeOf(M)},Xa(O)}function xa(){return xa=Object.assign?Object.assign.bind():function(O){for(var M=1;M<arguments.length;M++){var h=arguments[M];for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(O[p]=h[p])}return O},xa.apply(this,arguments)}var un=function(){function O(h){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=h.fetchSetup||dn,this.controller=new self.AbortController,this.stats=new Ti.LoadStats}var M=O.prototype;return M.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},M.abortInternal=function(){var h=this.response;h&&h.ok||(this.stats.aborted=!0,this.controller.abort())},M.abort=function(){var h;this.abortInternal(),(h=this.callbacks)!==null&&h!==void 0&&h.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},M.load=function(h,p,S){var T=this,C=this.stats;if(C.loading.start)throw new Error("Loader can only be used once.");C.loading.start=self.performance.now();var v=function(U,G){var ie={method:"GET",mode:"cors",credentials:"same-origin",signal:G,headers:new self.Headers(xa({},U.headers))};return U.rangeEnd&&ie.headers.set("Range","bytes="+U.rangeStart+"-"+String(U.rangeEnd-1)),ie}(h,this.controller.signal),x=S.onProgress,I=h.responseType==="arraybuffer",R=I?"byteLength":"length";this.context=h,this.config=p,this.callbacks=S,this.request=this.fetchSetup(h,v),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){T.abortInternal(),S.onTimeout(C,h,T.response)},p.timeout),self.fetch(this.request).then(function(U){if(T.response=T.loader=U,!U.ok){var G=U.status,ie=U.statusText;throw new Ai(ie||"fetch, bad network response",G,U)}return C.loading.first=Math.max(self.performance.now(),C.loading.start),C.total=parseInt(U.headers.get("Content-Length")||"0"),x&&(0,E.isFiniteNumber)(p.highWaterMark)?T.loadProgressively(U,C,h,p.highWaterMark,x):I?U.arrayBuffer():U.text()}).then(function(U){var G=T.response;self.clearTimeout(T.requestTimeout),C.loading.end=Math.max(self.performance.now(),C.loading.first);var ie=U[R];ie&&(C.loaded=C.total=ie);var le={url:G.url,data:U};x&&!(0,E.isFiniteNumber)(p.highWaterMark)&&x(C,h,U,G),S.onSuccess(le,C,h,G)}).catch(function(U){if(self.clearTimeout(T.requestTimeout),!C.aborted){var G=U&&U.code||0,ie=U?U.message:null;S.onError({code:G,text:ie},h,U?U.details:null)}})},M.getCacheAge=function(){var h=null;if(this.response){var p=this.response.headers.get("age");h=p?parseFloat(p):null}return h},M.loadProgressively=function(h,p,S,T,C){T===void 0&&(T=0);var v=new jt,x=h.body.getReader();return function I(){return x.read().then(function(R){if(R.done)return v.dataLength&&C(p,S,v.flush(),h),Promise.resolve(new ArrayBuffer(0));var U=R.value,G=U.length;return p.loaded+=G,G<T||v.dataLength?(v.push(U),v.dataLength>=T&&C(p,S,v.flush(),h)):C(p,S,U,h),I()}).catch(function(){return Promise.reject()})}()},O}();function dn(O,M){return new self.Request(O.url,M)}var Ai=function(O){var M,h;function p(S,T,C){var v;return(v=O.call(this,S)||this).code=void 0,v.details=void 0,v.code=T,v.details=C,v}return h=O,(M=p).prototype=Object.create(h.prototype),M.prototype.constructor=M,na(M,h),p}(za(Error));let rr=un;var Ya=/\s/;function ur(){return ur=Object.assign?Object.assign.bind():function(O){for(var M=1;M<arguments.length;M++){var h=arguments[M];for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(O[p]=h[p])}return O},ur.apply(this,arguments)}function bi(O,M){var h=Object.keys(O);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(O);M&&(p=p.filter(function(S){return Object.getOwnPropertyDescriptor(O,S).enumerable})),h.push.apply(h,p)}return h}function Er(O){for(var M=1;M<arguments.length;M++){var h=arguments[M]!=null?arguments[M]:{};M%2?bi(Object(h),!0).forEach(function(p){hn(O,p,h[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(h)):bi(Object(h)).forEach(function(p){Object.defineProperty(O,p,Object.getOwnPropertyDescriptor(h,p))})}return O}function hn(O,M,h){return M in O?Object.defineProperty(O,M,{value:h,enumerable:!0,configurable:!0,writable:!0}):O[M]=h,O}var cn=Er(Er({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ci,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Ir,bufferController:Gr,capLevelController:Ea,fpsController:Sa,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:vi,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(O,M,h,p){for(var S,T,C,v,x,I=[],R=self.VTTCue||self.TextTrackCue,U=0;U<p.rows.length;U++)if(C=!0,v=0,x="",!(S=p.rows[U]).isEmpty()){for(var G=0;G<S.chars.length;G++)Ya.test(S.chars[G].uchar)&&C?v++:(x+=S.chars[G].uchar,C=!1);S.cueStartTime=M,M===h&&(h+=1e-4),v>=16?v--:v++;var ie=hi(x.trim()),le=$a(M,h,ie);O&&O.cues&&O.cues.getCueById(le)||((T=new R(M,h,ie)).id=le,T.line=U+1,T.align="left",T.position=10+Math.min(80,10*Math.floor(8*v/32)),I.push(T))}return O&&I.length&&(I.sort(function(he,Te){return he.line==="auto"||Te.line==="auto"?0:he.line>8&&Te.line>8?Te.line-he.line:he.line-Te.line}),I.forEach(function(he){return Be(O,he)})),I}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:pa,subtitleTrackController:Xi,timelineController:yi,audioStreamController:qi,audioTrackController:ii,emeController:on,cmcdController:ln});function Ii(O,M){for(var h=0;h<M.length;h++){var p=M[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,p.key,p)}}var Ca=function(){function O(T){T===void 0&&(T={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new ri.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var C=this.config=function(Le,Je){if((Je.liveSyncDurationCount||Je.liveMaxLatencyDurationCount)&&(Je.liveSyncDuration||Je.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(Je.liveMaxLatencyDurationCount!==void 0&&(Je.liveSyncDurationCount===void 0||Je.liveMaxLatencyDurationCount<=Je.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(Je.liveMaxLatencyDuration!==void 0&&(Je.liveSyncDuration===void 0||Je.liveMaxLatencyDuration<=Je.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return ur({},Le,Je)}(O.DefaultConfig,T);this.userConfig=T,(0,w.enableLogs)(C.debug,"Hls instance"),this._autoLevelCapping=-1,C.progressive&&function(Le){var Je=Le.loader;Je!==rr&&Je!==Ci?(w.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),Le.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(Le.loader=rr,Le.progressive=!0,Le.enableSoftwareAES=!0,w.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}(C);var v=C.abrController,x=C.bufferController,I=C.capLevelController,R=C.fpsController,U=this.abrController=new v(this),G=this.bufferController=new x(this),ie=this.capLevelController=new I(this),le=new R(this),he=new et(this),Te=new tt(this),Ee=new at(this),je=this.levelController=new ge(this),Ve=new Se(this),Ne=this.streamController=new Hi(this,Ve);ie.setStreamController(Ne),le.setStreamController(Ne);var Re=[he,Te,je,Ne];this.networkControllers=Re;var He=[U,G,ie,le,Ee,Ve];this.audioTrackController=this.createController(C.audioTrackController,null,Re),this.createController(C.audioStreamController,Ve,Re),this.subtitleTrackController=this.createController(C.subtitleTrackController,null,Re),this.createController(C.subtitleStreamController,Ve,Re),this.createController(C.timelineController,null,He),this.emeController=this.createController(C.emeController,null,He),this.cmcdController=this.createController(C.cmcdController,null,He),this.latencyController=this.createController(ct,null,He),this.coreComponents=He}O.isSupported=function(){return function(){var T=Gt();if(!T)return!1;var C=Ma(),v=T&&typeof T.isTypeSupported=="function"&&T.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),x=!C||C.prototype&&typeof C.prototype.appendBuffer=="function"&&typeof C.prototype.remove=="function";return!!v&&!!x}()};var M,h,p,S=O.prototype;return S.createController=function(T,C,v){if(T){var x=C?new T(this,C):new T(this);return v&&v.push(x),x}return null},S.on=function(T,C,v){v===void 0&&(v=this),this._emitter.on(T,C,v)},S.once=function(T,C,v){v===void 0&&(v=this),this._emitter.once(T,C,v)},S.removeAllListeners=function(T){this._emitter.removeAllListeners(T)},S.off=function(T,C,v,x){v===void 0&&(v=this),this._emitter.off(T,C,v,x)},S.listeners=function(T){return this._emitter.listeners(T)},S.emit=function(T,C,v){return this._emitter.emit(T,C,v)},S.trigger=function(T,C){if(this.config.debug)return this.emit(T,T,C);try{return this.emit(T,T,C)}catch(v){w.logger.error("An internal error happened while handling event "+T+'. Error message: "'+v.message+'". Here is a stacktrace:',v),this.trigger(y.Events.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:T,error:v})}return!1},S.listenerCount=function(T){return this._emitter.listenerCount(T)},S.destroy=function(){w.logger.log("destroy"),this.trigger(y.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(T){return T.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(T){return T.destroy()}),this.coreComponents.length=0},S.attachMedia=function(T){w.logger.log("attachMedia"),this._media=T,this.trigger(y.Events.MEDIA_ATTACHING,{media:T})},S.detachMedia=function(){w.logger.log("detachMedia"),this.trigger(y.Events.MEDIA_DETACHING,void 0),this._media=null},S.loadSource=function(T){this.stopLoad();var C=this.media,v=this.url,x=this.url=m.buildAbsoluteURL(self.location.href,T,{alwaysNormalize:!0});w.logger.log("loadSource:"+x),C&&v&&v!==x&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(C)),this.trigger(y.Events.MANIFEST_LOADING,{url:T})},S.startLoad=function(T){T===void 0&&(T=-1),w.logger.log("startLoad("+T+")"),this.networkControllers.forEach(function(C){C.startLoad(T)})},S.stopLoad=function(){w.logger.log("stopLoad"),this.networkControllers.forEach(function(T){T.stopLoad()})},S.swapAudioCodec=function(){w.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},S.recoverMediaError=function(){w.logger.log("recoverMediaError");var T=this._media;this.detachMedia(),T&&this.attachMedia(T)},S.removeLevel=function(T,C){C===void 0&&(C=0),this.levelController.removeLevel(T,C)},M=O,p=[{key:"version",get:function(){return"1.2.9"}},{key:"Events",get:function(){return y.Events}},{key:"ErrorTypes",get:function(){return D.ErrorTypes}},{key:"ErrorDetails",get:function(){return D.ErrorDetails}},{key:"DefaultConfig",get:function(){return O.defaultConfig?O.defaultConfig:cn},set:function(T){O.defaultConfig=T}}],(h=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(T){w.logger.log("set currentLevel:"+T),this.loadLevel=T,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(T){w.logger.log("set nextLevel:"+T),this.levelController.manualLevel=T,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(T){w.logger.log("set loadLevel:"+T),this.levelController.manualLevel=T}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(T){this.levelController.nextLoadLevel=T}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(T){w.logger.log("set firstLevel:"+T),this.levelController.firstLevel=T}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(T){w.logger.log("set startLevel:"+T),T!==-1&&(T=Math.max(T,this.minAutoLevel)),this.levelController.startLevel=T}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(T){var C=!!T;C!==this.config.capLevelToPlayerSize&&(C?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=C)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(T){this._autoLevelCapping!==T&&(w.logger.log("set autoLevelCapping:"+T),this._autoLevelCapping=T)}},{key:"bandwidthEstimate",get:function(){var T=this.abrController.bwEstimator;return T?T.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var T=this.levels,C=this.config.minAutoBitrate;if(!T)return 0;for(var v=T.length,x=0;x<v;x++)if(T[x].maxBitrate>=C)return x;return 0}},{key:"maxAutoLevel",get:function(){var T=this.levels,C=this.autoLevelCapping;return C===-1&&T&&T.length?T.length-1:C}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(T){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,T)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var T=this.audioTrackController;return T?T.audioTracks:[]}},{key:"audioTrack",get:function(){var T=this.audioTrackController;return T?T.audioTrack:-1},set:function(T){var C=this.audioTrackController;C&&(C.audioTrack=T)}},{key:"subtitleTracks",get:function(){var T=this.subtitleTrackController;return T?T.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var T=this.subtitleTrackController;return T?T.subtitleTrack:-1},set:function(T){var C=this.subtitleTrackController;C&&(C.subtitleTrack=T)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var T=this.subtitleTrackController;return!!T&&T.subtitleDisplay},set:function(T){var C=this.subtitleTrackController;C&&(C.subtitleDisplay=T)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(T){this.config.lowLatencyMode=T}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&Ii(M.prototype,h),p&&Ii(M,p),Object.defineProperty(M,"prototype",{writable:!1}),O}();Ca.defaultConfig=void 0},923:(s,o,l)=>{"use strict";l.r(o),l.d(o,{BaseSegment:()=>q,ElementaryStreamTypes:()=>u,Fragment:()=>re,Part:()=>ee});var u,m=l(965),E=l(945),y=l(93),D=l(960),w=l(408);function B(H,te){H.prototype=Object.create(te.prototype),H.prototype.constructor=H,F(H,te)}function F(H,te){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(W,z){return W.__proto__=z,W},F(H,te)}function V(H,te){for(var W=0;W<te.length;W++){var z=te[W];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(H,z.key,z)}}function K(H,te,W){return te&&V(H.prototype,te),W&&V(H,W),Object.defineProperty(H,"prototype",{writable:!1}),H}(function(H){H.AUDIO="audio",H.VIDEO="video",H.AUDIOVIDEO="audiovideo"})(u||(u={}));var q=function(){function H(te){var W;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((W={})[u.AUDIO]=null,W[u.VIDEO]=null,W[u.AUDIOVIDEO]=null,W),this.baseurl=te}return H.prototype.setByteRange=function(te,W){var z=te.split("@",2),X=[];z.length===1?X[0]=W?W.byteRangeEndOffset:0:X[0]=parseInt(z[1]),X[1]=parseInt(z[0])+X[0],this._byteRange=X},K(H,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,E.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(te){this._url=te}}]),H}(),re=function(H){function te(z,X){var Q;return(Q=H.call(this,X)||this)._decryptdata=null,Q.rawProgramDateTime=null,Q.programDateTime=null,Q.tagList=[],Q.duration=0,Q.sn=0,Q.levelkey=void 0,Q.type=void 0,Q.loader=null,Q.level=-1,Q.cc=0,Q.startPTS=void 0,Q.endPTS=void 0,Q.appendedPTS=void 0,Q.startDTS=void 0,Q.endDTS=void 0,Q.start=0,Q.deltaPTS=void 0,Q.maxStartPTS=void 0,Q.minEndPTS=void 0,Q.stats=new w.LoadStats,Q.urlId=0,Q.data=void 0,Q.bitrateTest=!1,Q.title=null,Q.initSegment=null,Q.type=z,Q}B(te,H);var W=te.prototype;return W.createInitializationVector=function(z){for(var X=new Uint8Array(16),Q=12;Q<16;Q++)X[Q]=z>>8*(15-Q)&255;return X},W.setDecryptDataFromLevelKey=function(z,X){var Q=z;return z?.method==="AES-128"&&z.uri&&!z.iv&&((Q=D.LevelKey.fromURI(z.uri)).method=z.method,Q.iv=this.createInitializationVector(X),Q.keyFormat="identity"),Q},W.setElementaryStreamInfo=function(z,X,Q,$,oe,ae){ae===void 0&&(ae=!1);var _e=this.elementaryStreams,ve=_e[z];ve?(ve.startPTS=Math.min(ve.startPTS,X),ve.endPTS=Math.max(ve.endPTS,Q),ve.startDTS=Math.min(ve.startDTS,$),ve.endDTS=Math.max(ve.endDTS,oe)):_e[z]={startPTS:X,endPTS:Q,startDTS:$,endDTS:oe,partial:ae}},W.clearElementaryStreamInfo=function(){var z=this.elementaryStreams;z[u.AUDIO]=null,z[u.VIDEO]=null,z[u.AUDIOVIDEO]=null},K(te,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var z=this.sn;typeof z!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&y.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),z=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,z)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,m.isFiniteNumber)(this.programDateTime))return null;var z=(0,m.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*z}},{key:"encrypted",get:function(){var z;return!((z=this.decryptdata)===null||z===void 0||!z.keyFormat||!this.decryptdata.uri)}}]),te}(q),ee=function(H){function te(W,z,X,Q,$){var oe;(oe=H.call(this,X)||this).fragOffset=0,oe.duration=0,oe.gap=!1,oe.independent=!1,oe.relurl=void 0,oe.fragment=void 0,oe.index=void 0,oe.stats=new w.LoadStats,oe.duration=W.decimalFloatingPoint("DURATION"),oe.gap=W.bool("GAP"),oe.independent=W.bool("INDEPENDENT"),oe.relurl=W.enumeratedString("URI"),oe.fragment=z,oe.index=Q;var ae=W.enumeratedString("BYTERANGE");return ae&&oe.setByteRange(ae,$),$&&(oe.fragOffset=$.fragOffset+$.duration),oe}return B(te,H),K(te,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var W=this.elementaryStreams;return!!(W.audio||W.video||W.audiovideo)}}]),te}(q)},960:(s,o,l)=>{"use strict";l.r(o),l.d(o,{LevelKey:()=>E});var u=l(945);function m(y,D){for(var w=0;w<D.length;w++){var B=D[w];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(y,B.key,B)}}var E=function(){function y(B,F){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=F?(0,u.buildAbsoluteURL)(B,F,{alwaysNormalize:!0}):B}var D,w;return y.fromURL=function(B,F){return new y(B,F)},y.fromURI=function(B){return new y(B)},D=y,(w=[{key:"uri",get:function(){return this._uri}}])&&m(D.prototype,w),Object.defineProperty(D,"prototype",{writable:!1}),y}()},408:(s,o,l)=>{"use strict";l.r(o),l.d(o,{LoadStats:()=>u});var u=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},965:(s,o,l)=>{"use strict";l.r(o),l.d(o,{MAX_SAFE_INTEGER:()=>m,isFiniteNumber:()=>u});var u=Number.isFinite||function(E){return typeof E=="number"&&isFinite(E)},m=Number.MAX_SAFE_INTEGER||9007199254740991},524:(s,o,l)=>{"use strict";l.r(o),l.d(o,{default:()=>H,flushTextTrackMetadataCueSamples:()=>W,flushTextTrackUserdataCueSamples:()=>z,normalizePts:()=>te});var u=l(965);let m=function(){function $(){}return $.getSilentFrame=function(oe,ae){if(oe==="mp4a.40.2"){if(ae===1)return new Uint8Array([0,200,0,128,35,128]);if(ae===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(ae===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(ae===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(ae===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(ae===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(ae===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(ae===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(ae===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},$}();var E=Math.pow(2,32)-1,y=function(){function $(){}return $.init=function(){var oe;for(oe in $.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},$.types)$.types.hasOwnProperty(oe)&&($.types[oe]=[oe.charCodeAt(0),oe.charCodeAt(1),oe.charCodeAt(2),oe.charCodeAt(3)]);var ae=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),_e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);$.HDLR_TYPES={video:ae,audio:_e};var ve=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Pe=new Uint8Array([0,0,0,0,0,0,0,0]);$.STTS=$.STSC=$.STCO=Pe,$.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),$.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),$.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),$.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var fe=new Uint8Array([105,115,111,109]),xe=new Uint8Array([97,118,99,49]),Ce=new Uint8Array([0,0,0,1]);$.FTYP=$.box($.types.ftyp,fe,Ce,fe,xe),$.DINF=$.box($.types.dinf,$.box($.types.dref,ve))},$.box=function(oe){for(var ae=8,_e=arguments.length,ve=new Array(_e>1?_e-1:0),Pe=1;Pe<_e;Pe++)ve[Pe-1]=arguments[Pe];for(var fe=ve.length,xe=fe;fe--;)ae+=ve[fe].byteLength;var Ce=new Uint8Array(ae);for(Ce[0]=ae>>24&255,Ce[1]=ae>>16&255,Ce[2]=ae>>8&255,Ce[3]=255&ae,Ce.set(oe,4),fe=0,ae=8;fe<xe;fe++)Ce.set(ve[fe],ae),ae+=ve[fe].byteLength;return Ce},$.hdlr=function(oe){return $.box($.types.hdlr,$.HDLR_TYPES[oe])},$.mdat=function(oe){return $.box($.types.mdat,oe)},$.mdhd=function(oe,ae){ae*=oe;var _e=Math.floor(ae/(E+1)),ve=Math.floor(ae%(E+1));return $.box($.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,oe>>24&255,oe>>16&255,oe>>8&255,255&oe,_e>>24,_e>>16&255,_e>>8&255,255&_e,ve>>24,ve>>16&255,ve>>8&255,255&ve,85,196,0,0]))},$.mdia=function(oe){return $.box($.types.mdia,$.mdhd(oe.timescale,oe.duration),$.hdlr(oe.type),$.minf(oe))},$.mfhd=function(oe){return $.box($.types.mfhd,new Uint8Array([0,0,0,0,oe>>24,oe>>16&255,oe>>8&255,255&oe]))},$.minf=function(oe){return oe.type==="audio"?$.box($.types.minf,$.box($.types.smhd,$.SMHD),$.DINF,$.stbl(oe)):$.box($.types.minf,$.box($.types.vmhd,$.VMHD),$.DINF,$.stbl(oe))},$.moof=function(oe,ae,_e){return $.box($.types.moof,$.mfhd(oe),$.traf(_e,ae))},$.moov=function(oe){for(var ae=oe.length,_e=[];ae--;)_e[ae]=$.trak(oe[ae]);return $.box.apply(null,[$.types.moov,$.mvhd(oe[0].timescale,oe[0].duration)].concat(_e).concat($.mvex(oe)))},$.mvex=function(oe){for(var ae=oe.length,_e=[];ae--;)_e[ae]=$.trex(oe[ae]);return $.box.apply(null,[$.types.mvex].concat(_e))},$.mvhd=function(oe,ae){ae*=oe;var _e=Math.floor(ae/(E+1)),ve=Math.floor(ae%(E+1)),Pe=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,oe>>24&255,oe>>16&255,oe>>8&255,255&oe,_e>>24,_e>>16&255,_e>>8&255,255&_e,ve>>24,ve>>16&255,ve>>8&255,255&ve,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return $.box($.types.mvhd,Pe)},$.sdtp=function(oe){var ae,_e,ve=oe.samples||[],Pe=new Uint8Array(4+ve.length);for(ae=0;ae<ve.length;ae++)_e=ve[ae].flags,Pe[ae+4]=_e.dependsOn<<4|_e.isDependedOn<<2|_e.hasRedundancy;return $.box($.types.sdtp,Pe)},$.stbl=function(oe){return $.box($.types.stbl,$.stsd(oe),$.box($.types.stts,$.STTS),$.box($.types.stsc,$.STSC),$.box($.types.stsz,$.STSZ),$.box($.types.stco,$.STCO))},$.avc1=function(oe){var ae,_e,ve,Pe=[],fe=[];for(ae=0;ae<oe.sps.length;ae++)ve=(_e=oe.sps[ae]).byteLength,Pe.push(ve>>>8&255),Pe.push(255&ve),Pe=Pe.concat(Array.prototype.slice.call(_e));for(ae=0;ae<oe.pps.length;ae++)ve=(_e=oe.pps[ae]).byteLength,fe.push(ve>>>8&255),fe.push(255&ve),fe=fe.concat(Array.prototype.slice.call(_e));var xe=$.box($.types.avcC,new Uint8Array([1,Pe[3],Pe[4],Pe[5],255,224|oe.sps.length].concat(Pe).concat([oe.pps.length]).concat(fe))),Ce=oe.width,De=oe.height,ke=oe.pixelRatio[0],Xe=oe.pixelRatio[1];return $.box($.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,Ce>>8&255,255&Ce,De>>8&255,255&De,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),xe,$.box($.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),$.box($.types.pasp,new Uint8Array([ke>>24,ke>>16&255,ke>>8&255,255&ke,Xe>>24,Xe>>16&255,Xe>>8&255,255&Xe])))},$.esds=function(oe){var ae=oe.config.length;return new Uint8Array([0,0,0,0,3,23+ae,0,1,0,4,15+ae,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([ae]).concat(oe.config).concat([6,1,2]))},$.mp4a=function(oe){var ae=oe.samplerate;return $.box($.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,oe.channelCount,0,16,0,0,0,0,ae>>8&255,255&ae,0,0]),$.box($.types.esds,$.esds(oe)))},$.mp3=function(oe){var ae=oe.samplerate;return $.box($.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,oe.channelCount,0,16,0,0,0,0,ae>>8&255,255&ae,0,0]))},$.stsd=function(oe){return oe.type==="audio"?oe.segmentCodec==="mp3"&&oe.codec==="mp3"?$.box($.types.stsd,$.STSD,$.mp3(oe)):$.box($.types.stsd,$.STSD,$.mp4a(oe)):$.box($.types.stsd,$.STSD,$.avc1(oe))},$.tkhd=function(oe){var ae=oe.id,_e=oe.duration*oe.timescale,ve=oe.width,Pe=oe.height,fe=Math.floor(_e/(E+1)),xe=Math.floor(_e%(E+1));return $.box($.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,ae>>24&255,ae>>16&255,ae>>8&255,255&ae,0,0,0,0,fe>>24,fe>>16&255,fe>>8&255,255&fe,xe>>24,xe>>16&255,xe>>8&255,255&xe,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,ve>>8&255,255&ve,0,0,Pe>>8&255,255&Pe,0,0]))},$.traf=function(oe,ae){var _e=$.sdtp(oe),ve=oe.id,Pe=Math.floor(ae/(E+1)),fe=Math.floor(ae%(E+1));return $.box($.types.traf,$.box($.types.tfhd,new Uint8Array([0,0,0,0,ve>>24,ve>>16&255,ve>>8&255,255&ve])),$.box($.types.tfdt,new Uint8Array([1,0,0,0,Pe>>24,Pe>>16&255,Pe>>8&255,255&Pe,fe>>24,fe>>16&255,fe>>8&255,255&fe])),$.trun(oe,_e.length+16+20+8+16+8+8),_e)},$.trak=function(oe){return oe.duration=oe.duration||4294967295,$.box($.types.trak,$.tkhd(oe),$.mdia(oe))},$.trex=function(oe){var ae=oe.id;return $.box($.types.trex,new Uint8Array([0,0,0,0,ae>>24,ae>>16&255,ae>>8&255,255&ae,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},$.trun=function(oe,ae){var _e,ve,Pe,fe,xe,Ce,De=oe.samples||[],ke=De.length,Xe=12+16*ke,et=new Uint8Array(Xe);for(ae+=8+Xe,et.set([oe.type==="video"?1:0,0,15,1,ke>>>24&255,ke>>>16&255,ke>>>8&255,255&ke,ae>>>24&255,ae>>>16&255,ae>>>8&255,255&ae],0),_e=0;_e<ke;_e++)Pe=(ve=De[_e]).duration,fe=ve.size,xe=ve.flags,Ce=ve.cts,et.set([Pe>>>24&255,Pe>>>16&255,Pe>>>8&255,255&Pe,fe>>>24&255,fe>>>16&255,fe>>>8&255,255&fe,xe.isLeading<<2|xe.dependsOn,xe.isDependedOn<<6|xe.hasRedundancy<<4|xe.paddingValue<<1|xe.isNonSync,61440&xe.degradPrio,15&xe.degradPrio,Ce>>>24&255,Ce>>>16&255,Ce>>>8&255,255&Ce],12+16*_e);return $.box($.types.trun,et)},$.initSegment=function(oe){$.types||$.init();var ae=$.moov(oe),_e=new Uint8Array($.FTYP.byteLength+ae.byteLength);return _e.set($.FTYP),_e.set(ae,$.FTYP.byteLength),_e},$}();y.types=void 0,y.HDLR_TYPES=void 0,y.STTS=void 0,y.STSC=void 0,y.STCO=void 0,y.STSZ=void 0,y.VMHD=void 0,y.SMHD=void 0,y.STSD=void 0,y.FTYP=void 0,y.DINF=void 0;let D=y;var w=l(851),B=l(973),F=l(93),V=l(308),K=l(673);function q(){return q=Object.assign?Object.assign.bind():function($){for(var oe=1;oe<arguments.length;oe++){var ae=arguments[oe];for(var _e in ae)Object.prototype.hasOwnProperty.call(ae,_e)&&($[_e]=ae[_e])}return $},q.apply(this,arguments)}var re=null,ee=null,H=function(){function $(ae,_e,ve,Pe){if(Pe===void 0&&(Pe=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=ae,this.config=_e,this.typeSupported=ve,this.ISGenerated=!1,re===null){var fe=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);re=fe?parseInt(fe[1]):0}if(ee===null){var xe=navigator.userAgent.match(/Safari\/(\d+)/i);ee=xe?parseInt(xe[1]):0}}var oe=$.prototype;return oe.destroy=function(){},oe.resetTimeStamp=function(ae){F.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=ae},oe.resetNextTimestamp=function(){F.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},oe.resetInitSegment=function(){F.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},oe.getVideoStartPts=function(ae){var _e=!1,ve=ae.reduce(function(Pe,fe){var xe=fe.pts-Pe;return xe<-4294967296?(_e=!0,te(Pe,fe.pts)):xe>0?Pe:fe.pts},ae[0].pts);return _e&&F.logger.debug("PTS rollover detected"),ve},oe.remux=function(ae,_e,ve,Pe,fe,xe,Ce,De){var ke,Xe,et,tt,nt,Be,Fe=fe,J=fe,ue=ae.pid>-1,de=_e.pid>-1,Oe=_e.samples.length,Ue=ae.samples.length>0,Ke=Ce&&Oe>0||Oe>1;if((!ue||Ue)&&(!de||Ke)||this.ISGenerated||Ce){this.ISGenerated||(et=this.generateIS(ae,_e,fe));var at,ut=this.isVideoContiguous,st=-1;if(Ke&&(st=function(ft){for(var Ut=0;Ut<ft.length;Ut++)if(ft[Ut].key)return Ut;return-1}(_e.samples),!ut&&this.config.forceKeyFrameOnDiscontinuity))if(Be=!0,st>0){F.logger.warn("[mp4-remuxer]: Dropped "+st+" out of "+Oe+" video samples due to a missing keyframe");var ct=this.getVideoStartPts(_e.samples);_e.samples=_e.samples.slice(st),_e.dropped+=st,at=J+=(_e.samples[0].pts-ct)/_e.inputTimeScale}else st===-1&&(F.logger.warn("[mp4-remuxer]: No keyframe found out of "+Oe+" video samples"),Be=!1);if(this.ISGenerated){if(Ue&&Ke){var yt=this.getVideoStartPts(_e.samples),Ct=(te(ae.samples[0].pts,yt)-yt)/_e.inputTimeScale;Fe+=Math.max(0,Ct),J+=Math.max(0,-Ct)}if(Ue){if(ae.samplerate||(F.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),et=this.generateIS(ae,_e,fe)),Xe=this.remuxAudio(ae,Fe,this.isAudioContiguous,xe,de||Ke||De===V.PlaylistLevelType.AUDIO?J:void 0),Ke){var vt=Xe?Xe.endPTS-Xe.startPTS:0;_e.inputTimeScale||(F.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),et=this.generateIS(ae,_e,fe)),ke=this.remuxVideo(_e,J,ut,vt)}}else Ke&&(ke=this.remuxVideo(_e,J,ut,0));ke&&(ke.firstKeyFrame=st,ke.independent=st!==-1,ke.firstKeyFramePTS=at)}}return this.ISGenerated&&(ve.samples.length&&(nt=W(ve,fe,this._initPTS,this._initDTS)),Pe.samples.length&&(tt=z(Pe,fe,this._initPTS))),{audio:Xe,video:ke,initSegment:et,independent:Be,text:tt,id3:nt}},oe.generateIS=function(ae,_e,ve){var Pe,fe,xe,Ce=ae.samples,De=_e.samples,ke=this.typeSupported,Xe={},et=!(0,u.isFiniteNumber)(this._initPTS),tt="audio/mp4";if(et&&(Pe=fe=1/0),ae.config&&Ce.length&&(ae.timescale=ae.samplerate,ae.segmentCodec==="mp3"&&(ke.mpeg?(tt="audio/mpeg",ae.codec=""):ke.mp3&&(ae.codec="mp3")),Xe.audio={id:"audio",container:tt,codec:ae.codec,initSegment:ae.segmentCodec==="mp3"&&ke.mpeg?new Uint8Array(0):D.initSegment([ae]),metadata:{channelCount:ae.channelCount}},et&&(xe=ae.inputTimeScale,Pe=fe=Ce[0].pts-Math.round(xe*ve))),_e.sps&&_e.pps&&De.length&&(_e.timescale=_e.inputTimeScale,Xe.video={id:"main",container:"video/mp4",codec:_e.codec,initSegment:D.initSegment([_e]),metadata:{width:_e.width,height:_e.height}},et)){xe=_e.inputTimeScale;var nt=this.getVideoStartPts(De),Be=Math.round(xe*ve);fe=Math.min(fe,te(De[0].dts,nt)-Be),Pe=Math.min(Pe,nt-Be)}if(Object.keys(Xe).length)return this.ISGenerated=!0,et&&(this._initPTS=Pe,this._initDTS=fe),{tracks:Xe,initPTS:Pe,timescale:xe}},oe.remuxVideo=function(ae,_e,ve,Pe){var fe,xe,Ce=ae.inputTimeScale,De=ae.samples,ke=[],Xe=De.length,et=this._initPTS,tt=this.nextAvcDts,nt=8,Be=this.videoSampleDuration,Fe=Number.POSITIVE_INFINITY,J=Number.NEGATIVE_INFINITY,ue=!1;ve&&tt!==null||(tt=_e*Ce-(De[0].pts-te(De[0].dts,De[0].pts)));for(var de=0;de<Xe;de++){var Oe=De[de];Oe.pts=te(Oe.pts-et,tt),Oe.dts=te(Oe.dts-et,tt),Oe.dts<De[de>0?de-1:de].dts&&(ue=!0)}ue&&De.sort(function(dr,tr){var Pr=dr.dts-tr.dts,Wt=dr.pts-tr.pts;return Pr||Wt}),fe=De[0].dts;var Ue=De[De.length-1].dts-fe,Ke=Ue?Math.round(Ue/(Xe-1)):Be||ae.inputTimeScale/30;if(ve){var at=fe-tt,ut=at>Ke,st=at<-1;if((ut||st)&&(ut?F.logger.warn("AVC: "+(0,K.toMsFromMpegTsClock)(at,!0)+" ms ("+at+"dts) hole between fragments detected, filling it"):F.logger.warn("AVC: "+(0,K.toMsFromMpegTsClock)(-at,!0)+" ms ("+at+"dts) overlapping between fragments detected"),!st||tt>De[0].pts)){fe=tt;var ct=De[0].pts-at;De[0].dts=fe,De[0].pts=ct,F.logger.log("Video: First PTS/DTS adjusted: "+(0,K.toMsFromMpegTsClock)(ct,!0)+"/"+(0,K.toMsFromMpegTsClock)(fe,!0)+", delta: "+(0,K.toMsFromMpegTsClock)(at,!0)+" ms")}}fe=Math.max(0,fe);for(var yt=0,Ct=0,vt=0;vt<Xe;vt++){for(var ft=De[vt],Ut=ft.units,Nt=Ut.length,bt=0,sr=0;sr<Nt;sr++)bt+=Ut[sr].data.length;Ct+=bt,yt+=Nt,ft.length=bt,ft.dts=Math.max(ft.dts,fe),Fe=Math.min(ft.pts,Fe),J=Math.max(ft.pts,J)}xe=De[Xe-1].dts;var Yt,Qt=Ct+4*yt+8;try{Yt=new Uint8Array(Qt)}catch{return void this.observer.emit(w.Events.ERROR,w.Events.ERROR,{type:B.ErrorTypes.MUX_ERROR,details:B.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Qt,reason:"fail allocating video mdat "+Qt})}var lr=new DataView(Yt.buffer);lr.setUint32(0,Qt),Yt.set(D.types.mdat,4);for(var $t=!1,Ae=Number.POSITIVE_INFINITY,ye=Number.POSITIVE_INFINITY,Z=Number.NEGATIVE_INFINITY,me=Number.NEGATIVE_INFINITY,ge=0;ge<Xe;ge++){for(var Se=De[ge],be=Se.units,we=0,$e=0,ze=be.length;$e<ze;$e++){var Ge=be[$e],Ze=Ge.data,it=Ge.data.byteLength;lr.setUint32(nt,it),nt+=4,Yt.set(Ze,nt),nt+=it,we+=4+it}var rt=void 0;if(ge<Xe-1)Be=De[ge+1].dts-Se.dts,rt=De[ge+1].pts-Se.pts;else{var ot=this.config,gt=ge>0?Se.dts-De[ge-1].dts:Ke;if(rt=ge>0?Se.pts-De[ge-1].pts:Ke,ot.stretchShortVideoTrack&&this.nextAudioPts!==null){var St=Math.floor(ot.maxBufferHole*Ce),lt=(Pe?Fe+Pe*Ce:this.nextAudioPts)-Se.pts;lt>St?((Be=lt-gt)<0?Be=gt:$t=!0,F.logger.log("[mp4-remuxer]: It is approximately "+lt/90+" ms to the next segment; using duration "+Be/90+" ms for the last video frame.")):Be=gt}else Be=gt}var At=Math.round(Se.pts-Se.dts);Ae=Math.min(Ae,Be),Z=Math.max(Z,Be),ye=Math.min(ye,rt),me=Math.max(me,rt),ke.push(new X(Se.key,Be,we,At))}if(ke.length){if(re){if(re<70){var Ht=ke[0].flags;Ht.dependsOn=2,Ht.isNonSync=0}}else if(ee&&me-ye<Z-Ae&&Ke/Z<.025&&ke[0].cts===0){F.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Vt=fe,Lt=0,Jt=ke.length;Lt<Jt;Lt++){var mt=Vt+ke[Lt].duration,qt=Vt+ke[Lt].cts;if(Lt<Jt-1){var cr=mt+ke[Lt+1].cts;ke[Lt].duration=cr-qt}else ke[Lt].duration=Lt?ke[Lt-1].duration:Ke;ke[Lt].cts=0,Vt=mt}}}Be=$t||!Be?Ke:Be,this.nextAvcDts=tt=xe+Be,this.videoSampleDuration=Be,this.isVideoContiguous=!0;var Kt={data1:D.moof(ae.sequenceNumber++,fe,q({},ae,{samples:ke})),data2:Yt,startPTS:Fe/Ce,endPTS:(J+Be)/Ce,startDTS:fe/Ce,endDTS:tt/Ce,type:"video",hasAudio:!1,hasVideo:!0,nb:ke.length,dropped:ae.dropped};return ae.samples=[],ae.dropped=0,Kt},oe.remuxAudio=function(ae,_e,ve,Pe,fe){var xe=ae.inputTimeScale,Ce=xe/(ae.samplerate?ae.samplerate:xe),De=ae.segmentCodec==="aac"?1024:1152,ke=De*Ce,Xe=this._initPTS,et=ae.segmentCodec==="mp3"&&this.typeSupported.mpeg,tt=[],nt=fe!==void 0,Be=ae.samples,Fe=et?0:8,J=this.nextAudioPts||-1,ue=_e*xe;if(this.isAudioContiguous=ve=ve||Be.length&&J>0&&(Pe&&Math.abs(ue-J)<9e3||Math.abs(te(Be[0].pts-Xe,ue)-J)<20*ke),Be.forEach(function($e){$e.pts=te($e.pts-Xe,ue)}),!ve||J<0){if(Be=Be.filter(function($e){return $e.pts>=0}),!Be.length)return;J=fe===0?0:Pe&&!nt?Math.max(0,ue):Be[0].pts}if(ae.segmentCodec==="aac")for(var de=this.config.maxAudioFramesDrift,Oe=0,Ue=J;Oe<Be.length;Oe++){var Ke=Be[Oe],at=Ke.pts,ut=at-Ue,st=Math.abs(1e3*ut/xe);if(ut<=-de*ke&&nt)Oe===0&&(F.logger.warn("Audio frame @ "+(at/xe).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ut/xe)+" ms."),this.nextAudioPts=J=Ue=at);else if(ut>=de*ke&&st<1e4&&nt){var ct=Math.round(ut/ke);(Ue=at-ct*ke)<0&&(ct--,Ue+=ke),Oe===0&&(this.nextAudioPts=J=Ue),F.logger.warn("[mp4-remuxer]: Injecting "+ct+" audio frame @ "+(Ue/xe).toFixed(3)+"s due to "+Math.round(1e3*ut/xe)+" ms gap.");for(var yt=0;yt<ct;yt++){var Ct=Math.max(Ue,0),vt=m.getSilentFrame(ae.manifestCodec||ae.codec,ae.channelCount);vt||(F.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),vt=Ke.unit.subarray()),Be.splice(Oe,0,{unit:vt,pts:Ct}),Ue+=ke,Oe++}}Ke.pts=Ue,Ue+=ke}for(var ft,Ut=null,Nt=null,bt=0,sr=Be.length;sr--;)bt+=Be[sr].unit.byteLength;for(var Yt=0,Qt=Be.length;Yt<Qt;Yt++){var lr=Be[Yt],$t=lr.unit,Ae=lr.pts;if(Nt!==null)tt[Yt-1].duration=Math.round((Ae-Nt)/Ce);else{if(ve&&ae.segmentCodec==="aac"&&(Ae=J),Ut=Ae,!(bt>0))return;bt+=Fe;try{ft=new Uint8Array(bt)}catch{return void this.observer.emit(w.Events.ERROR,w.Events.ERROR,{type:B.ErrorTypes.MUX_ERROR,details:B.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:bt,reason:"fail allocating audio mdat "+bt})}et||(new DataView(ft.buffer).setUint32(0,bt),ft.set(D.types.mdat,4))}ft.set($t,Fe);var ye=$t.byteLength;Fe+=ye,tt.push(new X(!0,De,ye,0)),Nt=Ae}var Z=tt.length;if(Z){var me=tt[tt.length-1];this.nextAudioPts=J=Nt+Ce*me.duration;var ge=et?new Uint8Array(0):D.moof(ae.sequenceNumber++,Ut/Ce,q({},ae,{samples:tt}));ae.samples=[];var Se=Ut/xe,be=J/xe,we={data1:ge,data2:ft,startPTS:Se,endPTS:be,startDTS:Se,endDTS:be,type:"audio",hasAudio:!0,hasVideo:!1,nb:Z};return this.isAudioContiguous=!0,we}},oe.remuxEmptyAudio=function(ae,_e,ve,Pe){var fe=ae.inputTimeScale,xe=fe/(ae.samplerate?ae.samplerate:fe),Ce=this.nextAudioPts,De=(Ce!==null?Ce:Pe.startDTS*fe)+this._initDTS,ke=Pe.endDTS*fe+this._initDTS,Xe=1024*xe,et=Math.ceil((ke-De)/Xe),tt=m.getSilentFrame(ae.manifestCodec||ae.codec,ae.channelCount);if(F.logger.warn("[mp4-remuxer]: remux empty Audio"),tt){for(var nt=[],Be=0;Be<et;Be++){var Fe=De+Be*Xe;nt.push({unit:tt,pts:Fe,dts:Fe})}return ae.samples=nt,this.remuxAudio(ae,_e,ve,!1)}F.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},$}();function te($,oe){var ae;if(oe===null)return $;for(ae=oe<$?-8589934592:8589934592;Math.abs($-oe)>4294967296;)$+=ae;return $}function W($,oe,ae,_e){var ve=$.samples.length;if(ve){for(var Pe=$.inputTimeScale,fe=0;fe<ve;fe++){var xe=$.samples[fe];xe.pts=te(xe.pts-ae,oe*Pe)/Pe,xe.dts=te(xe.dts-_e,oe*Pe)/Pe}var Ce=$.samples;return $.samples=[],{samples:Ce}}}function z($,oe,ae){var _e=$.samples.length;if(_e){for(var ve=$.inputTimeScale,Pe=0;Pe<_e;Pe++){var fe=$.samples[Pe];fe.pts=te(fe.pts-ae,oe*ve)/ve}$.samples.sort(function(Ce,De){return Ce.pts-De.pts});var xe=$.samples;return $.samples=[],{samples:xe}}}var X=function($,oe,ae,_e){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=oe,this.size=ae,this.cts=_e,this.flags=new Q($)},Q=function($){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=$?2:1,this.isNonSync=$?0:1}},856:(s,o,l)=>{"use strict";var u;l.r(o),l.d(o,{MetadataSchema:()=>u}),function(m){m.audioId3="org.id3",m.dateRange="com.apple.quicktime.HLS",m.emsg="https://aomedia.org/emsg/ID3"}(u||(u={}))},308:(s,o,l)=>{"use strict";var u,m;l.r(o),l.d(o,{PlaylistContextType:()=>u,PlaylistLevelType:()=>m}),function(E){E.MANIFEST="manifest",E.LEVEL="level",E.AUDIO_TRACK="audioTrack",E.SUBTITLE_TRACK="subtitleTrack"}(u||(u={})),function(E){E.MAIN="main",E.AUDIO="audio",E.SUBTITLE="subtitle"}(m||(m={}))},93:(s,o,l)=>{"use strict";l.r(o),l.d(o,{enableLogs:()=>D,logger:()=>w});var u=function(){},m={trace:u,debug:u,log:u,warn:u,info:u,error:u},E=m;function y(B){var F=self.console[B];return F?F.bind(self.console,"["+B+"] >"):u}function D(B,F){if(self.console&&B===!0||typeof B=="object"){(function(V){for(var K=arguments.length,q=new Array(K>1?K-1:0),re=1;re<K;re++)q[re-1]=arguments[re];q.forEach(function(ee){E[ee]=V[ee]?V[ee].bind(V):y(ee)})})(B,"debug","log","info","warn","error");try{E.log('Debug logs enabled for "'+F+'"')}catch{E=m}}else E=m}var w=m},63:(s,o,l)=>{"use strict";l.r(o),l.d(o,{RemuxerTrackIdConfig:()=>w,appendUint8Array:()=>$,bin2str:()=>B,computeRawDurationFromSamples:()=>z,discardEPB:()=>ve,findBox:()=>re,getDuration:()=>W,getStartDTS:()=>te,offsetStartDTS:()=>X,parseEmsg:()=>Pe,parseInitSegment:()=>H,parseSEIMessageFromNALu:()=>_e,parseSamples:()=>oe,parseSegmentIndex:()=>ee,readSint32:()=>K,readUint16:()=>F,readUint32:()=>V,segmentValidRange:()=>Q,writeUint32:()=>q});var u=l(145),m=l(923),E=l(181),y=Math.pow(2,32)-1,D=[].push,w={video:1,audio:2,id3:3,text:4};function B(fe){return String.fromCharCode.apply(null,fe)}function F(fe,xe){var Ce=fe[xe]<<8|fe[xe+1];return Ce<0?65536+Ce:Ce}function V(fe,xe){var Ce=K(fe,xe);return Ce<0?4294967296+Ce:Ce}function K(fe,xe){return fe[xe]<<24|fe[xe+1]<<16|fe[xe+2]<<8|fe[xe+3]}function q(fe,xe,Ce){fe[xe]=Ce>>24,fe[xe+1]=Ce>>16&255,fe[xe+2]=Ce>>8&255,fe[xe+3]=255&Ce}function re(fe,xe){var Ce=[];if(!xe.length)return Ce;for(var De=fe.byteLength,ke=0;ke<De;){var Xe=V(fe,ke),et=Xe>1?ke+Xe:De;if(B(fe.subarray(ke+4,ke+8))===xe[0])if(xe.length===1)Ce.push(fe.subarray(ke+8,et));else{var tt=re(fe.subarray(ke+8,et),xe.slice(1));tt.length&&D.apply(Ce,tt)}ke=et}return Ce}function ee(fe){var xe=[],Ce=fe[0],De=8,ke=V(fe,De);De+=4,De+=Ce===0?8:16,De+=2;var Xe=fe.length+0,et=F(fe,De);De+=2;for(var tt=0;tt<et;tt++){var nt=De,Be=V(fe,nt);nt+=4;var Fe=2147483647&Be;if((2147483648&Be)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var J=V(fe,nt);nt+=4,xe.push({referenceSize:Fe,subsegmentDuration:J,info:{duration:J/ke,start:Xe,end:Xe+Fe-1}}),Xe+=Fe,De=nt+=4}return{earliestPresentationTime:0,timescale:ke,version:Ce,referencesCount:et,references:xe}}function H(fe){for(var xe=[],Ce=re(fe,["moov","trak"]),De=0;De<Ce.length;De++){var ke=Ce[De],Xe=re(ke,["tkhd"])[0];if(Xe){var et=Xe[0],tt=et===0?12:20,nt=V(Xe,tt),Be=re(ke,["mdia","mdhd"])[0];if(Be){var Fe=V(Be,tt=(et=Be[0])===0?12:20),J=re(ke,["mdia","hdlr"])[0];if(J){var ue=B(J.subarray(8,12)),de={soun:m.ElementaryStreamTypes.AUDIO,vide:m.ElementaryStreamTypes.VIDEO}[ue];if(de){var Oe=re(ke,["mdia","minf","stbl","stsd"])[0],Ue=void 0;Oe&&(Ue=B(Oe.subarray(12,16))),xe[nt]={timescale:Fe,type:de},xe[de]={timescale:Fe,id:nt,codec:Ue}}}}}}return re(fe,["moov","mvex","trex"]).forEach(function(Ke){var at=V(Ke,4),ut=xe[at];ut&&(ut.default={duration:V(Ke,12),flags:V(Ke,20)})}),xe}function te(fe,xe){return re(xe,["moof","traf"]).reduce(function(Ce,De){var ke=re(De,["tfdt"])[0],Xe=ke[0],et=re(De,["tfhd"]).reduce(function(tt,nt){var Be=V(nt,4),Fe=fe[Be];if(Fe){var J=V(ke,4);Xe===1&&(J*=Math.pow(2,32),J+=V(ke,8));var ue=J/(Fe.timescale||9e4);if(isFinite(ue)&&(tt===null||ue<tt))return ue}return tt},null);return et!==null&&isFinite(et)&&(Ce===null||et<Ce)?et:Ce},null)||0}function W(fe,xe){for(var Ce=0,De=0,ke=0,Xe=re(fe,["moof","traf"]),et=0;et<Xe.length;et++){var tt=Xe[et],nt=re(tt,["tfhd"])[0],Be=xe[V(nt,4)];if(Be){var Fe=Be.default,J=V(nt,0)|Fe?.flags,ue=Fe?.duration;8&J&&(ue=V(nt,2&J?12:8));for(var de=Be.timescale||9e4,Oe=re(tt,["trun"]),Ue=0;Ue<Oe.length;Ue++)!(Ce=z(Oe[Ue]))&&ue&&(Ce=ue*V(Oe[Ue],4)),Be.type===m.ElementaryStreamTypes.VIDEO?De+=Ce/de:Be.type===m.ElementaryStreamTypes.AUDIO&&(ke+=Ce/de)}}if(De===0&&ke===0){for(var Ke=0,at=re(fe,["sidx"]),ut=0;ut<at.length;ut++){var st=ee(at[ut]);st!=null&&st.references&&(Ke+=st.references.reduce(function(ct,yt){return ct+yt.info.duration||0},0))}return Ke}return De||ke}function z(fe){var xe=V(fe,0),Ce=8;1&xe&&(Ce+=4),4&xe&&(Ce+=4);for(var De=0,ke=V(fe,4),Xe=0;Xe<ke;Xe++)256&xe&&(De+=V(fe,Ce),Ce+=4),512&xe&&(Ce+=4),1024&xe&&(Ce+=4),2048&xe&&(Ce+=4);return De}function X(fe,xe,Ce){re(xe,["moof","traf"]).forEach(function(De){re(De,["tfhd"]).forEach(function(ke){var Xe=V(ke,4),et=fe[Xe];if(et){var tt=et.timescale||9e4;re(De,["tfdt"]).forEach(function(nt){var Be=nt[0],Fe=V(nt,4);if(Be===0)Fe-=Ce*tt,q(nt,4,Fe=Math.max(Fe,0));else{Fe*=Math.pow(2,32),Fe+=V(nt,8),Fe-=Ce*tt,Fe=Math.max(Fe,0);var J=Math.floor(Fe/(y+1)),ue=Math.floor(Fe%(y+1));q(nt,4,J),q(nt,8,ue)}})}})})}function Q(fe){var xe={valid:null,remainder:null},Ce=re(fe,["moof"]);if(!Ce)return xe;if(Ce.length<2)return xe.remainder=fe,xe;var De=Ce[Ce.length-1];return xe.valid=(0,u.sliceUint8)(fe,0,De.byteOffset-8),xe.remainder=(0,u.sliceUint8)(fe,De.byteOffset-8),xe}function $(fe,xe){var Ce=new Uint8Array(fe.length+xe.length);return Ce.set(fe),Ce.set(xe,fe.length),Ce}function oe(fe,xe){var Ce=[],De=xe.samples,ke=xe.timescale,Xe=xe.id,et=!1;return re(De,["moof"]).map(function(tt){var nt=tt.byteOffset-8;re(tt,["traf"]).map(function(Be){var Fe=re(Be,["tfdt"]).map(function(J){var ue=J[0],de=V(J,4);return ue===1&&(de*=Math.pow(2,32),de+=V(J,8)),de/ke})[0];return Fe!==void 0&&(fe=Fe),re(Be,["tfhd"]).map(function(J){var ue=V(J,4),de=16777215&V(J,0),Oe=0,Ue=(16&de)!=0,Ke=0,at=(32&de)!=0,ut=8;ue===Xe&&(1&de&&(ut+=8),2&de&&(ut+=4),8&de&&(Oe=V(J,ut),ut+=4),Ue&&(Ke=V(J,ut),ut+=4),at&&(ut+=4),xe.type==="video"&&(et=function(st){if(!st)return!1;var ct=st.indexOf("."),yt=ct<0?st:st.substring(0,ct);return yt==="hvc1"||yt==="hev1"||yt==="dvh1"||yt==="dvhe"}(xe.codec)),re(Be,["trun"]).map(function(st){var ct=st[0],yt=16777215&V(st,0),Ct=(1&yt)!=0,vt=0,ft=(4&yt)!=0,Ut=(256&yt)!=0,Nt=0,bt=(512&yt)!=0,sr=0,Yt=(1024&yt)!=0,Qt=(2048&yt)!=0,lr=0,$t=V(st,4),Ae=8;Ct&&(vt=V(st,Ae),Ae+=4),ft&&(Ae+=4);for(var ye=vt+nt,Z=0;Z<$t;Z++){if(Ut?(Nt=V(st,Ae),Ae+=4):Nt=Oe,bt?(sr=V(st,Ae),Ae+=4):sr=Ke,Yt&&(Ae+=4),Qt&&(lr=ct===0?V(st,Ae):K(st,Ae),Ae+=4),xe.type===m.ElementaryStreamTypes.VIDEO)for(var me=0;me<sr;){var ge=V(De,ye);ae(et,De[ye+=4])&&_e(De.subarray(ye,ye+ge),et?2:1,fe+lr/ke,Ce),ye+=ge,me+=ge+4}fe+=Nt/ke}}))})})}),Ce}function ae(fe,xe){if(fe){var Ce=xe>>1&63;return Ce===39||Ce===40}return(31&xe)==6}function _e(fe,xe,Ce,De){var ke=ve(fe),Xe=0;Xe+=xe;for(var et=0,tt=0,nt=!1,Be=0;Xe<ke.length;){et=0;do{if(Xe>=ke.length)break;et+=Be=ke[Xe++]}while(Be===255);tt=0;do{if(Xe>=ke.length)break;tt+=Be=ke[Xe++]}while(Be===255);var Fe=ke.length-Xe;if(!nt&&et===4&&Xe<ke.length){if(nt=!0,ke[Xe++]===181){var J=F(ke,Xe);if(Xe+=2,J===49){var ue=V(ke,Xe);if(Xe+=4,ue===1195456820){var de=ke[Xe++];if(de===3){var Oe=ke[Xe++],Ue=64&Oe,Ke=Ue?2+3*(31&Oe):0,at=new Uint8Array(Ke);if(Ue){at[0]=Oe;for(var ut=1;ut<Ke;ut++)at[ut]=ke[Xe++]}De.push({type:de,payloadType:et,pts:Ce,bytes:at})}}}}}else if(et===5&&tt<Fe){if(nt=!0,tt>16){for(var st=[],ct=0;ct<16;ct++){var yt=ke[Xe++].toString(16);st.push(yt.length==1?"0"+yt:yt),ct!==3&&ct!==5&&ct!==7&&ct!==9||st.push("-")}for(var Ct=tt-16,vt=new Uint8Array(Ct),ft=0;ft<Ct;ft++)vt[ft]=ke[Xe++];De.push({payloadType:et,pts:Ce,uuid:st.join(""),userData:(0,E.utf8ArrayToStr)(vt),userDataBytes:vt})}}else if(tt<Fe)Xe+=tt;else if(tt>Fe)break}}function ve(fe){for(var xe=fe.byteLength,Ce=[],De=1;De<xe-2;)fe[De]===0&&fe[De+1]===0&&fe[De+2]===3?(Ce.push(De+2),De+=2):De++;if(Ce.length===0)return fe;var ke=xe-Ce.length,Xe=new Uint8Array(ke),et=0;for(De=0;De<ke;et++,De++)et===Ce[0]&&(et++,Ce.shift()),Xe[De]=fe[et];return Xe}function Pe(fe){var xe=fe[0],Ce="",De="",ke=0,Xe=0,et=0,tt=0,nt=0,Be=0;if(xe===0){for(;B(fe.subarray(Be,Be+1))!=="\0";)Ce+=B(fe.subarray(Be,Be+1)),Be+=1;for(Ce+=B(fe.subarray(Be,Be+1)),Be+=1;B(fe.subarray(Be,Be+1))!=="\0";)De+=B(fe.subarray(Be,Be+1)),Be+=1;De+=B(fe.subarray(Be,Be+1)),Be+=1,ke=V(fe,12),Xe=V(fe,16),tt=V(fe,20),nt=V(fe,24),Be=28}else if(xe===1){ke=V(fe,Be+=4);var Fe=V(fe,Be+=4),J=V(fe,Be+=4);for(Be+=4,et=Math.pow(2,32)*Fe+J,Number.isSafeInteger(et)||(et=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),tt=V(fe,Be),nt=V(fe,Be+=4),Be+=4;B(fe.subarray(Be,Be+1))!=="\0";)Ce+=B(fe.subarray(Be,Be+1)),Be+=1;for(Ce+=B(fe.subarray(Be,Be+1)),Be+=1;B(fe.subarray(Be,Be+1))!=="\0";)De+=B(fe.subarray(Be,Be+1)),Be+=1;De+=B(fe.subarray(Be,Be+1)),Be+=1}return{schemeIdUri:Ce,value:De,timeScale:ke,presentationTime:et,presentationTimeDelta:Xe,eventDuration:tt,id:nt,payload:fe.subarray(Be,fe.byteLength)}}},673:(s,o,l)=>{"use strict";function u(D,w,B,F){B===void 0&&(B=1),F===void 0&&(F=!1);var V=D*w*B;return F?Math.round(V):V}function m(D,w,B,F){return B===void 0&&(B=1),F===void 0&&(F=!1),u(D,w,1/B,F)}function E(D,w){return w===void 0&&(w=!1),u(D,1e3,11111111111111112e-21,w)}function y(D,w){return w===void 0&&(w=1),u(D,9e4,1/w)}l.r(o),l.d(o,{toMpegTsClockFromTimescale:()=>y,toMsFromMpegTsClock:()=>E,toTimescaleFromBase:()=>u,toTimescaleFromScale:()=>m})},145:(s,o,l)=>{"use strict";function u(m,E,y){return Uint8Array.prototype.slice?m.slice(E,y):new Uint8Array(Array.prototype.slice.call(m,E,y))}l.r(o),l.d(o,{sliceUint8:()=>u})},729:s=>{"use strict";var o=Object.prototype.hasOwnProperty,l="~";function u(){}function m(w,B,F){this.fn=w,this.context=B,this.once=F||!1}function E(w,B,F,V,K){if(typeof F!="function")throw new TypeError("The listener must be a function");var q=new m(F,V||w,K),re=l?l+B:B;return w._events[re]?w._events[re].fn?w._events[re]=[w._events[re],q]:w._events[re].push(q):(w._events[re]=q,w._eventsCount++),w}function y(w,B){--w._eventsCount==0?w._events=new u:delete w._events[B]}function D(){this._events=new u,this._eventsCount=0}Object.create&&(u.prototype=Object.create(null),new u().__proto__||(l=!1)),D.prototype.eventNames=function(){var w,B,F=[];if(this._eventsCount===0)return F;for(B in w=this._events)o.call(w,B)&&F.push(l?B.slice(1):B);return Object.getOwnPropertySymbols?F.concat(Object.getOwnPropertySymbols(w)):F},D.prototype.listeners=function(w){var B=l?l+w:w,F=this._events[B];if(!F)return[];if(F.fn)return[F.fn];for(var V=0,K=F.length,q=new Array(K);V<K;V++)q[V]=F[V].fn;return q},D.prototype.listenerCount=function(w){var B=l?l+w:w,F=this._events[B];return F?F.fn?1:F.length:0},D.prototype.emit=function(w,B,F,V,K,q){var re=l?l+w:w;if(!this._events[re])return!1;var ee,H,te=this._events[re],W=arguments.length;if(te.fn){switch(te.once&&this.removeListener(w,te.fn,void 0,!0),W){case 1:return te.fn.call(te.context),!0;case 2:return te.fn.call(te.context,B),!0;case 3:return te.fn.call(te.context,B,F),!0;case 4:return te.fn.call(te.context,B,F,V),!0;case 5:return te.fn.call(te.context,B,F,V,K),!0;case 6:return te.fn.call(te.context,B,F,V,K,q),!0}for(H=1,ee=new Array(W-1);H<W;H++)ee[H-1]=arguments[H];te.fn.apply(te.context,ee)}else{var z,X=te.length;for(H=0;H<X;H++)switch(te[H].once&&this.removeListener(w,te[H].fn,void 0,!0),W){case 1:te[H].fn.call(te[H].context);break;case 2:te[H].fn.call(te[H].context,B);break;case 3:te[H].fn.call(te[H].context,B,F);break;case 4:te[H].fn.call(te[H].context,B,F,V);break;default:if(!ee)for(z=1,ee=new Array(W-1);z<W;z++)ee[z-1]=arguments[z];te[H].fn.apply(te[H].context,ee)}}return!0},D.prototype.on=function(w,B,F){return E(this,w,B,F,!1)},D.prototype.once=function(w,B,F){return E(this,w,B,F,!0)},D.prototype.removeListener=function(w,B,F,V){var K=l?l+w:w;if(!this._events[K])return this;if(!B)return y(this,K),this;var q=this._events[K];if(q.fn)q.fn!==B||V&&!q.once||F&&q.context!==F||y(this,K);else{for(var re=0,ee=[],H=q.length;re<H;re++)(q[re].fn!==B||V&&!q[re].once||F&&q[re].context!==F)&&ee.push(q[re]);ee.length?this._events[K]=ee.length===1?ee[0]:ee:y(this,K)}return this},D.prototype.removeAllListeners=function(w){var B;return w?(B=l?l+w:w,this._events[B]&&y(this,B)):(this._events=new u,this._eventsCount=0),this},D.prototype.off=D.prototype.removeListener,D.prototype.addListener=D.prototype.on,D.prefixed=l,D.EventEmitter=D,s.exports=D},945:function(s){var o,l,u,m,E;o=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,l=/^(?=([^\/?#]*))\1([^]*)$/,u=/(?:\/|^)\.(?=\/)/g,m=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,E={buildAbsoluteURL:function(y,D,w){if(w=w||{},y=y.trim(),!(D=D.trim())){if(!w.alwaysNormalize)return y;var B=E.parseURL(y);if(!B)throw new Error("Error trying to parse base URL.");return B.path=E.normalizePath(B.path),E.buildURLFromParts(B)}var F=E.parseURL(D);if(!F)throw new Error("Error trying to parse relative URL.");if(F.scheme)return w.alwaysNormalize?(F.path=E.normalizePath(F.path),E.buildURLFromParts(F)):D;var V=E.parseURL(y);if(!V)throw new Error("Error trying to parse base URL.");if(!V.netLoc&&V.path&&V.path[0]!=="/"){var K=l.exec(V.path);V.netLoc=K[1],V.path=K[2]}V.netLoc&&!V.path&&(V.path="/");var q={scheme:V.scheme,netLoc:F.netLoc,path:null,params:F.params,query:F.query,fragment:F.fragment};if(!F.netLoc&&(q.netLoc=V.netLoc,F.path[0]!=="/"))if(F.path){var re=V.path,ee=re.substring(0,re.lastIndexOf("/")+1)+F.path;q.path=E.normalizePath(ee)}else q.path=V.path,F.params||(q.params=V.params,F.query||(q.query=V.query));return q.path===null&&(q.path=w.alwaysNormalize?E.normalizePath(F.path):F.path),E.buildURLFromParts(q)},parseURL:function(y){var D=o.exec(y);return D?{scheme:D[1]||"",netLoc:D[2]||"",path:D[3]||"",params:D[4]||"",query:D[5]||"",fragment:D[6]||""}:null},normalizePath:function(y){for(y=y.split("").reverse().join("").replace(u,"");y.length!==(y=y.replace(m,"")).length;);return y.split("").reverse().join("")},buildURLFromParts:function(y){return y.scheme+y.netLoc+y.path+y.params+y.query+y.fragment}},s.exports=E}},r={};function i(s){var o=r[s];if(o!==void 0)return o.exports;var l=r[s]={exports:{}};return t[s].call(l.exports,l,l.exports,i),l.exports}i.m=t,i.n=s=>{var o=s&&s.__esModule?()=>s.default:()=>s;return i.d(o,{a:o}),o},i.d=(s,o)=>{for(var l in o)i.o(o,l)&&!i.o(s,l)&&Object.defineProperty(s,l,{enumerable:!0,get:o[l]})},i.o=(s,o)=>Object.prototype.hasOwnProperty.call(s,o),i.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var n=i(817);return n.default})())});var bn=Mi((exports,module)=>{(function(){var innerGlobal=typeof window<"u"?window:global,exportTo={};if(function(window,global,module){var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.arrayIteratorImpl=function(t){var r=0;return function(){return r<t.length?{done:!1,value:t[r++]}:{done:!0}}},$jscomp.arrayIterator=function(t){return{next:$jscomp.arrayIteratorImpl(t)}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.ISOLATE_POLYFILLS=!1,$jscomp.FORCE_POLYFILL_PROMISE=!1,$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||typeof Object.defineProperties=="function"?Object.defineProperty:function(t,r,i){return t==Array.prototype||t==Object.prototype||(t[r]=i.value),t},$jscomp.getGlobal=function(t){t=[typeof globalThis=="object"&&globalThis,t,typeof window=="object"&&window,typeof self=="object"&&self,typeof global=="object"&&global];for(var r=0;r<t.length;++r){var i=t[r];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")},$jscomp.global=$jscomp.getGlobal(this),$jscomp.IS_SYMBOL_NATIVE=typeof Symbol=="function"&&typeof Symbol("x")=="symbol",$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE,$jscomp.polyfills={},$jscomp.propertyToPolyfillSymbol={},$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(t,r){var i=$jscomp.propertyToPolyfillSymbol[r];return i==null?t[r]:(i=t[i],i!==void 0?i:t[r])};$jscomp.polyfill=function(t,r,i,n){r&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(t,r,i,n):$jscomp.polyfillUnisolated(t,r,i,n))},$jscomp.polyfillUnisolated=function(t,r,i,n){for(i=$jscomp.global,t=t.split("."),n=0;n<t.length-1;n++){var s=t[n];if(!(s in i))return;i=i[s]}t=t[t.length-1],n=i[t],r=r(n),r!=n&&r!=null&&$jscomp.defineProperty(i,t,{configurable:!0,writable:!0,value:r})},$jscomp.polyfillIsolated=function(t,r,i,n){var s=t.split(".");t=s.length===1,n=s[0],n=!t&&n in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var o=0;o<s.length-1;o++){var l=s[o];if(!(l in n))return;n=n[l]}s=s[s.length-1],i=$jscomp.IS_SYMBOL_NATIVE&&i==="es6"?n[s]:null,r=r(i),r!=null&&(t?$jscomp.defineProperty($jscomp.polyfills,s,{configurable:!0,writable:!0,value:r}):r!==i&&($jscomp.propertyToPolyfillSymbol[s]===void 0&&(i=1e9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[s]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(s):$jscomp.POLYFILL_PREFIX+i+"$"+s),$jscomp.defineProperty(n,$jscomp.propertyToPolyfillSymbol[s],{configurable:!0,writable:!0,value:r})))},$jscomp.initSymbol=function(){},$jscomp.polyfill("Symbol",function(t){if(t)return t;var r=function(o,l){this.$jscomp$symbol$id_=o,$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:l})};r.prototype.toString=function(){return this.$jscomp$symbol$id_};var i="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",n=0,s=function(o){if(this instanceof s)throw new TypeError("Symbol is not a constructor");return new r(i+(o||"")+"_"+n++,o)};return s},"es6","es3"),$jscomp.polyfill("Symbol.iterator",function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var r="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<r.length;i++){var n=$jscomp.global[r[i]];typeof n=="function"&&typeof n.prototype[t]!="function"&&$jscomp.defineProperty(n.prototype,t,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return t},"es6","es3"),$jscomp.iteratorPrototype=function(t){return t={next:t},t[Symbol.iterator]=function(){return this},t},$jscomp.createTemplateTagFirstArg=function(t){return t.raw=t},$jscomp.createTemplateTagFirstArgWithRaw=function(t,r){return t.raw=r,t},$jscomp.makeIterator=function(t){var r=typeof Symbol<"u"&&Symbol.iterator&&t[Symbol.iterator];return r?r.call(t):$jscomp.arrayIterator(t)},$jscomp.arrayFromIterator=function(t){for(var r,i=[];!(r=t.next()).done;)i.push(r.value);return i},$jscomp.arrayFromIterable=function(t){return t instanceof Array?t:$jscomp.arrayFromIterator($jscomp.makeIterator(t))},$jscomp.objectCreate=$jscomp.ASSUME_ES5||typeof Object.create=="function"?Object.create:function(t){var r=function(){};return r.prototype=t,new r},$jscomp.getConstructImplementation=function(){function t(){function i(){}return new i,Reflect.construct(i,[],function(){}),new i instanceof i}if($jscomp.TRUST_ES6_POLYFILLS&&typeof Reflect<"u"&&Reflect.construct){if(t())return Reflect.construct;var r=Reflect.construct;return function(i,n,s){return i=r(i,n),s&&Reflect.setPrototypeOf(i,s.prototype),i}}return function(i,n,s){return s===void 0&&(s=i),s=$jscomp.objectCreate(s.prototype||Object.prototype),Function.prototype.apply.call(i,s,n)||s}},$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf(),$jscomp.underscoreProtoCanBeSet=function(){var t={a:!0},r={};try{return r.__proto__=t,r.a}catch{}return!1},$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(t,r){if(t.__proto__=r,t.__proto__!==r)throw new TypeError(t+" is not extensible");return t}:null,$jscomp.inherits=function(t,r){if(t.prototype=$jscomp.objectCreate(r.prototype),t.prototype.constructor=t,$jscomp.setPrototypeOf){var i=$jscomp.setPrototypeOf;i(t,r)}else for(i in r)if(i!="prototype")if(Object.defineProperties){var n=Object.getOwnPropertyDescriptor(r,i);n&&Object.defineProperty(t,i,n)}else t[i]=r[i];t.superClass_=r.prototype},$jscomp.generator={},$jscomp.generator.ensureIteratorResultIsObject_=function(t){if(!(t instanceof Object))throw new TypeError("Iterator result "+t+" is not an object")},$jscomp.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1},$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},$jscomp.generator.Context.prototype.next_=function(t){this.yieldResult=t},$jscomp.generator.Context.prototype.throw_=function(t){this.abruptCompletion_={exception:t,isException:!0},this.jumpToErrorHandler_()},$jscomp.generator.Context.prototype.return=function(t){this.abruptCompletion_={return:t},this.nextAddress=this.finallyAddress_},$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(t){this.abruptCompletion_={jumpTo:t},this.nextAddress=this.finallyAddress_},$jscomp.generator.Context.prototype.yield=function(t,r){return this.nextAddress=r,{value:t}},$jscomp.generator.Context.prototype.yieldAll=function(t,r){var i=$jscomp.makeIterator(t),n=i.next();if($jscomp.generator.ensureIteratorResultIsObject_(n),n.done)this.yieldResult=n.value,this.nextAddress=r;else return this.yieldAllIterator_=i,this.yield(n.value,r)},$jscomp.generator.Context.prototype.jumpTo=function(t){this.nextAddress=t},$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(t,r){this.catchAddress_=t,r!=null&&(this.finallyAddress_=r)},$jscomp.generator.Context.prototype.setFinallyBlock=function(t){this.catchAddress_=0,this.finallyAddress_=t||0},$jscomp.generator.Context.prototype.leaveTryBlock=function(t,r){this.nextAddress=t,this.catchAddress_=r||0},$jscomp.generator.Context.prototype.enterCatchBlock=function(t){return this.catchAddress_=t||0,t=this.abruptCompletion_.exception,this.abruptCompletion_=null,t},$jscomp.generator.Context.prototype.enterFinallyBlock=function(t,r,i){i?this.finallyContexts_[i]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=t||0,this.finallyAddress_=r||0},$jscomp.generator.Context.prototype.leaveFinallyBlock=function(t,r){var i=this.finallyContexts_.splice(r||0)[0];if(i=this.abruptCompletion_=this.abruptCompletion_||i){if(i.isException)return this.jumpToErrorHandler_();i.jumpTo!=null&&this.finallyAddress_<i.jumpTo?(this.nextAddress=i.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=t},$jscomp.generator.Context.prototype.forIn=function(t){return new $jscomp.generator.Context.PropertyIterator(t)},$jscomp.generator.Context.PropertyIterator=function(t){this.object_=t,this.properties_=[];for(var r in t)this.properties_.push(r);this.properties_.reverse()},$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var t=this.properties_.pop();if(t in this.object_)return t}return null},$jscomp.generator.Engine_=function(t){this.context_=new $jscomp.generator.Context,this.program_=t},$jscomp.generator.Engine_.prototype.next_=function(t){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,t,this.context_.next_):(this.context_.next_(t),this.nextStep_())},$jscomp.generator.Engine_.prototype.return_=function(t){this.context_.start_();var r=this.context_.yieldAllIterator_;return r?this.yieldAllStep_("return"in r?r.return:function(i){return{value:i,done:!0}},t,this.context_.return):(this.context_.return(t),this.nextStep_())},$jscomp.generator.Engine_.prototype.throw_=function(t){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,t,this.context_.next_):(this.context_.throw_(t),this.nextStep_())},$jscomp.generator.Engine_.prototype.yieldAllStep_=function(t,r,i){try{var n=t.call(this.context_.yieldAllIterator_,r);if($jscomp.generator.ensureIteratorResultIsObject_(n),!n.done)return this.context_.stop_(),n;var s=n.value}catch(o){return this.context_.yieldAllIterator_=null,this.context_.throw_(o),this.nextStep_()}return this.context_.yieldAllIterator_=null,i.call(this.context_,s),this.nextStep_()},$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var t=this.program_(this.context_);if(t)return this.context_.stop_(),{value:t.value,done:!1}}catch(r){this.context_.yieldResult=void 0,this.context_.throw_(r)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(t=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,t.isException)throw t.exception;return{value:t.return,done:!0}}return{value:void 0,done:!0}},$jscomp.generator.Generator_=function(t){this.next=function(r){return t.next_(r)},this.throw=function(r){return t.throw_(r)},this.return=function(r){return t.return_(r)},this[Symbol.iterator]=function(){return this}},$jscomp.generator.createGenerator=function(t,r){var i=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(r));return $jscomp.setPrototypeOf&&t.prototype&&$jscomp.setPrototypeOf(i,t.prototype),i},$jscomp.asyncExecutePromiseGenerator=function(t){function r(n){return t.next(n)}function i(n){return t.throw(n)}return new Promise(function(n,s){function o(l){l.done?n(l.value):Promise.resolve(l.value).then(r,i).then(o,s)}o(t.next())})},$jscomp.asyncExecutePromiseGeneratorFunction=function(t){return $jscomp.asyncExecutePromiseGenerator(t())},$jscomp.asyncExecutePromiseGeneratorProgram=function(t){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(t)))},$jscomp.getRestArguments=function(){for(var t=Number(this),r=[],i=t;i<arguments.length;i++)r[i-t]=arguments[i];return r},$jscomp.polyfill("Reflect",function(t){return t||{}},"es6","es3"),$jscomp.polyfill("Reflect.construct",function(t){return $jscomp.construct},"es6","es3"),$jscomp.polyfill("Reflect.setPrototypeOf",function(t){if(t)return t;if($jscomp.setPrototypeOf){var r=$jscomp.setPrototypeOf;return function(i,n){try{return r(i,n),!0}catch{return!1}}}return null},"es6","es5"),$jscomp.polyfill("Promise",function(t){function r(){this.batch_=null}function i(l){return l instanceof s?l:new s(function(u,m){u(l)})}if(t&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&typeof $jscomp.global.PromiseRejectionEvent>"u")||!$jscomp.global.Promise||$jscomp.global.Promise.toString().indexOf("[native code]")===-1))return t;r.prototype.asyncExecute=function(l){if(this.batch_==null){this.batch_=[];var u=this;this.asyncExecuteFunction(function(){u.executeBatch_()})}this.batch_.push(l)};var n=$jscomp.global.setTimeout;r.prototype.asyncExecuteFunction=function(l){n(l,0)},r.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var l=this.batch_;this.batch_=[];for(var u=0;u<l.length;++u){var m=l[u];l[u]=null;try{m()}catch(E){this.asyncThrow_(E)}}}this.batch_=null},r.prototype.asyncThrow_=function(l){this.asyncExecuteFunction(function(){throw l})};var s=function(l){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[],this.isRejectionHandled_=!1;var u=this.createResolveAndReject_();try{l(u.resolve,u.reject)}catch(m){u.reject(m)}};s.prototype.createResolveAndReject_=function(){function l(E){return function(y){m||(m=!0,E.call(u,y))}}var u=this,m=!1;return{resolve:l(this.resolveTo_),reject:l(this.reject_)}},s.prototype.resolveTo_=function(l){if(l===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(l instanceof s)this.settleSameAsPromise_(l);else{e:switch(typeof l){case"object":var u=l!=null;break e;case"function":u=!0;break e;default:u=!1}u?this.resolveToNonPromiseObj_(l):this.fulfill_(l)}},s.prototype.resolveToNonPromiseObj_=function(l){var u=void 0;try{u=l.then}catch(m){this.reject_(m);return}typeof u=="function"?this.settleSameAsThenable_(u,l):this.fulfill_(l)},s.prototype.reject_=function(l){this.settle_(2,l)},s.prototype.fulfill_=function(l){this.settle_(1,l)},s.prototype.settle_=function(l,u){if(this.state_!=0)throw Error("Cannot settle("+l+", "+u+"): Promise already settled in state"+this.state_);this.state_=l,this.result_=u,this.state_===2&&this.scheduleUnhandledRejectionCheck_(),this.executeOnSettledCallbacks_()},s.prototype.scheduleUnhandledRejectionCheck_=function(){var l=this;n(function(){if(l.notifyUnhandledRejection_()){var u=$jscomp.global.console;typeof u<"u"&&u.error(l.result_)}},1)},s.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var l=$jscomp.global.CustomEvent,u=$jscomp.global.Event,m=$jscomp.global.dispatchEvent;return typeof m>"u"?!0:(typeof l=="function"?l=new l("unhandledrejection",{cancelable:!0}):typeof u=="function"?l=new u("unhandledrejection",{cancelable:!0}):(l=$jscomp.global.document.createEvent("CustomEvent"),l.initCustomEvent("unhandledrejection",!1,!0,l)),l.promise=this,l.reason=this.result_,m(l))},s.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){for(var l=0;l<this.onSettledCallbacks_.length;++l)o.asyncExecute(this.onSettledCallbacks_[l]);this.onSettledCallbacks_=null}};var o=new r;return s.prototype.settleSameAsPromise_=function(l){var u=this.createResolveAndReject_();l.callWhenSettled_(u.resolve,u.reject)},s.prototype.settleSameAsThenable_=function(l,u){var m=this.createResolveAndReject_();try{l.call(u,m.resolve,m.reject)}catch(E){m.reject(E)}},s.prototype.then=function(l,u){function m(w,B){return typeof w=="function"?function(F){try{E(w(F))}catch(V){y(V)}}:B}var E,y,D=new s(function(w,B){E=w,y=B});return this.callWhenSettled_(m(l,E),m(u,y)),D},s.prototype.catch=function(l){return this.then(void 0,l)},s.prototype.callWhenSettled_=function(l,u){function m(){switch(E.state_){case 1:l(E.result_);break;case 2:u(E.result_);break;default:throw Error("Unexpected state: "+E.state_)}}var E=this;this.onSettledCallbacks_==null?o.asyncExecute(m):this.onSettledCallbacks_.push(m),this.isRejectionHandled_=!0},s.resolve=i,s.reject=function(l){return new s(function(u,m){m(l)})},s.race=function(l){return new s(function(u,m){for(var E=$jscomp.makeIterator(l),y=E.next();!y.done;y=E.next())i(y.value).callWhenSettled_(u,m)})},s.all=function(l){var u=$jscomp.makeIterator(l),m=u.next();return m.done?i([]):new s(function(E,y){function D(F){return function(V){w[F]=V,B--,B==0&&E(w)}}var w=[],B=0;do w.push(void 0),B++,i(m.value).callWhenSettled_(D(w.length-1),y),m=u.next();while(!m.done)})},s},"es6","es3"),$jscomp.checkEs6ConformanceViaProxy=function(){try{var t={},r=Object.create(new $jscomp.global.Proxy(t,{get:function(i,n,s){return i==t&&n=="q"&&s==r}}));return r.q===!0}catch{return!1}},$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy(),$jscomp.owns=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},$jscomp.polyfill("WeakMap",function(t){function r(){if(!t||!Object.seal)return!1;try{var E=Object.seal({}),y=Object.seal({}),D=new t([[E,2],[y,3]]);return D.get(E)!=2||D.get(y)!=3?!1:(D.delete(E),D.set(y,4),!D.has(E)&&D.get(y)==4)}catch{return!1}}function i(){}function n(E){var y=typeof E;return y==="object"&&E!==null||y==="function"}function s(E){if(!$jscomp.owns(E,l)){var y=new i;$jscomp.defineProperty(E,l,{value:y})}}function o(E){if(!$jscomp.ISOLATE_POLYFILLS){var y=Object[E];y&&(Object[E]=function(D){return D instanceof i?D:(Object.isExtensible(D)&&s(D),y(D))})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(t&&$jscomp.ES6_CONFORMANCE)return t}else if(r())return t;var l="$jscomp_hidden_"+Math.random();o("freeze"),o("preventExtensions"),o("seal");var u=0,m=function(E){if(this.id_=(u+=Math.random()+1).toString(),E){E=$jscomp.makeIterator(E);for(var y;!(y=E.next()).done;)y=y.value,this.set(y[0],y[1])}};return m.prototype.set=function(E,y){if(!n(E))throw Error("Invalid WeakMap key");if(s(E),!$jscomp.owns(E,l))throw Error("WeakMap key fail: "+E);return E[l][this.id_]=y,this},m.prototype.get=function(E){return n(E)&&$jscomp.owns(E,l)?E[l][this.id_]:void 0},m.prototype.has=function(E){return n(E)&&$jscomp.owns(E,l)&&$jscomp.owns(E[l],this.id_)},m.prototype.delete=function(E){return n(E)&&$jscomp.owns(E,l)&&$jscomp.owns(E[l],this.id_)?delete E[l][this.id_]:!1},m},"es6","es3"),$jscomp.MapEntry=function(){},$jscomp.polyfill("Map",function(t){function r(){if($jscomp.ASSUME_NO_NATIVE_MAP||!t||typeof t!="function"||!t.prototype.entries||typeof Object.seal!="function")return!1;try{var m=Object.seal({x:4}),E=new t($jscomp.makeIterator([[m,"s"]]));if(E.get(m)!="s"||E.size!=1||E.get({x:4})||E.set({x:4},"t")!=E||E.size!=2)return!1;var y=E.entries(),D=y.next();return D.done||D.value[0]!=m||D.value[1]!="s"?!1:(D=y.next(),!(D.done||D.value[0].x!=4||D.value[1]!="t"||!y.next().done))}catch{return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(t&&$jscomp.ES6_CONFORMANCE)return t}else if(r())return t;var i=new WeakMap,n=function(m){if(this.data_={},this.head_=l(),this.size=0,m){m=$jscomp.makeIterator(m);for(var E;!(E=m.next()).done;)E=E.value,this.set(E[0],E[1])}};n.prototype.set=function(m,E){m=m===0?0:m;var y=s(this,m);return y.list||(y.list=this.data_[y.id]=[]),y.entry?y.entry.value=E:(y.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:m,value:E},y.list.push(y.entry),this.head_.previous.next=y.entry,this.head_.previous=y.entry,this.size++),this},n.prototype.delete=function(m){return m=s(this,m),m.entry&&m.list?(m.list.splice(m.index,1),m.list.length||delete this.data_[m.id],m.entry.previous.next=m.entry.next,m.entry.next.previous=m.entry.previous,m.entry.head=null,this.size--,!0):!1},n.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=l(),this.size=0},n.prototype.has=function(m){return!!s(this,m).entry},n.prototype.get=function(m){return(m=s(this,m).entry)&&m.value},n.prototype.entries=function(){return o(this,function(m){return[m.key,m.value]})},n.prototype.keys=function(){return o(this,function(m){return m.key})},n.prototype.values=function(){return o(this,function(m){return m.value})},n.prototype.forEach=function(m,E){for(var y=this.entries(),D;!(D=y.next()).done;)D=D.value,m.call(E,D[1],D[0],this)},n.prototype[Symbol.iterator]=n.prototype.entries;var s=function(m,E){var y=E&&typeof E;y=="object"||y=="function"?i.has(E)?y=i.get(E):(y=""+ ++u,i.set(E,y)):y="p_"+E;var D=m.data_[y];if(D&&$jscomp.owns(m.data_,y))for(var w=0;w<D.length;w++){var B=D[w];if(E!==E&&B.key!==B.key||E===B.key)return{id:y,list:D,index:w,entry:B}}return{id:y,list:D,index:-1,entry:void 0}},o=function(m,E){var y=m.head_;return $jscomp.iteratorPrototype(function(){if(y){for(;y.head!=m.head_;)y=y.previous;for(;y.next!=y.head;)return y=y.next,{done:!1,value:E(y)};y=null}return{done:!0,value:void 0}})},l=function(){var m={};return m.previous=m.next=m.head=m},u=0;return n},"es6","es3"),$jscomp.polyfill("Set",function(t){function r(){if($jscomp.ASSUME_NO_NATIVE_SET||!t||typeof t!="function"||!t.prototype.entries||typeof Object.seal!="function")return!1;try{var n=Object.seal({x:4}),s=new t($jscomp.makeIterator([n]));if(!s.has(n)||s.size!=1||s.add(n)!=s||s.size!=1||s.add({x:4})!=s||s.size!=2)return!1;var o=s.entries(),l=o.next();return l.done||l.value[0]!=n||l.value[1]!=n?!1:(l=o.next(),l.done||l.value[0]==n||l.value[0].x!=4||l.value[1]!=l.value[0]?!1:o.next().done)}catch{return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(t&&$jscomp.ES6_CONFORMANCE)return t}else if(r())return t;var i=function(n){if(this.map_=new Map,n){n=$jscomp.makeIterator(n);for(var s;!(s=n.next()).done;)this.add(s.value)}this.size=this.map_.size};return i.prototype.add=function(n){return n=n===0?0:n,this.map_.set(n,n),this.size=this.map_.size,this},i.prototype.delete=function(n){return n=this.map_.delete(n),this.size=this.map_.size,n},i.prototype.clear=function(){this.map_.clear(),this.size=0},i.prototype.has=function(n){return this.map_.has(n)},i.prototype.entries=function(){return this.map_.entries()},i.prototype.values=function(){return this.map_.values()},i.prototype.keys=i.prototype.values,i.prototype[Symbol.iterator]=i.prototype.values,i.prototype.forEach=function(n,s){var o=this;this.map_.forEach(function(l){return n.call(s,l,l,o)})},i},"es6","es3"),$jscomp.findInternal=function(t,r,i){t instanceof String&&(t=String(t));for(var n=t.length,s=0;s<n;s++){var o=t[s];if(r.call(i,o,s,t))return{i:s,v:o}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.findIndex",function(t){return t||function(r,i){return $jscomp.findInternal(this,r,i).i}},"es6","es3"),$jscomp.polyfill("Object.is",function(t){return t||function(r,i){return r===i?r!==0||1/r===1/i:r!==r&&i!==i}},"es6","es3"),$jscomp.polyfill("Array.prototype.includes",function(t){return t||function(r,i){var n=this;n instanceof String&&(n=String(n));var s=n.length,o=i||0;for(0>o&&(o=Math.max(o+s,0));o<s;o++){var l=n[o];if(l===r||Object.is(l,r))return!0}return!1}},"es7","es3"),$jscomp.checkStringArgs=function(t,r,i){if(t==null)throw new TypeError("The 'this' value for String.prototype."+i+" must not be null or undefined");if(r instanceof RegExp)throw new TypeError("First argument to String.prototype."+i+" must not be a regular expression");return t+""},$jscomp.polyfill("String.prototype.includes",function(t){return t||function(r,i){return $jscomp.checkStringArgs(this,r,"includes").indexOf(r,i||0)!==-1}},"es6","es3"),$jscomp.polyfill("Array.prototype.find",function(t){return t||function(r,i){return $jscomp.findInternal(this,r,i).v}},"es6","es3"),$jscomp.polyfill("String.prototype.startsWith",function(t){return t||function(r,i){var n=$jscomp.checkStringArgs(this,r,"startsWith");r+="";for(var s=n.length,o=r.length,l=Math.max(0,Math.min(i|0,n.length)),u=0;u<o&&l<s;)if(n[l++]!=r[u++])return!1;return u>=o}},"es6","es3"),$jscomp.iteratorFromArray=function(t,r){t instanceof String&&(t+="");var i=0,n=!1,s={next:function(){if(!n&&i<t.length){var o=i++;return{value:r(o,t[o]),done:!1}}return n=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s},$jscomp.polyfill("Array.prototype.keys",function(t){return t||function(){return $jscomp.iteratorFromArray(this,function(r){return r})}},"es6","es3"),$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&typeof Object.assign=="function"?Object.assign:function(t,r){for(var i=1;i<arguments.length;i++){var n=arguments[i];if(n)for(var s in n)$jscomp.owns(n,s)&&(t[s]=n[s])}return t},$jscomp.polyfill("Object.assign",function(t){return t||$jscomp.assign},"es6","es3"),$jscomp.polyfill("Array.from",function(t){return t||function(r,i,n){i=i??function(u){return u};var s=[],o=typeof Symbol<"u"&&Symbol.iterator&&r[Symbol.iterator];if(typeof o=="function"){r=o.call(r);for(var l=0;!(o=r.next()).done;)s.push(i.call(n,o.value,l++))}else for(o=r.length,l=0;l<o;l++)s.push(i.call(n,r[l],l));return s}},"es6","es3"),$jscomp.polyfill("Array.prototype.values",function(t){return t||function(){return $jscomp.iteratorFromArray(this,function(r,i){return i})}},"es8","es3"),$jscomp.polyfill("Promise.prototype.finally",function(t){return t||function(r){return this.then(function(i){return Promise.resolve(r()).then(function(){return i})},function(i){return Promise.resolve(r()).then(function(){throw i})})}},"es9","es3"),$jscomp.polyfill("Array.prototype.entries",function(t){return t||function(){return $jscomp.iteratorFromArray(this,function(r,i){return[r,i]})}},"es6","es3"),$jscomp.polyfill("String.prototype.repeat",function(t){return t||function(r){var i=$jscomp.checkStringArgs(this,null,"repeat");if(0>r||1342177279<r)throw new RangeError("Invalid count value");r|=0;for(var n="";r;)r&1&&(n+=i),(r>>>=1)&&(i+=i);return n}},"es6","es3"),$jscomp.polyfill("Number.isNaN",function(t){return t||function(r){return typeof r=="number"&&isNaN(r)}},"es6","es3"),$jscomp.polyfill("Object.values",function(t){return t||function(r){var i=[],n;for(n in r)$jscomp.owns(r,n)&&i.push(r[n]);return i}},"es8","es3"),$jscomp.polyfill("Math.log2",function(t){return t||function(r){return Math.log(r)/Math.LN2}},"es6","es3"),$jscomp.polyfill("Object.entries",function(t){return t||function(r){var i=[],n;for(n in r)$jscomp.owns(r,n)&&i.push([n,r[n]]);return i}},"es8","es3");var COMPILED=!0,goog=goog||{};if(goog.global=this||self,goog.exportPath_=function(t,r,i,n){t=t.split("."),n=n||goog.global,t[0]in n||typeof n.execScript>"u"||n.execScript("var "+t[0]);for(var s;t.length&&(s=t.shift());)if(t.length||r===void 0)n=n[s]&&n[s]!==Object.prototype[s]?n[s]:n[s]={};else if(!i&&goog.isObject(r)&&goog.isObject(n[s]))for(var o in r)r.hasOwnProperty(o)&&(n[s][o]=r[o]);else n[s]=r},goog.define=function(t,r){var i=r;if(!COMPILED){var n=goog.global.CLOSURE_UNCOMPILED_DEFINES,s=goog.global.CLOSURE_DEFINES;n&&n.nodeType===void 0&&Object.prototype.hasOwnProperty.call(n,t)?i=n[t]:s&&s.nodeType===void 0&&Object.prototype.hasOwnProperty.call(s,t)&&(i=s[t])}return i},goog.FEATURESET_YEAR=2012,goog.DEBUG=!0,goog.LOCALE="en",goog.getLocale=function(){return goog.LOCALE},goog.TRUSTED_SITE=!0,goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG,goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1,goog.provide=function(t){if(goog.isInModuleLoader_())throw Error("goog.provide cannot be used within a module.");if(!COMPILED&&goog.isProvided_(t))throw Error('Namespace "'+t+'" already declared.');goog.constructNamespace_(t)},goog.constructNamespace_=function(t,r,i){if(!COMPILED){delete goog.implicitNamespaces_[t];for(var n=t;(n=n.substring(0,n.lastIndexOf(".")))&&!goog.getObjectByName(n);)goog.implicitNamespaces_[n]=!0}goog.exportPath_(t,r,i)},goog.NONCE_PATTERN_=/^[\w+/_-]+[=]{0,2}$/,goog.getScriptNonce_=function(t){return t=(t||goog.global).document,(t=t.querySelector&&t.querySelector("script[nonce]"))&&(t=t.nonce||t.getAttribute("nonce"))&&goog.NONCE_PATTERN_.test(t)?t:""},goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/,goog.module=function(t){if(typeof t!="string"||!t||t.search(goog.VALID_MODULE_RE_)==-1)throw Error("Invalid module identifier");if(!goog.isInGoogModuleLoader_())throw Error("Module "+t+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");if(goog.moduleLoaderState_.moduleName=t,!COMPILED){if(goog.isProvided_(t))throw Error('Namespace "'+t+'" already declared.');delete goog.implicitNamespaces_[t]}},goog.module.get=function(t){return goog.module.getInternal_(t)},goog.module.getInternal_=function(t){if(!COMPILED){if(t in goog.loadedModules_)return goog.loadedModules_[t].exports;if(!goog.implicitNamespaces_[t])return t=goog.getObjectByName(t),t??null}return null},goog.ModuleType={ES6:"es6",GOOG:"goog"},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return goog.isInGoogModuleLoader_()||goog.isInEs6ModuleLoader_()},goog.isInGoogModuleLoader_=function(){return!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.GOOG},goog.isInEs6ModuleLoader_=function(){if(goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.ES6)return!0;var t=goog.global.$jscomp;return t?typeof t.getCurrentModulePath!="function"?!1:!!t.getCurrentModulePath():!1},goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInGoogModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.declareModuleId=function(t){if(!COMPILED){if(!goog.isInEs6ModuleLoader_())throw Error("goog.declareModuleId may only be called from within an ES6 module");if(goog.moduleLoaderState_&&goog.moduleLoaderState_.moduleName)throw Error("goog.declareModuleId may only be called once per module.");if(t in goog.loadedModules_)throw Error('Module with namespace "'+t+'" already exists.')}if(goog.moduleLoaderState_)goog.moduleLoaderState_.moduleName=t;else{var r=goog.global.$jscomp;if(!r||typeof r.getCurrentModulePath!="function")throw Error('Module with namespace "'+t+'" has been loaded incorrectly.');r=r.require(r.getCurrentModulePath()),goog.loadedModules_[t]={exports:r,type:goog.ModuleType.ES6,moduleId:t}}},goog.setTestOnly=function(t){if(goog.DISALLOW_TEST_ONLY_CODE)throw t=t||"",Error("Importing test-only code into non-debug environment"+(t?": "+t:"."))},goog.forwardDeclare=function(t){},COMPILED||(goog.isProvided_=function(t){return t in goog.loadedModules_||!goog.implicitNamespaces_[t]&&goog.getObjectByName(t)!=null},goog.implicitNamespaces_={"goog.module":!0}),goog.getObjectByName=function(t,r){for(var i=t.split("."),n=r||goog.global,s=0;s<i.length;s++)if(n=n[i[s]],n==null)return null;return n},goog.addDependency=function(t,r,i,n){!COMPILED&&goog.DEPENDENCIES_ENABLED&&goog.debugLoader_.addDependency(t,r,i,n)},goog.ENABLE_DEBUG_LOADER=!1,goog.logToConsole_=function(t){goog.global.console&&goog.global.console.error(t)},goog.require=function(t){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.debugLoader_.requested(t),goog.isProvided_(t)){if(goog.isInModuleLoader_())return goog.module.getInternal_(t)}else if(goog.ENABLE_DEBUG_LOADER){var r=goog.moduleLoaderState_;goog.moduleLoaderState_=null;try{goog.debugLoader_.load_(t)}finally{goog.moduleLoaderState_=r}}return null}},goog.requireType=function(t){return{}},goog.basePath="",goog.nullFunction=function(){},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(t){t.instance_=void 0,t.getInstance=function(){return t.instance_?t.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=t),t.instance_=new t)}},goog.instantiatedSingletons_=[],goog.LOAD_MODULE_USING_EVAL=!0,goog.SEAL_MODULE_EXPORTS=goog.DEBUG,goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.TRANSPILE="detect",goog.ASSUME_ES_MODULES_TRANSPILED=!1,goog.TRANSPILE_TO_LANGUAGE="",goog.TRANSPILER="transpile.js",goog.TRUSTED_TYPES_POLICY_NAME="goog",goog.hasBadLetScoping=null,goog.loadModule=function(t){var r=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:"",declareLegacyNamespace:!1,type:goog.ModuleType.GOOG};var i={},n=i;if(typeof t=="function")n=t.call(void 0,n);else if(typeof t=="string")n=goog.loadModuleFromSource_.call(void 0,n,t);else throw Error("Invalid module definition");var s=goog.moduleLoaderState_.moduleName;if(typeof s=="string"&&s)goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(s,n,i!==n):goog.SEAL_MODULE_EXPORTS&&Object.seal&&typeof n=="object"&&n!=null&&Object.seal(n),goog.loadedModules_[s]={exports:n,type:goog.ModuleType.GOOG,moduleId:goog.moduleLoaderState_.moduleName};else throw Error('Invalid module name "'+s+'"')}finally{goog.moduleLoaderState_=r}},goog.loadModuleFromSource_=function(a,b){return eval(goog.CLOSURE_EVAL_PREFILTER_.createScript(b)),a},goog.normalizePath_=function(t){t=t.split("/");for(var r=0;r<t.length;)t[r]=="."?t.splice(r,1):r&&t[r]==".."&&t[r-1]&&t[r-1]!=".."?t.splice(--r,2):r++;return t.join("/")},goog.loadFileSync_=function(t){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(t);try{var r=new goog.global.XMLHttpRequest;return r.open("get",t,!1),r.send(),r.status==0||r.status==200?r.responseText:null}catch{return null}},goog.transpile_=function(t,r,i){var n=goog.global.$jscomp;n||(goog.global.$jscomp=n={});var s=n.transpile;if(!s){var o=goog.basePath+goog.TRANSPILER,l=goog.loadFileSync_(o);if(l){if(function(){(0,eval)(l+`
//# sourceURL=`+o)}.call(goog.global),goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=goog.global.$gwtExport.$jscomp.transpile,n=goog.global.$jscomp,s=n.transpile}}return s||(s=n.transpile=function(u,m){return goog.logToConsole_(m+" requires transpilation but no transpiler was found."),u}),s(t,r,i)},goog.typeOf=function(t){var r=typeof t;return r!="object"?r:t?Array.isArray(t)?"array":r:"null"},goog.isArrayLike=function(t){var r=goog.typeOf(t);return r=="array"||r=="object"&&typeof t.length=="number"},goog.isDateLike=function(t){return goog.isObject(t)&&typeof t.getFullYear=="function"},goog.isObject=function(t){var r=typeof t;return r=="object"&&t!=null||r=="function"},goog.getUid=function(t){return Object.prototype.hasOwnProperty.call(t,goog.UID_PROPERTY_)&&t[goog.UID_PROPERTY_]||(t[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(t){return!!t[goog.UID_PROPERTY_]},goog.removeUid=function(t){t!==null&&"removeAttribute"in t&&t.removeAttribute(goog.UID_PROPERTY_);try{delete t[goog.UID_PROPERTY_]}catch{}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.cloneObject=function(t){var r=goog.typeOf(t);if(r=="object"||r=="array"){if(typeof t.clone=="function")return t.clone();if(typeof Map<"u"&&t instanceof Map)return new Map(t);if(typeof Set<"u"&&t instanceof Set)return new Set(t);r=r=="array"?[]:{};for(var i in t)r[i]=goog.cloneObject(t[i]);return r}return t},goog.bindNative_=function(t,r,i){return t.call.apply(t.bind,arguments)},goog.bindJs_=function(t,r,i){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,n),t.apply(r,s)}}return function(){return t.apply(r,arguments)}},goog.bind=function(t,r,i){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(t,r){var i=Array.prototype.slice.call(arguments,1);return function(){var n=i.slice();return n.push.apply(n,arguments),t.apply(this,n)}},goog.mixin=function(t,r){for(var i in r)t[i]=r[i]},goog.now=function(){return Date.now()},goog.globalEval=function(t){(0,eval)(t)},goog.getCssName=function(t,r){if(String(t).charAt(0)==".")throw Error('className passed in goog.getCssName must not start with ".". You passed: '+t);var i=function(s){return goog.cssNameMapping_[s]||s},n=function(s){s=s.split("-");for(var o=[],l=0;l<s.length;l++)o.push(i(s[l]));return o.join("-")};return n=goog.cssNameMapping_?goog.cssNameMappingStyle_=="BY_WHOLE"?i:n:function(s){return s},n=r?t+"-"+n(r):n(t),goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(n):n},goog.setCssNameMapping=function(t,r){goog.cssNameMapping_=t,goog.cssNameMappingStyle_=r},!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(t,r,i){return i&&i.html&&(t=t.replace(/</g,"&lt;")),i&&i.unescapeHtmlEntities&&(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&")),r&&(t=t.replace(/\{\$([^}]+)}/g,function(n,s){return r!=null&&s in r?r[s]:n})),t},goog.getMsgWithFallback=function(t,r){return t},goog.exportSymbol=function(t,r,i){goog.exportPath_(t,r,!0,i)},goog.exportProperty=function(t,r,i){t[r]=i},goog.inherits=function(t,r){function i(){}i.prototype=r.prototype,t.superClass_=r.prototype,t.prototype=new i,t.prototype.constructor=t,t.base=function(n,s,o){for(var l=Array(arguments.length-2),u=2;u<arguments.length;u++)l[u-2]=arguments[u];return r.prototype[s].apply(n,l)}},goog.scope=function(t){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a module.");t.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.defineClass=function(t,r){var i=r.constructor,n=r.statics;return i&&i!=Object.prototype.constructor||(i=function(){throw Error("cannot instantiate an interface (no constructor defined).")}),i=goog.defineClass.createSealingConstructor_(i,t),t&&goog.inherits(i,t),delete r.constructor,delete r.statics,goog.defineClass.applyProperties_(i.prototype,r),n!=null&&(n instanceof Function?n(i):goog.defineClass.applyProperties_(i,n)),i},goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG,goog.defineClass.createSealingConstructor_=function(t,r){return goog.defineClass.SEAL_CLASS_INSTANCES?function(){var i=t.apply(this,arguments)||this;return i[goog.UID_PROPERTY_]=i[goog.UID_PROPERTY_],i}:t},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),goog.defineClass.applyProperties_=function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);for(var n=0;n<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;n++)i=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[n],Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},goog.identity_=function(t){return t},goog.createTrustedTypesPolicy=function(t){var r=null,i=goog.global.trustedTypes;if(!i||!i.createPolicy)return r;try{r=i.createPolicy(t,{createHTML:goog.identity_,createScript:goog.identity_,createScriptURL:goog.identity_})}catch(n){goog.logToConsole_(n.message)}return r},!COMPILED&&goog.DEPENDENCIES_ENABLED&&(goog.isEdge_=function(){return!!(goog.global.navigator&&goog.global.navigator.userAgent?goog.global.navigator.userAgent:"").match(/Edge\/(\d+)(\.\d)*/i)},goog.inHtmlDocument_=function(){var t=goog.global.document;return t!=null&&"write"in t},goog.isDocumentLoading_=function(){var t=goog.global.document;return t.attachEvent?t.readyState!="complete":t.readyState=="loading"},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH!=null&&typeof goog.global.CLOSURE_BASE_PATH=="string")goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_()){var t=goog.global.document,r=t.currentScript;for(t=r?[r]:t.getElementsByTagName("SCRIPT"),r=t.length-1;0<=r;--r){var i=t[r].src,n=i.lastIndexOf("?");if(n=n==-1?i.length:n,i.substr(n-7,7)=="base.js"){goog.basePath=i.substr(0,n-7);break}}}},goog.findBasePath_(),goog.Transpiler=function(){this.requiresTranspilation_=null,this.transpilationTarget_=goog.TRANSPILE_TO_LANGUAGE},goog.Transpiler.prototype.createRequiresTranspilation_=function(){function a(t,r){e?d[t]=!0:r()?(c=t,d[t]=!1):e=d[t]=!0}function b(f){try{return!!eval(goog.CLOSURE_EVAL_PREFILTER_.createScript(f))}catch(t){return!1}}var c="es3",d={es3:!1},e=!1;return a("es5",function(){return b("[1,].length==1")}),a("es6",function(){return goog.isEdge_()?!1:b('(()=>{"use strict";class X{constructor(){if(new.target!=String)throw 1;this.x=42}}let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof String))throw 1;for(const a of[2,3]){if(a==2)continue;function f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()==3}})()')}),a("es7",function(){return b("2**3==8")}),a("es8",function(){return b("async()=>1,1")}),a("es9",function(){return b("({...rest}={}),1")}),a("es_2019",function(){return b('let r;try{r="\u2029"}catch{};r')}),a("es_2020",function(){return b("null?.x??1")}),a("es_next",function(){return!1}),{target:c,map:d}},goog.Transpiler.prototype.needsTranspile=function(t,r){if(goog.TRANSPILE=="always")return!0;if(goog.TRANSPILE=="never")return!1;if(!this.requiresTranspilation_){var i=this.createRequiresTranspilation_();this.requiresTranspilation_=i.map,this.transpilationTarget_=this.transpilationTarget_||i.target}if(t in this.requiresTranspilation_)return this.requiresTranspilation_[t]?!0:!(!goog.inHtmlDocument_()||r!="es6"||"noModule"in goog.global.document.createElement("script"));throw Error("Unknown language mode: "+t)},goog.Transpiler.prototype.transpile=function(t,r){return goog.transpile_(t,r,this.transpilationTarget_)},goog.transpiler_=new goog.Transpiler,goog.protectScriptTag_=function(t){return t.replace(/<\/(SCRIPT)/ig,"\\x3c/$1")},goog.DebugLoader_=function(){this.dependencies_={},this.idToPath_={},this.written_={},this.loadingDeps_=[],this.depsToLoad_=[],this.paused_=!1,this.factory_=new goog.DependencyFactory(goog.transpiler_),this.deferredCallbacks_={},this.deferredQueue_=[]},goog.DebugLoader_.prototype.bootstrap=function(t,r){function i(){n&&(goog.global.setTimeout(n,0),n=null)}var n=r;if(t.length){for(var s=[],o=0;o<t.length;o++){var l=this.getPathFromDeps_(t[o]);if(!l)throw Error("Unregonized namespace: "+t[o]);s.push(this.dependencies_[l])}l=goog.require;var u=0;for(o=0;o<t.length;o++)l(t[o]),s[o].onLoad(function(){++u==t.length&&i()})}else i()},goog.DebugLoader_.prototype.loadClosureDeps=function(){this.depsToLoad_.push(this.factory_.createDependency(goog.normalizePath_(goog.basePath+"deps.js"),"deps.js",[],[],{},!1)),this.loadDeps_()},goog.DebugLoader_.prototype.requested=function(t,r){var i=this.getPathFromDeps_(t);if(i&&(r||this.areDepsLoaded_(this.dependencies_[i].requires))){var n=this.deferredCallbacks_[i];n&&(delete this.deferredCallbacks_[i],n())}},goog.DebugLoader_.prototype.setDependencyFactory=function(t){this.factory_=t},goog.DebugLoader_.prototype.load_=function(t){if(this.getPathFromDeps_(t)){var r=this,i=[],n=function(s){var o=r.getPathFromDeps_(s);if(!o)throw Error("Bad dependency path or symbol: "+s);if(!r.written_[o]){for(r.written_[o]=!0,s=r.dependencies_[o],o=0;o<s.requires.length;o++)goog.isProvided_(s.requires[o])||n(s.requires[o]);i.push(s)}};n(t),t=!!this.depsToLoad_.length,this.depsToLoad_=this.depsToLoad_.concat(i),this.paused_||t||this.loadDeps_()}else goog.logToConsole_("goog.require could not find: "+t)},goog.DebugLoader_.prototype.loadDeps_=function(){for(var t=this,r=this.paused_;this.depsToLoad_.length&&!r;)(function(){var i=!1,n=t.depsToLoad_.shift(),s=!1;t.loading_(n);var o={pause:function(){if(i)throw Error("Cannot call pause after the call to load.");r=!0},resume:function(){i?t.resume_():r=!1},loaded:function(){if(s)throw Error("Double call to loaded.");s=!0,t.loaded_(n)},pending:function(){for(var l=[],u=0;u<t.loadingDeps_.length;u++)l.push(t.loadingDeps_[u]);return l},setModuleState:function(l){goog.moduleLoaderState_={type:l,moduleName:"",declareLegacyNamespace:!1}},registerEs6ModuleExports:function(l,u,m){m&&(goog.loadedModules_[m]={exports:u,type:goog.ModuleType.ES6,moduleId:m||""})},registerGoogModuleExports:function(l,u){goog.loadedModules_[l]={exports:u,type:goog.ModuleType.GOOG,moduleId:l}},clearModuleState:function(){goog.moduleLoaderState_=null},defer:function(l){if(i)throw Error("Cannot register with defer after the call to load.");t.defer_(n,l)},areDepsLoaded:function(){return t.areDepsLoaded_(n.requires)}};try{n.load(o)}finally{i=!0}})();r&&this.pause_()},goog.DebugLoader_.prototype.pause_=function(){this.paused_=!0},goog.DebugLoader_.prototype.resume_=function(){this.paused_&&(this.paused_=!1,this.loadDeps_())},goog.DebugLoader_.prototype.loading_=function(t){this.loadingDeps_.push(t)},goog.DebugLoader_.prototype.loaded_=function(t){for(var r=0;r<this.loadingDeps_.length;r++)if(this.loadingDeps_[r]==t){this.loadingDeps_.splice(r,1);break}for(r=0;r<this.deferredQueue_.length;r++)if(this.deferredQueue_[r]==t.path){this.deferredQueue_.splice(r,1);break}if(this.loadingDeps_.length==this.deferredQueue_.length&&!this.depsToLoad_.length)for(;this.deferredQueue_.length;)this.requested(this.deferredQueue_.shift(),!0);t.loaded()},goog.DebugLoader_.prototype.areDepsLoaded_=function(t){for(var r=0;r<t.length;r++){var i=this.getPathFromDeps_(t[r]);if(!i||!(i in this.deferredCallbacks_||goog.isProvided_(t[r])))return!1}return!0},goog.DebugLoader_.prototype.getPathFromDeps_=function(t){return t in this.idToPath_?this.idToPath_[t]:t in this.dependencies_?t:null},goog.DebugLoader_.prototype.defer_=function(t,r){this.deferredCallbacks_[t.path]=r,this.deferredQueue_.push(t.path)},goog.LoadController=function(){},goog.LoadController.prototype.pause=function(){},goog.LoadController.prototype.resume=function(){},goog.LoadController.prototype.loaded=function(){},goog.LoadController.prototype.pending=function(){},goog.LoadController.prototype.registerEs6ModuleExports=function(t,r,i){},goog.LoadController.prototype.setModuleState=function(t){},goog.LoadController.prototype.clearModuleState=function(){},goog.LoadController.prototype.defer=function(t){},goog.LoadController.prototype.areDepsLoaded=function(){},goog.Dependency=function(t,r,i,n,s){this.path=t,this.relativePath=r,this.provides=i,this.requires=n,this.loadFlags=s,this.loaded_=!1,this.loadCallbacks_=[]},goog.Dependency.prototype.getPathName=function(){var t=this.path,r=t.indexOf("://");return 0<=r&&(t=t.substring(r+3),r=t.indexOf("/"),0<=r&&(t=t.substring(r+1))),t},goog.Dependency.prototype.onLoad=function(t){this.loaded_?t():this.loadCallbacks_.push(t)},goog.Dependency.prototype.loaded=function(){this.loaded_=!0;var t=this.loadCallbacks_;this.loadCallbacks_=[];for(var r=0;r<t.length;r++)t[r]()},goog.Dependency.defer_=!1,goog.Dependency.callbackMap_={},goog.Dependency.registerCallback_=function(t){var r=Math.random().toString(32);return goog.Dependency.callbackMap_[r]=t,r},goog.Dependency.unregisterCallback_=function(t){delete goog.Dependency.callbackMap_[t]},goog.Dependency.callback_=function(t,r){if(t in goog.Dependency.callbackMap_){for(var i=goog.Dependency.callbackMap_[t],n=[],s=1;s<arguments.length;s++)n.push(arguments[s]);i.apply(void 0,n)}else throw Error("Callback key "+t+" does not exist (was base.js loaded more than once?).")},goog.Dependency.prototype.load=function(t){if(goog.global.CLOSURE_IMPORT_SCRIPT)goog.global.CLOSURE_IMPORT_SCRIPT(this.path)?t.loaded():t.pause();else if(goog.inHtmlDocument_()){var r=goog.global.document;if(r.readyState=="complete"&&!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING){if(/\bdeps.js$/.test(this.path)){t.loaded();return}throw Error('Cannot write "'+this.path+'" after document load')}var i=goog.getScriptNonce_();if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&goog.isDocumentLoading_()){var n=function(u){u.readyState&&u.readyState!="complete"?u.onload=n:(goog.Dependency.unregisterCallback_(s),t.loaded())},s=goog.Dependency.registerCallback_(n);i=i?' nonce="'+i+'"':"";var o='<script src="'+this.path+'"'+i+(goog.Dependency.defer_?" defer":"")+' id="script-'+s+'"><\/script>';o+="<script"+i+">",o=goog.Dependency.defer_?o+("document.getElementById('script-"+s+`').onload = function() {
  goog.Dependency.callback_('`+s+`', this);
};
`):o+("goog.Dependency.callback_('"+s+"', document.getElementById('script-"+s+"'));"),o+="<\/script>",r.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(o):o)}else{var l=r.createElement("script");l.defer=goog.Dependency.defer_,l.async=!1,i&&(l.nonce=i),l.onload=function(){l.onload=null,t.loaded()},l.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(this.path):this.path,r.head.appendChild(l)}}else goog.logToConsole_("Cannot use default debug loader outside of HTML documents."),this.relativePath=="deps.js"?(goog.logToConsole_("Consider setting CLOSURE_IMPORT_SCRIPT before loading base.js, or setting CLOSURE_NO_DEPS to true."),t.loaded()):t.pause()},goog.Es6ModuleDependency=function(t,r,i,n,s){goog.Dependency.call(this,t,r,i,n,s)},goog.inherits(goog.Es6ModuleDependency,goog.Dependency),goog.Es6ModuleDependency.prototype.load=function(t){function r(E,y){var D="",w=goog.getScriptNonce_();w&&(D=' nonce="'+w+'"'),D=y?'<script type="module" crossorigin'+D+">"+y+"<\/script>":'<script type="module" crossorigin src="'+E+'"'+D+"><\/script>",n.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(D):D)}function i(E,y){var D=n.createElement("script");D.defer=!0,D.async=!1,D.type="module",D.setAttribute("crossorigin",!0);var w=goog.getScriptNonce_();w&&(D.nonce=w),y?D.text=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScript(y):y:D.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(E):E,n.head.appendChild(D)}if(goog.global.CLOSURE_IMPORT_SCRIPT)goog.global.CLOSURE_IMPORT_SCRIPT(this.path)?t.loaded():t.pause();else if(goog.inHtmlDocument_()){var n=goog.global.document,s=this;if(goog.isDocumentLoading_()){var o=r;goog.Dependency.defer_=!0}else o=i;var l=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(l),t.setModuleState(goog.ModuleType.ES6)});o(void 0,'goog.Dependency.callback_("'+l+'")'),o(this.path,void 0);var u=goog.Dependency.registerCallback_(function(E){goog.Dependency.unregisterCallback_(u),t.registerEs6ModuleExports(s.path,E,goog.moduleLoaderState_.moduleName)});o(void 0,'import * as m from "'+this.path+'"; goog.Dependency.callback_("'+u+'", m)');var m=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(m),t.clearModuleState(),t.loaded()});o(void 0,'goog.Dependency.callback_("'+m+'")')}else goog.logToConsole_("Cannot use default debug loader outside of HTML documents."),t.pause()},goog.TransformedDependency=function(t,r,i,n,s){goog.Dependency.call(this,t,r,i,n,s),this.contents_=null,this.lazyFetch_=!goog.inHtmlDocument_()||!("noModule"in goog.global.document.createElement("script"))},goog.inherits(goog.TransformedDependency,goog.Dependency),goog.TransformedDependency.prototype.load=function(t){function r(){s.contents_=goog.loadFileSync_(s.path),s.contents_&&(s.contents_=s.transform(s.contents_),s.contents_&&(s.contents_+=`
//# sourceURL=`+s.path))}function i(){if(s.lazyFetch_&&r(),s.contents_){o&&t.setModuleState(goog.ModuleType.ES6);try{var E=s.contents_;if(s.contents_=null,goog.globalEval(goog.CLOSURE_EVAL_PREFILTER_.createScript(E)),o)var y=goog.moduleLoaderState_.moduleName}finally{o&&t.clearModuleState()}o&&goog.global.$jscomp.require.ensure([s.getPathName()],function(){t.registerEs6ModuleExports(s.path,goog.global.$jscomp.require(s.getPathName()),y)}),t.loaded()}}function n(){var E=goog.global.document,y=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(y),i()}),D=goog.getScriptNonce_();D="<script"+(D?' nonce="'+D+'"':"")+">"+goog.protectScriptTag_('goog.Dependency.callback_("'+y+'");')+"<\/script>",E.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(D):D)}var s=this;if(goog.global.CLOSURE_IMPORT_SCRIPT)r(),this.contents_&&goog.global.CLOSURE_IMPORT_SCRIPT("",this.contents_)?(this.contents_=null,t.loaded()):t.pause();else{var o=this.loadFlags.module==goog.ModuleType.ES6;this.lazyFetch_||r();var l=1<t.pending().length;if(goog.Dependency.defer_&&(l||goog.isDocumentLoading_()))t.defer(function(){i()});else{var u=goog.global.document;if(l=goog.inHtmlDocument_()&&("ActiveXObject"in goog.global||goog.isEdge_()),o&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()&&!l){goog.Dependency.defer_=!0,t.pause();var m=u.onreadystatechange;u.onreadystatechange=function(){u.readyState=="interactive"&&(u.onreadystatechange=m,i(),t.resume()),typeof m=="function"&&m.apply(void 0,arguments)}}else goog.inHtmlDocument_()&&goog.isDocumentLoading_()?n():i()}}},goog.TransformedDependency.prototype.transform=function(t){},goog.TranspiledDependency=function(t,r,i,n,s,o){goog.TransformedDependency.call(this,t,r,i,n,s),this.transpiler=o},goog.inherits(goog.TranspiledDependency,goog.TransformedDependency),goog.TranspiledDependency.prototype.transform=function(t){return this.transpiler.transpile(t,this.getPathName())},goog.PreTranspiledEs6ModuleDependency=function(t,r,i,n,s){goog.TransformedDependency.call(this,t,r,i,n,s)},goog.inherits(goog.PreTranspiledEs6ModuleDependency,goog.TransformedDependency),goog.PreTranspiledEs6ModuleDependency.prototype.transform=function(t){return t},goog.GoogModuleDependency=function(t,r,i,n,s,o,l){goog.TransformedDependency.call(this,t,r,i,n,s),this.needsTranspile_=o,this.transpiler_=l},goog.inherits(goog.GoogModuleDependency,goog.TransformedDependency),goog.GoogModuleDependency.prototype.transform=function(t){return this.needsTranspile_&&(t=this.transpiler_.transpile(t,this.getPathName())),goog.LOAD_MODULE_USING_EVAL&&goog.global.JSON!==void 0?"goog.loadModule("+goog.global.JSON.stringify(t+`
//# sourceURL=`+this.path+`
`)+");":'goog.loadModule(function(exports) {"use strict";'+t+`
;return exports});
//# sourceURL=`+this.path+`
`},goog.DebugLoader_.prototype.addDependency=function(t,r,i,n){r=r||[],t=t.replace(/\\/g,"/");var s=goog.normalizePath_(goog.basePath+t);for(n&&typeof n!="boolean"||(n=n?{module:goog.ModuleType.GOOG}:{}),i=this.factory_.createDependency(s,t,r,i,n,goog.transpiler_.needsTranspile(n.lang||"es3",n.module)),this.dependencies_[s]=i,i=0;i<r.length;i++)this.idToPath_[r[i]]=s;this.idToPath_[t]=s},goog.DependencyFactory=function(t){this.transpiler=t},goog.DependencyFactory.prototype.createDependency=function(t,r,i,n,s,o){return s.module==goog.ModuleType.GOOG?new goog.GoogModuleDependency(t,r,i,n,s,o,this.transpiler):o?new goog.TranspiledDependency(t,r,i,n,s,this.transpiler):s.module==goog.ModuleType.ES6?goog.TRANSPILE=="never"&&goog.ASSUME_ES_MODULES_TRANSPILED?new goog.PreTranspiledEs6ModuleDependency(t,r,i,n,s):new goog.Es6ModuleDependency(t,r,i,n,s):new goog.Dependency(t,r,i,n,s)},goog.debugLoader_=new goog.DebugLoader_,goog.loadClosureDeps=function(){goog.debugLoader_.loadClosureDeps()},goog.setDependencyFactory=function(t){goog.debugLoader_.setDependencyFactory(t)},goog.TRUSTED_TYPES_POLICY_=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#base"):null,goog.global.CLOSURE_NO_DEPS||goog.debugLoader_.loadClosureDeps(),goog.bootstrap=function(t,r){goog.debugLoader_.bootstrap(t,r)}),!COMPILED){var isChrome87=!1;try{isChrome87=eval(goog.global.trustedTypes.emptyScript)!==goog.global.trustedTypes.emptyScript}catch(t){}goog.CLOSURE_EVAL_PREFILTER_=goog.global.trustedTypes&&isChrome87&&goog.createTrustedTypesPolicy("goog#base#devonly#eval")||{createScript:goog.identity_}}goog.asserts=function(){},goog.asserts.assert=function(t,r){},goog.asserts.ENABLE_ASSERTS=!0,goog.asserts.ENABLE_ASSERTS&&console.assert&&console.assert.bind&&(goog.asserts.assert=console.assert.bind(console));var shaka={abr:{}};if(shaka.abr.Ewma=function(t){goog.asserts.assert(0<t,"expected halfLife to be positive"),this.alpha_=Math.exp(Math.log(.5)/t),this.totalWeight_=this.estimate_=0},shaka.abr.Ewma.prototype.updateAlpha=function(t){goog.asserts.assert(0<t,"expected halfLife to be positive"),this.alpha_=Math.exp(Math.log(.5)/t)},shaka.abr.Ewma.prototype.sample=function(t,r){var i=Math.pow(this.alpha_,t);i=r*(1-i)+i*this.estimate_,isNaN(i)||(this.estimate_=i,this.totalWeight_+=t)},shaka.abr.Ewma.prototype.getEstimate=function(){return this.estimate_/(1-Math.pow(this.alpha_,this.totalWeight_))},shaka.abr.EwmaBandwidthEstimator=function(){this.fast_=new shaka.abr.Ewma(2),this.slow_=new shaka.abr.Ewma(5),this.bytesSampled_=0,this.minTotalBytes_=128e3,this.minBytes_=16e3},shaka.abr.EwmaBandwidthEstimator.prototype.configure=function(t){this.minTotalBytes_=t.minTotalBytes,this.minBytes_=t.minBytes,this.fast_.updateAlpha(t.fastHalfLife),this.slow_.updateAlpha(t.slowHalfLife)},shaka.abr.EwmaBandwidthEstimator.prototype.sample=function(t,r){if(!(r<this.minBytes_)){var i=8e3*r/t,n=t/1e3;this.bytesSampled_+=r,this.fast_.sample(n,i),this.slow_.sample(n,i)}},shaka.abr.EwmaBandwidthEstimator.prototype.getBandwidthEstimate=function(t){return this.bytesSampled_<this.minTotalBytes_?t:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())},shaka.abr.EwmaBandwidthEstimator.prototype.hasGoodEstimate=function(){return this.bytesSampled_>=this.minTotalBytes_},shaka.log=function(){},shaka.log.alwaysError=function(){},shaka.log.alwaysWarn=function(){},shaka.log.warnOnce=function(t){var r=$jscomp.getRestArguments.apply(1,arguments);shaka.log.oneTimeWarningIssued_.has(t)||(shaka.log.oneTimeWarningIssued_.add(t),shaka.log.alwaysWarn.apply(shaka.log,$jscomp.arrayFromIterable(r)))},shaka.log.error=function(){},shaka.log.warning=function(){},shaka.log.info=function(){},shaka.log.debug=function(){},shaka.log.v1=function(){},shaka.log.v2=function(){},shaka.log.Level={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4,V1:5,V2:6},shaka.log.MAX_LOG_LEVEL=4,shaka.log.oneTimeWarningIssued_=new Set,window.console&&window.console.log.bind){var $jscomp$compprop0={};shaka.log.logMap_=($jscomp$compprop0[shaka.log.Level.ERROR]=console.error.bind(console),$jscomp$compprop0[shaka.log.Level.WARNING]=console.warn.bind(console),$jscomp$compprop0[shaka.log.Level.INFO]=console.info.bind(console),$jscomp$compprop0[shaka.log.Level.DEBUG]=console.log.bind(console),$jscomp$compprop0[shaka.log.Level.V1]=console.debug.bind(console),$jscomp$compprop0[shaka.log.Level.V2]=console.debug.bind(console),$jscomp$compprop0),shaka.log.alwaysWarn=shaka.log.logMap_[shaka.log.Level.WARNING],shaka.log.alwaysError=shaka.log.logMap_[shaka.log.Level.ERROR],goog.DEBUG?(goog.exportSymbol("shaka.log",shaka.log),shaka.log.setLevel=function(t){var r=function(i){return i<=t?(goog.asserts.assert(shaka.log.logMap_[i],"Unexpected log level"),shaka.log.logMap_[i]):function(){}};shaka.log.currentLevel=t,shaka.log.error=r(shaka.log.Level.ERROR),shaka.log.warning=r(shaka.log.Level.WARNING),shaka.log.info=r(shaka.log.Level.INFO),shaka.log.debug=r(shaka.log.Level.DEBUG),shaka.log.v1=r(shaka.log.Level.V1),shaka.log.v2=r(shaka.log.Level.V2)},shaka.log.setLevel(shaka.log.MAX_LOG_LEVEL)):(shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.ERROR&&(shaka.log.error=shaka.log.logMap_[shaka.log.Level.ERROR]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.WARNING&&(shaka.log.warning=shaka.log.logMap_[shaka.log.Level.WARNING]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.INFO&&(shaka.log.info=shaka.log.logMap_[shaka.log.Level.INFO]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.DEBUG&&(shaka.log.debug=shaka.log.logMap_[shaka.log.Level.DEBUG]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.V1&&(shaka.log.v1=shaka.log.logMap_[shaka.log.Level.V1]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.V2&&(shaka.log.v2=shaka.log.logMap_[shaka.log.Level.V2]))}shaka.util={},shaka.util.ArrayUtils=function(){},shaka.util.ArrayUtils.defaultEquals=function(t,r){return typeof t=="number"&&typeof r=="number"&&isNaN(t)&&isNaN(r)?!0:t===r},shaka.util.ArrayUtils.remove=function(t,r){var i=t.indexOf(r);-1<i&&t.splice(i,1)},shaka.util.ArrayUtils.count=function(t,r){for(var i=0,n=$jscomp.makeIterator(t),s=n.next();!s.done;s=n.next())i+=r(s.value)?1:0;return i},shaka.util.ArrayUtils.hasSameElements=function(t,r,i){if(i||(i=shaka.util.ArrayUtils.defaultEquals),t.length!=r.length)return!1;r=r.slice();var n={};t=$jscomp.makeIterator(t);for(var s=t.next();!s.done;n={$jscomp$loop$prop$item$574:n.$jscomp$loop$prop$item$574},s=t.next()){if(n.$jscomp$loop$prop$item$574=s.value,s=r.findIndex(function(o){return function(l){return i(o.$jscomp$loop$prop$item$574,l)}}(n)),s==-1)return!1;r[s]=r[r.length-1],r.pop()}return r.length==0},shaka.util.ArrayUtils.equal=function(t,r,i){if(i||(i=shaka.util.ArrayUtils.defaultEquals),t.length!=r.length)return!1;for(var n=0;n<t.length;n++)if(!i(t[n],r[n]))return!1;return!0},shaka.text={},shaka.text.Cue=function(t,r,i){var n=shaka.text.Cue;this.startTime=t,this.direction=n.direction.HORIZONTAL_LEFT_TO_RIGHT,this.endTime=r,this.payload=i,this.region=new shaka.text.CueRegion,this.position=null,this.positionAlign=n.positionAlign.AUTO,this.size=0,this.textAlign=n.textAlign.CENTER,this.writingMode=n.writingMode.HORIZONTAL_TOP_TO_BOTTOM,this.lineInterpretation=n.lineInterpretation.LINE_NUMBER,this.line=null,this.lineHeight="",this.lineAlign=n.lineAlign.START,this.displayAlign=n.displayAlign.AFTER,this.fontSize=this.textStrokeWidth=this.textStrokeColor=this.border=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=n.fontWeight.NORMAL,this.fontStyle=n.fontStyle.NORMAL,this.linePadding=this.letterSpacing=this.fontFamily="",this.opacity=1,this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.spacer=this.lineBreak=this.isContainer=!1,this.cellResolution={columns:32,rows:15}},shaka.text.Cue.lineBreak=function(t,r){var i=new shaka.text.Cue(t,r,"");return i.lineBreak=!0,i},shaka.text.Cue.prototype.clone=function(){var t=new shaka.text.Cue(0,0,""),r;for(r in this)t[r]=this[r],t[r]&&t[r].constructor==Array&&(t[r]=t[r].slice());return t},shaka.text.Cue.equal=function(t,r){if(t.startTime!=r.startTime||t.endTime!=r.endTime||t.payload!=r.payload)return!1;for(var i in t)if(i!="startTime"&&i!="endTime"&&i!="payload"){if(i=="nestedCues"){if(!shaka.util.ArrayUtils.equal(t.nestedCues,r.nestedCues,shaka.text.Cue.equal))return!1}else if(i=="region"||i=="cellResolution"){for(var n in t[i])if(t[i][n]!=r[i][n])return!1}else if(Array.isArray(t[i])){if(!shaka.util.ArrayUtils.equal(t[i],r[i]))return!1}else if(t[i]!=r[i])return!1}return!0},goog.exportSymbol("shaka.text.Cue",shaka.text.Cue),shaka.text.Cue.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:"auto"},goog.exportProperty(shaka.text.Cue,"positionAlign",shaka.text.Cue.positionAlign),shaka.text.Cue.textAlign={LEFT:"left",RIGHT:"right",CENTER:"center",START:"start",END:"end"},goog.exportProperty(shaka.text.Cue,"textAlign",shaka.text.Cue.textAlign),shaka.text.Cue.displayAlign={BEFORE:"before",CENTER:"center",AFTER:"after"},goog.exportProperty(shaka.text.Cue,"displayAlign",shaka.text.Cue.displayAlign),shaka.text.Cue.direction={HORIZONTAL_LEFT_TO_RIGHT:"ltr",HORIZONTAL_RIGHT_TO_LEFT:"rtl"},goog.exportProperty(shaka.text.Cue,"direction",shaka.text.Cue.direction),shaka.text.Cue.writingMode={HORIZONTAL_TOP_TO_BOTTOM:"horizontal-tb",VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"},goog.exportProperty(shaka.text.Cue,"writingMode",shaka.text.Cue.writingMode),shaka.text.Cue.lineInterpretation={LINE_NUMBER:0,PERCENTAGE:1},goog.exportProperty(shaka.text.Cue,"lineInterpretation",shaka.text.Cue.lineInterpretation),shaka.text.Cue.lineAlign={CENTER:"center",START:"start",END:"end"},goog.exportProperty(shaka.text.Cue,"lineAlign",shaka.text.Cue.lineAlign),shaka.text.Cue.defaultTextColor={white:"#FFF",lime:"#0F0",cyan:"#0FF",red:"#F00",yellow:"#FF0",magenta:"#F0F",blue:"#00F",black:"#000"},goog.exportProperty(shaka.text.Cue,"defaultTextColor",shaka.text.Cue.defaultTextColor),shaka.text.Cue.defaultTextBackgroundColor={bg_white:"#FFF",bg_lime:"#0F0",bg_cyan:"#0FF",bg_red:"#F00",bg_yellow:"#FF0",bg_magenta:"#F0F",bg_blue:"#00F",bg_black:"#000"},goog.exportProperty(shaka.text.Cue,"defaultTextBackgroundColor",shaka.text.Cue.defaultTextBackgroundColor),shaka.text.Cue.fontWeight={NORMAL:400,BOLD:700},goog.exportProperty(shaka.text.Cue,"fontWeight",shaka.text.Cue.fontWeight),shaka.text.Cue.fontStyle={NORMAL:"normal",ITALIC:"italic",OBLIQUE:"oblique"},goog.exportProperty(shaka.text.Cue,"fontStyle",shaka.text.Cue.fontStyle),shaka.text.Cue.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},goog.exportProperty(shaka.text.Cue,"textDecoration",shaka.text.Cue.textDecoration),shaka.text.CueRegion=function(){var t=shaka.text.CueRegion;this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=t.units.PERCENTAGE,this.scroll=t.scrollMode.NONE},goog.exportSymbol("shaka.text.CueRegion",shaka.text.CueRegion),shaka.text.CueRegion.units={PX:0,PERCENTAGE:1,LINES:2},goog.exportProperty(shaka.text.CueRegion,"units",shaka.text.CueRegion.units),shaka.text.CueRegion.scrollMode={NONE:"",UP:"up"},goog.exportProperty(shaka.text.CueRegion,"scrollMode",shaka.text.CueRegion.scrollMode),shaka.util.BufferUtils=function(){},shaka.util.BufferUtils.equal=function(t,r){var i=shaka.util.BufferUtils;if(!t&&!r)return!0;if(!t||!r||t.byteLength!=r.byteLength)return!1;if(i.unsafeGetArrayBuffer_(t)==i.unsafeGetArrayBuffer_(r)&&(t.byteOffset||0)==(r.byteOffset||0))return!0;i=shaka.util.BufferUtils.toUint8(t);for(var n=shaka.util.BufferUtils.toUint8(r),s=0;s<t.byteLength;s++)if(i[s]!=n[s])return!1;return!0},shaka.util.BufferUtils.unsafeGetArrayBuffer_=function(t){return t instanceof ArrayBuffer?t:t.buffer},shaka.util.BufferUtils.toArrayBuffer=function(t){return t instanceof ArrayBuffer?t:t.byteOffset==0&&t.byteLength==t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer},shaka.util.BufferUtils.toUint8=function(t,r,i){return i=i===void 0?1/0:i,shaka.util.BufferUtils.view_(t,r===void 0?0:r,i,Uint8Array)},shaka.util.BufferUtils.toDataView=function(t,r,i){return i=i===void 0?1/0:i,shaka.util.BufferUtils.view_(t,r===void 0?0:r,i,DataView)},shaka.util.BufferUtils.view_=function(t,r,i,n){var s=shaka.util.BufferUtils.unsafeGetArrayBuffer_(t),o=(t.byteOffset||0)+t.byteLength;return t=Math.max(0,Math.min((t.byteOffset||0)+r,o)),new n(s,t,Math.min(t+Math.max(i,0),o)-t)},goog.exportSymbol("shaka.util.BufferUtils",shaka.util.BufferUtils),goog.exportProperty(shaka.util.BufferUtils,"toDataView",shaka.util.BufferUtils.toDataView),goog.exportProperty(shaka.util.BufferUtils,"toUint8",shaka.util.BufferUtils.toUint8),goog.exportProperty(shaka.util.BufferUtils,"toArrayBuffer",shaka.util.BufferUtils.toArrayBuffer),goog.exportProperty(shaka.util.BufferUtils,"equal",shaka.util.BufferUtils.equal),shaka.deprecate={},shaka.deprecate.Version=function(t,r){this.major_=t,this.minor_=r},shaka.deprecate.Version.prototype.major=function(){return this.major_},shaka.deprecate.Version.prototype.minor=function(){return this.minor_},shaka.deprecate.Version.prototype.compareTo=function(t){var r=this.minor_-t.minor_;return this.major_-t.major_||r},shaka.deprecate.Version.prototype.toString=function(){return"v"+this.major_+"."+this.minor_},shaka.deprecate.Version.parse=function(t){return t=t.substring(1).split(".",2),new shaka.deprecate.Version(Number(t[0]),Number(t[1]))},shaka.deprecate.Enforcer=function(t,r,i){this.libraryVersion_=t,this.onPending_=r,this.onExpired_=i},shaka.deprecate.Enforcer.prototype.enforce=function(t,r,i){(0<t.compareTo(this.libraryVersion_)?this.onPending_:this.onExpired_)(this.libraryVersion_,t,r,i)},shaka.Deprecate=function(){},shaka.Deprecate.init=function(t){goog.asserts.assert(shaka.Deprecate.enforcer_==null,"Deprecate.init should only be called once."),shaka.Deprecate.enforcer_=new shaka.deprecate.Enforcer(shaka.deprecate.Version.parse(t),shaka.Deprecate.onPending_,shaka.Deprecate.onExpired_)},shaka.Deprecate.deprecateFeature=function(t,r,i){var n=shaka.Deprecate.enforcer_;goog.asserts.assert(n,"Missing deprecation enforcer. Was |init| called?"),t=new shaka.deprecate.Version(t,0),n.enforce(t,r,i)},shaka.Deprecate.onPending_=function(t,r,i,n){shaka.log.alwaysWarn([i,"has been deprecated and will be removed in",r,". We are currently at version",t,". Additional information:",n].join(" "))},shaka.Deprecate.onExpired_=function(t,r,i,n){t=[i,"has been deprecated and has been removed in",r,". We are now at version",t,". Additional information:",n].join(""),shaka.log.alwaysError(t),goog.asserts.assert(!1,t)},shaka.Deprecate.enforcer_=null,shaka.util.Functional=function(){},shaka.util.Functional.createFallbackPromiseChain=function(t,r){return t.reduce(function(i,n){return i.catch(function(){return r(n)})},Promise.reject())},shaka.util.Functional.collapseArrays=function(t,r){return t.concat(r)},shaka.util.Functional.ignored=function(){},shaka.util.Functional.noop=function(){},shaka.util.Functional.isNotNull=function(t){return t!=null},shaka.util.Functional.callFactory=function(t){var r=Object.create(t.prototype||Object.prototype);try{var i=t.call(r);i||(shaka.Deprecate.deprecateFeature(4,"Factories requiring new","Factories should be plain functions"),i=r)}catch{shaka.Deprecate.deprecateFeature(4,"Factories requiring new","Factories should be plain functions"),i=new t}return i},shaka.util.IDestroyable=function(){},shaka.util.IDestroyable.prototype.destroy=function(){},shaka.dependencies=function(){},shaka.dependencies.add=function(t,r){if(!shaka.dependencies.Allowed[t])throw Error(t+" is not supported");shaka.dependencies.dependencies_.set(t,function(){return r})},shaka.dependencies.has=function(t){return shaka.dependencies.dependencies_.has(t)},shaka.dependencies.muxjs=function(){return shaka.dependencies.dependencies_.get(shaka.dependencies.Allowed.muxjs)()},goog.exportSymbol("shaka.dependencies",shaka.dependencies),goog.exportProperty(shaka.dependencies,"has",shaka.dependencies.has),goog.exportProperty(shaka.dependencies,"add",shaka.dependencies.add),shaka.dependencies.Allowed={muxjs:"muxjs"},goog.exportProperty(shaka.dependencies,"Allowed",shaka.dependencies.Allowed),shaka.dependencies.dependencies_=new Map([[shaka.dependencies.Allowed.muxjs,function(){return window.muxjs}]]),shaka.util.Error=function(t,r,i){var n=$jscomp.getRestArguments.apply(3,arguments);if(this.severity=t,this.category=r,this.code=i,this.data=n,this.handled=!1,goog.DEBUG){var s=n="UNKNOWN",o;for(o in shaka.util.Error.Category)shaka.util.Error.Category[o]==this.category&&(n=o);for(var l in shaka.util.Error.Code)shaka.util.Error.Code[l]==this.code&&(s=l);if(this.message="Shaka Error "+n+"."+s+" ("+this.data.toString()+")",shaka.util.Error.createStack)try{throw Error(this.message)}catch(u){this.stack=u.stack}}},shaka.util.Error.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},goog.exportSymbol("shaka.util.Error",shaka.util.Error),goog.DEBUG&&(shaka.util.Error.createStack=!0),shaka.util.Error.Severity={RECOVERABLE:1,CRITICAL:2},goog.exportProperty(shaka.util.Error,"Severity",shaka.util.Error.Severity),shaka.util.Error.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9,ADS:10},goog.exportProperty(shaka.util.Error,"Category",shaka.util.Error.Category),shaka.util.Error.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,ATTEMPTS_EXHAUSTED:1010,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,INVALID_MP4_CEA:2010,TEXT_COULD_NOT_GUESS_MIME_TYPE:2011,CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS:2012,TEXT_ONLY_WEBVTT_SRC_EQUALS:2013,MISSING_TEXT_PLUGIN:2014,CHAPTERS_TRACK_FAILED:2015,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,CONTENT_TRANSFORMATION_FAILED:3019,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,RESTRICTIONS_CANNOT_BE_MET:4012,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,HLS_INTERNAL_SKIP_STREAM:4035,NO_VARIANTS:4036,PERIOD_FLATTENING_FAILED:4037,INCONSISTENT_DRM_ACROSS_PERIODS:4038,HLS_VARIABLE_NOT_FOUND:4039,STREAMING_ENGINE_STARTUP_INVALID_STATE:5006,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,SERVER_CERTIFICATE_REQUEST_FAILED:6017,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,OBJECT_DESTROYED:7003,CONTENT_NOT_LOADED:7004,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013,STORAGE_LIMIT_REACHED:9014,DOWNLOAD_SIZE_CALLBACK_ERROR:9015,MODIFY_OPERATION_NOT_SUPPORTED:9016,CS_IMA_SDK_MISSING:1e4,CS_AD_MANAGER_NOT_INITIALIZED:10001,SS_IMA_SDK_MISSING:10002,SS_AD_MANAGER_NOT_INITIALIZED:10003,CURRENT_DAI_REQUEST_NOT_FINISHED:10004},goog.exportProperty(shaka.util.Error,"Code",shaka.util.Error.Code);goog.uri={},goog.uri.utils={},goog.uri.utils.splitRe_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),goog.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7},goog.uri.utils.split=function(t){return t.match(goog.uri.utils.splitRe_)};goog.Uri=function(t){var r;t instanceof goog.Uri?(this.setScheme(t.getScheme()),this.setUserInfo(t.getUserInfo()),this.setDomain(t.getDomain()),this.setPort(t.getPort()),this.setPath(t.getPath()),this.setQueryData(t.getQueryData().clone()),this.setFragment(t.getFragment())):t&&(r=goog.uri.utils.split(String(t)))?(this.setScheme(r[goog.uri.utils.ComponentIndex.SCHEME]||"",!0),this.setUserInfo(r[goog.uri.utils.ComponentIndex.USER_INFO]||"",!0),this.setDomain(r[goog.uri.utils.ComponentIndex.DOMAIN]||"",!0),this.setPort(r[goog.uri.utils.ComponentIndex.PORT]),this.setPath(r[goog.uri.utils.ComponentIndex.PATH]||"",!0),this.setQueryData(r[goog.uri.utils.ComponentIndex.QUERY_DATA]||"",!0),this.setFragment(r[goog.uri.utils.ComponentIndex.FRAGMENT]||"",!0)):this.queryData_=new goog.Uri.QueryData(null,null)},goog.Uri.prototype.scheme_="",goog.Uri.prototype.userInfo_="",goog.Uri.prototype.domain_="",goog.Uri.prototype.port_=null,goog.Uri.prototype.path_="",goog.Uri.prototype.fragment_="",goog.Uri.prototype.toString=function(){var t=[],r=this.getScheme();if(r&&t.push(goog.Uri.encodeSpecialChars_(r,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),":"),r=this.getDomain()){t.push("//");var i=this.getUserInfo();i&&t.push(goog.Uri.encodeSpecialChars_(i,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),"@"),t.push(goog.Uri.removeDoubleEncoding_(encodeURIComponent(r))),r=this.getPort(),r!=null&&t.push(":",String(r))}return(r=this.getPath())&&(this.hasDomain()&&r.charAt(0)!="/"&&t.push("/"),t.push(goog.Uri.encodeSpecialChars_(r,r.charAt(0)=="/"?goog.Uri.reDisallowedInAbsolutePath_:goog.Uri.reDisallowedInRelativePath_,!0))),(r=this.getEncodedQuery())&&t.push("?",r),(r=this.getFragment())&&t.push("#",goog.Uri.encodeSpecialChars_(r,goog.Uri.reDisallowedInFragment_)),t.join("")},goog.Uri.prototype.resolve=function(t){var r=this.clone();r.scheme_==="data"&&(r=new goog.Uri);var i=t.hasScheme();i?r.setScheme(t.getScheme()):i=t.hasUserInfo(),i?r.setUserInfo(t.getUserInfo()):i=t.hasDomain(),i?r.setDomain(t.getDomain()):i=t.hasPort();var n=t.getPath();if(i)r.setPort(t.getPort());else if(i=t.hasPath()){if(n.charAt(0)!="/")if(this.hasDomain()&&!this.hasPath())n="/"+n;else{var s=r.getPath().lastIndexOf("/");s!=-1&&(n=r.getPath().substr(0,s+1)+n)}n=goog.Uri.removeDotSegments(n)}return i?r.setPath(n):i=t.hasQuery(),i?r.setQueryData(t.getQueryData().clone()):i=t.hasFragment(),i&&r.setFragment(t.getFragment()),r},goog.Uri.prototype.clone=function(){return new goog.Uri(this)},goog.Uri.prototype.getScheme=function(){return this.scheme_},goog.Uri.prototype.setScheme=function(t,r){return(this.scheme_=r?goog.Uri.decodeOrEmpty_(t,!0):t)&&(this.scheme_=this.scheme_.replace(/:$/,"")),this},goog.Uri.prototype.hasScheme=function(){return!!this.scheme_},goog.Uri.prototype.getUserInfo=function(){return this.userInfo_},goog.Uri.prototype.setUserInfo=function(t,r){return this.userInfo_=r?goog.Uri.decodeOrEmpty_(t):t,this},goog.Uri.prototype.hasUserInfo=function(){return!!this.userInfo_},goog.Uri.prototype.getDomain=function(){return this.domain_},goog.Uri.prototype.setDomain=function(t,r){return this.domain_=r?goog.Uri.decodeOrEmpty_(t,!0):t,this},goog.Uri.prototype.hasDomain=function(){return!!this.domain_},goog.Uri.prototype.getPort=function(){return this.port_},goog.Uri.prototype.setPort=function(t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);this.port_=t}else this.port_=null;return this},goog.Uri.prototype.hasPort=function(){return this.port_!=null},goog.Uri.prototype.getPath=function(){return this.path_},goog.Uri.prototype.setPath=function(t,r){return this.path_=r?goog.Uri.decodeOrEmpty_(t,!0):t,this},goog.Uri.prototype.hasPath=function(){return!!this.path_},goog.Uri.prototype.hasQuery=function(){return this.queryData_.toString()!==""},goog.Uri.prototype.setQueryData=function(t,r){return t instanceof goog.Uri.QueryData?this.queryData_=t:(r||(t=goog.Uri.encodeSpecialChars_(t,goog.Uri.reDisallowedInQuery_)),this.queryData_=new goog.Uri.QueryData(t,null)),this},goog.Uri.prototype.getEncodedQuery=function(){return this.queryData_.toString()},goog.Uri.prototype.getDecodedQuery=function(){return this.queryData_.toDecodedString()},goog.Uri.prototype.getQueryData=function(){return this.queryData_},goog.Uri.prototype.getFragment=function(){return this.fragment_},goog.Uri.prototype.setFragment=function(t,r){return this.fragment_=r?goog.Uri.decodeOrEmpty_(t):t,this},goog.Uri.prototype.hasFragment=function(){return!!this.fragment_},goog.Uri.removeDotSegments=function(t){if(t==".."||t==".")return"";if(t.indexOf("./")==-1&&t.indexOf("/.")==-1)return t;var r=t.lastIndexOf("/",0)==0;t=t.split("/");for(var i=[],n=0;n<t.length;){var s=t[n++];s=="."?r&&n==t.length&&i.push(""):s==".."?((1<i.length||i.length==1&&i[0]!="")&&i.pop(),r&&n==t.length&&i.push("")):(i.push(s),r=!0)}return i.join("/")},goog.Uri.decodeOrEmpty_=function(t,r){return t?r?decodeURI(t):decodeURIComponent(t):""},goog.Uri.encodeSpecialChars_=function(t,r,i){return t!=null?(t=encodeURI(t).replace(r,goog.Uri.encodeChar_),i&&(t=goog.Uri.removeDoubleEncoding_(t)),t):null},goog.Uri.encodeChar_=function(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)},goog.Uri.removeDoubleEncoding_=function(t){return t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")},goog.Uri.reDisallowedInSchemeOrUserInfo_=/[#\/\?@]/g,goog.Uri.reDisallowedInRelativePath_=/[#\?:]/g,goog.Uri.reDisallowedInAbsolutePath_=/[#\?]/g,goog.Uri.reDisallowedInQuery_=/[#\?@]/g,goog.Uri.reDisallowedInFragment_=/#/g,goog.Uri.QueryData=function(t,r){this.encodedQuery_=t||null},goog.Uri.QueryData.prototype.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_={},this.count_=0,this.encodedQuery_))for(var t=this.encodedQuery_.split("&"),r=0;r<t.length;r++){var i=t[r].indexOf("="),n=null;if(0<=i){var s=t[r].substring(0,i);n=t[r].substring(i+1)}else s=t[r];s=decodeURIComponent(s.replace(/\+/g," ")),n=n||"",this.add(s,decodeURIComponent(n.replace(/\+/g," ")))}},goog.Uri.QueryData.prototype.keyMap_=null,goog.Uri.QueryData.prototype.count_=null,goog.Uri.QueryData.prototype.getCount=function(){return this.ensureKeyMapInitialized_(),this.count_},goog.Uri.QueryData.prototype.add=function(t,r){this.ensureKeyMapInitialized_(),this.encodedQuery_=null;var i=this.keyMap_.hasOwnProperty(t)&&this.keyMap_[t];return i||(this.keyMap_[t]=i=[]),i.push(r),goog.asserts.assert(this.count_!=null,"Should not be null."),this.count_++,this},goog.Uri.QueryData.prototype.set=function(t,r){return this.ensureKeyMapInitialized_(),this.encodedQuery_=null,this.keyMap_.hasOwnProperty(t)?this.keyMap_[t]=[r]:this.add(t,r),this},goog.Uri.QueryData.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";var t=[],r;for(r in this.keyMap_)for(var i=encodeURIComponent(r),n=this.keyMap_[r],s=0;s<n.length;s++){var o=i;n[s]!==""&&(o+="="+encodeURIComponent(n[s])),t.push(o)}return this.encodedQuery_=t.join("&")},goog.Uri.QueryData.prototype.toDecodedString=function(){return goog.Uri.decodeOrEmpty_(this.toString())},goog.Uri.QueryData.prototype.clone=function(){var t=new goog.Uri.QueryData;if(t.encodedQuery_=this.encodedQuery_,this.keyMap_){var r={},i;for(i in this.keyMap_)r[i]=this.keyMap_[i].concat();t.keyMap_=r,t.count_=this.count_}return t},shaka.util.ManifestParserUtils=function(){},shaka.util.ManifestParserUtils.resolveUris=function(t,r){var i=shaka.util.Functional;if(r.length==0)return t;var n=r.map(function(s){return new goog.Uri(s)});return t.map(function(s){return new goog.Uri(s)}).map(function(s){return n.map(function(o){return s.resolve(o)})}).reduce(i.collapseArrays,[]).map(function(s){return s.toString()})},shaka.util.ManifestParserUtils.createDrmInfo=function(t,r){return{keySystem:t,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:r||[],keyIds:new Set}},shaka.util.ManifestParserUtils.guessCodecs=function(t,r){if(r.length==1)return r[0];var i=shaka.util.ManifestParserUtils.guessCodecsSafe(t,r);if(i!=null)return i;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_GUESS_CODECS,r)},shaka.util.ManifestParserUtils.guessCodecsSafe=function(t,r){for(var i=$jscomp.makeIterator(shaka.util.ManifestParserUtils.CODEC_REGEXPS_BY_CONTENT_TYPE_[t]),n=i.next();!n.done;n=i.next()){n=n.value;for(var s=$jscomp.makeIterator(r),o=s.next();!o.done;o=s.next())if(o=o.value,n.test(o.trim()))return o.trim()}return t==shaka.util.ManifestParserUtils.ContentType.TEXT?"":null},shaka.util.ManifestParserUtils.ContentType={VIDEO:"video",AUDIO:"audio",TEXT:"text",IMAGE:"image",APPLICATION:"application"},shaka.util.ManifestParserUtils.TextStreamKind={SUBTITLE:"subtitle",CLOSED_CAPTION:"caption"},shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS=1/15,shaka.util.ManifestParserUtils.VIDEO_CODEC_REGEXPS_=[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av01/],shaka.util.ManifestParserUtils.AUDIO_CODEC_REGEXPS_=[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],shaka.util.ManifestParserUtils.TEXT_CODEC_REGEXPS_=[/^vtt$/,/^wvtt/,/^stpp/],shaka.util.ManifestParserUtils.CODEC_REGEXPS_BY_CONTENT_TYPE_={audio:shaka.util.ManifestParserUtils.AUDIO_CODEC_REGEXPS_,video:shaka.util.ManifestParserUtils.VIDEO_CODEC_REGEXPS_,text:shaka.util.ManifestParserUtils.TEXT_CODEC_REGEXPS_},shaka.util.PublicPromise=function(){var t,r,i=new Promise(function(n,s){t=n,r=s});return i.resolve=t,i.reject=r,i},shaka.util.PublicPromise.prototype.resolve=function(t){},shaka.util.PublicPromise.prototype.reject=function(t){},shaka.util.Lazy=function(t){this.gen_=t,this.value_=void 0},shaka.util.Lazy.prototype.value=function(){return this.value_==null&&(this.value_=this.gen_(),goog.asserts.assert(this.value_!=null,"Unable to create lazy value")),this.value_},shaka.util.Lazy.prototype.reset=function(){this.value_=void 0},shaka.util.DelayedTick=function(t){this.onTick_=t,this.cancelPending_=null},shaka.util.DelayedTick.prototype.tickAfter=function(t){var r=this;this.stop();var i=!0,n=null;return this.cancelPending_=function(){window.clearTimeout(n),i=!1},n=window.setTimeout(function(){i&&r.onTick_()},1e3*t),this},shaka.util.DelayedTick.prototype.stop=function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)},shaka.util.Timer=function(t){this.onTick_=t,this.ticker_=null},shaka.util.Timer.prototype.tickNow=function(){return this.stop(),this.onTick_(),this},shaka.util.Timer.prototype.tickAfter=function(t){var r=this;return this.stop(),this.ticker_=new shaka.util.DelayedTick(function(){r.onTick_()}).tickAfter(t),this},shaka.util.Timer.prototype.tickEvery=function(t){var r=this;return this.stop(),this.ticker_=new shaka.util.DelayedTick(function(){r.ticker_.tickAfter(t),r.onTick_()}).tickAfter(t),this},shaka.util.Timer.prototype.stop=function(){this.ticker_&&(this.ticker_.stop(),this.ticker_=null)},goog.exportSymbol("shaka.util.Timer",shaka.util.Timer),goog.exportProperty(shaka.util.Timer.prototype,"stop",shaka.util.Timer.prototype.stop),goog.exportProperty(shaka.util.Timer.prototype,"tickEvery",shaka.util.Timer.prototype.tickEvery),goog.exportProperty(shaka.util.Timer.prototype,"tickAfter",shaka.util.Timer.prototype.tickAfter),goog.exportProperty(shaka.util.Timer.prototype,"tickNow",shaka.util.Timer.prototype.tickNow),shaka.util.Platform=function(){},shaka.util.Platform.supportsMediaSource=function(){return!!(window.MediaSource&&MediaSource.isTypeSupported)},shaka.util.Platform.supportsMediaType=function(t){return shaka.util.Platform.anyMediaElement().canPlayType(t)!=""},shaka.util.Platform.isEdge=function(){return!!navigator.userAgent.match(/Edge?\//)},shaka.util.Platform.isLegacyEdge=function(){return!!navigator.userAgent.match(/Edge\//)},shaka.util.Platform.isIE=function(){return shaka.util.Platform.userAgentContains_("Trident/")},shaka.util.Platform.isXboxOne=function(){return shaka.util.Platform.userAgentContains_("Xbox One")},shaka.util.Platform.isTizen=function(){return shaka.util.Platform.userAgentContains_("Tizen")},shaka.util.Platform.isTizen4=function(){return shaka.util.Platform.userAgentContains_("Tizen 4")},shaka.util.Platform.isTizen3=function(){return shaka.util.Platform.userAgentContains_("Tizen 3")},shaka.util.Platform.isTizen2=function(){return shaka.util.Platform.userAgentContains_("Tizen 2")},shaka.util.Platform.isWebOS=function(){return shaka.util.Platform.userAgentContains_("Web0S")},shaka.util.Platform.isWebOS3=function(){return shaka.util.Platform.userAgentContains_("Web0S")&&shaka.util.Platform.userAgentContains_("Chrome/38.0.2125.122 Safari/537.36")},shaka.util.Platform.isChromecast=function(){return shaka.util.Platform.userAgentContains_("CrKey")},shaka.util.Platform.isChrome=function(){return shaka.util.Platform.userAgentContains_("Chrome")&&!shaka.util.Platform.isEdge()},shaka.util.Platform.isApple=function(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!shaka.util.Platform.isTizen()&&!shaka.util.Platform.isEOS()&&!shaka.util.Platform.isPS4()},shaka.util.Platform.isPS5=function(){return shaka.util.Platform.userAgentContains_("PlayStation 5")},shaka.util.Platform.isPS4=function(){return shaka.util.Platform.userAgentContains_("PlayStation 4")},shaka.util.Platform.safariVersion=function(){if(!shaka.util.Platform.isApple())return null;var t=navigator.userAgent.match(/Version\/(\d+)/);return t||(t=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(t[1],10):null},shaka.util.Platform.isSafari=function(){return!!shaka.util.Platform.safariVersion()},shaka.util.Platform.isEOS=function(){return shaka.util.Platform.userAgentContains_("PC=EOS")},shaka.util.Platform.isMobile=function(){return/(?:iPhone|iPad|iPod|Android)/.test(navigator.userAgent)?!0:shaka.util.Platform.isApple()&&1<navigator.maxTouchPoints},shaka.util.Platform.userAgentContains_=function(t){return(navigator.userAgent||"").includes(t)},shaka.util.Platform.anyMediaElement=function(){var t=shaka.util.Platform;return t.cachedMediaElement_||(t.cacheExpirationTimer_||(t.cacheExpirationTimer_=new shaka.util.Timer(function(){t.cachedMediaElement_=null})),t.cachedMediaElement_=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0],t.cachedMediaElement_||(t.cachedMediaElement_=document.createElement("video")),t.cacheExpirationTimer_.tickAfter(1)),t.cachedMediaElement_},shaka.util.Platform.requiresEncryptionInfoInAllInitSegments=function(){var t=shaka.util.Platform;return t.isTizen()||t.isXboxOne()},shaka.util.Platform.cacheExpirationTimer_=null,shaka.util.Platform.cachedMediaElement_=null,shaka.util.StringUtils=function(){},shaka.util.StringUtils.fromUTF8=function(t){if(!t)return"";if(t=shaka.util.BufferUtils.toUint8(t),t[0]==239&&t[1]==187&&t[2]==191&&(t=t.subarray(3)),window.TextDecoder&&!shaka.util.Platform.isPS4())return t=new TextDecoder().decode(t),t.includes("\uFFFD")&&shaka.log.alwaysError('Decoded string contains an "unknown character" codepoint.  That probably means the UTF8 encoding was incorrect!'),t;for(var r="",i=0;i<t.length;++i){var n=65533;if(t[i]&128?t.length>=i+2&&(t[i]&224)==192&&(t[i+1]&192)==128?(n=(t[i]&31)<<6|t[i+1]&63,i+=1):t.length>=i+3&&(t[i]&240)==224&&(t[i+1]&192)==128&&(t[i+2]&192)==128?(n=(t[i]&15)<<12|(t[i+1]&63)<<6|t[i+2]&63,i+=2):t.length>=i+4&&(t[i]&241)==240&&(t[i+1]&192)==128&&(t[i+2]&192)==128&&(t[i+3]&192)==128&&(n=(t[i]&7)<<18|(t[i+1]&63)<<12|(t[i+2]&63)<<6|t[i+3]&63,i+=3):n=t[i],65535>=n)r+=String.fromCharCode(n);else{n-=65536;var s=n&1023;r+=String.fromCharCode(55296+(n>>10)),r+=String.fromCharCode(56320+s)}}return r},shaka.util.StringUtils.fromUTF16=function(t,r,i){if(!t)return"";if(!i&&t.byteLength%2!=0)throw shaka.log.error("Data has an incorrect length, must be even."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BAD_ENCODING);i=Math.floor(t.byteLength/2);var n=new Uint16Array(i);t=shaka.util.BufferUtils.toDataView(t);for(var s=0;s<i;s++)n[s]=t.getUint16(2*s,r);return shaka.util.StringUtils.fromCharCode(n)},shaka.util.StringUtils.fromBytesAutoDetect=function(t){var r=shaka.util.StringUtils;if(!t)return"";var i=shaka.util.BufferUtils.toUint8(t);if(i[0]==239&&i[1]==187&&i[2]==191)return r.fromUTF8(i);if(i[0]==254&&i[1]==255)return r.fromUTF16(i.subarray(2),!1);if(i[0]==255&&i[1]==254)return r.fromUTF16(i.subarray(2),!0);var n=function(s){return i.byteLength<=s||32<=i[s]&&126>=i[s]};if(shaka.log.debug("Unable to find byte-order-mark, making an educated guess."),i[0]==0&&i[2]==0)return r.fromUTF16(t,!1);if(i[1]==0&&i[3]==0)return r.fromUTF16(t,!0);if(n(0)&&n(1)&&n(2)&&n(3))return r.fromUTF8(t);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.UNABLE_TO_DETECT_ENCODING)},shaka.util.StringUtils.toUTF8=function(t){if(window.TextEncoder&&!shaka.util.Platform.isPS4()){var r=new TextEncoder;return shaka.util.BufferUtils.toArrayBuffer(r.encode(t))}t=encodeURIComponent(t),t=unescape(t),r=new Uint8Array(t.length);for(var i=0;i<t.length;i++)r[i]=t[i].charCodeAt(0);return shaka.util.BufferUtils.toArrayBuffer(r)},shaka.util.StringUtils.toUTF16=function(t,r){for(var i=new ArrayBuffer(2*t.length),n=new DataView(i),s=0;s<t.length;++s){var o=t.charCodeAt(s);n.setUint16(2*s,o,r)}return i},shaka.util.StringUtils.fromCharCode=function(t){return shaka.util.StringUtils.fromCharCodeImpl_.value()(t)},shaka.util.StringUtils.resetFromCharCode=function(){shaka.util.StringUtils.fromCharCodeImpl_.reset()},goog.exportSymbol("shaka.util.StringUtils",shaka.util.StringUtils),goog.exportProperty(shaka.util.StringUtils,"resetFromCharCode",shaka.util.StringUtils.resetFromCharCode),goog.exportProperty(shaka.util.StringUtils,"toUTF16",shaka.util.StringUtils.toUTF16),goog.exportProperty(shaka.util.StringUtils,"toUTF8",shaka.util.StringUtils.toUTF8),goog.exportProperty(shaka.util.StringUtils,"fromBytesAutoDetect",shaka.util.StringUtils.fromBytesAutoDetect),goog.exportProperty(shaka.util.StringUtils,"fromUTF16",shaka.util.StringUtils.fromUTF16),goog.exportProperty(shaka.util.StringUtils,"fromUTF8",shaka.util.StringUtils.fromUTF8),shaka.util.StringUtils.fromCharCodeImpl_=new shaka.util.Lazy(function(){for(var t=function(i){try{var n=new Uint8Array(i),s=String.fromCharCode.apply(null,n);return goog.asserts.assert(s,"Should get value"),0<s.length}catch{return!1}},r={$jscomp$loop$prop$size$576:65536};0<r.$jscomp$loop$prop$size$576;r={$jscomp$loop$prop$size$576:r.$jscomp$loop$prop$size$576},r.$jscomp$loop$prop$size$576/=2)if(t(r.$jscomp$loop$prop$size$576))return function(i){return function(n){for(var s="",o=0;o<n.length;o+=i.$jscomp$loop$prop$size$576){var l=n.subarray(o,o+i.$jscomp$loop$prop$size$576);s+=String.fromCharCode.apply(null,l)}return s}}(r);return goog.asserts.assert(!1,"Unable to create a fromCharCode method"),null}),shaka.util.Uint8ArrayUtils=function(){},shaka.util.Uint8ArrayUtils.equal=function(t,r){return shaka.Deprecate.deprecateFeature(4,"shaka.util.Uint8ArrayUtils.equal","Please use shaka.util.BufferUtils.equal instead."),shaka.util.BufferUtils.equal(t,r)},shaka.util.Uint8ArrayUtils.toStandardBase64=function(t){return t=shaka.util.StringUtils.fromCharCode(shaka.util.BufferUtils.toUint8(t)),btoa(t)},shaka.util.Uint8ArrayUtils.toBase64=function(t,r){r=r??!0;var i=shaka.util.Uint8ArrayUtils.toStandardBase64(t).replace(/\+/g,"-").replace(/\//g,"_");return r?i:i.replace(/[=]*$/,"")},shaka.util.Uint8ArrayUtils.fromBase64=function(t){t=window.atob(t.replace(/-/g,"+").replace(/_/g,"/"));for(var r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r},shaka.util.Uint8ArrayUtils.fromHex=function(t){for(var r=t.length/2,i=new Uint8Array(r),n=0;n<r;n++)i[n]=window.parseInt(t.substr(2*n,2),16);return i},shaka.util.Uint8ArrayUtils.toHex=function(t){var r=shaka.util.BufferUtils.toUint8(t);t="",r=$jscomp.makeIterator(r);for(var i=r.next();!i.done;i=r.next())i=i.value,i=i.toString(16),i.length==1&&(i="0"+i),t+=i;return t},shaka.util.Uint8ArrayUtils.concat=function(){for(var t=$jscomp.getRestArguments.apply(0,arguments),r=0,i=$jscomp.makeIterator(t),n=i.next();!n.done;n=i.next())r+=n.value.byteLength;for(r=new Uint8Array(r),i=0,t=$jscomp.makeIterator(t),n=t.next();!n.done;n=t.next())n=n.value,r.set(shaka.util.BufferUtils.toUint8(n),i),i+=n.byteLength;return r},goog.exportSymbol("shaka.util.Uint8ArrayUtils",shaka.util.Uint8ArrayUtils),goog.exportProperty(shaka.util.Uint8ArrayUtils,"concat",shaka.util.Uint8ArrayUtils.concat),goog.exportProperty(shaka.util.Uint8ArrayUtils,"toHex",shaka.util.Uint8ArrayUtils.toHex),goog.exportProperty(shaka.util.Uint8ArrayUtils,"fromHex",shaka.util.Uint8ArrayUtils.fromHex),goog.exportProperty(shaka.util.Uint8ArrayUtils,"fromBase64",shaka.util.Uint8ArrayUtils.fromBase64),goog.exportProperty(shaka.util.Uint8ArrayUtils,"toBase64",shaka.util.Uint8ArrayUtils.toBase64),goog.exportProperty(shaka.util.Uint8ArrayUtils,"toStandardBase64",shaka.util.Uint8ArrayUtils.toStandardBase64),goog.exportProperty(shaka.util.Uint8ArrayUtils,"equal",shaka.util.Uint8ArrayUtils.equal),shaka.media={},shaka.media.Transmuxer=function(){var t=this;this.muxjs_=shaka.dependencies.muxjs(),this.muxTransmuxer_=new this.muxjs_.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.transmuxPromise_=null,this.transmuxedData_=[],this.captions_=[],this.metadata_=[],this.isTransmuxing_=!1,this.muxTransmuxer_.on("data",function(r){return t.onTransmuxed_(r)}),this.muxTransmuxer_.on("done",function(){return t.onTransmuxDone_()})},shaka.media.Transmuxer.prototype.destroy=function(){return this.muxTransmuxer_.dispose(),this.muxTransmuxer_=null,Promise.resolve()},shaka.media.Transmuxer.isSupported=function(t,r){var i=shaka.media.Transmuxer;if(!shaka.dependencies.muxjs()||!i.isTsContainer(t))return!1;if(r)return MediaSource.isTypeSupported(i.convertTsCodecs(r,t));var n=shaka.util.ManifestParserUtils.ContentType,s=i.convertTsCodecs(n.AUDIO,t);return i=i.convertTsCodecs(n.VIDEO,t),MediaSource.isTypeSupported(s)||MediaSource.isTypeSupported(i)},shaka.media.Transmuxer.isTsContainer=function(t){return t.toLowerCase().split(";")[0].split("/")[1]=="mp2t"},shaka.media.Transmuxer.convertTsCodecs=function(t,r){var i=shaka.util.ManifestParserUtils.ContentType,n=r.replace(/mp2t/i,"mp4");if(t==i.AUDIO&&(n=n.replace("video","audio")),i=/avc1\.(66|77|100)\.(\d+)/.exec(n)){var s="avc1.",o=i[1];o=="66"?s+="4200":o=="77"?s+="4d00":(goog.asserts.assert(o=="100","Legacy avc1 parsing code out of sync with regex!"),s+="6400"),o=Number(i[2]),goog.asserts.assert(256>o,"Invalid legacy avc1 level number!"),s+=(o>>4).toString(16),s+=(o&15).toString(16),n=n.replace(i[0],s)}return n},shaka.media.Transmuxer.prototype.transmux=function(t){return goog.asserts.assert(!this.isTransmuxing_,"No transmuxing should be in progress."),this.isTransmuxing_=!0,this.transmuxPromise_=new shaka.util.PublicPromise,this.transmuxedData_=[],this.captions_=[],this.metadata_=[],t=shaka.util.BufferUtils.toUint8(t),this.muxTransmuxer_.push(t),this.muxTransmuxer_.flush(),this.isTransmuxing_&&this.transmuxPromise_.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.TRANSMUXING_FAILED)),this.transmuxPromise_},shaka.media.Transmuxer.prototype.onTransmuxed_=function(t){this.captions_=t.captions,this.metadata_=t.metadata,this.transmuxedData_.push(shaka.util.Uint8ArrayUtils.concat(t.initSegment,t.data))},shaka.media.Transmuxer.prototype.onTransmuxDone_=function(){var t={data:shaka.util.Uint8ArrayUtils.concat.apply(shaka.util.Uint8ArrayUtils,$jscomp.arrayFromIterable(this.transmuxedData_)),captions:this.captions_,metadata:this.metadata_};this.transmuxPromise_.resolve(t),this.isTransmuxing_=!1},shaka.util.MimeUtils=function(){},shaka.util.MimeUtils.getFullType=function(t,r){var i=t;return r&&(i+='; codecs="'+r+'"'),i},shaka.util.MimeUtils.getFullOrConvertedType=function(t,r,i){if(t=shaka.util.MimeUtils.getFullType(t,r),r=shaka.util.ManifestParserUtils.ContentType,shaka.media.Transmuxer.isTsContainer(t)){if(shaka.dependencies.muxjs())return shaka.media.Transmuxer.convertTsCodecs(i,t)}else if(i==r.AUDIO)return t.replace("video","audio");return t},shaka.util.MimeUtils.getExtendedType=function(t){var r=[t.mimeType];return shaka.util.MimeUtils.EXTENDED_MIME_PARAMETERS_.forEach(function(i,n){var s=t[n];s&&r.push(i+'="'+s+'"')}),t.hdr=="PQ"&&r.push('eotf="smpte2084"'),r.join(";")},shaka.util.MimeUtils.getContainerType=function(t){return t.split(";")[0].split("/")[1]},shaka.util.MimeUtils.splitCodecs=function(t){return t.split(",")},shaka.util.MimeUtils.getNormalizedCodec=function(t){var r=shaka.util.MimeUtils.getCodecParts_(t);switch(t=r[0],r=r[1].toLowerCase(),!0){case(t==="mp4a"&&r==="69"):case(t==="mp4a"&&r==="6b"):return"mp3";case(t==="mp4a"&&r==="66"):case(t==="mp4a"&&r==="67"):case(t==="mp4a"&&r==="68"):case(t==="mp4a"&&r==="40.2"):case(t==="mp4a"&&r==="40.02"):case(t==="mp4a"&&r==="40.5"):case(t==="mp4a"&&r==="40.05"):case(t==="mp4a"&&r==="40.29"):case(t==="mp4a"&&r==="40.42"):return"aac";case(t==="mp4a"&&r==="a5"):return"ac-3";case(t==="mp4a"&&r==="a6"):return"ec-3";case(t==="mp4a"&&r==="b2"):return"dtsx";case(t==="mp4a"&&r==="a9"):return"dtsc";case t==="avc1":case t==="avc3":return"avc";case t==="hvc1":case t==="hev1":return"hevc";case t==="dvh1":case t==="dvhe":return"dovi"}return t},shaka.util.MimeUtils.getCodecBase=function(t){return shaka.util.MimeUtils.getCodecParts_(t)[0]},shaka.util.MimeUtils.getBasicType=function(t){return t.split(";")[0]},shaka.util.MimeUtils.getCodecs=function(t){return t=t.split(/ *; */),t.shift(),(t=t.find(function(r){return r.startsWith("codecs=")}))?t.split("=")[1].replace(/^"|"$/g,""):""},shaka.util.MimeUtils.getCodecParts_=function(t){var r=t.split(".");return t=r[0],r.shift(),r=r.join("."),[t,r]},shaka.util.MimeUtils.EXTENDED_MIME_PARAMETERS_=new Map().set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels"),shaka.util.MimeUtils.CEA608_CLOSED_CAPTION_MIMETYPE="application/cea-608",shaka.util.MimeUtils.CEA708_CLOSED_CAPTION_MIMETYPE="application/cea-708",shaka.text.TextEngine=function(t){this.parser_=null,this.displayer_=t,this.appendWindowStart_=this.timestampOffset_=0,this.appendWindowEnd_=1/0,this.bufferEnd_=this.bufferStart_=null,this.selectedClosedCaptionId_="",this.closedCaptionsMap_=new Map},shaka.text.TextEngine.registerParser=function(t,r){shaka.text.TextEngine.parserMap_[t]=r},shaka.text.TextEngine.unregisterParser=function(t){delete shaka.text.TextEngine.parserMap_[t]},shaka.text.TextEngine.findParser=function(t){return shaka.text.TextEngine.parserMap_[t]},shaka.text.TextEngine.isTypeSupported=function(t){return!!(shaka.text.TextEngine.parserMap_[t]||t==shaka.util.MimeUtils.CEA608_CLOSED_CAPTION_MIMETYPE||t==shaka.util.MimeUtils.CEA708_CLOSED_CAPTION_MIMETYPE)},shaka.text.TextEngine.prototype.destroy=function(){return this.displayer_=this.parser_=null,this.closedCaptionsMap_.clear(),Promise.resolve()},shaka.text.TextEngine.prototype.setDisplayer=function(t){this.displayer_=t},shaka.text.TextEngine.prototype.initParser=function(t){t!=shaka.util.MimeUtils.CEA608_CLOSED_CAPTION_MIMETYPE&&t!=shaka.util.MimeUtils.CEA708_CLOSED_CAPTION_MIMETYPE&&(t=shaka.text.TextEngine.parserMap_[t],goog.asserts.assert(t,"Text type negotiation should have happened already"),this.parser_=shaka.util.Functional.callFactory(t))},shaka.text.TextEngine.prototype.appendBuffer=function(t,r,i){var n=this,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){if(u.nextAddress==1)return goog.asserts.assert(n.parser_,"The parser should already be initialized"),u.yield(Promise.resolve(),2);if(!n.parser_||!n.displayer_)return u.return();if(r==null||i==null)return n.parser_.parseInit(shaka.util.BufferUtils.toUint8(t)),u.return();s={periodStart:n.timestampOffset_,segmentStart:r,segmentEnd:i},o=n.parser_.parseMedia(shaka.util.BufferUtils.toUint8(t),s),l=o.filter(function(m){return m.startTime>=n.appendWindowStart_&&m.startTime<n.appendWindowEnd_}),n.displayer_.append(l),n.bufferStart_==null?n.bufferStart_=Math.max(r,n.appendWindowStart_):(goog.asserts.assert(n.bufferEnd_!=null,"There should already be a buffered range end."),goog.asserts.assert(1>=r-n.bufferEnd_,"There should not be a gap in text references >1s")),n.bufferEnd_=Math.min(i,n.appendWindowEnd_),u.jumpToEnd()})},shaka.text.TextEngine.prototype.remove=function(t,r){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(n.nextAddress==1)return n.yield(Promise.resolve(),2);i.displayer_&&i.displayer_.remove(t,r)&&(i.bufferStart_==null?goog.asserts.assert(i.bufferEnd_==null,"end must be null if startTime is null"):(goog.asserts.assert(i.bufferEnd_!=null,"end must be non-null if startTime is non-null"),r<=i.bufferStart_||t>=i.bufferEnd_||(t<=i.bufferStart_&&r>=i.bufferEnd_?i.bufferStart_=i.bufferEnd_=null:t<=i.bufferStart_&&r<i.bufferEnd_?i.bufferStart_=r:t>i.bufferStart_&&r>=i.bufferEnd_?i.bufferEnd_=t:goog.asserts.assert(!1,"removal from the middle is not supported by TextEngine")))),n.jumpToEnd()})},shaka.text.TextEngine.prototype.setTimestampOffset=function(t){this.timestampOffset_=t},shaka.text.TextEngine.prototype.setAppendWindow=function(t,r){this.appendWindowStart_=t,this.appendWindowEnd_=r},shaka.text.TextEngine.prototype.bufferStart=function(){return this.bufferStart_},shaka.text.TextEngine.prototype.bufferEnd=function(){return this.bufferEnd_},shaka.text.TextEngine.prototype.isBuffered=function(t){return this.bufferStart_==null||this.bufferEnd_==null?!1:t>=this.bufferStart_&&t<this.bufferEnd_},shaka.text.TextEngine.prototype.bufferedAheadOf=function(t){return this.bufferEnd_==null||this.bufferEnd_<t?0:(goog.asserts.assert(this.bufferStart_!=null,"start should not be null if end is not null"),this.bufferEnd_-Math.max(t,this.bufferStart_))},shaka.text.TextEngine.prototype.setSelectedClosedCaptionId=function(t,r){this.selectedClosedCaptionId_=t;var i=this.closedCaptionsMap_.get(t);if(i)for(var n=$jscomp.makeIterator(i.keys()),s=n.next();!s.done;s=n.next())(s=i.get(s.value).filter(function(o){return o.endTime<=r}))&&this.displayer_.append(s)},shaka.text.TextEngine.prototype.convertMuxjsCaptionsToShakaCaptions=function(t){var r=[];t=$jscomp.makeIterator(t);for(var i=t.next();!i.done;i=t.next()){i=i.value;var n=new shaka.text.Cue(i.startTime,i.endTime,i.text);r.push({stream:i.stream,cue:n})}return r},shaka.text.TextEngine.prototype.applyVideoTimestampOffsetRecursive_=function(t,r){t.startTime+=r,t.endTime+=r;for(var i=$jscomp.makeIterator(t.nestedCues),n=i.next();!n.done;n=i.next())this.applyVideoTimestampOffsetRecursive_(n.value,r)},shaka.text.TextEngine.prototype.storeAndAppendClosedCaptions=function(t,r,i,n){var s=r+" "+i,o=new Map;t=$jscomp.makeIterator(t);for(var l=t.next();!l.done;l=t.next()){var u=l.value;l=u.stream,u=u.cue,o.has(l)||o.set(l,new Map),o.get(l).has(s)||o.get(l).set(s,[]),this.applyVideoTimestampOffsetRecursive_(u,n),u.startTime>=this.appendWindowStart_&&u.startTime<this.appendWindowEnd_&&(o.get(l).get(s).push(u),l==this.selectedClosedCaptionId_&&this.displayer_.append([u]))}for(n=$jscomp.makeIterator(o.keys()),s=n.next();!s.done;s=n.next())for(s=s.value,this.closedCaptionsMap_.has(s)||this.closedCaptionsMap_.set(s,new Map),t=$jscomp.makeIterator(o.get(s).keys()),l=t.next();!l.done;l=t.next())l=l.value,u=o.get(s).get(l),this.closedCaptionsMap_.get(s).set(l,u);this.bufferStart_=this.bufferStart_==null?Math.max(r,this.appendWindowStart_):Math.min(this.bufferStart_,Math.max(r,this.appendWindowStart_)),this.bufferEnd_=Math.max(this.bufferEnd_,Math.min(i,this.appendWindowEnd_))},shaka.text.TextEngine.prototype.getNumberOfClosedCaptionChannels=function(){return this.closedCaptionsMap_.size},shaka.text.TextEngine.prototype.getNumberOfClosedCaptionsInChannel=function(t){return(t=this.closedCaptionsMap_.get(t))?t.size:0},goog.exportSymbol("shaka.text.TextEngine",shaka.text.TextEngine),goog.exportProperty(shaka.text.TextEngine.prototype,"destroy",shaka.text.TextEngine.prototype.destroy),goog.exportProperty(shaka.text.TextEngine,"findParser",shaka.text.TextEngine.findParser),goog.exportProperty(shaka.text.TextEngine,"unregisterParser",shaka.text.TextEngine.unregisterParser),goog.exportProperty(shaka.text.TextEngine,"registerParser",shaka.text.TextEngine.registerParser),shaka.text.TextEngine.parserMap_={},shaka.util.LanguageUtils=function(){},shaka.util.LanguageUtils.areLocaleCompatible=function(t,r){var i=shaka.util.LanguageUtils;return t=i.normalize(t),r=i.normalize(r),t==r},shaka.util.LanguageUtils.areLanguageCompatible=function(t,r){var i=shaka.util.LanguageUtils;t=i.normalize(t),r=i.normalize(r);var n=i.disassembleLocale_(t);return i=i.disassembleLocale_(r),n[0]==i[0]},shaka.util.LanguageUtils.isParentOf=function(t,r){var i=shaka.util.LanguageUtils;t=i.normalize(t),r=i.normalize(r);var n=i.disassembleLocale_(t);return i=i.disassembleLocale_(r),n[0]==i[0]&&n.length==1&&i.length==2},shaka.util.LanguageUtils.isSiblingOf=function(t,r){var i=shaka.util.LanguageUtils;t=i.normalize(t),r=i.normalize(r);var n=i.disassembleLocale_(t);return i=i.disassembleLocale_(r),n.length==2&&i.length==2&&n[0]==i[0]},shaka.util.LanguageUtils.normalize=function(t){var r=shaka.util.LanguageUtils,i=t.split("-");return t=i[0]||"",i=i[1]||"",t=t.toLowerCase(),t=r.isoMap_.get(t)||t,(i=i.toUpperCase())?t+"-"+i:t},shaka.util.LanguageUtils.areSiblings=function(t,r){var i=shaka.util.LanguageUtils,n=i.getBase(t);return i=i.getBase(r),t!=n&&r!=i&&n==i},shaka.util.LanguageUtils.relatedness=function(t,r){var i=shaka.util.LanguageUtils;return t=i.normalize(t),r=i.normalize(r),r==t?4:i.isParentOf(r,t)?3:i.isSiblingOf(r,t)?2:i.isParentOf(t,r)?1:0},shaka.util.LanguageUtils.getBase=function(t){var r=shaka.util.LanguageUtils,i=t.indexOf("-");return t=0<=i?t.substring(0,i):t,t=t.toLowerCase(),t=r.isoMap_.get(t)||t},shaka.util.LanguageUtils.getLocaleForText=function(t){var r=shaka.util.LanguageUtils;return goog.asserts.assert(t.type==shaka.util.ManifestParserUtils.ContentType.TEXT,"Can only get language from text streams"),r.normalize(t.language||"und")},shaka.util.LanguageUtils.getLocaleForVariant=function(t){var r=shaka.util.LanguageUtils;return t.language?r.normalize(t.language):t.audio&&t.audio.language?r.normalize(t.audio.language):t.video&&t.video.language?r.normalize(t.video.language):"und"},shaka.util.LanguageUtils.findClosestLocale=function(t,r){for(var i=shaka.util.LanguageUtils,n=i.normalize(t),s=new Set,o=$jscomp.makeIterator(r),l=o.next();!l.done;l=o.next())s.add(i.normalize(l.value));for(o=$jscomp.makeIterator(s),l=o.next();!l.done;l=o.next())if(l=l.value,l==n)return l;for(o=$jscomp.makeIterator(s),l=o.next();!l.done;l=o.next())if(l=l.value,i.isParentOf(l,n))return l;for(o=$jscomp.makeIterator(s),l=o.next();!l.done;l=o.next())if(l=l.value,i.isSiblingOf(l,n))return l;for(s=$jscomp.makeIterator(s),l=s.next();!l.done;l=s.next())if(l=l.value,i.isParentOf(n,l))return l;return null},shaka.util.LanguageUtils.disassembleLocale_=function(t){var r=t.split("-");return goog.asserts.assert(2>=r.length,["Locales should not have more than 2 components. ",t," has too many components."].join()),r},goog.exportSymbol("shaka.util.LanguageUtils",shaka.util.LanguageUtils),goog.exportProperty(shaka.util.LanguageUtils,"findClosestLocale",shaka.util.LanguageUtils.findClosestLocale),goog.exportProperty(shaka.util.LanguageUtils,"getLocaleForVariant",shaka.util.LanguageUtils.getLocaleForVariant),goog.exportProperty(shaka.util.LanguageUtils,"getLocaleForText",shaka.util.LanguageUtils.getLocaleForText),goog.exportProperty(shaka.util.LanguageUtils,"getBase",shaka.util.LanguageUtils.getBase),goog.exportProperty(shaka.util.LanguageUtils,"relatedness",shaka.util.LanguageUtils.relatedness),goog.exportProperty(shaka.util.LanguageUtils,"areSiblings",shaka.util.LanguageUtils.areSiblings),goog.exportProperty(shaka.util.LanguageUtils,"normalize",shaka.util.LanguageUtils.normalize),goog.exportProperty(shaka.util.LanguageUtils,"isSiblingOf",shaka.util.LanguageUtils.isSiblingOf),goog.exportProperty(shaka.util.LanguageUtils,"isParentOf",shaka.util.LanguageUtils.isParentOf),goog.exportProperty(shaka.util.LanguageUtils,"areLanguageCompatible",shaka.util.LanguageUtils.areLanguageCompatible),goog.exportProperty(shaka.util.LanguageUtils,"areLocaleCompatible",shaka.util.LanguageUtils.areLocaleCompatible),shaka.util.LanguageUtils.isoMap_=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]),shaka.util.MultiMap=function(){this.map_={}},shaka.util.MultiMap.prototype.push=function(t,r){this.map_.hasOwnProperty(t)?this.map_[t].push(r):this.map_[t]=[r]},shaka.util.MultiMap.prototype.get=function(t){return(t=this.map_[t])?t.slice():null},shaka.util.MultiMap.prototype.getAll=function(){var t=[],r;for(r in this.map_)t.push.apply(t,$jscomp.arrayFromIterable(this.map_[r]));return t},shaka.util.MultiMap.prototype.remove=function(t,r){t in this.map_&&(this.map_[t]=this.map_[t].filter(function(i){return i!=r}),this.map_[t].length==0&&delete this.map_[t])},shaka.util.MultiMap.prototype.clear=function(){this.map_={}},shaka.util.MultiMap.prototype.forEach=function(t){for(var r in this.map_)t(r,this.map_[r])},shaka.util.MultiMap.prototype.size=function(){return Object.keys(this.map_).length},shaka.util.MultiMap.prototype.keys=function(){return Object.keys(this.map_)},shaka.util.StreamUtils=function(){},shaka.util.StreamUtils.chooseCodecsAndFilterManifest=function(t,r,i,n,s){var o=shaka.util.StreamUtils,l=t.variants;(r.length||i.length)&&(l=o.choosePreferredCodecs(l,r,i)),l=o.filterVariantsByAudioChannelCount(l,n),r=o.getVariantsByCodecs_(l),r=o.filterVariantsByDensity_(r);var u=o.chooseCodecsByDecodingAttributes_(r,s);t.variants=t.variants.filter(function(m){return o.getVariantCodecs_(m)==u?!0:(shaka.log.debug("Dropping Variant (better codec available)",m),!1)})},shaka.util.StreamUtils.getVariantsByCodecs_=function(t){var r=new shaka.util.MultiMap;t=$jscomp.makeIterator(t);for(var i=t.next();!i.done;i=t.next()){i=i.value;var n=shaka.util.StreamUtils.getVariantCodecs_(i);r.push(n,i)}return r},shaka.util.StreamUtils.filterVariantsByDensity_=function(t){var r=0,i=new Map,n=t.size();return t.forEach(function(s,o){for(var l=$jscomp.makeIterator(o),u=l.next();!u.done;u=l.next()){u=u.value;var m=u.video;if(m&&m.width&&m.height){m=m.width*m.height*(m.frameRate||1),i.has(m)||i.set(m,new shaka.util.MultiMap);var E=i.get(m);E.push(s,u),E.size()===n&&(r=Math.max(r,m))}}}),r?i.get(r):t},shaka.util.StreamUtils.choosePreferredCodecs=function(t,r,i){var n={};r=$jscomp.makeIterator(r);for(var s=r.next();!s.done;n={$jscomp$loop$prop$videoCodec$578:n.$jscomp$loop$prop$videoCodec$578},s=r.next())if(n.$jscomp$loop$prop$videoCodec$578=s.value,s=t.filter(function(o){return function(l){return l.video&&l.video.codecs.startsWith(o.$jscomp$loop$prop$videoCodec$578)}}(n)),s.length){t=s;break}for(n={},i=$jscomp.makeIterator(i),r=i.next();!r.done;n={$jscomp$loop$prop$audioCodec$580:n.$jscomp$loop$prop$audioCodec$580},r=i.next())if(n.$jscomp$loop$prop$audioCodec$580=r.value,r=t.filter(function(o){return function(l){return l.audio&&l.audio.codecs.startsWith(o.$jscomp$loop$prop$audioCodec$580)}}(n)),r.length){t=r;break}return t},shaka.util.StreamUtils.chooseCodecsByDecodingAttributes_=function(t,r){for(var i=shaka.util.StreamUtils,n=$jscomp.makeIterator(r),s=n.next();!s.done;s=n.next())if(s=s.value,s==i.DecodingAttributes.SMOOTH||s==i.DecodingAttributes.POWER){if(t=i.chooseCodecsByMediaCapabilitiesInfo_(t,s),t.size()==1)return t.keys()[0]}else if(s==i.DecodingAttributes.BANDWIDTH)break;return i.findCodecsByLowestBandwidth_(t)},shaka.util.StreamUtils.chooseCodecsByMediaCapabilitiesInfo_=function(t,r){var i=0,n=new shaka.util.MultiMap;return t.forEach(function(s,o){for(var l=0,u=0,m=$jscomp.makeIterator(o),E=m.next();!E.done;E=m.next())E=E.value,E.decodingInfos.length&&(l+=E.decodingInfos[0][r]?1:0,u++);l/=u,shaka.log.debug("codecs",s,"avg",r,l),l>i?(n.clear(),n.push(s,o),i=l):l==i&&n.push(s,o)}),n},shaka.util.StreamUtils.findCodecsByLowestBandwidth_=function(t){var r="",i=1/0;return t.forEach(function(n,s){for(var o=0,l=0,u=$jscomp.makeIterator(s),m=u.next();!m.done;m=u.next())o+=m.value.bandwidth||0,++l;o/=l,shaka.log.debug("codecs",n,"avg bandwidth",o),o<i&&(r=n,i=o)}),goog.asserts.assert(r!=="","Should have chosen codecs!"),goog.asserts.assert(!isNaN(i),"Bandwidth should be a number!"),r},shaka.util.StreamUtils.getVariantCodecs_=function(t){var r="";t.video&&(r=shaka.util.MimeUtils.getNormalizedCodec(t.video.codecs));var i="";return t.audio&&(i=shaka.util.MimeUtils.getNormalizedCodec(t.audio.codecs)),r+"-"+i},shaka.util.StreamUtils.filterByRestrictions=function(t,r,i){t.variants=t.variants.filter(function(n){return shaka.util.StreamUtils.meetsRestrictions(n,r,i)})},shaka.util.StreamUtils.meetsRestrictions=function(t,r,i){var n=function(o,l,u){return o>=l&&o<=u},s=t.video;return!(s&&s.width&&s.height&&(!n(s.width,r.minWidth,Math.min(r.maxWidth,i.width))||!n(s.height,r.minHeight,Math.min(r.maxHeight,i.height))||!n(s.width*s.height,r.minPixels,r.maxPixels))||t&&t.video&&t.video.frameRate&&!n(t.video.frameRate,r.minFrameRate,r.maxFrameRate)||!n(t.bandwidth,r.minBandwidth,r.maxBandwidth))},shaka.util.StreamUtils.applyRestrictions=function(t,r,i){var n=!1;t=$jscomp.makeIterator(t);for(var s=t.next();!s.done;s=t.next()){s=s.value;var o=s.allowedByApplication;s.allowedByApplication=shaka.util.StreamUtils.meetsRestrictions(s,r,i),o!=s.allowedByApplication&&(n=!0)}return n},shaka.util.StreamUtils.filterManifest=function(t,r,i){return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(n.nextAddress==1)return n.yield(shaka.util.StreamUtils.filterManifestByMediaCapabilities(i,0<i.offlineSessionIds.length),2);shaka.util.StreamUtils.filterManifestByCurrentVariant(r,i),shaka.util.StreamUtils.filterTextStreams_(i),shaka.util.StreamUtils.filterImageStreams_(i),n.jumpToEnd()})},shaka.util.StreamUtils.filterManifestByMediaCapabilities=function(t,r){return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){if(i.nextAddress==1)return goog.asserts.assert(navigator.mediaCapabilities,"MediaCapabilities should be valid."),i.yield(shaka.util.StreamUtils.getDecodingInfosForVariants(t.variants,r,!1),2);t.variants=t.variants.filter(function(n){var s=n.video,o=shaka.util.ManifestParserUtils.ContentType;if(s){var l=shaka.util.StreamUtils.patchVp9(s.codecs);if(s.codecs.includes(",")){var u=s.codecs.split(",");if(l=shaka.util.ManifestParserUtils.guessCodecs(o.VIDEO,u),u=shaka.util.ManifestParserUtils.guessCodecs(o.AUDIO,u),u=shaka.util.MimeUtils.getFullOrConvertedType(s.mimeType,u,o.AUDIO),!MediaSource.isTypeSupported(u))return!1}if(l=shaka.util.MimeUtils.getFullOrConvertedType(s.mimeType,l,o.VIDEO),!MediaSource.isTypeSupported(l))return!1}return(l=n.audio)&&(u=shaka.util.StreamUtils.getCorrectAudioCodecs_(l.codecs),o=shaka.util.MimeUtils.getFullOrConvertedType(l.mimeType,u,o.AUDIO),!MediaSource.isTypeSupported(o))?!1:shaka.util.Platform.isXboxOne()&&s&&(s.width&&1920<s.width||s.height&&1080<s.height)&&s.codecs.includes("avc1.")?(shaka.log.debug("Dropping variant - not compatible with platform",shaka.util.StreamUtils.getVariantSummaryString_(n)),!1):((s=n.decodingInfos.some(function(m){return m.supported}))||shaka.log.debug("Dropping variant - not compatible with platform",shaka.util.StreamUtils.getVariantSummaryString_(n)),s)}),i.jumpToEnd()})},shaka.util.StreamUtils.getDecodingInfosForVariants=function(t,r,i){var n,s,o,l,u,m,E,y,D,w,B;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){if(n=t.some(function(V){return V.decodingInfos.length}))return shaka.log.debug("Already got the variants' decodingInfo."),F.return();for(s=navigator.mediaCapabilities,o=[],l=function(V,K){var q,re;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ee){if(ee.nextAddress==1)return ee.setCatchFinallyBlocks(2),ee.yield(s.decodingInfo(K),4);if(ee.nextAddress!=2)return q=ee.yieldResult,V.decodingInfos.push(q),ee.leaveTryBlock(0);re=ee.enterCatchBlock(),shaka.log.info("MediaCapabilities.decodingInfo() failed.",JSON.stringify(K),re),ee.jumpToEnd()})},u=$jscomp.makeIterator(t),m=u.next();!m.done;m=u.next())for(E=m.value,y=shaka.util.StreamUtils.getDecodingConfigs_(E,r,i),D=$jscomp.makeIterator(y),w=D.next();!w.done;w=D.next())B=w.value,o.push(l(E,B));return F.yield(Promise.all(o),0)})},shaka.util.StreamUtils.getDecodingConfigs_=function(t,r,i){var n=t.audio,s=t.video,o=shaka.util.ManifestParserUtils.ContentType;if(i={type:i?"file":"media-source"},s){var l=s.codecs;if(s.codecs.includes(",")){var u=s.codecs.split(",");l=shaka.util.ManifestParserUtils.guessCodecs(o.VIDEO,u),l=shaka.util.StreamUtils.patchVp9(l),u=shaka.util.ManifestParserUtils.guessCodecs(o.AUDIO,u),u=shaka.util.MimeUtils.getFullOrConvertedType(s.mimeType,u,o.AUDIO),i.audio={contentType:u,channels:2,bitrate:t.bandwidth||1,samplerate:1,spatialRendering:!1}}if(l=shaka.util.StreamUtils.patchVp9(l),l=shaka.util.MimeUtils.getFullOrConvertedType(s.mimeType,l,o.VIDEO),i.video={contentType:l,width:s.width||64,height:s.height||64,bitrate:s.bandwidth||t.bandwidth||1,framerate:s.frameRate||1},s.hdr)switch(s.hdr){case"SDR":i.video.transferFunction="srgb";break;case"PQ":i.video.transferFunction="pq";break;case"HLG":i.video.transferFunction="hlg"}}if(n&&(l=shaka.util.StreamUtils.getCorrectAudioCodecs_(n.codecs),o=shaka.util.MimeUtils.getFullOrConvertedType(n.mimeType,l,o.AUDIO),i.audio={contentType:o,channels:n.channelsCount||2,bitrate:n.bandwidth||t.bandwidth||1,samplerate:n.audioSamplingRate||1,spatialRendering:n.spatialAudio}),l=(t.video?t.video.drmInfos:[]).concat(t.audio?t.audio.drmInfos:[]),!l.length)return[i];t=[],o=new Map,l=$jscomp.makeIterator(l);for(var m=l.next();!m.done;m=l.next())u=m.value,o.get(u.keySystem)||o.set(u.keySystem,[]),o.get(u.keySystem).push(u);l=r?"required":"optional",r=r?["persistent-license"]:["temporary"],u=$jscomp.makeIterator(o.keys());for(var E=u.next();!E.done;E=u.next()){var y=E.value;E=Object.assign({},i);var D=o.get(y);for(y={keySystem:y,initDataType:"cenc",persistentState:l,distinctiveIdentifier:"optional",sessionTypes:r},D=$jscomp.makeIterator(D),m=D.next();!m.done;m=D.next()){if(m=m.value,m.initData&&m.initData.length){for(var w=new Set,B=$jscomp.makeIterator(m.initData),F=B.next();!F.done;F=B.next())w.add(F.value.initDataType);1<w.size&&shaka.log.v2("DrmInfo contains more than one initDataType,","and we use the initDataType of the first initData.",m),y.initDataType=m.initData[0].initDataType}m.distinctiveIdentifierRequired&&(y.distinctiveIdentifier="required"),m.persistentStateRequired&&(y.persistentState="required"),m.sessionType&&(y.sessionTypes=[m.sessionType]),n&&(y.audio?y.audio.robustness=y.audio.robustness||m.audioRobustness:y.audio={robustness:m.audioRobustness}),s&&(y.video?y.video.robustness=y.video.robustness||m.videoRobustness:y.video={robustness:m.videoRobustness})}E.keySystemConfiguration=y,t.push(E)}return t},shaka.util.StreamUtils.getCorrectAudioCodecs_=function(t){return shaka.util.Platform.isTizen()&&t.toLowerCase()=="ac-3"?"ec-3":t},shaka.util.StreamUtils.patchVp9=function(t){return t=="vp9"?"vp09.00.41.08":t},shaka.util.StreamUtils.filterManifestByCurrentVariant=function(t,r){var i=shaka.util.StreamUtils;r.variants=r.variants.filter(function(n){var s=n.audio;return n=n.video,s&&t&&t.audio&&!i.areStreamsCompatible_(s,t.audio)?(shaka.log.debug("Droping variant - not compatible with active audio","active audio",i.getStreamSummaryString_(t.audio),"variant.audio",i.getStreamSummaryString_(s)),!1):n&&t&&t.video&&!i.areStreamsCompatible_(n,t.video)?(shaka.log.debug("Droping variant - not compatible with active video","active video",i.getStreamSummaryString_(t.video),"variant.video",i.getStreamSummaryString_(n)),!1):!0})},shaka.util.StreamUtils.filterTextStreams_=function(t){t.textStreams=t.textStreams.filter(function(r){var i=shaka.util.MimeUtils.getFullType(r.mimeType,r.codecs);return(i=shaka.text.TextEngine.isTypeSupported(i))||shaka.log.debug("Dropping text stream. Is not supported by the platform.",r),i})},shaka.util.StreamUtils.filterImageStreams_=function(t){t.imageStreams=t.imageStreams.filter(function(r){var i=["image/svg+xml","image/png","image/jpeg"],n=shaka.util.Platform;return(n.isWebOS()||n.isTizen()||n.isChromecast())&&i.push("image/webp"),(i=i.includes(r.mimeType))||shaka.log.debug("Dropping image stream. Is not supported by the platform.",r),i})},shaka.util.StreamUtils.areStreamsCompatible_=function(t,r){return!(t.mimeType!=r.mimeType||t.codecs.split(".")[0]!=r.codecs.split(".")[0])},shaka.util.StreamUtils.variantToTrack=function(t){var r=t.audio,i=t.video,n=r?r.codecs:null,s=i?i.codecs:null,o=[];s&&o.push(s),n&&o.push(n);var l=[];i&&l.push(i.mimeType),r&&l.push(r.mimeType),l=l[0]||null;var u=[];r&&u.push(r.kind),i&&u.push(i.kind),u=u[0]||null;var m=new Set;if(r)for(var E=$jscomp.makeIterator(r.roles),y=E.next();!y.done;y=E.next())m.add(y.value);if(i)for(E=$jscomp.makeIterator(i.roles),y=E.next();!y.done;y=E.next())m.add(y.value);return t={id:t.id,active:!1,type:"variant",bandwidth:t.bandwidth,language:t.language,label:null,kind:u,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:l,codecs:o.join(", "),audioCodec:n,videoCodec:s,primary:t.primary,roles:Array.from(m),audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null},i&&(t.videoId=i.id,t.originalVideoId=i.originalId,t.width=i.width||null,t.height=i.height||null,t.frameRate=i.frameRate||null,t.pixelAspectRatio=i.pixelAspectRatio||null,t.videoBandwidth=i.bandwidth||null),r&&(t.audioId=r.id,t.originalAudioId=r.originalId,t.channelsCount=r.channelsCount,t.audioSamplingRate=r.audioSamplingRate,t.audioBandwidth=r.bandwidth||null,t.spatialAudio=r.spatialAudio,t.label=r.label,t.audioRoles=r.roles),t},shaka.util.StreamUtils.textStreamToTrack=function(t){return{id:t.id,active:!1,type:shaka.util.ManifestParserUtils.ContentType.TEXT,bandwidth:0,language:t.language,label:t.label,kind:t.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:t.mimeType,codecs:t.codecs||null,audioCodec:null,videoCodec:null,primary:t.primary,roles:t.roles,audioRoles:null,forced:t.forced,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:t.originalId,originalImageId:null}},shaka.util.StreamUtils.imageStreamToTrack=function(t){var r=shaka.util.ManifestParserUtils.ContentType,i=t.width||null,n=t.height||null,s=null;t.segmentIndex&&(s=t.segmentIndex.get(0));var o=t.tilesLayout;return s&&(o=s.getTilesLayout()||o),o&&i!=null&&(i/=Number(o.split("x")[0])),o&&n!=null&&(n/=Number(o.split("x")[1])),{id:t.id,active:!1,type:r.IMAGE,bandwidth:t.bandwidth||0,language:"",label:null,kind:null,width:i,height:n,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:t.mimeType,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:o||null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:t.originalId}},shaka.util.StreamUtils.html5TrackId=function(t){return t.__shaka_id||(t.__shaka_id=shaka.util.StreamUtils.nextTrackId_++),t.__shaka_id},shaka.util.StreamUtils.html5TextTrackToTrack=function(t){var r=shaka.util.MimeUtils.CEA608_CLOSED_CAPTION_MIMETYPE,i=shaka.util.StreamUtils.html5TrackToGenericShakaTrack_(t);return i.active=t.mode!="disabled",i.type="text",i.originalTextId=t.id,t.kind=="captions"&&(i.mimeType=r),t.kind&&(i.roles=[t.kind]),t.kind=="forced"&&(i.forced=!0),i},shaka.util.StreamUtils.html5AudioTrackToTrack=function(t){var r=shaka.util.StreamUtils.html5TrackToGenericShakaTrack_(t);return r.active=t.enabled,r.type="variant",r.originalAudioId=t.id,t.kind=="main"&&(r.primary=!0),t.kind&&(r.roles=[t.kind],r.audioRoles=[t.kind],r.label=t.label),r},shaka.util.StreamUtils.html5TrackToGenericShakaTrack_=function(t){return{id:shaka.util.StreamUtils.html5TrackId(t),active:!1,type:"",bandwidth:0,language:shaka.util.LanguageUtils.normalize(t.language),label:t.label,kind:t.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],forced:!1,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null}},shaka.util.StreamUtils.isPlayable=function(t){return t.allowedByApplication&&t.allowedByKeySystem},shaka.util.StreamUtils.getPlayableVariants=function(t){return t.filter(function(r){return shaka.util.StreamUtils.isPlayable(r)})},shaka.util.StreamUtils.filterVariantsByAudioChannelCount=function(t,r){var i=t.filter(function(l){return l.audio&&l.audio.channelsCount}),n=new Map;i=$jscomp.makeIterator(i);for(var s=i.next();!s.done;s=i.next()){s=s.value;var o=s.audio.channelsCount;goog.asserts.assert(o!=null,"Must have count after filtering!"),n.has(o)||n.set(o,[]),n.get(o).push(s)}return i=Array.from(n.keys()),i.length==0?t:(s=i.filter(function(l){return l<=r}),s.length?n.get(Math.max.apply(Math,$jscomp.arrayFromIterable(s))):n.get(Math.min.apply(Math,$jscomp.arrayFromIterable(i))))},shaka.util.StreamUtils.filterStreamsByLanguageAndRole=function(t,r,i,n){var s=shaka.util.LanguageUtils,o=t,l=t.filter(function(E){return E.primary});l.length&&(o=l);var u=o.length?o[0].language:"";if(o=o.filter(function(E){return E.language==u}),r){var m=s.findClosestLocale(s.normalize(r),t.map(function(E){return E.language}));m&&(o=t.filter(function(E){return s.normalize(E.language)==m}))}if(o=o.filter(function(E){return E.forced==n}),i){if(t=shaka.util.StreamUtils.filterTextStreamsByRole_(o,i),t.length)return t;shaka.log.warning("No exact match for the text role could be found.")}else if(t=o.filter(function(E){return E.roles.length==0}),t.length)return t;return t=o.map(function(E){return E.roles}).reduce(shaka.util.Functional.collapseArrays,[]),t.length?shaka.util.StreamUtils.filterTextStreamsByRole_(o,t[0]):o},shaka.util.StreamUtils.filterTextStreamsByRole_=function(t,r){return t.filter(function(i){return i.roles.includes(r)})},shaka.util.StreamUtils.isAudio=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.AUDIO},shaka.util.StreamUtils.isVideo=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.VIDEO},shaka.util.StreamUtils.getVariantStreams=function(t){var r=[];return t.audio&&r.push(t.audio),t.video&&r.push(t.video),r},shaka.util.StreamUtils.getVariantSummaryString_=function(t){var r=[];return t.audio&&r.push(shaka.util.StreamUtils.getStreamSummaryString_(t.audio)),t.video&&r.push(shaka.util.StreamUtils.getStreamSummaryString_(t.video)),r.join(", ")},shaka.util.StreamUtils.getStreamSummaryString_=function(t){return shaka.util.StreamUtils.isAudio(t)?"type=audio codecs="+t.codecs+" bandwidth="+t.bandwidth+" channelsCount="+t.channelsCount+" audioSamplingRate="+t.audioSamplingRate:shaka.util.StreamUtils.isVideo(t)?"type=video codecs="+t.codecs+" bandwidth="+t.bandwidth+" frameRate="+t.frameRate+" width="+t.width+" height="+t.height:"unexpected stream type"},shaka.util.StreamUtils.nextTrackId_=0,shaka.util.StreamUtils.DecodingAttributes={SMOOTH:"smooth",POWER:"powerEfficient",BANDWIDTH:"bandwidth"},shaka.abr.SimpleAbrManager=function(){var t=this;this.switch_=null,this.enabled_=!1,this.bandwidthEstimator_=new shaka.abr.EwmaBandwidthEstimator,navigator.connection&&navigator.connection.addEventListener("change",function(){if(t.config_.useNetworkInformation&&t.enabled_){t.bandwidthEstimator_=new shaka.abr.EwmaBandwidthEstimator,t.config_&&t.bandwidthEstimator_.configure(t.config_.advanced);var r=t.chooseVariant();r&&t.switch_(r)}}),this.variants_=[],this.playbackRate_=1,this.startupComplete_=!1,this.config_=this.lastTimeChosenMs_=null},shaka.abr.SimpleAbrManager.prototype.stop=function(){this.switch_=null,this.enabled_=!1,this.variants_=[],this.playbackRate_=1,this.lastTimeChosenMs_=null},shaka.abr.SimpleAbrManager.prototype.init=function(t){this.switch_=t},shaka.abr.SimpleAbrManager.prototype.chooseVariant=function(){var t=shaka.abr.SimpleAbrManager,r=t.filterAndSortVariants_(this.config_.restrictions,this.variants_),i=this.getDefaultBandwidth_();i=this.bandwidthEstimator_.getBandwidthEstimate(i),this.variants_.length&&!r.length&&(shaka.log.warning("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),r=t.filterAndSortVariants_(null,this.variants_),r=[r[0]]),t=r[0]||null;for(var n=0;n<r.length;n++){for(var s=r[n],o=isNaN(this.playbackRate_)?1:Math.abs(this.playbackRate_),l=o*s.bandwidth,u=l/this.config_.bandwidthDowngradeTarget,m={bandwidth:1/0},E=n+1;E<r.length;E++)if(s.bandwidth!=r[E].bandwidth){m=r[E];break}o=o*m.bandwidth/this.config_.bandwidthUpgradeTarget,shaka.log.v2("Bandwidth ranges:",(l/1e6).toFixed(3),(u/1e6).toFixed(3),(o/1e6).toFixed(3)),i>=u&&i<=o&&t.bandwidth!=s.bandwidth&&(t=s)}return this.lastTimeChosenMs_=Date.now(),t},shaka.abr.SimpleAbrManager.prototype.enable=function(){this.enabled_=!0},shaka.abr.SimpleAbrManager.prototype.disable=function(){this.enabled_=!1},shaka.abr.SimpleAbrManager.prototype.segmentDownloaded=function(t,r){shaka.log.v2("Segment downloaded:","deltaTimeMs="+t,"numBytes="+r,"lastTimeChosenMs="+this.lastTimeChosenMs_,"enabled="+this.enabled_),goog.asserts.assert(0<=t,"expected a non-negative duration"),this.bandwidthEstimator_.sample(t,r),this.lastTimeChosenMs_!=null&&this.enabled_&&this.suggestStreams_()},shaka.abr.SimpleAbrManager.prototype.getBandwidthEstimate=function(){var t=this.getDefaultBandwidth_();return this.bandwidthEstimator_.getBandwidthEstimate(t)},shaka.abr.SimpleAbrManager.prototype.setVariants=function(t){this.variants_=t},shaka.abr.SimpleAbrManager.prototype.playbackRateChanged=function(t){this.playbackRate_=t},shaka.abr.SimpleAbrManager.prototype.configure=function(t){this.config_=t,this.bandwidthEstimator_&&this.config_&&this.bandwidthEstimator_.configure(this.config_.advanced)},shaka.abr.SimpleAbrManager.prototype.suggestStreams_=function(){if(shaka.log.v2("Suggesting Streams..."),goog.asserts.assert(this.lastTimeChosenMs_!=null,"lastTimeChosenMs_ should not be null"),this.startupComplete_){if(Date.now()-this.lastTimeChosenMs_<1e3*this.config_.switchInterval){shaka.log.v2("Still within switch interval...");return}}else{if(!this.bandwidthEstimator_.hasGoodEstimate()){shaka.log.v2("Still waiting for a good estimate...");return}this.startupComplete_=!0}var t=this.chooseVariant(),r=this.getDefaultBandwidth_();r=this.bandwidthEstimator_.getBandwidthEstimate(r),r=Math.round(r/1e3),t&&(shaka.log.debug("Calling switch_(), bandwidth="+r+" kbps"),this.switch_(t))},shaka.abr.SimpleAbrManager.prototype.getDefaultBandwidth_=function(){var t=this.config_.defaultBandwidthEstimate;return navigator.connection&&navigator.connection.downlink&&this.config_.useNetworkInformation&&(t=1e6*navigator.connection.downlink),t},shaka.abr.SimpleAbrManager.filterAndSortVariants_=function(t,r){return t&&(r=r.filter(function(i){return goog.asserts.assert(t,"Restrictions should exist!"),shaka.util.StreamUtils.meetsRestrictions(i,t,{width:1/0,height:1/0})})),r.sort(function(i,n){return i.bandwidth-n.bandwidth})},goog.exportSymbol("shaka.abr.SimpleAbrManager",shaka.abr.SimpleAbrManager),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"configure",shaka.abr.SimpleAbrManager.prototype.configure),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"playbackRateChanged",shaka.abr.SimpleAbrManager.prototype.playbackRateChanged),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"setVariants",shaka.abr.SimpleAbrManager.prototype.setVariants),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"getBandwidthEstimate",shaka.abr.SimpleAbrManager.prototype.getBandwidthEstimate),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"segmentDownloaded",shaka.abr.SimpleAbrManager.prototype.segmentDownloaded),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"disable",shaka.abr.SimpleAbrManager.prototype.disable),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"enable",shaka.abr.SimpleAbrManager.prototype.enable),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"chooseVariant",shaka.abr.SimpleAbrManager.prototype.chooseVariant),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"init",shaka.abr.SimpleAbrManager.prototype.init),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"stop",shaka.abr.SimpleAbrManager.prototype.stop),shaka.media.AdaptationSet=function(t,r){this.root_=t,this.variants_=new Set([t]),r=r||[];for(var i=$jscomp.makeIterator(r),n=i.next();!n.done;n=i.next())this.add(n.value)},shaka.media.AdaptationSet.prototype.add=function(t){return this.canInclude(t)?(this.variants_.add(t),!0):(shaka.log.warning("Rejecting variant - not compatible with root."),!1)},shaka.media.AdaptationSet.prototype.canInclude=function(t){return shaka.media.AdaptationSet.areAdaptable(this.root_,t)},shaka.media.AdaptationSet.areAdaptable=function(t,r){var i=shaka.media.AdaptationSet;return!!t.audio!=!!r.audio||!!t.video!=!!r.video||t.language!=r.language||(goog.asserts.assert(!!t.audio==!!r.audio,"Both should either have audio or not have audio."),t.audio&&r.audio&&!i.areAudiosCompatible_(t.audio,r.audio))?!1:(goog.asserts.assert(!!t.video==!!r.video,"Both should either have video or not have video."),!(t.video&&r.video&&!i.areVideosCompatible_(t.video,r.video)))},shaka.media.AdaptationSet.prototype.values=function(){return this.variants_.values()},shaka.media.AdaptationSet.areAudiosCompatible_=function(t,r){var i=shaka.media.AdaptationSet;return!((!t.channelsCount||!r.channelsCount||2<t.channelsCount||2<r.channelsCount)&&t.channelsCount!=r.channelsCount||!i.canTransitionBetween_(t,r)||!i.areRolesEqual_(t.roles,r.roles))},shaka.media.AdaptationSet.areVideosCompatible_=function(t,r){var i=shaka.media.AdaptationSet;return!!(i.canTransitionBetween_(t,r)&&i.areRolesEqual_(t.roles,r.roles))},shaka.media.AdaptationSet.canTransitionBetween_=function(t,r){if(t.mimeType!=r.mimeType)return!1;var i=shaka.util.MimeUtils.splitCodecs(t.codecs).map(function(o){return shaka.util.MimeUtils.getCodecBase(o)}),n=shaka.util.MimeUtils.splitCodecs(r.codecs).map(function(o){return shaka.util.MimeUtils.getCodecBase(o)});if(i.length!=n.length)return!1;i.sort(),n.sort();for(var s=0;s<i.length;s++)if(i[s]!=n[s])return!1;return!0},shaka.media.AdaptationSet.areRolesEqual_=function(t,r){var i=new Set(t),n=new Set(r);if(i.delete("main"),n.delete("main"),i.size!=n.size)return!1;i=$jscomp.makeIterator(i);for(var s=i.next();!s.done;s=i.next())if(!n.has(s.value))return!1;return!0},shaka.media.AdaptationSetCriteria=function(){},shaka.media.AdaptationSetCriteria.prototype.create=function(t){},shaka.media.ExampleBasedCriteria=function(t){this.example_=t,this.fallback_=new shaka.media.PreferenceBasedCriteria(t.language,"",t.audio&&t.audio.channelsCount?t.audio.channelsCount:0,"")},shaka.media.ExampleBasedCriteria.prototype.create=function(t){var r=this,i=t.filter(function(n){return shaka.media.AdaptationSet.areAdaptable(r.example_,n)});return i.length?new shaka.media.AdaptationSet(i[0],i):this.fallback_.create(t)},shaka.media.PreferenceBasedCriteria=function(t,r,i,n){this.language_=t,this.role_=r,this.channelCount_=i,this.label_=n===void 0?"":n},shaka.media.PreferenceBasedCriteria.prototype.create=function(t){var r=shaka.media.PreferenceBasedCriteria,i=shaka.util.StreamUtils,n=[];n=r.filterByLanguage_(t,this.language_);var s=t.filter(function(o){return o.primary});for(n=n.length?n:s.length?s:t,t=r.filterVariantsByRole_(n,this.role_),t.length?n=t:shaka.log.warning("No exact match for variant role could be found."),this.channelCount_&&(i=i.filterVariantsByAudioChannelCount(n,this.channelCount_),i.length?n=i:shaka.log.warning("No exact match for the channel count could be found.")),this.label_&&(r=r.filterVariantsByLabel_(n,this.label_),r.length?n=r:shaka.log.warning("No exact match for variant label could be found.")),r=new shaka.media.AdaptationSet(n[0]),n=$jscomp.makeIterator(n),i=n.next();!i.done;i=n.next())i=i.value,r.canInclude(i)&&r.add(i);return r},shaka.media.PreferenceBasedCriteria.filterByLanguage_=function(t,r){var i=shaka.util.LanguageUtils,n=i.normalize(r),s=i.findClosestLocale(n,t.map(function(o){return i.getLocaleForVariant(o)}));return s?t.filter(function(o){return s==i.getLocaleForVariant(o)}):[]},shaka.media.PreferenceBasedCriteria.filterVariantsByRole_=function(t,r){return t.filter(function(i){return i.audio?r?i.audio.roles.includes(r):i.audio.roles.length==0:!1})},shaka.media.PreferenceBasedCriteria.filterVariantsByLabel_=function(t,r){return t.filter(function(i){if(!i.audio)return!1;i=i.audio.label.toLowerCase();var n=r.toLowerCase();return i==n})},shaka.media.BufferingObserver=function(t,r){var i=shaka.media.BufferingObserver.State;this.previousState_=i.SATISFIED,this.thresholds_=new Map().set(i.SATISFIED,r).set(i.STARVING,t)},shaka.media.BufferingObserver.prototype.setThresholds=function(t,r){var i=shaka.media.BufferingObserver.State;this.thresholds_.set(i.SATISFIED,r).set(i.STARVING,t)},shaka.media.BufferingObserver.prototype.update=function(t,r){var i=shaka.media.BufferingObserver.State,n=this.thresholds_.get(this.previousState_),s=this.previousState_;return this.previousState_=i=r||t>=n?i.SATISFIED:i.STARVING,s!=i},shaka.media.BufferingObserver.prototype.setState=function(t){this.previousState_=t},shaka.media.BufferingObserver.prototype.getState=function(){return this.previousState_},shaka.media.BufferingObserver.State={STARVING:0,SATISFIED:1},shaka.net={},shaka.net.Backoff=function(t,r){r=r===void 0?!1:r;var i=shaka.net.Backoff.defaultRetryParameters();this.maxAttempts_=t.maxAttempts==null?i.maxAttempts:t.maxAttempts,goog.asserts.assert(1<=this.maxAttempts_,"maxAttempts should be >= 1"),this.baseDelay_=t.baseDelay==null?i.baseDelay:t.baseDelay,goog.asserts.assert(0<=this.baseDelay_,"baseDelay should be >= 0"),this.fuzzFactor_=t.fuzzFactor==null?i.fuzzFactor:t.fuzzFactor,goog.asserts.assert(0<=this.fuzzFactor_,"fuzzFactor should be >= 0"),this.backoffFactor_=t.backoffFactor==null?i.backoffFactor:t.backoffFactor,goog.asserts.assert(0<=this.backoffFactor_,"backoffFactor should be >= 0"),this.numAttempts_=0,this.nextUnfuzzedDelay_=this.baseDelay_,(this.autoReset_=r)&&(goog.asserts.assert(2<=this.maxAttempts_,"maxAttempts must be >= 2 for autoReset == true"),this.numAttempts_=1)},shaka.net.Backoff.prototype.attempt=function(){var t=this,r,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(n.nextAddress==1){if(t.numAttempts_>=t.maxAttempts_)if(t.autoReset_)t.reset_();else throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.ATTEMPTS_EXHAUSTED);return r=t.numAttempts_,t.numAttempts_++,r==0?(goog.asserts.assert(!t.autoReset_,"Failed to delay with auto-reset!"),n.return()):(i=shaka.net.Backoff.fuzz_(t.nextUnfuzzedDelay_,t.fuzzFactor_),n.yield(new Promise(function(s){shaka.net.Backoff.defer(i,s)}),2))}t.nextUnfuzzedDelay_*=t.backoffFactor_,n.jumpToEnd()})},shaka.net.Backoff.defaultRetryParameters=function(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4}},shaka.net.Backoff.fuzz_=function(t,r){return t*(1+(2*Math.random()-1)*r)},shaka.net.Backoff.prototype.reset_=function(){goog.asserts.assert(this.autoReset_,"Should only be used for auto-reset!"),this.numAttempts_=1,this.nextUnfuzzedDelay_=this.baseDelay_},shaka.net.Backoff.defer=function(t,r){new shaka.util.Timer(r).tickAfter(t/1e3)},shaka.util.AbortableOperation=function(t,r){this.promise=t,this.onAbort_=r,this.aborted_=!1},shaka.util.AbortableOperation.failed=function(t){return new shaka.util.AbortableOperation(Promise.reject(t),function(){return Promise.resolve()})},shaka.util.AbortableOperation.aborted=function(){var t=Promise.reject(shaka.util.AbortableOperation.abortError());return t.catch(function(){}),new shaka.util.AbortableOperation(t,function(){return Promise.resolve()})},shaka.util.AbortableOperation.abortError=function(){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED)},shaka.util.AbortableOperation.completed=function(t){return new shaka.util.AbortableOperation(Promise.resolve(t),function(){return Promise.resolve()})},shaka.util.AbortableOperation.notAbortable=function(t){return new shaka.util.AbortableOperation(t,function(){return t.catch(function(){})})},shaka.util.AbortableOperation.prototype.abort=function(){return this.aborted_=!0,this.onAbort_()},shaka.util.AbortableOperation.all=function(t){return new shaka.util.AbortableOperation(Promise.all(t.map(function(r){return r.promise})),function(){return Promise.all(t.map(function(r){return r.abort()}))})},shaka.util.AbortableOperation.prototype.finally=function(t){return this.promise.then(function(r){return t(!0)},function(r){return t(!1)}),this},shaka.util.AbortableOperation.prototype.chain=function(t,r){var i=this,n=new shaka.util.PublicPromise,s=shaka.util.AbortableOperation.abortError(),o=function(){return n.reject(s),i.abort()},l=function(u){return function(m){if(i.aborted_&&u)n.reject(s);else{var E=u?t:r;E?o=shaka.util.AbortableOperation.wrapChainCallback_(E,m,n):(u?n.resolve:n.reject)(m)}}};return this.promise.then(l(!0),l(!1)),new shaka.util.AbortableOperation(n,function(){return o()})},shaka.util.AbortableOperation.wrapChainCallback_=function(t,r,i){try{var n=t(r);return n&&n.promise&&n.abort?(i.resolve(n.promise),function(){return n.abort()}):(i.resolve(n),function(){return Promise.resolve(n).then(function(){},function(){})})}catch(s){return i.reject(s),function(){return Promise.resolve()}}},goog.exportSymbol("shaka.util.AbortableOperation",shaka.util.AbortableOperation),goog.exportProperty(shaka.util.AbortableOperation.prototype,"chain",shaka.util.AbortableOperation.prototype.chain),goog.exportProperty(shaka.util.AbortableOperation.prototype,"finally",shaka.util.AbortableOperation.prototype.finally),goog.exportProperty(shaka.util.AbortableOperation,"all",shaka.util.AbortableOperation.all),goog.exportProperty(shaka.util.AbortableOperation.prototype,"abort",shaka.util.AbortableOperation.prototype.abort),goog.exportProperty(shaka.util.AbortableOperation,"notAbortable",shaka.util.AbortableOperation.notAbortable),goog.exportProperty(shaka.util.AbortableOperation,"completed",shaka.util.AbortableOperation.completed),goog.exportProperty(shaka.util.AbortableOperation,"aborted",shaka.util.AbortableOperation.aborted),goog.exportProperty(shaka.util.AbortableOperation,"failed",shaka.util.AbortableOperation.failed),shaka.util.FakeEvent=function(t,r){if(r)if(r instanceof Map)for(var i=$jscomp.makeIterator(r.keys()),n=i.next();!n.done;n=i.next())n=n.value,Object.defineProperty(this,n,{value:r.get(n),writable:!0,enumerable:!0});else for(n in i=shaka.util.FakeEvent.recastDictAsObject_(r),i)Object.defineProperty(this,n,{value:i[n],writable:!0,enumerable:!0});this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now(),this.type=t,this.isTrusted=!1,this.target=this.currentTarget=null,this.stopped=!1},shaka.util.FakeEvent.fromRealEvent=function(t){var r=new shaka.util.FakeEvent(t.type),i;for(i in t)Object.defineProperty(r,i,{value:t[i],writable:!0,enumerable:!0});return r},shaka.util.FakeEvent.recastDictAsObject_=function(t){return goog.asserts.assert(!(t instanceof Map),"dict should not be a map"),t},shaka.util.FakeEvent.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},shaka.util.FakeEvent.prototype.stopImmediatePropagation=function(){this.stopped=!0},shaka.util.FakeEvent.prototype.stopPropagation=function(){},goog.exportSymbol("shaka.util.FakeEvent",shaka.util.FakeEvent),shaka.util.IReleasable=function(){},shaka.util.IReleasable.prototype.release=function(){},shaka.util.FakeEventTarget=function(){this.listeners_=new shaka.util.MultiMap,this.dispatchTarget=this},shaka.util.FakeEventTarget.prototype.addEventListener=function(t,r,i){this.listeners_&&this.listeners_.push(t,r)},shaka.util.FakeEventTarget.prototype.listenToAllEvents=function(t){this.addEventListener(shaka.util.FakeEventTarget.ALL_EVENTS_,t)},shaka.util.FakeEventTarget.prototype.removeEventListener=function(t,r,i){this.listeners_&&this.listeners_.remove(t,r)},shaka.util.FakeEventTarget.prototype.dispatchEvent=function(t){if(goog.asserts.assert(t instanceof shaka.util.FakeEvent,"FakeEventTarget can only dispatch FakeEvents!"),!this.listeners_)return!0;var r=this.listeners_.get(t.type)||[],i=this.listeners_.get(shaka.util.FakeEventTarget.ALL_EVENTS_);for(i&&(r=r.concat(i)),r=$jscomp.makeIterator(r),i=r.next();!i.done;i=r.next()){i=i.value,t.target=this.dispatchTarget,t.currentTarget=this.dispatchTarget;try{i.handleEvent?i.handleEvent(t):i.call(this,t)}catch(n){shaka.log.error("Uncaught exception in event handler",n,n?n.message:null,n?n.stack:null)}if(t.stopped)break}return t.defaultPrevented},shaka.util.FakeEventTarget.prototype.release=function(){this.listeners_=null},shaka.util.FakeEventTarget.ALL_EVENTS_="All",shaka.util.ObjectUtils=function(){},shaka.util.ObjectUtils.cloneObject=function(t){var r=new Set,i=function(n){switch(typeof n){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return n;default:if(!n||n.buffer&&n.buffer.constructor==ArrayBuffer)return n;if(r.has(n))return null;var s=n.constructor==Array;if(n.constructor!=Object&&!s)return null;r.add(n);var o=s?[]:{},l;for(l in n)o[l]=i(n[l]);return s&&(o.length=n.length),o}};return i(t)},shaka.util.ObjectUtils.shallowCloneObject=function(t){var r={},i;for(i in t)r[i]=t[i];return r},shaka.util.OperationManager=function(){this.operations_=[]},shaka.util.OperationManager.prototype.manage=function(t){var r=this;this.operations_.push(t.finally(function(){shaka.util.ArrayUtils.remove(r.operations_,t)}))},shaka.util.OperationManager.prototype.destroy=function(){for(var t=[],r=$jscomp.makeIterator(this.operations_),i=r.next();!i.done;i=r.next())i=i.value,i.promise.catch(function(){}),t.push(i.abort());return this.operations_=[],Promise.all(t)},shaka.net.NetworkingEngine=function(t,r,i){shaka.util.FakeEventTarget.call(this),this.destroyed_=!1,this.operationManager_=new shaka.util.OperationManager,this.requestFilters_=new Set,this.responseFilters_=new Set,this.onProgressUpdated_=t||null,this.onHeadersReceived_=r||null,this.onDownloadFailed_=i||null,this.forceHTTPS_=!1},$jscomp.inherits(shaka.net.NetworkingEngine,shaka.util.FakeEventTarget),shaka.net.NetworkingEngine.prototype.setForceHTTPS=function(t){this.forceHTTPS_=t},shaka.net.NetworkingEngine.registerScheme=function(t,r,i,n){n=n===void 0?!1:n,goog.asserts.assert(i==null||0<i,"explicit priority must be > 0"),i=i||shaka.net.NetworkingEngine.PluginPriority.APPLICATION;var s=shaka.net.NetworkingEngine.schemes_[t];(!s||i>=s.priority)&&(shaka.net.NetworkingEngine.schemes_[t]={priority:i,plugin:r,progressSupport:n})},shaka.net.NetworkingEngine.unregisterScheme=function(t){delete shaka.net.NetworkingEngine.schemes_[t]},shaka.net.NetworkingEngine.prototype.registerRequestFilter=function(t){this.requestFilters_.add(t)},shaka.net.NetworkingEngine.prototype.unregisterRequestFilter=function(t){this.requestFilters_.delete(t)},shaka.net.NetworkingEngine.prototype.clearAllRequestFilters=function(){this.requestFilters_.clear()},shaka.net.NetworkingEngine.prototype.registerResponseFilter=function(t){this.responseFilters_.add(t)},shaka.net.NetworkingEngine.prototype.unregisterResponseFilter=function(t){this.responseFilters_.delete(t)},shaka.net.NetworkingEngine.prototype.clearAllResponseFilters=function(){this.responseFilters_.clear()},shaka.net.NetworkingEngine.defaultRetryParameters=function(){return shaka.net.Backoff.defaultRetryParameters()},shaka.net.NetworkingEngine.makeRequest=function(t,r,i){return{uris:t,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:r,licenseRequestType:null,sessionId:null,streamDataCallback:i===void 0?null:i}},shaka.net.NetworkingEngine.prototype.destroy=function(){return this.destroyed_=!0,this.requestFilters_.clear(),this.responseFilters_.clear(),shaka.util.FakeEventTarget.prototype.release.call(this),this.operationManager_.destroy()},shaka.net.NetworkingEngine.prototype.request=function(t,r){var i=this,n=shaka.util.ObjectUtils,s=new shaka.net.NetworkingEngine.NumBytesRemainingClass;if(this.destroyed_)return n=Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED)),n.catch(function(){}),new shaka.net.NetworkingEngine.PendingRequest(n,function(){return Promise.resolve()},s);goog.asserts.assert(r.uris&&r.uris.length,"Request without URIs!"),r.method=r.method||"GET",r.headers=r.headers||{},r.retryParameters=r.retryParameters?n.cloneObject(r.retryParameters):shaka.net.NetworkingEngine.defaultRetryParameters(),r.uris=n.cloneObject(r.uris),n=this.filterRequest_(t,r);var o=n.chain(function(){return i.makeRequestWithRetry_(t,r,s)}),l=o.chain(function(D){return i.filterResponse_(t,D)}),u=Date.now(),m=0;n.promise.then(function(){m=Date.now()-u},function(){});var E=0;o.promise.then(function(){E=Date.now()},function(){});var y=l.chain(function(D){var w=Date.now()-E,B=D.response;return B.timeMs+=m,B.timeMs+=w,!D.gotProgress&&i.onProgressUpdated_&&!B.fromCache&&t==shaka.net.NetworkingEngine.RequestType.SEGMENT&&i.onProgressUpdated_(B.timeMs,B.data.byteLength),B},function(D){throw D&&(goog.asserts.assert(D instanceof shaka.util.Error,"Wrong error type"),D.severity=shaka.util.Error.Severity.CRITICAL),D});return n=new shaka.net.NetworkingEngine.PendingRequest(y.promise,function(){return y.abort()},s),this.operationManager_.manage(n),n},shaka.net.NetworkingEngine.prototype.filterRequest_=function(t,r){for(var i=shaka.util.AbortableOperation.completed(void 0),n={},s=$jscomp.makeIterator(this.requestFilters_),o=s.next();!o.done;n={$jscomp$loop$prop$requestFilter$582:n.$jscomp$loop$prop$requestFilter$582},o=s.next())n.$jscomp$loop$prop$requestFilter$582=o.value,i=i.chain(function(l){return function(){return r.body&&(r.body=shaka.util.BufferUtils.toArrayBuffer(r.body)),l.$jscomp$loop$prop$requestFilter$582(t,r)}}(n));return i.chain(void 0,function(l){throw l instanceof shaka.util.Error&&l.code==shaka.util.Error.Code.OPERATION_ABORTED?l:new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.REQUEST_FILTER_ERROR,l)})},shaka.net.NetworkingEngine.prototype.makeRequestWithRetry_=function(t,r,i){var n=new shaka.net.Backoff(r.retryParameters,!1);return this.send_(t,r,n,0,null,i)},shaka.net.NetworkingEngine.prototype.send_=function(t,r,i,n,s,o){var l=this;this.forceHTTPS_&&(r.uris[n]=r.uris[n].replace("http://","https://"));var u=new goog.Uri(r.uris[n]),m=u.getScheme(),E=!1;m||(m=shaka.net.NetworkingEngine.getLocationProtocol_(),goog.asserts.assert(m[m.length-1]==":","location.protocol expected to end with a colon!"),m=m.slice(0,-1),u.setScheme(m),r.uris[n]=u.toString()),m=m.toLowerCase();var y=(m=shaka.net.NetworkingEngine.schemes_[m])?m.plugin:null;if(!y)return shaka.util.AbortableOperation.failed(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.UNSUPPORTED_SCHEME,u));var D=m.progressSupport,w=null,B=null,F=!1,V=!1,K;return shaka.util.AbortableOperation.notAbortable(i.attempt()).chain(function(){if(l.destroyed_)return shaka.util.AbortableOperation.aborted();K=Date.now();var q=shaka.net.NetworkingEngine.RequestType.SEGMENT,re=y(r.uris[n],r,t,function(te,W,z){w&&w.stop(),B&&B.tickAfter(H/1e3),l.onProgressUpdated_&&t==q&&(l.onProgressUpdated_(te,W),E=!0,o.setBytes(z))},function(te){l.onHeadersReceived_&&l.onHeadersReceived_(te,r,t),V=!0});if(!D)return re;var ee=r.retryParameters.connectionTimeout;ee&&(w=new shaka.util.Timer(function(){F=!0,re.abort()}),w.tickAfter(ee/1e3));var H=r.retryParameters.stallTimeout;return H&&(B=new shaka.util.Timer(function(){F=!0,re.abort()})),re}).chain(function(q){w&&w.stop(),B&&B.stop(),q.timeMs==null&&(q.timeMs=Date.now()-K);var re={response:q,gotProgress:E};return!V&&l.onHeadersReceived_&&l.onHeadersReceived_(q.headers,r,t),re},function(q){if(w&&w.stop(),B&&B.stop(),l.onDownloadFailed_){var re=null,ee=0;q instanceof shaka.util.Error&&(re=q,q.code==shaka.util.Error.Code.BAD_HTTP_STATUS&&(ee=q.data[1])),l.onDownloadFailed_(r,re,ee,F)}if(l.destroyed_)return shaka.util.AbortableOperation.aborted();if(F&&(q=new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,r.uris[n],t)),q instanceof shaka.util.Error){if(q.code==shaka.util.Error.Code.OPERATION_ABORTED)throw q;if(q.code==shaka.util.Error.Code.ATTEMPTS_EXHAUSTED)throw goog.asserts.assert(s,"Should have last error"),s;if(q.severity==shaka.util.Error.Severity.RECOVERABLE)return re=new Map().set("error",q),re=new shaka.util.FakeEvent("retry",re),l.dispatchEvent(re),n=(n+1)%r.uris.length,l.send_(t,r,i,n,q,o)}throw q})},shaka.net.NetworkingEngine.prototype.filterResponse_=function(t,r){for(var i=shaka.util.AbortableOperation.completed(void 0),n={},s=$jscomp.makeIterator(this.responseFilters_),o=s.next();!o.done;n={$jscomp$loop$prop$responseFilter$584:n.$jscomp$loop$prop$responseFilter$584},o=s.next())n.$jscomp$loop$prop$responseFilter$584=o.value,i=i.chain(function(l){return function(){var u=r.response;return u.data&&(u.data=shaka.util.BufferUtils.toArrayBuffer(u.data)),l.$jscomp$loop$prop$responseFilter$584(t,u)}}(n));return i.chain(function(){return r},function(l){var u=shaka.util.Error.Severity.CRITICAL;if(l instanceof shaka.util.Error){if(l.code==shaka.util.Error.Code.OPERATION_ABORTED)throw l;u=l.severity}throw new shaka.util.Error(u,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.RESPONSE_FILTER_ERROR,l)})},shaka.net.NetworkingEngine.getLocationProtocol_=function(){return location.protocol},goog.exportSymbol("shaka.net.NetworkingEngine",shaka.net.NetworkingEngine),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"request",shaka.net.NetworkingEngine.prototype.request),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"destroy",shaka.net.NetworkingEngine.prototype.destroy),goog.exportProperty(shaka.net.NetworkingEngine,"makeRequest",shaka.net.NetworkingEngine.makeRequest),goog.exportProperty(shaka.net.NetworkingEngine,"defaultRetryParameters",shaka.net.NetworkingEngine.defaultRetryParameters),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"clearAllResponseFilters",shaka.net.NetworkingEngine.prototype.clearAllResponseFilters),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"unregisterResponseFilter",shaka.net.NetworkingEngine.prototype.unregisterResponseFilter),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"registerResponseFilter",shaka.net.NetworkingEngine.prototype.registerResponseFilter),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"clearAllRequestFilters",shaka.net.NetworkingEngine.prototype.clearAllRequestFilters),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"unregisterRequestFilter",shaka.net.NetworkingEngine.prototype.unregisterRequestFilter),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"registerRequestFilter",shaka.net.NetworkingEngine.prototype.registerRequestFilter),goog.exportProperty(shaka.net.NetworkingEngine,"unregisterScheme",shaka.net.NetworkingEngine.unregisterScheme),goog.exportProperty(shaka.net.NetworkingEngine,"registerScheme",shaka.net.NetworkingEngine.registerScheme),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"setForceHTTPS",shaka.net.NetworkingEngine.prototype.setForceHTTPS),shaka.net.NetworkingEngine.NumBytesRemainingClass=function(){this.bytesToLoad_=0},shaka.net.NetworkingEngine.NumBytesRemainingClass.prototype.setBytes=function(t){this.bytesToLoad_=t},shaka.net.NetworkingEngine.NumBytesRemainingClass.prototype.getBytes=function(){return this.bytesToLoad_},goog.exportProperty(shaka.net.NetworkingEngine,"NumBytesRemainingClass",shaka.net.NetworkingEngine.NumBytesRemainingClass),shaka.net.NetworkingEngine.PendingRequest=function(t,r,i){shaka.util.AbortableOperation.call(this,t,r),this.bytesRemaining_=i},$jscomp.inherits(shaka.net.NetworkingEngine.PendingRequest,shaka.util.AbortableOperation),shaka.net.NetworkingEngine.PendingRequest.prototype.getBytesRemaining=function(){return this.bytesRemaining_.getBytes()},goog.exportProperty(shaka.net.NetworkingEngine,"PendingRequest",shaka.net.NetworkingEngine.PendingRequest),shaka.net.NetworkingEngine.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4,SERVER_CERTIFICATE:5},goog.exportProperty(shaka.net.NetworkingEngine,"RequestType",shaka.net.NetworkingEngine.RequestType),shaka.net.NetworkingEngine.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3},goog.exportProperty(shaka.net.NetworkingEngine,"PluginPriority",shaka.net.NetworkingEngine.PluginPriority),shaka.net.NetworkingEngine.schemes_={},shaka.util.Destroyer=function(t){this.destroyed_=!1,this.waitOnDestroy_=new shaka.util.PublicPromise,this.onDestroy_=t},shaka.util.Destroyer.prototype.destroyed=function(){return this.destroyed_},shaka.util.Destroyer.prototype.destroy=function(){var t=this;return this.destroyed_?this.waitOnDestroy_:(this.destroyed_=!0,this.onDestroy_().then(function(){t.waitOnDestroy_.resolve()},function(){t.waitOnDestroy_.resolve()}))},shaka.util.Destroyer.prototype.ensureNotDestroyed=function(t){if(this.destroyed_)throw t instanceof shaka.util.Error&&t.code==shaka.util.Error.Code.OBJECT_DESTROYED?t:shaka.util.Destroyer.destroyedError(t)},shaka.util.Destroyer.destroyedError=function(t){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OBJECT_DESTROYED,t)},shaka.util.EventManager=function(){this.bindingMap_=new shaka.util.MultiMap},shaka.util.EventManager.prototype.release=function(){this.removeAll(),this.bindingMap_=null},shaka.util.EventManager.prototype.listen=function(t,r,i,n){this.bindingMap_&&(t=new shaka.util.EventManager.Binding_(t,r,i,n),this.bindingMap_.push(r,t))},shaka.util.EventManager.prototype.listenOnce=function(t,r,i,n){var s=this,o=function(l){s.unlisten(t,r,o),i(l)};this.listen(t,r,o,n)},shaka.util.EventManager.prototype.unlisten=function(t,r,i){if(this.bindingMap_){var n=this.bindingMap_.get(r)||[];n=$jscomp.makeIterator(n);for(var s=n.next();!s.done;s=n.next())s=s.value,s.target!=t||i!=s.listener&&i||(s.unlisten(),this.bindingMap_.remove(r,s))}},shaka.util.EventManager.prototype.removeAll=function(){if(this.bindingMap_){var t=this.bindingMap_.getAll();t=$jscomp.makeIterator(t);for(var r=t.next();!r.done;r=t.next())r.value.unlisten();this.bindingMap_.clear()}},goog.exportSymbol("shaka.util.EventManager",shaka.util.EventManager),goog.exportProperty(shaka.util.EventManager.prototype,"removeAll",shaka.util.EventManager.prototype.removeAll),goog.exportProperty(shaka.util.EventManager.prototype,"unlisten",shaka.util.EventManager.prototype.unlisten),goog.exportProperty(shaka.util.EventManager.prototype,"listenOnce",shaka.util.EventManager.prototype.listenOnce),goog.exportProperty(shaka.util.EventManager.prototype,"listen",shaka.util.EventManager.prototype.listen),goog.exportProperty(shaka.util.EventManager.prototype,"release",shaka.util.EventManager.prototype.release),shaka.util.EventManager.Binding_=function(t,r,i,n){this.target=t,this.type=r,this.listener=i,this.options=shaka.util.EventManager.Binding_.convertOptions_(t,n),this.target.addEventListener(r,i,this.options)},shaka.util.EventManager.Binding_.prototype.unlisten=function(){goog.asserts.assert(this.target,"Missing target"),this.target.removeEventListener(this.type,this.listener,this.options),this.listener=this.target=null,this.options=!1},shaka.util.EventManager.Binding_.convertOptions_=function(t,r){if(r==null)return!1;if(typeof r=="boolean")return r;var i=new Set(["passive","capture"]),n=Object.keys(r).filter(function(s){return!i.has(s)});return goog.asserts.assert(n.length==0,"Unsupported flag(s) to addEventListener: "+n.join(",")),shaka.util.EventManager.Binding_.doesSupportObject_(t)?r:r.capture||!1},shaka.util.EventManager.Binding_.doesSupportObject_=function(t){var r=shaka.util.EventManager.Binding_.supportsObject_;if(r==null){r=!1;try{var i={},n={get:function(){return r=!0,!1}};Object.defineProperty(i,"passive",n),Object.defineProperty(i,"capture",n),n=function(){},t.addEventListener("test",n,i),t.removeEventListener("test",n,i)}catch{r=!1}shaka.util.EventManager.Binding_.supportsObject_=r}return r||!1},shaka.util.EventManager.Binding_.supportsObject_=void 0,shaka.util.FairPlayUtils=function(){},shaka.util.FairPlayUtils.defaultGetContentId=function(t){return t=shaka.util.StringUtils.fromBytesAutoDetect(t),new goog.Uri(t).getDomain()},shaka.util.FairPlayUtils.initDataTransform=function(t,r,i){if(!i||!i.byteLength)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.SERVER_CERTIFICATE_REQUIRED);r=typeof r=="string"?shaka.util.StringUtils.toUTF16(r,!0):r,t=shaka.util.StringUtils.fromBytesAutoDetect(t),t=shaka.util.StringUtils.toUTF16(t,!0);var n=new Uint8Array(12+t.byteLength+r.byteLength+i.byteLength),s=0,o=function(l){shaka.util.BufferUtils.toDataView(n).setUint32(s,l.byteLength,!0),s+=4,n.set(shaka.util.BufferUtils.toUint8(l),s),s+=l.byteLength};return o(t),o(r),o(i),goog.asserts.assert(s==n.length,"Inconsistent init data length"),n},goog.exportSymbol("shaka.util.FairPlayUtils",shaka.util.FairPlayUtils),goog.exportProperty(shaka.util.FairPlayUtils,"initDataTransform",shaka.util.FairPlayUtils.initDataTransform),goog.exportProperty(shaka.util.FairPlayUtils,"defaultGetContentId",shaka.util.FairPlayUtils.defaultGetContentId),shaka.util.Iterables=function(){},shaka.util.Iterables.map=function(t,r){for(var i=[],n=$jscomp.makeIterator(t),s=n.next();!s.done;s=n.next())i.push(r(s.value));return i},shaka.util.Iterables.every=function(t,r){for(var i=$jscomp.makeIterator(t),n=i.next();!n.done;n=i.next())if(!r(n.value))return!1;return!0},shaka.util.Iterables.some=function(t,r){for(var i=$jscomp.makeIterator(t),n=i.next();!n.done;n=i.next())if(r(n.value))return!0;return!1},shaka.util.Iterables.filter=function(t,r){for(var i=[],n=$jscomp.makeIterator(t),s=n.next();!s.done;s=n.next())s=s.value,r(s)&&i.push(s);return i},shaka.util.MapUtils=function(){},shaka.util.MapUtils.asMap=function(t){for(var r=new Map,i=$jscomp.makeIterator(Object.keys(t)),n=i.next();!n.done;n=i.next())n=n.value,r.set(n,t[n]);return r},shaka.util.MapUtils.asObject=function(t){var r={};return t.forEach(function(i,n){r[n]=i}),r},shaka.util.MapUtils.hasSameElements=function(t,r){if(t||r){if(t&&!r||r&&!t)return!1}else return!0;if(t.size!=r.size)return!1;for(var i=$jscomp.makeIterator(t),n=i.next();!n.done;n=i.next()){var s=$jscomp.makeIterator(n.value);if(n=s.next().value,s=s.next().value,!r.has(n)||(n=r.get(n),n!=s||n==null))return!1}return!0},shaka.media.DrmEngine=function(t,r){var i=this;r=r===void 0?1:r,this.playerInterface_=t,this.supportedTypes_=new Set,this.video_=this.mediaKeys_=null,this.initializedForStorage_=this.initialized_=!1,this.licenseTimeSeconds_=0,this.currentDrmInfo_=null,this.eventManager_=new shaka.util.EventManager,this.activeSessions_=new Map,this.offlineSessionIds_=[],this.allSessionsLoaded_=new shaka.util.PublicPromise,this.config_=null,this.onError_=function(n){i.allSessionsLoaded_.reject(n),t.onError(n)},this.keyStatusByKeyId_=new Map,this.announcedKeyStatusByKeyId_=new Map,this.keyStatusTimer_=new shaka.util.Timer(function(){return i.processKeyStatusChanges_()}),this.usePersistentLicenses_=!1,this.mediaKeyMessageEvents_=[],this.initialRequestsSent_=!1,this.expirationTimer_=new shaka.util.Timer(function(){i.pollExpiration_()}).tickEvery(r),this.allSessionsLoaded_.catch(function(){}),this.destroyer_=new shaka.util.Destroyer(function(){return i.destroyNow_()}),this.srcEquals_=!1},shaka.media.DrmEngine.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.media.DrmEngine.prototype.destroyNow_=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){switch(r.nextAddress){case 1:return t.eventManager_.release(),t.eventManager_=null,t.allSessionsLoaded_.reject(),t.expirationTimer_.stop(),t.expirationTimer_=null,t.keyStatusTimer_.stop(),t.keyStatusTimer_=null,r.yield(t.closeOpenSessions_(),2);case 2:if(!t.video_){r.jumpTo(3);break}return goog.asserts.assert(!t.video_.src,"video src must be removed first!"),r.setCatchFinallyBlocks(4),r.yield(t.video_.setMediaKeys(null),6);case 6:r.leaveTryBlock(5);break;case 4:r.enterCatchBlock();case 5:t.video_=null;case 3:t.currentDrmInfo_=null,t.supportedTypes_.clear(),t.mediaKeys_=null,t.offlineSessionIds_=[],t.config_=null,t.onError_=function(){},t.playerInterface_=null,t.srcEquals_=!1,r.jumpToEnd()}})},shaka.media.DrmEngine.prototype.configure=function(t){this.config_=t},shaka.media.DrmEngine.prototype.setSrcEquals=function(t){this.srcEquals_=t},shaka.media.DrmEngine.prototype.initForStorage=function(t,r){return this.initializedForStorage_=!0,this.offlineSessionIds_=[],this.usePersistentLicenses_=r,this.init_(t)},shaka.media.DrmEngine.prototype.initForPlayback=function(t,r){return this.offlineSessionIds_=r,this.usePersistentLicenses_=0<r.length,this.init_(t)},shaka.media.DrmEngine.prototype.initForRemoval=function(t,r,i,n,s){var o=new Map;return n={audioCapabilities:n,videoCapabilities:s,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:t},n.drmInfos=[{keySystem:t,licenseServerUri:r,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:i,serverCertificateUri:"",initData:null,keyIds:null}],o.set(t,n),this.queryMediaKeys_(o,[])},shaka.media.DrmEngine.prototype.init_=function(t){var r=this,i,n,s,o,l,u,m,E,y,D,w,B,F,V;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){if(K.nextAddress==1){if(goog.asserts.assert(r.config_,"DrmEngine configure() must be called before init()!"),i=r.configureClearKey_())for(n=$jscomp.makeIterator(t),s=n.next();!s.done;s=n.next())o=s.value,o.video&&(o.video.drmInfos=[i]),o.audio&&(o.audio.drmInfos=[i]);for(l=t.some(function(q){return!!(q.video&&q.video.drmInfos.length||q.audio&&q.audio.drmInfos.length)}),l||(u=shaka.util.MapUtils.asMap(r.config_.servers),shaka.media.DrmEngine.replaceDrmInfo_(t,u)),m=$jscomp.makeIterator(t),s=m.next();!s.done;s=m.next())for(E=s.value,y=r.getVariantDrmInfos_(E),D=$jscomp.makeIterator(y),w=D.next();!w.done;w=D.next())B=w.value,shaka.media.DrmEngine.fillInDrmInfoDefaults_(B,shaka.util.MapUtils.asMap(r.config_.servers),shaka.util.MapUtils.asMap(r.config_.advanced||{}));return K.yield(shaka.util.StreamUtils.getDecodingInfosForVariants(t,r.usePersistentLicenses_,r.srcEquals_),2)}return F=l||Object.keys(r.config_.servers).length,F?(V=r.queryMediaKeys_(void 0,t),K.return(l?V:V.catch(function(){}))):(r.initialized_=!0,K.return(Promise.resolve()))})},shaka.media.DrmEngine.prototype.attach=function(t){var r=this,i,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){if(s.nextAddress==1)return r.mediaKeys_?(r.video_=t,r.eventManager_.listenOnce(r.video_,"play",function(){return r.onPlay_()}),"webkitCurrentPlaybackTargetIsWireless"in r.video_&&r.eventManager_.listen(r.video_,"webkitcurrentplaybacktargetiswirelesschanged",function(){return r.closeOpenSessions_()}),i=r.video_.setMediaKeys(r.mediaKeys_),i=i.catch(function(o){return goog.asserts.assert(o instanceof Error,"Wrong error type!"),Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_ATTACH_TO_VIDEO,o.message))}),s.yield(i,2)):(r.eventManager_.listenOnce(t,"encrypted",function(o){r.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.ENCRYPTED_CONTENT_WITHOUT_DRM_INFO))}),s.return());r.destroyer_.ensureNotDestroyed(),r.createOrLoad(),r.currentDrmInfo_.initData.length||r.offlineSessionIds_.length||(n=function(o){return r.newInitData(o.initDataType,shaka.util.BufferUtils.toUint8(o.initData))},r.eventManager_.listen(r.video_,"encrypted",n)),s.jumpToEnd()})},shaka.media.DrmEngine.prototype.setServerCertificate=function(){var t=this,r,i,n,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){switch(u.nextAddress){case 1:if(goog.asserts.assert(t.initialized_,"Must call init() before setServerCertificate"),!t.mediaKeys_||!t.currentDrmInfo_)return u.return();if(!t.currentDrmInfo_.serverCertificateUri||t.currentDrmInfo_.serverCertificate&&t.currentDrmInfo_.serverCertificate.length){u.jumpTo(2);break}return r=shaka.net.NetworkingEngine.makeRequest([t.currentDrmInfo_.serverCertificateUri],t.config_.retryParameters),u.setCatchFinallyBlocks(3),i=t.playerInterface_.netEngine.request(shaka.net.NetworkingEngine.RequestType.SERVER_CERTIFICATE,r),u.yield(i.promise,5);case 5:n=u.yieldResult,t.currentDrmInfo_.serverCertificate=shaka.util.BufferUtils.toUint8(n.data),u.leaveTryBlock(4);break;case 3:throw s=u.enterCatchBlock(),goog.asserts.assert(s instanceof shaka.util.Error,"Wrong NetworkingEngine error type!"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.SERVER_CERTIFICATE_REQUEST_FAILED,s);case 4:if(t.destroyer_.destroyed())return u.return();case 2:return!t.currentDrmInfo_.serverCertificate||!t.currentDrmInfo_.serverCertificate.length?u.return():(u.setCatchFinallyBlocks(6),u.yield(t.mediaKeys_.setServerCertificate(t.currentDrmInfo_.serverCertificate),8));case 8:(o=u.yieldResult)||shaka.log.warning("Server certificates are not supported by the key system.  The server certificate has been ignored."),u.leaveTryBlock(0);break;case 6:throw l=u.enterCatchBlock(),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.INVALID_SERVER_CERTIFICATE,l.message)}})},shaka.media.DrmEngine.prototype.removeSession=function(t){var r=this,i,n,s;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){if(o.nextAddress==1)return goog.asserts.assert(r.mediaKeys_,"Must call init() before removeSession"),o.yield(r.loadOfflineSession_(t),2);if(o.nextAddress!=3)return i=o.yieldResult,i?(n=[],(s=r.activeSessions_.get(i))&&(s.updatePromise=new shaka.util.PublicPromise,n.push(s.updatePromise)),shaka.log.v2("Attempting to remove session",t),n.push(i.remove()),o.yield(Promise.all(n),3)):(shaka.log.v2("Ignoring attempt to remove missing session",t),o.return());r.activeSessions_.delete(i),o.jumpToEnd()})},shaka.media.DrmEngine.prototype.createOrLoad=function(){for(var t=(this.currentDrmInfo_?this.currentDrmInfo_.initData:[])||[],r=$jscomp.makeIterator(t),i=r.next();!i.done;i=r.next())i=i.value,this.newInitData(i.initDataType,i.initData);for(r=$jscomp.makeIterator(this.offlineSessionIds_),i=r.next();!i.done;i=r.next())this.loadOfflineSession_(i.value);return t.length||this.offlineSessionIds_.length||this.allSessionsLoaded_.resolve(),this.allSessionsLoaded_},shaka.media.DrmEngine.prototype.newInitData=function(t,r){var i=this.activeSessions_.values();i=$jscomp.makeIterator(i);for(var n=i.next();!n.done;n=i.next())if(shaka.util.BufferUtils.equal(r,n.value.initData)&&!shaka.util.Platform.isTizen2()){shaka.log.debug("Ignoring duplicate init data.");return}this.createSession(t,r,this.currentDrmInfo_.sessionType)},shaka.media.DrmEngine.prototype.initialized=function(){return this.initialized_},shaka.media.DrmEngine.keySystem=function(t){return t?t.keySystem:""},shaka.media.DrmEngine.isPlayReadyKeySystem=function(t){return t?!!t.match(/^com\.(microsoft|chromecast)\.playready/):!1},shaka.media.DrmEngine.isFairPlayKeySystem=function(t){return t?!!t.match(/^com\.apple\.fps/):!1},shaka.media.DrmEngine.prototype.willSupport=function(t){if(shaka.util.Platform.isLegacyEdge())return!0;if(t=t.toLowerCase(),shaka.util.Platform.isTizen()&&t.includes('codecs="ac-3"')){var r=t.replace("ac-3","ec-3");return this.supportedTypes_.has(t)||this.supportedTypes_.has(r)}return this.supportedTypes_.has(t)},shaka.media.DrmEngine.prototype.getSessionIds=function(){var t=this.activeSessions_.keys();return t=shaka.util.Iterables.map(t,function(r){return r.sessionId}),Array.from(t)},shaka.media.DrmEngine.prototype.getExpiration=function(){var t=1/0,r=this.activeSessions_.keys();r=$jscomp.makeIterator(r);for(var i=r.next();!i.done;i=r.next())i=i.value,isNaN(i.expiration)||(t=Math.min(t,i.expiration));return t},shaka.media.DrmEngine.prototype.getLicenseTime=function(){return this.licenseTimeSeconds_?this.licenseTimeSeconds_:NaN},shaka.media.DrmEngine.prototype.getDrmInfo=function(){return this.currentDrmInfo_},shaka.media.DrmEngine.prototype.getMediaKeys=function(){return this.mediaKeys_},shaka.media.DrmEngine.prototype.getKeyStatuses=function(){return shaka.util.MapUtils.asObject(this.announcedKeyStatusByKeyId_)},shaka.media.DrmEngine.prototype.getMediaKeySessions=function(){return Array.from(this.activeSessions_.keys())},shaka.media.DrmEngine.computeMimeType_=function(t,r){var i=shaka.util.MimeUtils.getFullType(t.mimeType,r||t.codecs);return shaka.media.Transmuxer.isSupported(i)?shaka.media.Transmuxer.convertTsCodecs(t.type,i):i},shaka.media.DrmEngine.prototype.queryMediaKeys_=function(t,r){var i=this,n,s,o,l,u,m,E,y,D,w,B,F,V;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){switch(K.nextAddress){case 1:if(n=new Map,r.length){s=i.getKeySystemAccessFromVariants_(r,n),K.jumpTo(2);break}return K.yield(i.getKeySystemAccessByConfigs_(t),3);case 3:s=K.yieldResult;case 2:if(o=s,!o)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE);for(i.destroyer_.ensureNotDestroyed(),K.setCatchFinallyBlocks(4),i.supportedTypes_.clear(),l=o.getConfiguration(),shaka.log.v2("Got MediaKeySystemAccess with configuration",l),u=l.audioCapabilities||[],m=l.videoCapabilities||[],E=$jscomp.makeIterator(u),y=E.next();!y.done;y=E.next())D=y.value,i.supportedTypes_.add(D.contentType.toLowerCase());for(w=$jscomp.makeIterator(m),y=w.next();!y.done;y=w.next())B=y.value,i.supportedTypes_.add(B.contentType.toLowerCase());if(goog.asserts.assert(i.supportedTypes_.size,"We should get at least one supported MIME type"),i.currentDrmInfo_=r.length?i.createDrmInfoByInfos_(o.keySystem,n.get(o.keySystem)):shaka.media.DrmEngine.createDrmInfoByConfigs_(o.keySystem,t.get(o.keySystem)),!i.currentDrmInfo_.licenseServerUri)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.NO_LICENSE_SERVER_GIVEN,i.currentDrmInfo_.keySystem);return K.yield(o.createMediaKeys(),6);case 6:return F=K.yieldResult,i.destroyer_.ensureNotDestroyed(),shaka.log.info("Created MediaKeys object for key system",i.currentDrmInfo_.keySystem),i.mediaKeys_=F,i.initialized_=!0,K.yield(i.setServerCertificate(),7);case 7:i.destroyer_.ensureNotDestroyed(),K.leaveTryBlock(0);break;case 4:throw V=K.enterCatchBlock(),i.destroyer_.ensureNotDestroyed(V),i.currentDrmInfo_=null,i.supportedTypes_.clear(),V instanceof shaka.util.Error?V:new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_CDM,V.message)}})},shaka.media.DrmEngine.prototype.getKeySystemAccessFromVariants_=function(t,r){for(var i=$jscomp.makeIterator(t),n=i.next();!n.done;n=i.next()){var s=this.getVariantDrmInfos_(n.value);for(s=$jscomp.makeIterator(s),n=s.next();!n.done;n=s.next()){var o=n.value;r.has(o.keySystem)||r.set(o.keySystem,[]),r.get(o.keySystem).push(o)}}if(r.size==1&&r.has(""))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.NO_RECOGNIZED_KEY_SYSTEMS);for(i={},s=$jscomp.makeIterator(this.config_.preferredKeySystems),o=s.next();!o.done;i={$jscomp$loop$prop$preferredKeySystem$586:i.$jscomp$loop$prop$preferredKeySystem$586},o=s.next())for(i.$jscomp$loop$prop$preferredKeySystem$586=o.value,o=$jscomp.makeIterator(t),n=o.next();!n.done;n=o.next())if(n=n.value.decodingInfos.find(function(E){return function(y){return y.supported&&y.keySystemAccess!=null&&y.keySystemAccess.keySystem==E.$jscomp$loop$prop$preferredKeySystem$586}}(i)))return n.keySystemAccess;for(i=$jscomp.makeIterator([!0,!1]),s=i.next();!s.done;s=i.next())for(s=s.value,o=$jscomp.makeIterator(t),n=o.next();!n.done;n=o.next()){var l=$jscomp.makeIterator(n.value.decodingInfos);for(n=l.next();!n.done;n=l.next()){var u=n.value;if(u.supported&&u.keySystemAccess){n=r.get(u.keySystemAccess.keySystem);var m=$jscomp.makeIterator(n);for(n=m.next();!n.done;n=m.next())if(!!n.value.licenseServerUri==s)return u.keySystemAccess}}}return null},shaka.media.DrmEngine.prototype.getKeySystemAccessByConfigs_=function(t){var r=this,i,n,s,o,l,u,m,E,y,D,w,B,F,V,K,q,re;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ee){switch(ee.nextAddress){case 1:if(t.size==1&&t.has(""))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.NO_RECOGNIZED_KEY_SYSTEMS);for(n=$jscomp.makeIterator(t.values()),s=n.next();!s.done;s=n.next())o=s.value,o.audioCapabilities.length==0&&delete o.audioCapabilities,o.videoCapabilities.length==0&&delete o.videoCapabilities;l=$jscomp.makeIterator(r.config_.preferredKeySystems),u=l.next();case 2:if(u.done){ee.jumpTo(4);break}if(m=u.value,!t.has(m)){ee.jumpTo(3);break}return E=t.get(m),ee.setCatchFinallyBlocks(6),ee.yield(navigator.requestMediaKeySystemAccess(m,[E]),8);case 8:return i=ee.yieldResult,ee.return(i);case 6:y=ee.enterCatchBlock(),shaka.log.v2("Requesting",m,"failed with config",E,y);case 7:r.destroyer_.ensureNotDestroyed();case 3:u=l.next(),ee.jumpTo(2);break;case 4:D=$jscomp.makeIterator([!0,!1]),w=D.next();case 9:if(w.done){ee.jumpTo(11);break}B=w.value,F=$jscomp.makeIterator(t.keys()),u=F.next();case 12:if(u.done){w=D.next(),ee.jumpTo(9);break}if(V=u.value,K=t.get(V),q=K.drmInfos.some(function(H){return!!H.licenseServerUri}),q!=B){ee.jumpTo(13);break}return ee.setCatchFinallyBlocks(15),ee.yield(navigator.requestMediaKeySystemAccess(V,[K]),17);case 17:return i=ee.yieldResult,ee.return(i);case 15:re=ee.enterCatchBlock(),shaka.log.v2("Requesting",V,"failed with config",K,re);case 16:r.destroyer_.ensureNotDestroyed();case 13:u=F.next(),ee.jumpTo(12);break;case 11:return ee.return(i)}})},shaka.media.DrmEngine.prototype.configureClearKey_=function(){var t=shaka.util.MapUtils.asMap(this.config_.clearKeys);if(t.size==0)return null;var r=shaka.util.StringUtils,i=shaka.util.Uint8ArrayUtils,n=[],s=[];t.forEach(function(l,u){var m=i.fromHex(u),E=i.fromHex(l);m={kty:"oct",kid:i.toBase64(m,!1),k:i.toBase64(E,!1)},n.push(m),s.push(m.kid)}),t=JSON.stringify({keys:n});var o=JSON.stringify({kids:s});return r=[{initData:shaka.util.BufferUtils.toUint8(r.toUTF8(o)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+window.btoa(t),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:r,keyIds:new Set(s)}},shaka.media.DrmEngine.prototype.loadOfflineSession_=function(t){var r=this,i,n,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){switch(u.nextAddress){case 1:try{shaka.log.v1("Attempting to load an offline session",t),i=r.mediaKeys_.createSession("persistent-license")}catch(m){return n=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,m.message),r.onError_(n),u.return(Promise.reject(n))}return r.eventManager_.listen(i,"message",function(m){return r.onSessionMessage_(m)}),r.eventManager_.listen(i,"keystatuseschange",function(m){return r.onKeyStatusesChange_(m)}),s={initData:null,loaded:!1,oldExpiration:1/0,updatePromise:null,type:"persistent-license"},r.activeSessions_.set(i,s),u.setCatchFinallyBlocks(2),u.yield(i.load(t),4);case 4:return o=u.yieldResult,r.destroyer_.ensureNotDestroyed(),shaka.log.v2("Loaded offline session",t,o),o?(s.loaded=!0,r.areAllSessionsLoaded_()&&r.allSessionsLoaded_.resolve(),u.return(i)):(r.activeSessions_.delete(i),r.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.OFFLINE_SESSION_REMOVED)),u.return(Promise.resolve()));case 2:l=u.enterCatchBlock(),r.destroyer_.ensureNotDestroyed(l),r.activeSessions_.delete(i),r.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,l.message));case 3:return u.return(Promise.resolve())}})},shaka.media.DrmEngine.prototype.createSession=function(t,r,i){var n=this;goog.asserts.assert(this.mediaKeys_,"mediaKeys_ should be valid when creating temporary session.");try{shaka.log.info("Creating new",i,"session");var s=this.mediaKeys_.createSession(i)}catch(o){this.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,o.message));return}this.eventManager_.listen(s,"message",function(o){return n.onSessionMessage_(o)}),this.eventManager_.listen(s,"keystatuseschange",function(o){return n.onKeyStatusesChange_(o)}),this.activeSessions_.set(s,{initData:r,loaded:!1,oldExpiration:1/0,updatePromise:null,type:i});try{r=this.config_.initDataTransform(r,t,this.currentDrmInfo_)}catch(o){t=o,o instanceof shaka.util.Error||(t=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.INIT_DATA_TRANSFORM_ERROR,o)),this.onError_(t);return}this.config_.logLicenseExchange&&(i=shaka.util.Uint8ArrayUtils.toBase64(r),shaka.log.info("EME init data: type=",t,"data=",i)),s.generateRequest(t,r).catch(function(o){if(!n.destroyer_.destroyed()){goog.asserts.assert(o instanceof Error,"Wrong error type!"),n.activeSessions_.delete(s);var l=o.errorCode;if(l&&l.systemCode){var u=l.systemCode;0>u&&(u+=Math.pow(2,32)),u="0x"+u.toString(16)}n.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_GENERATE_LICENSE_REQUEST,o.message,o,u))}})},shaka.media.DrmEngine.defaultInitDataTransform=function(t,r,i){return r=="skd"&&(r=i.serverCertificate,i=shaka.util.FairPlayUtils.defaultGetContentId(t),t=shaka.util.FairPlayUtils.initDataTransform(t,i,r)),t},shaka.media.DrmEngine.prototype.onSessionMessage_=function(t){this.delayLicenseRequest_()?this.mediaKeyMessageEvents_.push(t):this.sendLicenseRequest_(t)},shaka.media.DrmEngine.prototype.delayLicenseRequest_=function(){return this.video_?this.config_.delayLicenseRequestUntilPlayed&&this.video_.paused&&!this.initialRequestsSent_:!1},shaka.media.DrmEngine.prototype.sendLicenseRequest_=function(t){var r=this,i,n,s,o,l,u,m,E,y,D,w,B,F,V,K,q,re;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ee){switch(ee.nextAddress){case 1:return i=t.target,shaka.log.v1("Sending license request for session",i.sessionId,"of type",t.messageType),r.config_.logLicenseExchange&&(n=shaka.util.Uint8ArrayUtils.toBase64(t.message),shaka.log.info("EME license request",n)),s=r.activeSessions_.get(i),o=r.currentDrmInfo_.licenseServerUri,l=r.config_.advanced[r.currentDrmInfo_.keySystem],t.messageType=="individualization-request"&&l&&l.individualizationServer&&(o=l.individualizationServer),u=shaka.net.NetworkingEngine.RequestType.LICENSE,m=shaka.net.NetworkingEngine.makeRequest([o],r.config_.retryParameters),m.body=t.message,m.method="POST",m.licenseRequestType=t.messageType,m.sessionId=i.sessionId,shaka.media.DrmEngine.isPlayReadyKeySystem(r.currentDrmInfo_.keySystem)&&r.unpackPlayReadyRequest_(m),E=Date.now(),ee.setCatchFinallyBlocks(2),D=r.playerInterface_.netEngine.request(u,m),ee.yield(D.promise,4);case 4:y=ee.yieldResult,ee.leaveTryBlock(3);break;case 2:return w=ee.enterCatchBlock(),goog.asserts.assert(w instanceof shaka.util.Error,"Wrong NetworkingEngine error type!"),B=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.LICENSE_REQUEST_FAILED,w),r.onError_(B),s&&s.updatePromise&&s.updatePromise.reject(B),ee.return();case 3:return r.destroyer_.destroyed()?ee.return():(r.licenseTimeSeconds_+=(Date.now()-E)/1e3,r.config_.logLicenseExchange&&(F=shaka.util.Uint8ArrayUtils.toBase64(y.data),shaka.log.info("EME license response",F)),ee.setCatchFinallyBlocks(5),shaka.log.v1("Updating session",i.sessionId),ee.yield(i.update(y.data),7));case 7:ee.leaveTryBlock(6);break;case 5:return V=ee.enterCatchBlock(),K=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.LICENSE_RESPONSE_REJECTED,V.message),r.onError_(K),s&&s.updatePromise&&s.updatePromise.reject(K),ee.return();case 6:if(r.destroyer_.destroyed())return ee.return();q=new shaka.util.FakeEvent("drmsessionupdate"),r.playerInterface_.onEvent(q),s&&(s.updatePromise&&s.updatePromise.resolve(),re=new shaka.util.Timer(function(){s.loaded=!0,r.areAllSessionsLoaded_()&&r.allSessionsLoaded_.resolve()}),re.tickAfter(shaka.media.DrmEngine.SESSION_LOAD_TIMEOUT_)),ee.jumpToEnd()}})},shaka.media.DrmEngine.prototype.unpackPlayReadyRequest_=function(t){var r=shaka.util.StringUtils.fromUTF16(t.body,!0,!0);if(r.includes("PlayReadyKeyMessage")){shaka.log.debug("Unwrapping PlayReady request."),r=new DOMParser().parseFromString(r,"application/xml");var i=r.getElementsByTagName("HttpHeader");i=$jscomp.makeIterator(i);for(var n=i.next();!n.done;n=i.next()){var s=n.value;n=s.getElementsByTagName("name")[0],s=s.getElementsByTagName("value")[0],goog.asserts.assert(n&&s,"Malformed PlayReady headers!"),t.headers[n.textContent]=s.textContent}r=r.getElementsByTagName("Challenge")[0],goog.asserts.assert(r,"Malformed PlayReady challenge!"),goog.asserts.assert(r.getAttribute("encoding")=="base64encoded","Unexpected PlayReady challenge encoding!"),t.body=shaka.util.Uint8ArrayUtils.fromBase64(r.textContent)}else shaka.log.debug("PlayReady request is already unwrapped."),t.headers["Content-Type"]="text/xml; charset=utf-8"},shaka.media.DrmEngine.prototype.onKeyStatusesChange_=function(t){var r=this;t=t.target,shaka.log.v2("Key status changed for session",t.sessionId);var i=this.activeSessions_.get(t),n=!1;t.keyStatuses.forEach(function(o,l){if(typeof l=="string"){var u=l;l=o,o=u}if(shaka.media.DrmEngine.isPlayReadyKeySystem(r.currentDrmInfo_.keySystem)&&l.byteLength==16&&(shaka.util.Platform.isEdge()||shaka.util.Platform.isPS4())){u=shaka.util.BufferUtils.toDataView(l);var m=u.getUint32(0,!0),E=u.getUint16(4,!0),y=u.getUint16(6,!0);u.setUint32(0,m,!1),u.setUint16(4,E,!1),u.setUint16(6,y,!1)}o!="status-pending"&&(i.loaded=!0),i||goog.asserts.assert(o!="usable","Usable keys found in closed session"),o=="expired"&&(n=!0),u=shaka.util.Uint8ArrayUtils.toHex(l),r.keyStatusByKeyId_.set(u,o)});var s=t.expiration-Date.now();(0>s||n&&1e3>s)&&i&&!i.updatePromise&&(shaka.log.debug("Session has expired",t.sessionId),this.activeSessions_.delete(t),t.close().catch(function(){})),this.areAllSessionsLoaded_()&&(this.allSessionsLoaded_.resolve(),this.keyStatusTimer_.tickAfter(shaka.media.DrmEngine.KEY_STATUS_BATCH_TIME))},shaka.media.DrmEngine.prototype.processKeyStatusChanges_=function(){var t=this.keyStatusByKeyId_,r=this.announcedKeyStatusByKeyId_;r.clear(),t.forEach(function(i,n){return r.set(n,i)}),t=Array.from(r.values()),t.length&&t.every(function(i){return i=="expired"})&&this.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.EXPIRED)),this.playerInterface_.onKeyStatus(shaka.util.MapUtils.asObject(r))},shaka.media.DrmEngine.isBrowserSupported=function(){return!!window.MediaKeys&&!!window.navigator&&!!window.navigator.requestMediaKeySystemAccess&&!!window.MediaKeySystemAccess&&!!window.MediaKeySystemAccess.prototype.getConfiguration},shaka.media.DrmEngine.probeSupport=function(){var t,r,i,n,s,o,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){return m.nextAddress==1?(goog.asserts.assert(shaka.media.DrmEngine.isBrowserSupported(),"Must have basic EME support"),t="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.microsoft.playready.recommendation com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" "),r=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],i={initDataTypes:["cenc"],videoCapabilities:r},n={videoCapabilities:r,persistentState:"required",sessionTypes:["persistent-license"]},s=[n,i],o=new Map,l=function(E){var y,D,w;return $jscomp.asyncExecutePromiseGeneratorProgram(function(B){switch(B.nextAddress){case 1:return B.setCatchFinallyBlocks(2),B.yield(navigator.requestMediaKeySystemAccess(E,s),4);case 4:return y=B.yieldResult,w=(D=y.getConfiguration().sessionTypes)?D.includes("persistent-license"):!1,shaka.util.Platform.isTizen3()&&(w=!1),o.set(E,{persistentState:w}),B.yield(y.createMediaKeys(),5);case 5:B.leaveTryBlock(0);break;case 2:B.enterCatchBlock(),o.set(E,null),B.jumpToEnd()}})},u=t.map(function(E){return l(E)}),m.yield(Promise.all(u),2)):m.return(shaka.util.MapUtils.asObject(o))})},shaka.media.DrmEngine.prototype.onPlay_=function(){for(var t=$jscomp.makeIterator(this.mediaKeyMessageEvents_),r=t.next();!r.done;r=t.next())this.sendLicenseRequest_(r.value);this.initialRequestsSent_=!0,this.mediaKeyMessageEvents_=[]},shaka.media.DrmEngine.prototype.closeSession_=function(t){var r,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(n.nextAddress==1)return r=shaka.media.DrmEngine,i=new Promise(function(s,o){new shaka.util.Timer(o).tickAfter(r.CLOSE_TIMEOUT_)}),n.setCatchFinallyBlocks(2),n.yield(Promise.race([Promise.all([t.close(),t.closed]),i]),4);if(n.nextAddress!=2)return n.leaveTryBlock(0);n.enterCatchBlock(),shaka.log.warning("Timeout waiting for session close"),n.jumpToEnd()})},shaka.media.DrmEngine.prototype.closeOpenSessions_=function(){var t=this,r;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return r=Array.from(t.activeSessions_.entries()),t.activeSessions_.clear(),i.yield(Promise.all(r.map(function(n){n=$jscomp.makeIterator(n);var s=n.next().value,o=n.next().value,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){if(u.nextAddress==1)return u.setCatchFinallyBlocks(2),!t.initializedForStorage_&&!t.offlineSessionIds_.includes(s.sessionId)&&o.type==="persistent-license"?(shaka.log.v1("Removing session",s.sessionId),u.yield(s.remove(),5)):(shaka.log.v1("Closing session",s.sessionId,o),u.yield(t.closeSession_(s),5));if(u.nextAddress!=2)return u.leaveTryBlock(0);l=u.enterCatchBlock(),shaka.log.error("Failed to close or remove the session",l),u.jumpToEnd()})})),0)})},shaka.media.DrmEngine.prototype.supportsVariant=function(t){var r=t.audio,i=t.video;if(r&&r.encrypted&&(r=shaka.media.DrmEngine.computeMimeType_(r),!this.willSupport(r))||i&&i.encrypted&&(i=shaka.media.DrmEngine.computeMimeType_(i),!this.willSupport(i)))return!1;var n=shaka.media.DrmEngine.keySystem(this.currentDrmInfo_);return t=this.getVariantDrmInfos_(t),t.length==0||t.some(function(s){return s.keySystem==n})},shaka.media.DrmEngine.areDrmCompatible=function(t,r){return t.length&&r.length?0<shaka.media.DrmEngine.getCommonDrmInfos(t,r).length:!0},shaka.media.DrmEngine.getCommonDrmInfos=function(t,r){if(!t.length)return r;if(!r.length)return t;for(var i=[],n=$jscomp.makeIterator(t),s=n.next();!s.done;s=n.next()){s=s.value;for(var o={},l=$jscomp.makeIterator(r),u=l.next();!u.done;o={$jscomp$loop$prop$initData$588:o.$jscomp$loop$prop$initData$588},u=l.next())if(u=u.value,s.keySystem==u.keySystem){o.$jscomp$loop$prop$initData$588=[],o.$jscomp$loop$prop$initData$588=o.$jscomp$loop$prop$initData$588.concat(s.initData||[]),o.$jscomp$loop$prop$initData$588=o.$jscomp$loop$prop$initData$588.concat(u.initData||[]),o.$jscomp$loop$prop$initData$588=o.$jscomp$loop$prop$initData$588.filter(function(m){return function(E,y){return E.keyId===void 0||y===m.$jscomp$loop$prop$initData$588.findIndex(function(D){return D.keyId===E.keyId})}}(o)),l=s.keyIds&&u.keyIds?new Set([].concat($jscomp.arrayFromIterable(s.keyIds),$jscomp.arrayFromIterable(u.keyIds))):s.keyIds||u.keyIds,i.push({keySystem:s.keySystem,licenseServerUri:s.licenseServerUri||u.licenseServerUri,distinctiveIdentifierRequired:s.distinctiveIdentifierRequired||u.distinctiveIdentifierRequired,persistentStateRequired:s.persistentStateRequired||u.persistentStateRequired,videoRobustness:s.videoRobustness||u.videoRobustness,audioRobustness:s.audioRobustness||u.audioRobustness,serverCertificate:s.serverCertificate||u.serverCertificate,serverCertificateUri:s.serverCertificateUri||u.serverCertificateUri,initData:o.$jscomp$loop$prop$initData$588,keyIds:l});break}}return i},shaka.media.DrmEngine.prototype.getVariantDrmInfos_=function(t){return(t.video?t.video.drmInfos:[]).concat(t.audio?t.audio.drmInfos:[])},shaka.media.DrmEngine.prototype.pollExpiration_=function(){var t=this;this.activeSessions_.forEach(function(r,i){var n=r.oldExpiration,s=i.expiration;isNaN(s)&&(s=1/0),s!=n&&(t.playerInterface_.onExpirationUpdated(i.sessionId,s),r.oldExpiration=s)})},shaka.media.DrmEngine.prototype.areAllSessionsLoaded_=function(){var t=this.activeSessions_.values();return shaka.util.Iterables.every(t,function(r){return r.loaded})},shaka.media.DrmEngine.replaceDrmInfo_=function(t,r){var i=[];r.forEach(function(o,l){i.push({keySystem:l,licenseServerUri:o,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",initData:[],keyIds:new Set})});for(var n=$jscomp.makeIterator(t),s=n.next();!s.done;s=n.next())s=s.value,s.video&&(s.video.drmInfos=i),s.audio&&(s.audio.drmInfos=i)},shaka.media.DrmEngine.prototype.createDrmInfoByInfos_=function(t,r){var i=[],n=[],s=[],o=[],l=new Set;shaka.media.DrmEngine.processDrmInfos_(r,i,s,n,o,l),1<s.length&&shaka.log.warning("Multiple unique server certificates found! Only the first will be used."),1<i.length&&shaka.log.warning("Multiple unique license server URIs found! Only the first will be used."),1<n.length&&shaka.log.warning("Multiple unique server certificate URIs found! Only the first will be used.");var u=this.usePersistentLicenses_?"persistent-license":"temporary";for(i={keySystem:t,licenseServerUri:i[0],distinctiveIdentifierRequired:r[0].distinctiveIdentifierRequired,persistentStateRequired:r[0].persistentStateRequired,sessionType:r[0].sessionType||u,audioRobustness:r[0].audioRobustness||"",videoRobustness:r[0].videoRobustness||"",serverCertificate:s[0],serverCertificateUri:n[0],initData:o,keyIds:l},n=$jscomp.makeIterator(r),s=n.next();!s.done;s=n.next())s=s.value,s.distinctiveIdentifierRequired&&(i.distinctiveIdentifierRequired=s.distinctiveIdentifierRequired),s.persistentStateRequired&&(i.persistentStateRequired=s.persistentStateRequired);return i},shaka.media.DrmEngine.createDrmInfoByConfigs_=function(t,r){var i=[],n=[],s=[],o=[],l=new Set;return shaka.media.DrmEngine.processDrmInfos_(r.drmInfos,i,s,n,o,l),1<s.length&&shaka.log.warning("Multiple unique server certificates found! Only the first will be used."),1<n.length&&shaka.log.warning("Multiple unique server certificate URIs found! Only the first will be used."),1<i.length&&shaka.log.warning("Multiple unique license server URIs found! Only the first will be used."),{keySystem:t,licenseServerUri:i[0],distinctiveIdentifierRequired:r.distinctiveIdentifier=="required",persistentStateRequired:r.persistentState=="required",sessionType:r.sessionTypes[0]||"temporary",audioRobustness:(r.audioCapabilities?r.audioCapabilities[0].robustness:"")||"",videoRobustness:(r.videoCapabilities?r.videoCapabilities[0].robustness:"")||"",serverCertificate:s[0],serverCertificateUri:n[0],initData:o,keyIds:l}},shaka.media.DrmEngine.processDrmInfos_=function(t,r,i,n,s,o){var l={};t=$jscomp.makeIterator(t);for(var u=t.next();!u.done;l={$jscomp$loop$prop$drmInfo$590:l.$jscomp$loop$prop$drmInfo$590},u=t.next()){if(l.$jscomp$loop$prop$drmInfo$590=u.value,r.includes(l.$jscomp$loop$prop$drmInfo$590.licenseServerUri)||r.push(l.$jscomp$loop$prop$drmInfo$590.licenseServerUri),n.includes(l.$jscomp$loop$prop$drmInfo$590.serverCertificateUri)||n.push(l.$jscomp$loop$prop$drmInfo$590.serverCertificateUri),l.$jscomp$loop$prop$drmInfo$590.serverCertificate&&(i.some(function(y){return function(D){return shaka.util.BufferUtils.equal(D,y.$jscomp$loop$prop$drmInfo$590.serverCertificate)}}(l))||i.push(l.$jscomp$loop$prop$drmInfo$590.serverCertificate)),l.$jscomp$loop$prop$drmInfo$590.initData){u={};for(var m=$jscomp.makeIterator(l.$jscomp$loop$prop$drmInfo$590.initData),E=m.next();!E.done;u={$jscomp$loop$prop$initDataOverride$592:u.$jscomp$loop$prop$initDataOverride$592},E=m.next())u.$jscomp$loop$prop$initDataOverride$592=E.value,s.some(function(y){return function(D){var w=y.$jscomp$loop$prop$initDataOverride$592;return D=D.keyId&&D.keyId==w.keyId?!0:D.initDataType==w.initDataType&&shaka.util.BufferUtils.equal(D.initData,w.initData),D}}(u))||s.push(u.$jscomp$loop$prop$initDataOverride$592)}if(l.$jscomp$loop$prop$drmInfo$590.keyIds)for(u=$jscomp.makeIterator(l.$jscomp$loop$prop$drmInfo$590.keyIds),m=u.next();!m.done;m=u.next())o.add(m.value)}},shaka.media.DrmEngine.fillInDrmInfoDefaults_=function(t,r,i){t.keySystem&&(t.keySystem!="org.w3.clearkey"||!t.licenseServerUri)&&(r.size&&(r=r.get(t.keySystem)||"",t.licenseServerUri=r),t.keyIds||(t.keyIds=new Set),(i=i.get(t.keySystem))&&(t.distinctiveIdentifierRequired||(t.distinctiveIdentifierRequired=i.distinctiveIdentifierRequired),t.persistentStateRequired||(t.persistentStateRequired=i.persistentStateRequired),t.videoRobustness||(t.videoRobustness=i.videoRobustness),t.audioRobustness||(t.audioRobustness=i.audioRobustness),t.serverCertificate||(t.serverCertificate=i.serverCertificate),i.sessionType&&(t.sessionType=i.sessionType),t.serverCertificateUri||(t.serverCertificateUri=i.serverCertificateUri)),window.cast&&window.cast.__platform__&&t.keySystem=="com.microsoft.playready"&&(t.keySystem="com.chromecast.playready"))},shaka.media.DrmEngine.CLOSE_TIMEOUT_=1,shaka.media.DrmEngine.SESSION_LOAD_TIMEOUT_=5,shaka.media.DrmEngine.KEY_STATUS_BATCH_TIME=.5,shaka.media.DrmEngine.DUMMY_KEY_ID=new shaka.util.Lazy(function(){return shaka.util.BufferUtils.toArrayBuffer(new Uint8Array([0]))}),shaka.media.ManifestParser=function(){},shaka.media.ManifestParser.registerParserByExtension=function(t,r){shaka.media.ManifestParser.parsersByExtension[t]=r},shaka.media.ManifestParser.registerParserByMime=function(t,r){shaka.media.ManifestParser.parsersByMime[t]=r},shaka.media.ManifestParser.unregisterParserByMime=function(t){delete shaka.media.ManifestParser.parsersByMime[t]},shaka.media.ManifestParser.probeSupport=function(){var t=shaka.media.ManifestParser,r={};if(shaka.util.Platform.supportsMediaSource()){for(var i in t.parsersByMime)r[i]=!0;for(var n in t.parsersByExtension)r[n]=!0}i={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"},n=$jscomp.makeIterator(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"]);for(var s=n.next();!s.done;s=n.next())s=s.value,shaka.util.Platform.supportsMediaSource()?r[s]=!!t.parsersByMime[s]:r[s]=shaka.util.Platform.supportsMediaType(s);for(var o in i)shaka.util.Platform.supportsMediaSource()?r[o]=!!t.parsersByExtension[o]:r[o]=shaka.util.Platform.supportsMediaType(i[o]);return r},shaka.media.ManifestParser.getFactory=function(t,r,i,n){var s,o,l,u,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){if(E.nextAddress==1){if(s=shaka.media.ManifestParser,n){if(o=s.parsersByMime[n.toLowerCase()])return E.return(o);shaka.log.warning("Could not determine manifest type using MIME type ",n)}if(l=s.getExtension(t)){if(u=s.parsersByExtension[l])return E.return(u);shaka.log.warning("Could not determine manifest type for extension ",l)}else shaka.log.warning("Could not find extension for ",t);return n?E.jumpTo(2):E.yield(s.getMimeType(t,r,i),3)}if(E.nextAddress!=2&&(n=E.yieldResult)){if(m=shaka.media.ManifestParser.parsersByMime[n])return E.return(m);shaka.log.warning("Could not determine manifest type using MIME type",n)}throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.UNABLE_TO_GUESS_MANIFEST_TYPE,t)})},shaka.media.ManifestParser.getMimeType=function(t,r,i){var n,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){return u.nextAddress==1?(n=shaka.net.NetworkingEngine.RequestType.MANIFEST,s=shaka.net.NetworkingEngine.makeRequest([t],i),s.method="HEAD",u.yield(r.request(n,s).promise,2)):(o=u.yieldResult,l=o.headers["content-type"],u.return(l?l.toLowerCase().split(";").shift():""))})},shaka.media.ManifestParser.getExtension=function(t){return t=new goog.Uri(t).getPath().split("/").pop().split("."),t.length==1?"":t.pop().toLowerCase()},shaka.media.ManifestParser.isSupported=function(t,r){return shaka.util.Platform.supportsMediaSource()?r in shaka.media.ManifestParser.parsersByMime||shaka.media.ManifestParser.getExtension(t)in shaka.media.ManifestParser.parsersByExtension:!1},goog.exportSymbol("shaka.media.ManifestParser",shaka.media.ManifestParser),goog.exportProperty(shaka.media.ManifestParser,"unregisterParserByMime",shaka.media.ManifestParser.unregisterParserByMime),goog.exportProperty(shaka.media.ManifestParser,"registerParserByMime",shaka.media.ManifestParser.registerParserByMime),goog.exportProperty(shaka.media.ManifestParser,"registerParserByExtension",shaka.media.ManifestParser.registerParserByExtension),shaka.media.ManifestParser.parsersByMime={},shaka.media.ManifestParser.parsersByExtension={},shaka.util.DataViewReader=function(t,r){this.dataView_=shaka.util.BufferUtils.toDataView(t),this.littleEndian_=r==shaka.util.DataViewReader.Endianness.LITTLE_ENDIAN,this.position_=0},shaka.util.DataViewReader.prototype.getDataView=function(){return this.dataView_},shaka.util.DataViewReader.prototype.hasMoreData=function(){return this.position_<this.dataView_.byteLength},shaka.util.DataViewReader.prototype.getPosition=function(){return this.position_},shaka.util.DataViewReader.prototype.getLength=function(){return this.dataView_.byteLength},shaka.util.DataViewReader.prototype.readUint8=function(){try{var t=this.dataView_.getUint8(this.position_);return this.position_+=1,t}catch{throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readUint16=function(){try{var t=this.dataView_.getUint16(this.position_,this.littleEndian_);return this.position_+=2,t}catch{throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readUint32=function(){try{var t=this.dataView_.getUint32(this.position_,this.littleEndian_);return this.position_+=4,t}catch{throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readInt32=function(){try{var t=this.dataView_.getInt32(this.position_,this.littleEndian_);return this.position_+=4,t}catch{throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readUint64=function(){try{if(this.littleEndian_)var t=this.dataView_.getUint32(this.position_,!0),r=this.dataView_.getUint32(this.position_+4,!0);else r=this.dataView_.getUint32(this.position_,!1),t=this.dataView_.getUint32(this.position_+4,!1)}catch{throw this.outOfBounds_()}if(2097151<r)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);return this.position_+=8,r*Math.pow(2,32)+t},shaka.util.DataViewReader.prototype.readBytes=function(t){if(goog.asserts.assert(0<=t,"Bad call to DataViewReader.readBytes"),this.position_+t>this.dataView_.byteLength)throw this.outOfBounds_();var r=shaka.util.BufferUtils.toUint8(this.dataView_,this.position_,t);return this.position_+=t,r},shaka.util.DataViewReader.prototype.skip=function(t){if(goog.asserts.assert(0<=t,"Bad call to DataViewReader.skip"),this.position_+t>this.dataView_.byteLength)throw this.outOfBounds_();this.position_+=t},shaka.util.DataViewReader.prototype.rewind=function(t){if(goog.asserts.assert(0<=t,"Bad call to DataViewReader.rewind"),this.position_<t)throw this.outOfBounds_();this.position_-=t},shaka.util.DataViewReader.prototype.seek=function(t){if(goog.asserts.assert(0<=t,"Bad call to DataViewReader.seek"),0>t||t>this.dataView_.byteLength)throw this.outOfBounds_();this.position_=t},shaka.util.DataViewReader.prototype.readTerminatedString=function(){for(var t=this.position_;this.hasMoreData()&&this.dataView_.getUint8(this.position_)!=0;)this.position_+=1;return t=shaka.util.BufferUtils.toUint8(this.dataView_,t,this.position_-t),this.position_+=1,shaka.util.StringUtils.fromUTF8(t)},shaka.util.DataViewReader.prototype.outOfBounds_=function(){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS)},goog.exportSymbol("shaka.util.DataViewReader",shaka.util.DataViewReader),goog.exportProperty(shaka.util.DataViewReader.prototype,"readTerminatedString",shaka.util.DataViewReader.prototype.readTerminatedString),goog.exportProperty(shaka.util.DataViewReader.prototype,"seek",shaka.util.DataViewReader.prototype.seek),goog.exportProperty(shaka.util.DataViewReader.prototype,"rewind",shaka.util.DataViewReader.prototype.rewind),goog.exportProperty(shaka.util.DataViewReader.prototype,"skip",shaka.util.DataViewReader.prototype.skip),goog.exportProperty(shaka.util.DataViewReader.prototype,"readBytes",shaka.util.DataViewReader.prototype.readBytes),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint64",shaka.util.DataViewReader.prototype.readUint64),goog.exportProperty(shaka.util.DataViewReader.prototype,"readInt32",shaka.util.DataViewReader.prototype.readInt32),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint32",shaka.util.DataViewReader.prototype.readUint32),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint16",shaka.util.DataViewReader.prototype.readUint16),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint8",shaka.util.DataViewReader.prototype.readUint8),goog.exportProperty(shaka.util.DataViewReader.prototype,"getLength",shaka.util.DataViewReader.prototype.getLength),goog.exportProperty(shaka.util.DataViewReader.prototype,"getPosition",shaka.util.DataViewReader.prototype.getPosition),goog.exportProperty(shaka.util.DataViewReader.prototype,"hasMoreData",shaka.util.DataViewReader.prototype.hasMoreData),shaka.util.DataViewReader.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:1},goog.exportProperty(shaka.util.DataViewReader,"Endianness",shaka.util.DataViewReader.Endianness),shaka.util.Mp4Parser=function(){this.headers_=[],this.boxDefinitions_=[],this.done_=!1},shaka.util.Mp4Parser.prototype.box=function(t,r){var i=shaka.util.Mp4Parser.typeFromString_(t);return this.headers_[i]=shaka.util.Mp4Parser.BoxType_.BASIC_BOX,this.boxDefinitions_[i]=r,this},shaka.util.Mp4Parser.prototype.fullBox=function(t,r){var i=shaka.util.Mp4Parser.typeFromString_(t);return this.headers_[i]=shaka.util.Mp4Parser.BoxType_.FULL_BOX,this.boxDefinitions_[i]=r,this},shaka.util.Mp4Parser.prototype.stop=function(){this.done_=!0},shaka.util.Mp4Parser.prototype.parse=function(t,r,i){for(t=new shaka.util.DataViewReader(t,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),this.done_=!1;t.hasMoreData()&&!this.done_;)this.parseNext(0,t,r,i)},shaka.util.Mp4Parser.prototype.parseNext=function(t,r,i,n){var s=r.getPosition();if(n&&s+8>r.getLength())this.done_=!0;else{var o=r.readUint32(),l=r.readUint32(),u=shaka.util.Mp4Parser.typeToString(l),m=!1;switch(shaka.log.v2("Parsing MP4 box",u),o){case 0:o=r.getLength()-s;break;case 1:if(n&&r.getPosition()+8>r.getLength()){this.done_=!0;return}o=r.readUint64(),m=!0}if(u=this.boxDefinitions_[l]){var E=null,y=null;if(this.headers_[l]==shaka.util.Mp4Parser.BoxType_.FULL_BOX){if(n&&r.getPosition()+4>r.getLength()){this.done_=!0;return}y=r.readUint32(),E=y>>>24,y&=16777215}l=s+o,i&&l>r.getLength()&&(l=r.getLength()),n&&l>r.getLength()?this.done_=!0:(n=l-r.getPosition(),r=0<n?r.readBytes(n):new Uint8Array(0),r=new shaka.util.DataViewReader(r,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),u({parser:this,partialOkay:i||!1,version:E,flags:y,reader:r,size:o,start:s+t,has64BitSize:m}))}else t=Math.min(s+o-r.getPosition(),r.getLength()-r.getPosition()),r.skip(t)}},shaka.util.Mp4Parser.children=function(t){for(var r=shaka.util.Mp4Parser.headerSize(t);t.reader.hasMoreData()&&!t.parser.done_;)t.parser.parseNext(t.start+r,t.reader,t.partialOkay)},shaka.util.Mp4Parser.sampleDescription=function(t){for(var r=shaka.util.Mp4Parser.headerSize(t),i=t.reader.readUint32(),n=0;n<i&&(t.parser.parseNext(t.start+r,t.reader,t.partialOkay),!t.parser.done_);n++);},shaka.util.Mp4Parser.allData=function(t){return function(r){var i=r.reader.getLength()-r.reader.getPosition();t(r.reader.readBytes(i))}},shaka.util.Mp4Parser.typeFromString_=function(t){goog.asserts.assert(t.length==4,"Mp4 box names must be 4 characters long");var r=0;t=$jscomp.makeIterator(t);for(var i=t.next();!i.done;i=t.next())r=r<<8|i.value.charCodeAt(0);return r},shaka.util.Mp4Parser.typeToString=function(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,t&255)},shaka.util.Mp4Parser.headerSize=function(t){return 8+(t.has64BitSize?8:0)+(t.flags!=null?4:0)},goog.exportSymbol("shaka.util.Mp4Parser",shaka.util.Mp4Parser),goog.exportProperty(shaka.util.Mp4Parser,"headerSize",shaka.util.Mp4Parser.headerSize),goog.exportProperty(shaka.util.Mp4Parser,"typeToString",shaka.util.Mp4Parser.typeToString),goog.exportProperty(shaka.util.Mp4Parser,"allData",shaka.util.Mp4Parser.allData),goog.exportProperty(shaka.util.Mp4Parser,"sampleDescription",shaka.util.Mp4Parser.sampleDescription),goog.exportProperty(shaka.util.Mp4Parser,"children",shaka.util.Mp4Parser.children),goog.exportProperty(shaka.util.Mp4Parser.prototype,"parseNext",shaka.util.Mp4Parser.prototype.parseNext),goog.exportProperty(shaka.util.Mp4Parser.prototype,"parse",shaka.util.Mp4Parser.prototype.parse),goog.exportProperty(shaka.util.Mp4Parser.prototype,"stop",shaka.util.Mp4Parser.prototype.stop),goog.exportProperty(shaka.util.Mp4Parser.prototype,"fullBox",shaka.util.Mp4Parser.prototype.fullBox),goog.exportProperty(shaka.util.Mp4Parser.prototype,"box",shaka.util.Mp4Parser.prototype.box),shaka.util.Mp4Parser.BoxType_={BASIC_BOX:0,FULL_BOX:1},shaka.media.ContentWorkarounds=function(){},shaka.media.ContentWorkarounds.fakeEncryption=function(t){var r=shaka.media.ContentWorkarounds;t=shaka.util.BufferUtils.toUint8(t);var i=!1,n,s=[],o=function(E){s.push(E),shaka.util.Mp4Parser.children(E)},l=function(E){i=!0},u=[];if(new shaka.util.Mp4Parser().box("moov",o).box("trak",o).box("mdia",o).box("minf",o).box("stbl",o).fullBox("stsd",function(E){n=E,s.push(E),shaka.util.Mp4Parser.sampleDescription(E)}).fullBox("encv",l).fullBox("enca",l).fullBox("avc1",function(E){u.push({box:E,newType:r.BOX_TYPE_ENCV_})}).fullBox("avc3",function(E){u.push({box:E,newType:r.BOX_TYPE_ENCV_})}).fullBox("ac-3",function(E){u.push({box:E,newType:r.BOX_TYPE_ENCA_})}).fullBox("ec-3",function(E){u.push({box:E,newType:r.BOX_TYPE_ENCA_})}).fullBox("mp4a",function(E){u.push({box:E,newType:r.BOX_TYPE_ENCA_})}).parse(t),i)return shaka.log.debug("Init segment already indicates encryption."),t;if(u.length==0||!n)throw shaka.log.error("Failed to find boxes needed to fake encryption!"),shaka.log.v2("Failed init segment (hex):",shaka.util.Uint8ArrayUtils.toHex(t)),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.CONTENT_TRANSFORMATION_FAILED);for(u.reverse(),o=$jscomp.makeIterator(u),l=o.next();!l.done;l=o.next()){l=l.value;var m=shaka.util.Mp4Parser.typeToString(l.newType);shaka.log.debug('Inserting "'+m+'" box into init segment.'),t=r.insertEncryptionMetadata_(t,n,l.box,s,l.newType)}return t},shaka.media.ContentWorkarounds.insertEncryptionMetadata_=function(t,r,i,n,s){var o=shaka.media.ContentWorkarounds,l=o.createEncryptionMetadata_(t,i,s);s=new Uint8Array(t.byteLength+l.byteLength),i=shaka.util.Platform.isXboxOne()?i.start:i.start+i.size;var u=t.subarray(0,i);for(t=t.subarray(i),s.set(u),s.set(l,i),s.set(t,i+l.byteLength),n=$jscomp.makeIterator(n),t=n.next();!t.done;t=n.next())t=t.value,goog.asserts.assert(t.start<i,"Ancestor MP4 box found in the wrong location!  Modified init segment will not make sense!"),o.updateBoxSize_(s,t.start,t.size+l.byteLength);return o=shaka.util.BufferUtils.toDataView(s,r.start),r=shaka.util.Mp4Parser.headerSize(r),l=o.getUint32(r),o.setUint32(r,l+1),s},shaka.media.ContentWorkarounds.createEncryptionMetadata_=function(t,r,i){var n=shaka.media.ContentWorkarounds,s=n.CANNED_SINF_BOX_.value(),o=t.subarray(r.start,r.start+r.size),l=shaka.util.BufferUtils.toDataView(o);return t=new Uint8Array(r.size+s.byteLength),t.set(o,0),o=shaka.util.BufferUtils.toDataView(t),o.setUint32(n.BOX_TYPE_OFFSET_,i),t.set(s,r.size),i=l.getUint32(n.BOX_TYPE_OFFSET_),o.setUint32(r.size+n.CANNED_SINF_BOX_FORMAT_OFFSET_,i),n.updateBoxSize_(t,0,t.byteLength),t},shaka.media.ContentWorkarounds.updateBoxSize_=function(t,r,i){var n=shaka.media.ContentWorkarounds;t=shaka.util.BufferUtils.toDataView(t,r),r=t.getUint32(n.BOX_SIZE_OFFSET_),r!=0&&(r==1?(t.setUint32(n.BOX_SIZE_64_OFFSET_,i>>32),t.setUint32(n.BOX_SIZE_64_OFFSET_+4,i&4294967295)):t.setUint32(n.BOX_SIZE_OFFSET_,i))},shaka.media.ContentWorkarounds.CANNED_SINF_BOX_=new shaka.util.Lazy(function(){return new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}),shaka.media.ContentWorkarounds.CANNED_SINF_BOX_FORMAT_OFFSET_=16,shaka.media.ContentWorkarounds.BOX_SIZE_OFFSET_=0,shaka.media.ContentWorkarounds.BOX_TYPE_OFFSET_=4,shaka.media.ContentWorkarounds.BOX_SIZE_64_OFFSET_=8,shaka.media.ContentWorkarounds.BOX_TYPE_ENCV_=1701733238,shaka.media.ContentWorkarounds.BOX_TYPE_ENCA_=1701733217,shaka.cea={},shaka.cea.ICaptionDecoder=function(){},shaka.cea.ICaptionDecoder.prototype.extract=function(t,r){},shaka.cea.ICaptionDecoder.prototype.decode=function(){},shaka.cea.ICaptionDecoder.prototype.clear=function(){},shaka.cea.CeaUtils=function(){},shaka.cea.CeaUtils.getParsedCaption=function(t,r,i,n,s){if(n>=s)return null;for(var o=-1,l=-1,u=0;u<i.length;u++)if(i[u].some(function(H){return H!=null&&H.getChar().trim()!=""})){o=u;break}for(u=i.length-1;0<=u;u--)if(i[u].some(function(H){return H!=null&&H.getChar().trim()!=""})){l=u;break}if(o===-1||l===-1)return null;for(var m=u=!1,E=shaka.cea.CeaUtils.DEFAULT_TXT_COLOR,y=shaka.cea.CeaUtils.DEFAULT_BG_COLOR,D=shaka.cea.CeaUtils.createStyledCue(n,s,u,m,E,y);o<=l;o++){for(var w=i[o],B=-1,F=-1,V=0;V<w.length;V++)if(w[V]!=null&&w[V].getChar().trim()!==""){B=V;break}for(V=w.length-1;0<=V;V--)if(w[V]!=null&&w[V].getChar().trim()!==""){F=V;break}if(B===-1||F===-1)w=shaka.cea.CeaUtils.createLineBreakCue(n,s),t.nestedCues.push(w);else{for(;B<=F;B++)if(V=w[B]){var K=V.isUnderlined(),q=V.isItalicized(),re=V.getTextColor(),ee=V.getBackgroundColor();(K!=u||q!=m||re!=E||ee!=y)&&(D.payload&&t.nestedCues.push(D),D=shaka.cea.CeaUtils.createStyledCue(n,s,K,q,re,ee),u=K,m=q,E=re,y=ee),D.payload+=V.getChar()}else D.payload+=" ";D.payload&&t.nestedCues.push(D),o!==l&&(D=shaka.cea.CeaUtils.createLineBreakCue(n,s),t.nestedCues.push(D)),D=shaka.cea.CeaUtils.createStyledCue(n,s,u,m,E,y)}}return t.nestedCues.length?{cue:t,stream:r}:null},shaka.cea.CeaUtils.createStyledCue=function(t,r,i,n,s,o){return t=new shaka.text.Cue(t,r,""),i&&t.textDecoration.push(shaka.text.Cue.textDecoration.UNDERLINE),n&&(t.fontStyle=shaka.text.Cue.fontStyle.ITALIC),t.color=s,t.backgroundColor=o,t},shaka.cea.CeaUtils.createLineBreakCue=function(t,r){var i=new shaka.text.Cue(t,r,"");return i.lineBreak=!0,i},shaka.cea.CeaUtils.StyledChar=function(t,r,i,n,s){this.character_=t,this.underline_=r,this.italics_=i,this.backgroundColor_=n,this.textColor_=s},shaka.cea.CeaUtils.StyledChar.prototype.getChar=function(){return this.character_},shaka.cea.CeaUtils.StyledChar.prototype.isUnderlined=function(){return this.underline_},shaka.cea.CeaUtils.StyledChar.prototype.isItalicized=function(){return this.italics_},shaka.cea.CeaUtils.StyledChar.prototype.getBackgroundColor=function(){return this.backgroundColor_},shaka.cea.CeaUtils.StyledChar.prototype.getTextColor=function(){return this.textColor_},shaka.cea.CeaUtils.DEFAULT_BG_COLOR="black",shaka.cea.CeaUtils.DEFAULT_TXT_COLOR="white",shaka.cea.Cea608Memory=function(t,r){this.rows_=[],this.row_=1,this.scrollRows_=0,this.fieldNum_=t,this.channelNum_=r,this.italics_=this.underline_=!1,this.textColor_=shaka.cea.CeaUtils.DEFAULT_TXT_COLOR,this.backgroundColor_=shaka.cea.CeaUtils.DEFAULT_BG_COLOR,this.reset()},shaka.cea.Cea608Memory.prototype.forceEmit=function(t,r){var i="CC"+(this.fieldNum_<<1|this.channelNum_+1),n=new shaka.text.Cue(t,r,"");return shaka.cea.CeaUtils.getParsedCaption(n,i,this.rows_,t,r)},shaka.cea.Cea608Memory.prototype.reset=function(){this.resetAllRows(),this.row_=1},shaka.cea.Cea608Memory.prototype.getRow=function(){return this.row_},shaka.cea.Cea608Memory.prototype.setRow=function(t){this.row_=t},shaka.cea.Cea608Memory.prototype.getScrollSize=function(){return this.scrollRows_},shaka.cea.Cea608Memory.prototype.setScrollSize=function(t){this.scrollRows_=t},shaka.cea.Cea608Memory.prototype.addChar=function(t,r){if(!(32>r||127<r)){var i="";switch(t){case shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN:i=shaka.cea.Cea608Memory.CharSet.BasicNorthAmericanChars.has(r)?shaka.cea.Cea608Memory.CharSet.BasicNorthAmericanChars.get(r):String.fromCharCode(r);break;case shaka.cea.Cea608Memory.CharSet.SPECIAL_NORTH_AMERICAN:i=shaka.cea.Cea608Memory.CharSet.SpecialNorthAmericanChars.get(r);break;case shaka.cea.Cea608Memory.CharSet.SPANISH_FRENCH:this.eraseChar(),i=shaka.cea.Cea608Memory.CharSet.ExtendedSpanishFrench.get(r);break;case shaka.cea.Cea608Memory.CharSet.PORTUGUESE_GERMAN:this.eraseChar(),i=shaka.cea.Cea608Memory.CharSet.ExtendedPortugueseGerman.get(r)}i&&(i=new shaka.cea.CeaUtils.StyledChar(i,this.underline_,this.italics_,this.backgroundColor_,this.textColor_),this.rows_[this.row_].push(i))}},shaka.cea.Cea608Memory.prototype.eraseChar=function(){this.rows_[this.row_].pop()},shaka.cea.Cea608Memory.prototype.moveRows=function(t,r,i){if(t>=r)for(--i;0<=i;i--)this.rows_[t+i]=this.rows_[r+i].map(function(s){return s});else for(var n=0;n<i;n++)this.rows_[t+n]=this.rows_[r+n].map(function(s){return s})},shaka.cea.Cea608Memory.prototype.resetRows=function(t,r){for(var i=0;i<=r;i++)this.rows_[t+i]=[]},shaka.cea.Cea608Memory.prototype.resetAllRows=function(){this.resetRows(0,shaka.cea.Cea608Memory.CC_ROWS)},shaka.cea.Cea608Memory.prototype.eraseBuffer=function(){this.row_=0<this.scrollRows_?this.scrollRows_:0,this.resetAllRows()},shaka.cea.Cea608Memory.prototype.setUnderline=function(t){this.underline_=t},shaka.cea.Cea608Memory.prototype.setItalics=function(t){this.italics_=t},shaka.cea.Cea608Memory.prototype.setTextColor=function(t){this.textColor_=t},shaka.cea.Cea608Memory.prototype.setBackgroundColor=function(t){this.backgroundColor_=t},shaka.cea.Cea608Memory.CC_ROWS=15,shaka.cea.Cea608Memory.CharSet={BASIC_NORTH_AMERICAN:0,SPECIAL_NORTH_AMERICAN:1,SPANISH_FRENCH:2,PORTUGUESE_GERMAN:3},shaka.cea.Cea608Memory.CharSet.BasicNorthAmericanChars=new Map([[39,"\u2019"],[42,"\xE1"],[92,"\xE9"],[92,"\xE9"],[94,"\xED"],[95,"\xF3"],[96,"\xFA"],[123,"\xE7"],[124,"\xF7"],[125,"\xD1"],[126,"\xF1"],[127,"\u2588"]]),shaka.cea.Cea608Memory.CharSet.SpecialNorthAmericanChars=new Map([[48,"\xAE"],[49,"\xB0"],[50,"\xBD"],[51,"\xBF"],[52,"\u2122"],[53,"\xA2"],[54,"\xA3"],[55,"\u266A"],[56,"\xE0"],[57,"\u2800"],[58,"\xE8"],[59,"\xE2"],[60,"\xEA"],[61,"\xEE"],[62,"\xF4"],[63,"\xFB"]]),shaka.cea.Cea608Memory.CharSet.ExtendedSpanishFrench=new Map([[32,"\xC1"],[33,"\xC9"],[34,"\xD3"],[35,"\xDA"],[36,"\xDC"],[37,"\xFC"],[38,"\u2018"],[39,"\xA1"],[40,"*"],[41,"'"],[42,"\u2500"],[43,"\xA9"],[44,"\u2120"],[45,"\xB7"],[46,"\u201C"],[47,"\u201D"],[48,"\xC0"],[49,"\xC2"],[50,"\xC7"],[51,"\xC8"],[52,"\xCA"],[53,"\xCB"],[54,"\xEB"],[55,"\xCE"],[56,"\xCF"],[57,"\xEF"],[58,"\xD4"],[59,"\xD9"],[60,"\xF9"],[61,"\xDB"],[62,"\xAB"],[63,"\xBB"]]),shaka.cea.Cea608Memory.CharSet.ExtendedPortugueseGerman=new Map([[32,"\xC3"],[33,"\xE3"],[34,"\xCD"],[35,"\xCC"],[36,"\xEC"],[37,"\xD2"],[38,"\xF2"],[39,"\xD5"],[40,"\xF5"],[41,"{"],[42,"}"],[43,"\\"],[44,"^"],[45,"_"],[46,"|"],[47,"~"],[48,"\xC4"],[49,"\xE4"],[50,"\xD6"],[51,"\xF6"],[52,"\xDF"],[53,"\xA5"],[54,"\xA4"],[55,"\u2502"],[56,"\xC5"],[57,"\xE5"],[58,"\xD8"],[59,"\xF8"],[60,"\u250C"],[61,"\u2510"],[62,"\u2514"],[63,"\u2518"]]),shaka.cea.Cea608DataChannel=function(t,r){this.type_=shaka.cea.Cea608DataChannel.CaptionType.NONE,this.text_=new shaka.cea.Cea608Memory(t,r),this.displayedMemory_=new shaka.cea.Cea608Memory(t,r),this.nonDisplayedMemory_=new shaka.cea.Cea608Memory(t,r),this.curbuf_=this.displayedMemory_,this.prevEndTime_=0,this.lastcp_=null},shaka.cea.Cea608DataChannel.prototype.reset=function(){this.type_=shaka.cea.Cea608DataChannel.CaptionType.PAINTON,this.curbuf_=this.displayedMemory_,this.lastcp_=null,this.displayedMemory_.reset(),this.nonDisplayedMemory_.reset(),this.text_.reset()},shaka.cea.Cea608DataChannel.prototype.pacToRow_=function(t,r){return[11,11,1,2,3,4,12,13,14,15,5,6,7,8,9,10][(t&7)<<1|r>>5&1]},shaka.cea.Cea608DataChannel.prototype.controlPac_=function(t,r){var i=this.pacToRow_(t,r),n=(r&30)>>1,s=shaka.cea.CeaUtils.DEFAULT_TXT_COLOR,o=!1;if(7>n?s=shaka.cea.Cea608DataChannel.TEXT_COLORS[n]:n===7&&(o=!0),n=(r&1)===1,this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT){var l=this.curbuf_;if(this.type_===shaka.cea.Cea608DataChannel.CaptionType.ROLLUP&&i!==l.getRow()){var u=1+l.getRow()-l.getScrollSize(),m=1+i-l.getScrollSize();l.moveRows(m,u,l.getScrollSize()),l.resetRows(0,m-1),l.resetRows(i+1,shaka.cea.Cea608Memory.CC_ROWS-i)}l.setRow(i),this.curbuf_.setUnderline(n),this.curbuf_.setItalics(o),this.curbuf_.setTextColor(s),this.curbuf_.setBackgroundColor(shaka.cea.CeaUtils.DEFAULT_BG_COLOR)}},shaka.cea.Cea608DataChannel.prototype.controlMidrow_=function(t){this.curbuf_.setUnderline(!1),this.curbuf_.setItalics(!1),this.curbuf_.setTextColor(shaka.cea.CeaUtils.DEFAULT_TXT_COLOR),this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,32);var r=!1,i=shaka.cea.Cea608DataChannel.TEXT_COLORS[(t&14)>>1];i==="white_italics"&&(i="white",r=!0),this.curbuf_.setUnderline((t&1)===1),this.curbuf_.setItalics(r),this.curbuf_.setTextColor(i)},shaka.cea.Cea608DataChannel.prototype.controlBackgroundAttribute_=function(t,r){var i=shaka.cea.CeaUtils.DEFAULT_BG_COLOR;!(t&7)&&(i=shaka.cea.Cea608DataChannel.BG_COLORS[(r&14)>>1]),this.curbuf_.setBackgroundColor(i)},shaka.cea.Cea608DataChannel.prototype.controlMiscellaneous_=function(t){var r=shaka.cea.Cea608DataChannel.MiscCmd_,i=t.pts,n=null;switch(t.ccData2){case r.RCL:this.controlRcl_();break;case r.BS:this.controlBs_();break;case r.RU2:n=this.controlRu_(2,i);break;case r.RU3:n=this.controlRu_(3,i);break;case r.RU4:n=this.controlRu_(4,i);break;case r.FON:this.controlFon_();break;case r.RDC:this.controlRdc_(i);break;case r.TR:this.controlTr_();break;case r.RTD:this.controlRtd_();break;case r.EDM:n=this.controlEdm_(i);break;case r.CR:n=this.controlCr_(i);break;case r.ENM:this.controlEnm_();break;case r.EOC:n=this.controlEoc_(i)}return n},shaka.cea.Cea608DataChannel.prototype.controlCr_=function(t){var r=this.curbuf_;if(this.type_!==shaka.cea.Cea608DataChannel.CaptionType.ROLLUP)return null;var i=r.forceEmit(this.prevEndTime_,t),n=r.getRow()-r.getScrollSize()+1;return r.moveRows(n-1,n,r.getScrollSize()),r.resetRows(0,n-1),r.resetRows(r.getRow(),shaka.cea.Cea608Memory.CC_ROWS-r.getRow()),this.prevEndTime_=t,i},shaka.cea.Cea608DataChannel.prototype.controlRu_=function(t,r){var i=this.curbuf_=this.displayedMemory_,n=null;return this.type_!==shaka.cea.Cea608DataChannel.CaptionType.ROLLUP&&this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT&&(n=i.forceEmit(this.prevEndTime_,r),this.displayedMemory_.eraseBuffer(),this.nonDisplayedMemory_.eraseBuffer(),i.setRow(shaka.cea.Cea608Memory.CC_ROWS)),this.type_=shaka.cea.Cea608DataChannel.CaptionType.ROLLUP,i.setScrollSize(t),n},shaka.cea.Cea608DataChannel.prototype.controlFon_=function(){this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,32)},shaka.cea.Cea608DataChannel.prototype.controlEdm_=function(t){var r=this.displayedMemory_,i=null;return this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT&&(i=r.forceEmit(this.prevEndTime_,t)),r.resetAllRows(),i},shaka.cea.Cea608DataChannel.prototype.controlRdc_=function(t){this.type_=shaka.cea.Cea608DataChannel.CaptionType.PAINTON,this.curbuf_=this.displayedMemory_,this.curbuf_.setScrollSize(0),this.prevEndTime_=t},shaka.cea.Cea608DataChannel.prototype.controlEnm_=function(){this.nonDisplayedMemory_.resetAllRows()},shaka.cea.Cea608DataChannel.prototype.controlEoc_=function(t){var r=null;this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT&&(r=this.displayedMemory_.forceEmit(this.prevEndTime_,t));var i=this.nonDisplayedMemory_;return this.nonDisplayedMemory_=this.displayedMemory_,this.displayedMemory_=i,this.controlRcl_(),this.prevEndTime_=t,r},shaka.cea.Cea608DataChannel.prototype.controlRcl_=function(){this.type_=shaka.cea.Cea608DataChannel.CaptionType.POPON,this.curbuf_=this.nonDisplayedMemory_,this.curbuf_.setScrollSize(0)},shaka.cea.Cea608DataChannel.prototype.controlBs_=function(){this.curbuf_.eraseChar()},shaka.cea.Cea608DataChannel.prototype.controlTr_=function(){this.text_.reset(),this.controlRtd_()},shaka.cea.Cea608DataChannel.prototype.controlRtd_=function(){shaka.log.warnOnce("Cea608DataChannel","CEA-608 text mode entered, but is unsupported"),this.curbuf_=this.text_,this.type_=shaka.cea.Cea608DataChannel.CaptionType.TEXT},shaka.cea.Cea608DataChannel.prototype.handleBasicNorthAmericanChar=function(t,r){this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,t),this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,r)},shaka.cea.Cea608DataChannel.prototype.handleExtendedWesternEuropeanChar_=function(t,r){this.curbuf_.addChar(t&1?shaka.cea.Cea608Memory.CharSet.PORTUGUESE_GERMAN:shaka.cea.Cea608Memory.CharSet.SPANISH_FRENCH,r)},shaka.cea.Cea608DataChannel.prototype.handleControlCode=function(t){var r=t.ccData1,i=t.ccData2;if(this.lastcp_===(r<<8|i))return this.lastcp_=null;if(this.lastcp_=r<<8|i,this.isPAC_(r,i))this.controlPac_(r,i);else if(this.isMidrowStyleChange_(r,i))this.controlMidrow_(i);else if(this.isBackgroundAttribute_(r,i))this.controlBackgroundAttribute_(r,i);else if(this.isSpecialNorthAmericanChar_(r,i))this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.SPECIAL_NORTH_AMERICAN,i);else if(this.isExtendedWesternEuropeanChar_(r,i))this.handleExtendedWesternEuropeanChar_(r,i);else if(this.isMiscellaneous_(r,i))return this.controlMiscellaneous_(t);return null},shaka.cea.Cea608DataChannel.prototype.isMiscellaneous_=function(t,r){return(t&246)===20&&(r&240)===32},shaka.cea.Cea608DataChannel.prototype.isPAC_=function(t,r){return(t&240)===16&&(r&192)===64},shaka.cea.Cea608DataChannel.prototype.isMidrowStyleChange_=function(t,r){return(t&247)===17&&(r&240)===32},shaka.cea.Cea608DataChannel.prototype.isBackgroundAttribute_=function(t,r){return(t&247)===16&&(r&240)===32||(t&247)===23&&(r&255)===45},shaka.cea.Cea608DataChannel.prototype.isSpecialNorthAmericanChar_=function(t,r){return(t&247)===17&&(r&240)===48},shaka.cea.Cea608DataChannel.prototype.isExtendedWesternEuropeanChar_=function(t,r){return(t&246)===18&&(r&224)===32},shaka.cea.Cea608DataChannel.isControlCode=function(t){return(t&112)===16},shaka.cea.Cea608DataChannel.MiscCmd_={RCL:32,BS:33,AOD:34,AON:35,DER:36,RU2:37,RU3:38,RU4:39,FON:40,RDC:41,TR:42,RTD:43,EDM:44,CR:45,ENM:46,EOC:47},shaka.cea.Cea608DataChannel.CaptionType={NONE:0,POPON:1,PAINTON:2,ROLLUP:3,TEXT:4},shaka.cea.Cea608DataChannel.BG_COLORS="black green blue cyan red yellow magenta black".split(" "),shaka.cea.Cea608DataChannel.TEXT_COLORS="white green blue cyan red yellow magenta white_italics".split(" "),shaka.cea.Cea708Window=function(t){this.windowNum_=t,this.relativeToggle_=this.visible_=!1,this.colCount_=this.rowCount_=this.anchorId_=this.verticalAnchor_=this.horizontalAnchor_=0,this.justification_=shaka.cea.Cea708Window.TextJustification.CENTER,this.memory_=[],this.col_=this.row_=this.startTime_=0,this.underline_=this.italics_=!1,this.textColor_=shaka.cea.CeaUtils.DEFAULT_TXT_COLOR,this.backgroundColor_=shaka.cea.CeaUtils.DEFAULT_BG_COLOR,this.resetMemory(),shaka.util.Functional.ignored(this.verticalAnchor_,this.relativeToggle_,this.horizontalAnchor_,this.anchorId_,this.windowNum_)},shaka.cea.Cea708Window.prototype.defineWindow=function(t,r,i,n,s,o,l){this.visible_=t,this.verticalAnchor_=r,this.horizontalAnchor_=i,this.anchorId_=n,this.relativeToggle_=s,this.rowCount_=o,this.colCount_=l},shaka.cea.Cea708Window.prototype.resetMemory=function(){this.memory_=[];for(var t=0;t<shaka.cea.Cea708Window.MAX_ROWS;t++)this.memory_.push(this.createNewRow_())},shaka.cea.Cea708Window.prototype.createNewRow_=function(){for(var t=[],r=0;r<shaka.cea.Cea708Window.MAX_COLS;r++)t.push(null);return t},shaka.cea.Cea708Window.prototype.setCharacter=function(t){this.isPenInBounds_()&&(t=new shaka.cea.CeaUtils.StyledChar(t,this.underline_,this.italics_,this.backgroundColor_,this.textColor_),this.memory_[this.row_][this.col_]=t,this.col_++)},shaka.cea.Cea708Window.prototype.backspace=function(){!this.isPenInBounds_()||0>=this.col_&&0>=this.row_||(0>=this.col_?(this.col_=this.colCount_-1,this.row_--):this.col_--,this.memory_[this.row_][this.col_]=null)},shaka.cea.Cea708Window.prototype.isPenInBounds_=function(){var t=this.col_<this.colCount_&&0<=this.col_;return this.row_<this.rowCount_&&0<=this.row_&&t},shaka.cea.Cea708Window.prototype.isVisible=function(){return this.visible_},shaka.cea.Cea708Window.prototype.moveUpRows_=function(t){for(var r=0,i=t;i<shaka.cea.Cea708Window.MAX_ROWS;i++,r++)this.memory_[r]=this.memory_[i];for(i=0;i<t;i++,r++)this.memory_[r]=this.createNewRow_()},shaka.cea.Cea708Window.prototype.carriageReturn=function(){this.row_+1>=this.rowCount_?this.moveUpRows_(1):this.row_++,this.col_=0},shaka.cea.Cea708Window.prototype.horizontalCarriageReturn=function(){this.memory_[this.row_]=this.createNewRow_(),this.col_=0},shaka.cea.Cea708Window.prototype.forceEmit=function(t,r){var i="svc"+r,n=shaka.cea.Cea708Window.TextJustification,s=new shaka.text.Cue(this.startTime_,t,"");return s.textAlign=this.justification_===n.LEFT?shaka.text.Cue.textAlign.LEFT:this.justification_===n.RIGHT?shaka.text.Cue.textAlign.RIGHT:shaka.text.Cue.textAlign.CENTER,(i=shaka.cea.CeaUtils.getParsedCaption(s,i,this.memory_,this.startTime_,t))&&this.setStartTime(t),i},shaka.cea.Cea708Window.prototype.setPenLocation=function(t,r){this.row_=t,this.col_=r},shaka.cea.Cea708Window.prototype.setPenBackgroundColor=function(t){this.backgroundColor_=t},shaka.cea.Cea708Window.prototype.setPenTextColor=function(t){this.textColor_=t},shaka.cea.Cea708Window.prototype.setPenUnderline=function(t){this.underline_=t},shaka.cea.Cea708Window.prototype.setPenItalics=function(t){this.italics_=t},shaka.cea.Cea708Window.prototype.resetPen=function(){this.col_=this.row_=0,this.italics_=this.underline_=!1,this.textColor_=shaka.cea.CeaUtils.DEFAULT_TXT_COLOR,this.backgroundColor_=shaka.cea.CeaUtils.DEFAULT_BG_COLOR},shaka.cea.Cea708Window.prototype.setJustification=function(t){this.justification_=t},shaka.cea.Cea708Window.prototype.display=function(){this.visible_=!0},shaka.cea.Cea708Window.prototype.hide=function(){this.visible_=!1},shaka.cea.Cea708Window.prototype.toggle=function(){this.visible_=!this.visible_},shaka.cea.Cea708Window.prototype.setStartTime=function(t){this.startTime_=t},shaka.cea.Cea708Window.TextJustification={LEFT:0,RIGHT:1,CENTER:2,FULL:3},shaka.cea.Cea708Window.MAX_COLS=42,shaka.cea.Cea708Window.MAX_ROWS=15,shaka.cea.DtvccPacketBuilder=function(){this.builtPackets_=[],this.currentPacketBeingBuilt_=null,this.bytesLeftToAddInCurrentPacket_=0},shaka.cea.DtvccPacketBuilder.prototype.addByte=function(t){t.type===shaka.cea.DtvccPacketBuilder.DTVCC_PACKET_START?(this.bytesLeftToAddInCurrentPacket_=2*(t.value&63)-1,this.currentPacketBeingBuilt_=[]):this.currentPacketBeingBuilt_&&(0<this.bytesLeftToAddInCurrentPacket_&&(this.currentPacketBeingBuilt_.push(t),this.bytesLeftToAddInCurrentPacket_--),this.bytesLeftToAddInCurrentPacket_===0&&(t=new shaka.cea.DtvccPacket(this.currentPacketBeingBuilt_),this.builtPackets_.push(t),this.currentPacketBeingBuilt_=null,this.bytesLeftToAddInCurrentPacket_=0))},shaka.cea.DtvccPacketBuilder.prototype.getBuiltPackets=function(){return this.builtPackets_},shaka.cea.DtvccPacketBuilder.prototype.clearBuiltPackets=function(){this.builtPackets_=[]},shaka.cea.DtvccPacketBuilder.prototype.clear=function(){this.builtPackets_=[],this.currentPacketBeingBuilt_=[],this.bytesLeftToAddInCurrentPacket_=0},shaka.cea.DtvccPacket=function(t){this.pos_=0,this.packetData_=t},shaka.cea.DtvccPacket.prototype.hasMoreData=function(){return this.pos_<this.packetData_.length},shaka.cea.DtvccPacket.prototype.getPosition=function(){return this.pos_},shaka.cea.DtvccPacket.prototype.readByte=function(){if(!this.hasMoreData())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS);return this.packetData_[this.pos_++]},shaka.cea.DtvccPacket.prototype.skip=function(t){if(this.pos_+t>this.packetData_.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS);this.pos_+=t},shaka.cea.DtvccPacketBuilder.DTVCC_PACKET_DATA=2,shaka.cea.DtvccPacketBuilder.DTVCC_PACKET_START=3,shaka.cea.Cea708Service=function(t){this.serviceNumber_=t,this.windows_=[null,null,null,null,null,null,null,null],this.currentWindow_=null},shaka.cea.Cea708Service.prototype.handleCea708ControlCode=function(t){var r=t.readByte(),i=r.value;if(r=r.pts,i===shaka.cea.Cea708Service.EXT_CEA708_CTRL_CODE_BYTE1){var n=t.readByte();i=i<<16|n.value}return 0<=i&&31>=i?this.handleC0_(i,r):128<=i&&159>=i?this.handleC1_(t,i,r):(4096<=i&&4127>=i?this.handleC2_(t,i&255):4224<=i&&4255>=i?this.handleC3_(t,i&255):32<=i&&127>=i?this.handleG0_(i):160<=i&&255>=i?this.handleG1_(i):4128<=i&&4223>=i?this.handleG2_(i&255):4256<=i&&4351>=i&&this.handleG3_(i&255),null)},shaka.cea.Cea708Service.prototype.handleG0_=function(t){this.currentWindow_&&(t===127?this.currentWindow_.setCharacter("\u266A"):this.currentWindow_.setCharacter(String.fromCharCode(t)))},shaka.cea.Cea708Service.prototype.handleG1_=function(t){this.currentWindow_&&this.currentWindow_.setCharacter(String.fromCharCode(t))},shaka.cea.Cea708Service.prototype.handleG2_=function(t){this.currentWindow_&&(shaka.cea.Cea708Service.G2Charset.has(t)?(t=shaka.cea.Cea708Service.G2Charset.get(t),this.currentWindow_.setCharacter(t)):this.currentWindow_.setCharacter("_"))},shaka.cea.Cea708Service.prototype.handleG3_=function(t){this.currentWindow_&&(t!=160?this.currentWindow_.setCharacter("_"):this.currentWindow_.setCharacter("[CC]"))},shaka.cea.Cea708Service.prototype.handleC0_=function(t,r){if(!this.currentWindow_)return null;var i=this.currentWindow_,n=null;switch(t){case shaka.cea.Cea708Service.ASCII_BACKSPACE:i.backspace();break;case shaka.cea.Cea708Service.ASCII_CARRIAGE_RETURN:i.isVisible()&&(n=i.forceEmit(r,this.serviceNumber_)),i.carriageReturn();break;case shaka.cea.Cea708Service.ASCII_HOR_CARRIAGE_RETURN:i.isVisible()&&(n=i.forceEmit(r,this.serviceNumber_)),i.horizontalCarriageReturn();break;case shaka.cea.Cea708Service.ASCII_FORM_FEED:i.isVisible()&&(n=i.forceEmit(r,this.serviceNumber_)),i.resetMemory(),i.setPenLocation(0,0)}return n},shaka.cea.Cea708Service.prototype.handleC1_=function(t,r,i){if(128<=r&&135>=r)this.setCurrentWindow_(r&7);else{if(r===136)return t=t.readByte().value,this.clearWindows_(t,i);if(r===137)t=t.readByte().value,this.displayWindows_(t,i);else{if(r===138)return t=t.readByte().value,this.hideWindows_(t,i);if(r===139)return t=t.readByte().value,this.toggleWindows_(t,i);if(r===140)return t=t.readByte().value,this.deleteWindows_(t,i);if(r===143)return this.reset_(i);r===144?this.setPenAttributes_(t):r===145?this.setPenColor_(t):r===146?this.setPenLocation_(t):r===151?this.setWindowAttributes_(t):152<=r&&159>=r&&this.defineWindow_(t,(r&15)-8,i)}}return null},shaka.cea.Cea708Service.prototype.handleC2_=function(t,r){8<=r&&15>=r?t.skip(1):16<=r&&23>=r?t.skip(2):24<=r&&31>=r&&t.skip(3)},shaka.cea.Cea708Service.prototype.handleC3_=function(t,r){128<=r&&135>=r?t.skip(4):136<=r&&143>=r&&t.skip(5)},shaka.cea.Cea708Service.prototype.setCurrentWindow_=function(t){this.windows_[t]&&(this.currentWindow_=this.windows_[t])},shaka.cea.Cea708Service.prototype.getSpecifiedWindowIds_=function(t){for(var r=[],i=0;8>i;i++)(t&1)===1&&this.windows_[i]&&r.push(i),t>>=1;return r},shaka.cea.Cea708Service.prototype.clearWindows_=function(t,r){for(var i=null,n=$jscomp.makeIterator(this.getSpecifiedWindowIds_(t)),s=n.next();!s.done;s=n.next())s=this.windows_[s.value],s.isVisible()&&(i=s.forceEmit(r,this.serviceNumber_)),s.resetMemory();return i},shaka.cea.Cea708Service.prototype.displayWindows_=function(t,r){for(var i=$jscomp.makeIterator(this.getSpecifiedWindowIds_(t)),n=i.next();!n.done;n=i.next())n=this.windows_[n.value],n.isVisible()||n.setStartTime(r),n.display()},shaka.cea.Cea708Service.prototype.hideWindows_=function(t,r){for(var i=null,n=$jscomp.makeIterator(this.getSpecifiedWindowIds_(t)),s=n.next();!s.done;s=n.next())s=this.windows_[s.value],s.isVisible()&&(i=s.forceEmit(r,this.serviceNumber_)),s.hide();return i},shaka.cea.Cea708Service.prototype.toggleWindows_=function(t,r){for(var i=null,n=$jscomp.makeIterator(this.getSpecifiedWindowIds_(t)),s=n.next();!s.done;s=n.next())s=this.windows_[s.value],s.isVisible()?i=s.forceEmit(r,this.serviceNumber_):s.setStartTime(r),s.toggle();return i},shaka.cea.Cea708Service.prototype.deleteWindows_=function(t,r){for(var i=null,n=$jscomp.makeIterator(this.getSpecifiedWindowIds_(t)),s=n.next();!s.done;s=n.next()){s=s.value;var o=this.windows_[s];o.isVisible()&&(i=o.forceEmit(r,this.serviceNumber_)),this.windows_[s]=null}return i},shaka.cea.Cea708Service.prototype.reset_=function(t){return t=this.deleteWindows_(255,t),this.clear(),t},shaka.cea.Cea708Service.prototype.clear=function(){this.currentWindow_=null,this.windows_=[null,null,null,null,null,null,null,null]},shaka.cea.Cea708Service.prototype.setPenAttributes_=function(t){if(t.skip(1),t=t.readByte().value,this.currentWindow_){var r=0<(t&64);this.currentWindow_.setPenItalics(0<(t&128)),this.currentWindow_.setPenUnderline(r)}},shaka.cea.Cea708Service.prototype.setPenColor_=function(t){var r=t.readByte().value,i=t.readByte().value;if(t.skip(1),this.currentWindow_){t=i&3;var n=(i&12)>>2;i=(i&48)>>4,r=this.rgbColorToHex_((r&48)>>4,(r&12)>>2,r&3),t=this.rgbColorToHex_(i,n,t),this.currentWindow_.setPenTextColor(r),this.currentWindow_.setPenBackgroundColor(t)}},shaka.cea.Cea708Service.prototype.setPenLocation_=function(t){var r=t.readByte().value;t=t.readByte().value,this.currentWindow_&&this.currentWindow_.setPenLocation(r&15,t&63)},shaka.cea.Cea708Service.prototype.setWindowAttributes_=function(t){t.skip(1),t.skip(1);var r=t.readByte().value;t.skip(1),this.currentWindow_&&this.currentWindow_.setJustification(r&3)},shaka.cea.Cea708Service.prototype.defineWindow_=function(t,r,i){var n=this.windows_[r]!==null;if(!n){var s=new shaka.cea.Cea708Window(r);s.setStartTime(i),this.windows_[r]=s}var o=t.readByte().value,l=t.readByte().value;i=t.readByte().value;var u=t.readByte().value;s=t.readByte().value,t=t.readByte().value,o=0<(o&32);var m=l&127;l=0<(l&128);var E=(u&15)+1;u=(u&240)>>4,s=(s&63)+1,n&&!(t&7)||this.windows_[r].resetPen(),this.windows_[r].defineWindow(o,m,i,u,l,E,s),this.currentWindow_=this.windows_[r]},shaka.cea.Cea708Service.prototype.rgbColorToHex_=function(t,r,i){var n={0:0,1:0,2:1,3:1};return t=n[t],r=n[r],i=n[i],shaka.cea.Cea708Service.Colors[t<<2|r<<1|i]},shaka.cea.Cea708Service.ASCII_BACKSPACE=8,shaka.cea.Cea708Service.ASCII_FORM_FEED=12,shaka.cea.Cea708Service.ASCII_CARRIAGE_RETURN=13,shaka.cea.Cea708Service.ASCII_HOR_CARRIAGE_RETURN=14,shaka.cea.Cea708Service.EXT_CEA708_CTRL_CODE_BYTE1=16,shaka.cea.Cea708Service.G2Charset=new Map([[32," "],[33,"\xA0"],[37,"\u2026"],[42,"\u0160"],[44,"\u0152"],[48,"\u2588"],[49,"\u2018"],[50,"\u2019"],[51,"\u201C"],[52,"\u201D"],[53,"\u2022"],[57,"\u2122"],[58,"\u0161"],[60,"\u0153"],[61,"\u2120"],[63,"\u0178"],[118,"\u215B"],[119,"\u215C"],[120,"\u215D"],[121,"\u215E"],[122,"\u2502"],[123,"\u2510"],[124,"\u2514"],[125,"\u2500"],[126,"\u2518"],[127,"\u250C"]]),shaka.cea.Cea708Service.Colors="black blue green cyan red magenta yellow white".split(" "),shaka.cea.CeaDecoder=function(){this.cea608DataArray_=[],this.cea708DataArray_=[],this.dtvccPacketBuilder_=new shaka.cea.DtvccPacketBuilder,this.badFrames_=0,this.cea608ModeToStream_=new Map([["CC1",new shaka.cea.Cea608DataChannel(0,0)],["CC2",new shaka.cea.Cea608DataChannel(0,1)],["CC3",new shaka.cea.Cea608DataChannel(1,0)],["CC4",new shaka.cea.Cea608DataChannel(1,1)]]),this.currentField2Channel_=this.currentField1Channel_=0,this.serviceNumberToService_=new Map,this.reset()},shaka.cea.CeaDecoder.prototype.clear=function(){this.badFrames_=0,this.cea608DataArray_=[],this.cea708DataArray_=[],this.dtvccPacketBuilder_.clear(),this.reset();for(var t=$jscomp.makeIterator(this.serviceNumberToService_.values()),r=t.next();!r.done;r=t.next())r.value.clear()},shaka.cea.CeaDecoder.prototype.reset=function(){this.currentField2Channel_=this.currentField1Channel_=0;for(var t=$jscomp.makeIterator(this.cea608ModeToStream_.values()),r=t.next();!r.done;r=t.next())r.value.reset()},shaka.cea.CeaDecoder.prototype.extract=function(t,r){var i=new shaka.util.DataViewReader(t,shaka.util.DataViewReader.Endianness.BIG_ENDIAN);if(i.readUint8()===shaka.cea.CeaDecoder.USA_COUNTRY_CODE&&i.readUint16()===shaka.cea.CeaDecoder.ATSC_PROVIDER_CODE&&i.readUint32()===shaka.cea.CeaDecoder.ATSC1_USER_IDENTIFIER&&i.readUint8()===3){var n=i.readUint8();if(n&64){n&=31,i.skip(1);for(var s=0;s<n;s++){var o=i.readUint8(),l=(o&4)>>2,u=i.readUint8(),m=i.readUint8();l&&(o&=3,o===shaka.cea.CeaDecoder.NTSC_CC_FIELD_1||o===shaka.cea.CeaDecoder.NTSC_CC_FIELD_2?this.cea608DataArray_.push({pts:r,type:o,ccData1:u,ccData2:m,order:this.cea608DataArray_.length}):(this.cea708DataArray_.push({pts:r,type:o,value:u,order:this.cea708DataArray_.length}),this.cea708DataArray_.push({pts:r,type:shaka.cea.DtvccPacketBuilder.DTVCC_PACKET_DATA,value:m,order:this.cea708DataArray_.length})))}}}},shaka.cea.CeaDecoder.prototype.decode=function(){var t=[],r=function(n,s){return n.pts-s.pts||n.order-s.order};this.cea608DataArray_.sort(r),this.cea708DataArray_.sort(r),r=$jscomp.makeIterator(this.cea608DataArray_);for(var i=r.next();!i.done;i=r.next())(i=this.decodeCea608_(i.value))&&t.push(i);for(r=$jscomp.makeIterator(this.cea708DataArray_),i=r.next();!i.done;i=r.next())this.dtvccPacketBuilder_.addByte(i.value);for(r=this.dtvccPacketBuilder_.getBuiltPackets(),r=$jscomp.makeIterator(r),i=r.next();!i.done;i=r.next())i=this.decodeCea708_(i.value),t.push.apply(t,$jscomp.arrayFromIterable(i));return this.dtvccPacketBuilder_.clearBuiltPackets(),this.cea608DataArray_=[],this.cea708DataArray_=[],t},shaka.cea.CeaDecoder.prototype.decodeCea608_=function(t){var r=t.type;if(shaka.cea.Cea608DataChannel.isControlCode(t.ccData1)){var i=t.ccData1>>3&1;r===0?this.currentField1Channel_=i:this.currentField2Channel_=i}return r=this.cea608ModeToStream_.get("CC"+(r<<1|(r?this.currentField2Channel_:this.currentField1Channel_)+1)),t.ccData1===255&&t.ccData2===255||!t.ccData1&&!t.ccData2||!this.isOddParity_(t.ccData1)||!this.isOddParity_(t.ccData2)?(45<=++this.badFrames_&&this.reset(),null):(this.badFrames_=0,t.ccData1&=127,t.ccData2&=127,!t.ccData1&&!t.ccData2?null:(i=null,shaka.cea.Cea608DataChannel.isControlCode(t.ccData1)?i=r.handleControlCode(t):r.handleBasicNorthAmericanChar(t.ccData1,t.ccData2),i))},shaka.cea.CeaDecoder.prototype.decodeCea708_=function(t){var r=[];try{for(;t.hasMoreData();){var i=t.readByte().value,n=(i&224)>>5,s=i&31;if(n===7&&s!=0&&(n=t.readByte().value&63),n!=0){if(!this.serviceNumberToService_.has(n)){var o=new shaka.cea.Cea708Service(n);this.serviceNumberToService_.set(n,o)}for(var l=this.serviceNumberToService_.get(n),u=t.getPosition();t.getPosition()-u<s;){var m=l.handleCea708ControlCode(t);m&&r.push(m)}}}}catch(E){if(E instanceof shaka.util.Error&&E.code===shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS)shaka.log.warnOnce("CEA708_INVALID_DATA","Buffer read out of bounds / invalid CEA-708 Data.");else throw E}return r},shaka.cea.CeaDecoder.prototype.isOddParity_=function(t){for(var r=0;t;)r^=t&1,t>>=1;return r===1},shaka.cea.CeaDecoder.ATSC_PROVIDER_CODE=49,shaka.cea.CeaDecoder.ATSC1_USER_IDENTIFIER=1195456820,shaka.cea.CeaDecoder.NTSC_CC_FIELD_1=0,shaka.cea.CeaDecoder.NTSC_CC_FIELD_2=1,shaka.cea.CeaDecoder.USA_COUNTRY_CODE=181,shaka.cea.ICeaParser=function(){},shaka.cea.ICeaParser.prototype.init=function(t){},shaka.cea.ICeaParser.prototype.parse=function(t){},shaka.cea.ICeaParser.NALU_TYPE_SEI=6,shaka.cea.ICeaParser.DEFAULT_TIMESCALE_VALUE=9e4,shaka.cea.SeiProcessor=function(){},shaka.cea.SeiProcessor.prototype.process=function(t){var r=[];t=this.removeEmu(t);for(var i=0;i<t.length;){for(var n=0;t[i]==255;)n+=255,i++;n+=t[i++];for(var s=0;t[i]==255;)s+=255,i++;s+=t[i++],n==4&&r.push(t.subarray(i,i+s)),i+=s}return r},shaka.cea.SeiProcessor.prototype.removeEmu=function(t){for(var r=t,i=t=0;i<r.length;)t==2&&r[i]==3?(t=0,r=[].concat($jscomp.arrayFromIterable(r)),r.splice(i,1),r=new Uint8Array(r)):r[i]==0?t++:t=0,i++;return r},shaka.util.Mp4BoxParsers=function(){},shaka.util.Mp4BoxParsers.parseTFHD=function(t,r){var i=null,n=null,s=t.readUint32();return r&1&&t.skip(8),r&2&&t.skip(4),r&8&&(i=t.readUint32()),r&16&&(n=t.readUint32()),{trackId:s,defaultSampleDuration:i,defaultSampleSize:n}},shaka.util.Mp4BoxParsers.parseTFDT=function(t,r){return{baseMediaDecodeTime:r==1?t.readUint64():t.readUint32()}},shaka.util.Mp4BoxParsers.parseMDHD=function(t,r){return r==1?(t.skip(8),t.skip(8)):(t.skip(4),t.skip(4)),{timescale:t.readUint32()}},shaka.util.Mp4BoxParsers.parseTREX=function(t){t.skip(4),t.skip(4);var r=t.readUint32();return t=t.readUint32(),{defaultSampleDuration:r,defaultSampleSize:t}},shaka.util.Mp4BoxParsers.parseTRUN=function(t,r,i){var n=t.readUint32(),s=[];i&1&&t.skip(4),i&4&&t.skip(4);for(var o=0;o<n;o++){var l={sampleDuration:null,sampleSize:null,sampleCompositionTimeOffset:null};i&256&&(l.sampleDuration=t.readUint32()),i&512&&(l.sampleSize=t.readUint32()),i&1024&&t.skip(4),i&2048&&(l.sampleCompositionTimeOffset=r==0?t.readUint32():t.readInt32()),s.push(l)}return{sampleCount:n,sampleData:s}},shaka.util.Mp4BoxParsers.parseTKHD=function(t,r){return r==1?(t.skip(8),t.skip(8)):(t.skip(4),t.skip(4)),{trackId:t.readUint32()}},shaka.cea.Mp4CeaParser=function(){this.seiProcessor_=new shaka.cea.SeiProcessor,this.trackIdToTimescale_=new Map,this.defaultSampleSize_=this.defaultSampleDuration_=0},shaka.cea.Mp4CeaParser.prototype.init=function(t){var r=this,i=shaka.util.Mp4Parser,n=[],s=[];if(new i().box("moov",i.children).box("mvex",i.children).fullBox("trex",function(o){o=shaka.util.Mp4BoxParsers.parseTREX(o.reader),r.defaultSampleDuration_=o.defaultSampleDuration,r.defaultSampleSize_=o.defaultSampleSize}).box("trak",i.children).fullBox("tkhd",function(o){goog.asserts.assert(o.version!=null,"TKHD is a full box and should have a valid version."),o=shaka.util.Mp4BoxParsers.parseTKHD(o.reader,o.version),n.push(o.trackId)}).box("mdia",i.children).fullBox("mdhd",function(o){goog.asserts.assert(o.version!=null,"MDHD is a full box and should have a valid version."),o=shaka.util.Mp4BoxParsers.parseMDHD(o.reader,o.version),s.push(o.timescale)}).parse(t,!0),!n.length||!s.length||n.length!=s.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_CEA);n.forEach(function(o,l){r.trackIdToTimescale_.set(o,s[l])})},shaka.cea.Mp4CeaParser.prototype.parse=function(t){var r=this,i=shaka.util.Mp4Parser,n=[],s=this.defaultSampleDuration_,o=this.defaultSampleSize_,l=[],u=null,m=shaka.cea.ICeaParser.DEFAULT_TIMESCALE_VALUE;return new i().box("moof",i.children).box("traf",i.children).fullBox("trun",function(E){goog.asserts.assert(E.version!=null&&E.flags!=null,"TRUN is a full box and should have a valid version & flags."),l=shaka.util.Mp4BoxParsers.parseTRUN(E.reader,E.version,E.flags).sampleData}).fullBox("tfhd",function(E){goog.asserts.assert(E.flags!=null,"TFHD is a full box and should have valid flags."),E=shaka.util.Mp4BoxParsers.parseTFHD(E.reader,E.flags),s=E.defaultSampleDuration||r.defaultSampleDuration_,o=E.defaultSampleSize||r.defaultSampleSize_,E=E.trackId,r.trackIdToTimescale_.has(E)&&(m=r.trackIdToTimescale_.get(E))}).fullBox("tfdt",function(E){goog.asserts.assert(E.version!=null,"TFDT is a full box and should have a valid version."),u=shaka.util.Mp4BoxParsers.parseTFDT(E.reader,E.version).baseMediaDecodeTime}).box("mdat",function(E){if(u===null)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_CEA);r.parseMdat_(E.reader,u,m,s,o,l,n)}).parse(t,!1),n},shaka.cea.Mp4CeaParser.prototype.parseMdat_=function(t,r,i,n,s,o,l){var u=0,m=s;for(o.length&&(m=o[0].sampleSize||s);t.hasMoreData();){var E=t.readUint32();if((t.readUint8()&31)==shaka.cea.ICeaParser.NALU_TYPE_SEI){var y=0;o.length>u&&(y=o[u].sampleCompositionTimeOffset||0),y=(r+y)/i;for(var D=$jscomp.makeIterator(this.seiProcessor_.process(t.readBytes(E-1))),w=D.next();!w.done;w=D.next())l.push({packet:w.value,pts:y})}else try{t.skip(E-1)}catch{break}m-=E+4,m==0&&(r=o.length>u?r+(o[u].sampleDuration||n):r+n,u++,m=o.length>u&&o[u].sampleSize||s)}},shaka.media.IClosedCaptionParser=function(){},shaka.media.IClosedCaptionParser.prototype.init=function(t){},shaka.media.IClosedCaptionParser.prototype.parseFrom=function(t){},shaka.media.IClosedCaptionParser.prototype.reset=function(){},shaka.media.ClosedCaptionParser=function(){this.ceaParser_=new shaka.cea.Mp4CeaParser,this.ceaDecoder_=new shaka.cea.CeaDecoder},shaka.media.ClosedCaptionParser.prototype.init=function(t){this.ceaParser_.init(t)},shaka.media.ClosedCaptionParser.prototype.parseFrom=function(t){t=this.ceaParser_.parse(t),t=$jscomp.makeIterator(t);for(var r=t.next();!r.done;r=t.next()){r=r.value;var i=shaka.util.BufferUtils.toUint8(r.packet);0<i.length&&this.ceaDecoder_.extract(i,r.pts)}return this.ceaDecoder_.decode()},shaka.media.ClosedCaptionParser.prototype.reset=function(){this.ceaDecoder_.clear()},shaka.media.TimeRangesUtils=function(){},shaka.media.TimeRangesUtils.bufferStart=function(t){return!t||t.length==1&&1e-6>t.end(0)-t.start(0)?null:t.length==1&&0>t.start(0)?0:t.length?t.start(0):null},shaka.media.TimeRangesUtils.bufferEnd=function(t){return!t||t.length==1&&1e-6>t.end(0)-t.start(0)?null:t.length?t.end(t.length-1):null},shaka.media.TimeRangesUtils.isBuffered=function(t,r,i){return i=i===void 0?0:i,!t||!t.length||t.length==1&&1e-6>t.end(0)-t.start(0)||r>t.end(t.length-1)?!1:r+i>=t.start(0)},shaka.media.TimeRangesUtils.bufferedAheadOf=function(t,r){if(!t||!t.length||t.length==1&&1e-6>t.end(0)-t.start(0))return 0;for(var i=0,n=$jscomp.makeIterator(shaka.media.TimeRangesUtils.getBufferedInfo(t)),s=n.next();!s.done;s=n.next()){var o=s.value;s=o.start,o=o.end,o>r&&(i+=o-Math.max(s,r))}return i},shaka.media.TimeRangesUtils.getGapIndex=function(t,r,i){var n=shaka.media.TimeRangesUtils;return!t||!t.length||t.length==1&&1e-6>t.end(0)-t.start(0)?null:(t=n.getBufferedInfo(t).findIndex(function(s,o,l){return s.start>r&&(o==0||l[o-1].end-r<=i)}),0<=t?t:null)},shaka.media.TimeRangesUtils.getBufferedInfo=function(t){if(!t)return[];for(var r=[],i=0;i<t.length;i++)r.push({start:t.start(i),end:t.end(i)});return r},shaka.media.MediaSourceEngine=function(t,r,i,n){var s=this;this.video_=t,this.textDisplayer_=i,this.sourceBuffers_={},this.sourceBufferTypes_={},this.expectedEncryption_={},this.textEngine_=null,t=function(o,l,u){},this.onMetadata_=n||t,this.queues_={},this.eventManager_=new shaka.util.EventManager,this.transmuxers_={},this.captionParser_=r,this.mediaSourceOpen_=new shaka.util.PublicPromise,this.mediaSource_=this.createMediaSource(this.mediaSourceOpen_),this.destroyer_=new shaka.util.Destroyer(function(){return s.doDestroy_()}),this.url_=""},shaka.media.MediaSourceEngine.prototype.createMediaSource=function(t){var r=this,i=new MediaSource;return this.eventManager_.listenOnce(i,"sourceopen",function(){return r.onSourceOpen_(t)}),this.url_=shaka.media.MediaSourceEngine.createObjectURL(i),this.video_.src=this.url_,i},shaka.media.MediaSourceEngine.prototype.onSourceOpen_=function(t){URL.revokeObjectURL(this.url_),t.resolve()},shaka.media.MediaSourceEngine.isStreamSupported=function(t){var r=shaka.util.MimeUtils.getFullType(t.mimeType,t.codecs),i=shaka.util.MimeUtils.getExtendedType(t);return shaka.text.TextEngine.isTypeSupported(r)||MediaSource.isTypeSupported(i)||shaka.media.Transmuxer.isSupported(r,t.type)},shaka.media.MediaSourceEngine.probeSupport=function(){for(var t={},r=$jscomp.makeIterator('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),i=r.next();!i.done;i=r.next()){i=i.value,shaka.util.Platform.supportsMediaSource()?shaka.text.TextEngine.isTypeSupported(i)?t[i]=!0:t[i]=MediaSource.isTypeSupported(i)||shaka.media.Transmuxer.isSupported(i):t[i]=shaka.util.Platform.supportsMediaType(i);var n=i.split(";")[0];t[n]=t[n]||t[i]}return t},shaka.media.MediaSourceEngine.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.media.MediaSourceEngine.prototype.doDestroy_=function(){var t=this,r,i,n,s,o,l,u,m,E,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(D){if(D.nextAddress==1){r=shaka.util.Functional,i=[];for(n in t.queues_)for(s=t.queues_[n],o=s[0],t.queues_[n]=s.slice(0,1),o&&i.push(o.p.catch(r.noop)),l=$jscomp.makeIterator(s.slice(1)),u=l.next();!u.done;u=l.next())m=u.value,m.p.reject(shaka.util.Destroyer.destroyedError());t.textEngine_&&i.push(t.textEngine_.destroy()),t.textDisplayer_&&i.push(t.textDisplayer_.destroy());for(E in t.transmuxers_)i.push(t.transmuxers_[E].destroy());return D.yield(Promise.all(i),2)}if(t.eventManager_&&(t.eventManager_.release(),t.eventManager_=null),t.video_&&(t.video_.removeAttribute("src"),t.video_.load(),t.video_=null),t.mediaSource_=null,t.textEngine_=null,t.textDisplayer_=null,t.sourceBuffers_={},t.transmuxers_={},t.captionParser_=null,goog.DEBUG)for(y in t.queues_)goog.asserts.assert(t.queues_[y].length==0,y+" queue should be empty after destroy!");t.queues_={},D.jumpToEnd()})},shaka.media.MediaSourceEngine.prototype.open=function(){return this.mediaSourceOpen_},shaka.media.MediaSourceEngine.prototype.init=function(t,r){var i=this,n,s,o,l,u,m,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){if(y.nextAddress==1)return n=shaka.util.ManifestParserUtils.ContentType,y.yield(i.mediaSourceOpen_,2);for(s={},o=$jscomp.makeIterator(t.keys()),l=o.next();!l.done;s={$jscomp$loop$prop$contentType$595:s.$jscomp$loop$prop$contentType$595},l=o.next())s.$jscomp$loop$prop$contentType$595=l.value,u=t.get(s.$jscomp$loop$prop$contentType$595),goog.asserts.assert(shaka.media.MediaSourceEngine.isStreamSupported(u),"Type negotiation should happen before MediaSourceEngine.init!"),m=shaka.util.MimeUtils.getFullType(u.mimeType,u.codecs),s.$jscomp$loop$prop$contentType$595==n.TEXT?i.reinitText(m):(!r&&MediaSource.isTypeSupported(m)||!shaka.media.Transmuxer.isSupported(m,s.$jscomp$loop$prop$contentType$595)||(i.transmuxers_[s.$jscomp$loop$prop$contentType$595]=new shaka.media.Transmuxer,m=shaka.media.Transmuxer.convertTsCodecs(s.$jscomp$loop$prop$contentType$595,m)),E=i.mediaSource_.addSourceBuffer(m),i.eventManager_.listen(E,"error",function(D){return function(){return i.onError_(D.$jscomp$loop$prop$contentType$595)}}(s)),i.eventManager_.listen(E,"updateend",function(D){return function(){return i.onUpdateEnd_(D.$jscomp$loop$prop$contentType$595)}}(s)),i.sourceBuffers_[s.$jscomp$loop$prop$contentType$595]=E,i.sourceBufferTypes_[s.$jscomp$loop$prop$contentType$595]=m,i.queues_[s.$jscomp$loop$prop$contentType$595]=[],i.expectedEncryption_[s.$jscomp$loop$prop$contentType$595]=!!u.drmInfos.length);y.jumpToEnd()})},shaka.media.MediaSourceEngine.prototype.reinitText=function(t){this.textEngine_||(this.textEngine_=new shaka.text.TextEngine(this.textDisplayer_)),this.textEngine_.initParser(t)},shaka.media.MediaSourceEngine.prototype.ended=function(){return this.mediaSource_?this.mediaSource_.readyState=="ended":!0},shaka.media.MediaSourceEngine.prototype.bufferStart=function(t){return t==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.bufferStart():shaka.media.TimeRangesUtils.bufferStart(this.getBuffered_(t))},shaka.media.MediaSourceEngine.prototype.bufferEnd=function(t){return t==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.bufferEnd():shaka.media.TimeRangesUtils.bufferEnd(this.getBuffered_(t))},shaka.media.MediaSourceEngine.prototype.isBuffered=function(t,r,i){return t==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.isBuffered(r):(t=this.getBuffered_(t),shaka.media.TimeRangesUtils.isBuffered(t,r,i))},shaka.media.MediaSourceEngine.prototype.bufferedAheadOf=function(t,r){if(t==shaka.util.ManifestParserUtils.ContentType.TEXT)return this.textEngine_.bufferedAheadOf(r);var i=this.getBuffered_(t);return shaka.media.TimeRangesUtils.bufferedAheadOf(i,r)},shaka.media.MediaSourceEngine.prototype.getBufferedInfo=function(){var t=shaka.util.ManifestParserUtils.ContentType,r=shaka.media.TimeRangesUtils;if(t={total:r.getBufferedInfo(this.video_.buffered),audio:r.getBufferedInfo(this.getBuffered_(t.AUDIO)),video:r.getBufferedInfo(this.getBuffered_(t.VIDEO)),text:[]},this.textEngine_){r=this.textEngine_.bufferStart();var i=this.textEngine_.bufferEnd();r!=null&&i!=null&&t.text.push({start:r,end:i})}return t},shaka.media.MediaSourceEngine.prototype.getBuffered_=function(t){try{return this.sourceBuffers_[t].buffered}catch(r){return t in this.sourceBuffers_&&shaka.log.error("failed to get buffered range for "+t,r),null}},shaka.media.MediaSourceEngine.prototype.appendBuffer=function(t,r,i,n,s){var o=this,l,u,m,E,y,D,w,B;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){return F.nextAddress==1?(l=shaka.util.ManifestParserUtils.ContentType,t==l.TEXT?F.yield(o.textEngine_.appendBuffer(r,i,n),0):o.transmuxers_[t]?F.yield(o.transmuxers_[t].transmux(r),10):s?(o.textEngine_||o.reinitText("text/vtt"),i==null&&n==null?o.captionParser_.init(r):(u=o.captionParser_.parseFrom(r),u.length&&(m=o.sourceBuffers_[l.VIDEO].timestampOffset,o.textEngine_.storeAndAppendClosedCaptions(u,i,n,m))),r=o.workAroundBrokenPlatforms_(r,i,t),F.yield(o.enqueueOperation_(t,function(){return o.append_(t,r)}),0)):(r=o.workAroundBrokenPlatforms_(r,i,t),F.yield(o.enqueueOperation_(t,function(){return o.append_(t,r)}),0))):(E=F.yieldResult,o.textEngine_||o.reinitText("text/vtt"),E.metadata&&(y=o.sourceBuffers_[t].timestampOffset,o.onMetadata_(E.metadata,y,n)),E.captions&&E.captions.length&&(D=o.sourceBuffers_[l.VIDEO].timestampOffset,w=o.textEngine_.convertMuxjsCaptionsToShakaCaptions(E.captions),o.textEngine_.storeAndAppendClosedCaptions(w,i,n,D)),B=E.data,B=o.workAroundBrokenPlatforms_(B,i,t),F.yield(o.enqueueOperation_(t,function(){return o.append_(t,B)}),0))})},shaka.media.MediaSourceEngine.prototype.setSelectedClosedCaptionId=function(t){var r=this.bufferEnd(shaka.util.ManifestParserUtils.ContentType.VIDEO)||0;this.textEngine_.setSelectedClosedCaptionId(t,r)},shaka.media.MediaSourceEngine.prototype.clearSelectedClosedCaptionId=function(){this.textEngine_&&this.textEngine_.setSelectedClosedCaptionId("",0)},shaka.media.MediaSourceEngine.prototype.remove=function(t,r,i){var n=this,s;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return s=shaka.util.ManifestParserUtils.ContentType,t==s.TEXT?o.yield(n.textEngine_.remove(r,i),0):o.yield(n.enqueueOperation_(t,function(){return n.remove_(t,r,i)}),0)})},shaka.media.MediaSourceEngine.prototype.clear=function(t){var r=this,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return i=shaka.util.ManifestParserUtils.ContentType,t==i.TEXT?r.textEngine_?n.yield(r.textEngine_.remove(0,1/0),0):n.return():n.yield(r.enqueueOperation_(t,function(){return r.remove_(t,0,r.mediaSource_.duration)}),0)})},shaka.media.MediaSourceEngine.prototype.resetCaptionParser=function(){this.captionParser_.reset()},shaka.media.MediaSourceEngine.prototype.flush=function(t){var r=this,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return i=shaka.util.ManifestParserUtils.ContentType,t==i.TEXT?n.return():n.yield(r.enqueueOperation_(t,function(){return r.flush_(t)}),0)})},shaka.media.MediaSourceEngine.prototype.setStreamProperties=function(t,r,i,n){var s=this,o;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){return o=shaka.util.ManifestParserUtils.ContentType,t==o.TEXT?(s.textEngine_.setTimestampOffset(r),s.textEngine_.setAppendWindow(i,n),l.return()):l.yield(Promise.all([s.enqueueOperation_(t,function(){return s.abort_(t)}),s.enqueueOperation_(t,function(){return s.setTimestampOffset_(t,r)}),s.enqueueOperation_(t,function(){return s.setAppendWindow_(t,i,n)})]),0)})},shaka.media.MediaSourceEngine.prototype.endOfStream=function(t){var r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return i.yield(r.enqueueBlockingOperation_(function(){r.ended()||(t?r.mediaSource_.endOfStream(t):r.mediaSource_.endOfStream())}),0)})},shaka.media.MediaSourceEngine.prototype.setDuration=function(t){var r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return goog.asserts.assert(isNaN(r.mediaSource_.duration)||r.mediaSource_.duration<=t,"duration cannot decrease: "+r.mediaSource_.duration+" -> "+t),i.yield(r.enqueueBlockingOperation_(function(){r.mediaSource_.duration=t}),0)})},shaka.media.MediaSourceEngine.prototype.getDuration=function(){return this.mediaSource_.duration},shaka.media.MediaSourceEngine.prototype.append_=function(t,r){this.sourceBuffers_[t].appendBuffer(r)},shaka.media.MediaSourceEngine.prototype.remove_=function(t,r,i){i<=r?this.onUpdateEnd_(t):this.sourceBuffers_[t].remove(r,i)},shaka.media.MediaSourceEngine.prototype.abort_=function(t){var r=this.sourceBuffers_[t].appendWindowStart,i=this.sourceBuffers_[t].appendWindowEnd;this.sourceBuffers_[t].abort(),this.sourceBuffers_[t].appendWindowStart=r,this.sourceBuffers_[t].appendWindowEnd=i,this.onUpdateEnd_(t)},shaka.media.MediaSourceEngine.prototype.flush_=function(t){goog.asserts.assert(this.video_.buffered.length==0,"MediaSourceEngine.flush_ should only be used after clearing all data!"),this.video_.currentTime-=.001,this.onUpdateEnd_(t)},shaka.media.MediaSourceEngine.prototype.setTimestampOffset_=function(t,r){0>r&&(r+=.001),this.sourceBuffers_[t].timestampOffset=r,this.onUpdateEnd_(t)},shaka.media.MediaSourceEngine.prototype.setAppendWindow_=function(t,r,i){this.sourceBuffers_[t].appendWindowStart=0,this.sourceBuffers_[t].appendWindowEnd=i,this.sourceBuffers_[t].appendWindowStart=r,this.onUpdateEnd_(t)},shaka.media.MediaSourceEngine.prototype.onError_=function(t){var r=this.queues_[t][0];goog.asserts.assert(r,"Spurious error event!"),goog.asserts.assert(!this.sourceBuffers_[t].updating,"SourceBuffer should not be updating on error!"),r.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_FAILED,this.video_.error?this.video_.error.code:0))},shaka.media.MediaSourceEngine.prototype.onUpdateEnd_=function(t){var r=this.queues_[t][0];goog.asserts.assert(r,"Spurious updateend event!"),r&&(goog.asserts.assert(!this.sourceBuffers_[t].updating,"SourceBuffer should not be updating on updateend!"),r.p.resolve(),this.popFromQueue_(t))},shaka.media.MediaSourceEngine.prototype.enqueueOperation_=function(t,r){this.destroyer_.ensureNotDestroyed();var i={start:r,p:new shaka.util.PublicPromise};return this.queues_[t].push(i),this.queues_[t].length==1&&this.startOperation_(t),i.p},shaka.media.MediaSourceEngine.prototype.enqueueBlockingOperation_=function(t){var r=this,i,n,s,o,l,u,m,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){switch(y.nextAddress){case 1:r.destroyer_.ensureNotDestroyed(),i=[],n={};for(s in r.sourceBuffers_)n.$jscomp$loop$prop$ready$597=new shaka.util.PublicPromise,o={start:function(D){return function(){return D.$jscomp$loop$prop$ready$597.resolve()}}(n),p:n.$jscomp$loop$prop$ready$597},r.queues_[s].push(o),i.push(n.$jscomp$loop$prop$ready$597),r.queues_[s].length==1&&o.start(),n={$jscomp$loop$prop$ready$597:n.$jscomp$loop$prop$ready$597};return y.setCatchFinallyBlocks(2),y.yield(Promise.all(i),4);case 4:y.leaveTryBlock(3);break;case 2:if(l=y.enterCatchBlock(),goog.asserts.assert(r.destroyer_.destroyed(),"Should be destroyed by now"),goog.DEBUG)for(u in r.sourceBuffers_)r.queues_[u].length&&(goog.asserts.assert(r.queues_[u].length==1,"Should be at most one item in queue!"),goog.asserts.assert(i.includes(r.queues_[u][0].p),"The item in queue should be one of our waiters!"),r.queues_[u].shift());throw l;case 3:if(goog.DEBUG)for(m in r.sourceBuffers_)goog.asserts.assert(r.sourceBuffers_[m].updating==0,"SourceBuffers should not be updating after a blocking op!");try{t()}catch(D){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,D)}finally{for(E in r.sourceBuffers_)r.popFromQueue_(E)}y.jumpToEnd()}})},shaka.media.MediaSourceEngine.prototype.popFromQueue_=function(t){this.queues_[t].shift(),this.startOperation_(t)},shaka.media.MediaSourceEngine.prototype.startOperation_=function(t){var r=this.queues_[t][0];if(r)try{r.start()}catch(i){i.name=="QuotaExceededError"?r.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.QUOTA_EXCEEDED_ERROR,t)):r.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,i)),this.popFromQueue_(t)}},shaka.media.MediaSourceEngine.prototype.getTextDisplayer=function(){return goog.asserts.assert(this.textDisplayer_,"TextDisplayer should only be null when this is destroyed"),this.textDisplayer_},shaka.media.MediaSourceEngine.prototype.setTextDisplayer=function(t){var r=this.textDisplayer_;this.textDisplayer_=t,r&&(t.setTextVisibility(r.isTextVisible()),r.destroy()),this.textEngine_&&this.textEngine_.setDisplayer(t)},shaka.media.MediaSourceEngine.prototype.workAroundBrokenPlatforms_=function(t,r,i){var n=this.expectedEncryption_[i];return r==null&&n&&shaka.util.Platform.requiresEncryptionInfoInAllInitSegments()&&shaka.util.MimeUtils.getContainerType(this.sourceBufferTypes_[i])=="mp4"&&(shaka.log.debug("Forcing fake encryption information in init segment."),t=shaka.media.ContentWorkarounds.fakeEncryption(t)),t},shaka.media.MediaSourceEngine.createObjectURL=window.URL.createObjectURL,shaka.media.InitSegmentReference=function(t,r,i,n){this.getUris=t,this.startByte=r,this.endByte=i,this.mediaQuality=n===void 0?null:n},shaka.media.InitSegmentReference.prototype.getStartByte=function(){return this.startByte},shaka.media.InitSegmentReference.prototype.getEndByte=function(){return this.endByte},shaka.media.InitSegmentReference.prototype.getSize=function(){return this.endByte?this.endByte-this.startByte:null},shaka.media.InitSegmentReference.prototype.getMediaQuality=function(){return this.mediaQuality},shaka.media.InitSegmentReference.equal=function(t,r){var i=shaka.util.ArrayUtils;return t&&r?t.getStartByte()==r.getStartByte()&&t.getEndByte()==r.getEndByte()&&i.equal(t.getUris(),r.getUris()):t==r},goog.exportSymbol("shaka.media.InitSegmentReference",shaka.media.InitSegmentReference),goog.exportProperty(shaka.media.InitSegmentReference.prototype,"getEndByte",shaka.media.InitSegmentReference.prototype.getEndByte),goog.exportProperty(shaka.media.InitSegmentReference.prototype,"getStartByte",shaka.media.InitSegmentReference.prototype.getStartByte),shaka.media.SegmentReference=function(t,r,i,n,s,o,l,u,m,E,y,D){E=E===void 0?[]:E,y=y===void 0?"":y,D=D===void 0?null:D,goog.asserts.assert(t<=r,"startTime must be less than or equal to endTime"),goog.asserts.assert(s==null||n<s,"startByte must be < endByte"),this.startTime=t,this.trueEndTime=this.endTime=r,this.getUrisInner=i,this.startByte=n,this.endByte=s,this.initSegmentReference=o,this.timestampOffset=l,this.appendWindowStart=u,this.appendWindowEnd=m,this.partialReferences=E,this.tilesLayout=y,this.tileDuration=D},shaka.media.SegmentReference.prototype.getUris=function(){return this.getUrisInner()},shaka.media.SegmentReference.prototype.getStartTime=function(){return this.startTime},shaka.media.SegmentReference.prototype.getEndTime=function(){return this.endTime},shaka.media.SegmentReference.prototype.getStartByte=function(){return this.startByte},shaka.media.SegmentReference.prototype.getEndByte=function(){return this.endByte},shaka.media.SegmentReference.prototype.getSize=function(){return this.endByte?this.endByte-this.startByte:null},shaka.media.SegmentReference.prototype.hasPartialSegments=function(){return 0<this.partialReferences.length},shaka.media.SegmentReference.prototype.getTilesLayout=function(){return this.tilesLayout},shaka.media.SegmentReference.prototype.getTileDuration=function(){return this.tileDuration},goog.exportSymbol("shaka.media.SegmentReference",shaka.media.SegmentReference),goog.exportProperty(shaka.media.SegmentReference.prototype,"getTileDuration",shaka.media.SegmentReference.prototype.getTileDuration),goog.exportProperty(shaka.media.SegmentReference.prototype,"getTilesLayout",shaka.media.SegmentReference.prototype.getTilesLayout),goog.exportProperty(shaka.media.SegmentReference.prototype,"getEndByte",shaka.media.SegmentReference.prototype.getEndByte),goog.exportProperty(shaka.media.SegmentReference.prototype,"getStartByte",shaka.media.SegmentReference.prototype.getStartByte),goog.exportProperty(shaka.media.SegmentReference.prototype,"getEndTime",shaka.media.SegmentReference.prototype.getEndTime),goog.exportProperty(shaka.media.SegmentReference.prototype,"getStartTime",shaka.media.SegmentReference.prototype.getStartTime),goog.exportProperty(shaka.media.SegmentReference.prototype,"getUris",shaka.media.SegmentReference.prototype.getUris),shaka.media.PresentationTimeline=function(t,r,i){this.presentationStartTime_=t,this.presentationDelay_=r,this.segmentAvailabilityDuration_=this.duration_=1/0,this.maxSegmentDuration_=1,this.maxSegmentEndTime_=this.minSegmentStartTime_=null,this.clockOffset_=0,this.static_=!0,this.userSeekStart_=0,this.autoCorrectDrift_=i===void 0?!0:i,this.availabilityTimeOffset_=0,this.startTimeLocked_=!1},shaka.media.PresentationTimeline.prototype.getDuration=function(){return this.duration_},shaka.media.PresentationTimeline.prototype.getMaxSegmentDuration=function(){return this.maxSegmentDuration_},shaka.media.PresentationTimeline.prototype.setDuration=function(t){goog.asserts.assert(0<t,"duration must be > 0"),this.duration_=t},shaka.media.PresentationTimeline.prototype.getPresentationStartTime=function(){return this.presentationStartTime_},shaka.media.PresentationTimeline.prototype.setClockOffset=function(t){this.clockOffset_=t},shaka.media.PresentationTimeline.prototype.setStatic=function(t){this.static_=t},shaka.media.PresentationTimeline.prototype.setSegmentAvailabilityDuration=function(t){goog.asserts.assert(0<=t,"segmentAvailabilityDuration must be >= 0"),this.segmentAvailabilityDuration_=t},shaka.media.PresentationTimeline.prototype.setDelay=function(t){goog.asserts.assert(0<=t,"delay must be >= 0"),this.presentationDelay_=t},shaka.media.PresentationTimeline.prototype.getDelay=function(){return this.presentationDelay_},shaka.media.PresentationTimeline.prototype.notifySegments=function(t){if(t.length!=0){var r=t[t.length-1].endTime;this.notifyMinSegmentStartTime(t[0].startTime),this.maxSegmentDuration_=t.reduce(function(i,n){return Math.max(i,n.endTime-n.startTime)},this.maxSegmentDuration_),this.maxSegmentEndTime_=Math.max(this.maxSegmentEndTime_,r),this.presentationStartTime_!=null&&this.autoCorrectDrift_&&!this.startTimeLocked_&&(this.presentationStartTime_=(Date.now()+this.clockOffset_)/1e3-this.maxSegmentEndTime_-this.maxSegmentDuration_),shaka.log.v1("notifySegments:","maxSegmentDuration="+this.maxSegmentDuration_)}},shaka.media.PresentationTimeline.prototype.lockStartTime=function(){this.startTimeLocked_=!0},shaka.media.PresentationTimeline.prototype.notifyMinSegmentStartTime=function(t){this.minSegmentStartTime_=this.minSegmentStartTime_==null?t:Math.min(this.minSegmentStartTime_,t)},shaka.media.PresentationTimeline.prototype.notifyMaxSegmentDuration=function(t){this.maxSegmentDuration_=Math.max(this.maxSegmentDuration_,t),shaka.log.v1("notifyNewSegmentDuration:","maxSegmentDuration="+this.maxSegmentDuration_)},shaka.media.PresentationTimeline.prototype.offset=function(t){this.minSegmentStartTime_!=null&&(this.minSegmentStartTime_+=t),this.maxSegmentEndTime_!=null&&(this.maxSegmentEndTime_+=t)},shaka.media.PresentationTimeline.prototype.isLive=function(){return this.duration_==1/0&&!this.static_},shaka.media.PresentationTimeline.prototype.isInProgress=function(){return this.duration_!=1/0&&!this.static_},shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityStart=function(){goog.asserts.assert(0<=this.segmentAvailabilityDuration_,"The availability duration should be positive");var t=this.getSegmentAvailabilityEnd()-this.segmentAvailabilityDuration_;return Math.max(this.userSeekStart_,t)},shaka.media.PresentationTimeline.prototype.setUserSeekStart=function(t){this.userSeekStart_=t},shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityEnd=function(){return this.isLive()||this.isInProgress()?Math.min(this.getLiveEdge_()+this.availabilityTimeOffset_,this.duration_):this.maxSegmentEndTime_?Math.min(this.maxSegmentEndTime_,this.duration_):this.duration_},shaka.media.PresentationTimeline.prototype.getSafeSeekRangeStart=function(t){var r=Math.max(this.minSegmentStartTime_,this.userSeekStart_);if(this.segmentAvailabilityDuration_==1/0)return Math.ceil(1e3*r)/1e3;var i=this.getSegmentAvailabilityEnd()-this.segmentAvailabilityDuration_;return t=Math.min(i+t,this.getSeekRangeEnd()),Math.max(r,t)},shaka.media.PresentationTimeline.prototype.getSeekRangeStart=function(){return this.getSafeSeekRangeStart(0)},shaka.media.PresentationTimeline.prototype.getSeekRangeEnd=function(){var t=this.isLive()||this.isInProgress()?this.presentationDelay_:0;return Math.max(0,this.getSegmentAvailabilityEnd()-t)},shaka.media.PresentationTimeline.prototype.usingPresentationStartTime=function(){return!(this.presentationStartTime_==null||this.maxSegmentEndTime_!=null&&this.autoCorrectDrift_)},shaka.media.PresentationTimeline.prototype.getLiveEdge_=function(){goog.asserts.assert(this.presentationStartTime_!=null,"Cannot compute timeline live edge without start time");var t=(Date.now()+this.clockOffset_)/1e3;return Math.max(0,t-this.maxSegmentDuration_-this.presentationStartTime_)},shaka.media.PresentationTimeline.prototype.setAvailabilityTimeOffset=function(t){this.availabilityTimeOffset_=t},shaka.media.PresentationTimeline.prototype.assertIsValid=function(){goog.DEBUG&&(this.isLive()?goog.asserts.assert(this.presentationStartTime_!=null,"Detected as live stream, but does not match our model of live!"):this.isInProgress()?goog.asserts.assert(this.presentationStartTime_!=null&&this.segmentAvailabilityDuration_==1/0,"Detected as IPR stream, but does not match our model of IPR!"):goog.asserts.assert(this.segmentAvailabilityDuration_==1/0&&this.duration_!=1/0&&this.static_,"Detected as VOD stream, but does not match our model of VOD!"))},goog.exportSymbol("shaka.media.PresentationTimeline",shaka.media.PresentationTimeline),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setAvailabilityTimeOffset",shaka.media.PresentationTimeline.prototype.setAvailabilityTimeOffset),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"usingPresentationStartTime",shaka.media.PresentationTimeline.prototype.usingPresentationStartTime),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSeekRangeEnd",shaka.media.PresentationTimeline.prototype.getSeekRangeEnd),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSeekRangeStart",shaka.media.PresentationTimeline.prototype.getSeekRangeStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSafeSeekRangeStart",shaka.media.PresentationTimeline.prototype.getSafeSeekRangeStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSegmentAvailabilityEnd",shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityEnd),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setUserSeekStart",shaka.media.PresentationTimeline.prototype.setUserSeekStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSegmentAvailabilityStart",shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"isInProgress",shaka.media.PresentationTimeline.prototype.isInProgress),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"isLive",shaka.media.PresentationTimeline.prototype.isLive),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"offset",shaka.media.PresentationTimeline.prototype.offset),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifyMaxSegmentDuration",shaka.media.PresentationTimeline.prototype.notifyMaxSegmentDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifyMinSegmentStartTime",shaka.media.PresentationTimeline.prototype.notifyMinSegmentStartTime),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"lockStartTime",shaka.media.PresentationTimeline.prototype.lockStartTime),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifySegments",shaka.media.PresentationTimeline.prototype.notifySegments),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getDelay",shaka.media.PresentationTimeline.prototype.getDelay),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setDelay",shaka.media.PresentationTimeline.prototype.setDelay),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setSegmentAvailabilityDuration",shaka.media.PresentationTimeline.prototype.setSegmentAvailabilityDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setStatic",shaka.media.PresentationTimeline.prototype.setStatic),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setClockOffset",shaka.media.PresentationTimeline.prototype.setClockOffset),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getPresentationStartTime",shaka.media.PresentationTimeline.prototype.getPresentationStartTime),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setDuration",shaka.media.PresentationTimeline.prototype.setDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getMaxSegmentDuration",shaka.media.PresentationTimeline.prototype.getMaxSegmentDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getDuration",shaka.media.PresentationTimeline.prototype.getDuration),shaka.media.StallDetector=function(t,r){this.implementation_=t,this.wasMakingProgress_=t.shouldBeMakingProgress(),this.value_=t.getPresentationSeconds(),this.lastUpdateSeconds_=t.getWallSeconds(),this.didJump_=!1,this.stallThresholdSeconds_=r,this.onStall_=function(){}},shaka.media.StallDetector.prototype.release=function(){this.implementation_=null,this.onStall_=function(){}},shaka.media.StallDetector.prototype.onStall=function(t){this.onStall_=t},shaka.media.StallDetector.prototype.poll=function(){var t=this.implementation_,r=t.shouldBeMakingProgress(),i=t.getPresentationSeconds(),n=t.getWallSeconds();return(this.value_!=i||this.wasMakingProgress_!=r)&&(this.lastUpdateSeconds_=n,this.value_=i,this.wasMakingProgress_=r,this.didJump_=!1),i=n-this.lastUpdateSeconds_,(r=i>=this.stallThresholdSeconds_&&r&&!this.didJump_)&&(this.onStall_(this.value_,i),this.didJump_=!0,this.value_=t.getPresentationSeconds()),r},shaka.media.StallDetector.Implementation=function(){},shaka.media.StallDetector.Implementation.prototype.shouldBeMakingProgress=function(){},shaka.media.StallDetector.Implementation.prototype.getPresentationSeconds=function(){},shaka.media.StallDetector.Implementation.prototype.getWallSeconds=function(){},shaka.media.StallDetector.MediaElementImplementation=function(t){this.mediaElement_=t},shaka.media.StallDetector.MediaElementImplementation.prototype.shouldBeMakingProgress=function(){return this.mediaElement_.paused||this.mediaElement_.playbackRate==0||this.mediaElement_.buffered.length==0?!1:shaka.media.StallDetector.MediaElementImplementation.hasContentFor_(this.mediaElement_.buffered,this.mediaElement_.currentTime)},shaka.media.StallDetector.MediaElementImplementation.prototype.getPresentationSeconds=function(){return this.mediaElement_.currentTime},shaka.media.StallDetector.MediaElementImplementation.prototype.getWallSeconds=function(){return Date.now()/1e3},shaka.media.StallDetector.MediaElementImplementation.hasContentFor_=function(t,r){for(var i=$jscomp.makeIterator(shaka.media.TimeRangesUtils.getBufferedInfo(t)),n=i.next();!n.done;n=i.next())if(n=n.value,!(r<n.start-.1||r>n.end-.5))return!0;return!1},shaka.media.GapJumpingController=function(t,r,i,n,s){var o=this;this.video_=t,this.timeline_=r,this.config_=i,this.onEvent_=s,this.eventManager_=new shaka.util.EventManager,this.seekingEventReceived_=!1,this.prevReadyState_=t.readyState,this.didFireLargeGap_=!1,this.stallDetector_=n,this.hadSegmentAppended_=!1,this.eventManager_.listen(t,"waiting",function(){return o.onPollGapJump_()}),this.gapJumpTimer_=new shaka.util.Timer(function(){o.onPollGapJump_()}).tickEvery(.25)},shaka.media.GapJumpingController.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),this.gapJumpTimer_!=null&&(this.gapJumpTimer_.stop(),this.gapJumpTimer_=null),this.stallDetector_&&(this.stallDetector_.release(),this.stallDetector_=null),this.video_=this.timeline_=this.onEvent_=null},shaka.media.GapJumpingController.prototype.onSegmentAppended=function(){this.hadSegmentAppended_=!0,this.onPollGapJump_()},shaka.media.GapJumpingController.prototype.onSeeking=function(){this.seekingEventReceived_=!0,this.didFireLargeGap_=this.hadSegmentAppended_=!1},shaka.media.GapJumpingController.prototype.onPollGapJump_=function(){if(this.video_.readyState!=0){if(this.video_.seeking){if(!this.seekingEventReceived_)return}else this.seekingEventReceived_=!1;if((!this.video_.paused||this.video_.currentTime==0&&(this.video_.autoplay||this.video_.currentTime!=0))&&(this.video_.readyState!=this.prevReadyState_&&(this.didFireLargeGap_=!1,this.prevReadyState_=this.video_.readyState),!this.stallDetector_||!this.stallDetector_.poll())){var t=this.config_.smallGapLimit,r=this.video_.currentTime,i=this.video_.buffered,n=shaka.media.TimeRangesUtils.getGapIndex(i,r,this.config_.gapDetectionThreshold);if(n!=null&&(n!=0||this.hadSegmentAppended_)){var s=i.start(n),o=this.timeline_.getSeekRangeEnd();if(!(s>=o)){o=s-r,t=o<=t;var l=!1;if(!(o<shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE)){if(!t&&!this.didFireLargeGap_){this.didFireLargeGap_=!0;var u=new Map().set("currentTime",r).set("gapSize",o);u=new shaka.util.FakeEvent("largegap",u),u.cancelable=!0,this.onEvent_(u),this.config_.jumpLargeGaps&&!u.defaultPrevented?l=!0:shaka.log.info("Ignoring large gap at",r,"size",o)}(t||l)&&(n==0?shaka.log.info("Jumping forward",o,"seconds because of gap before start time of",s):shaka.log.info("Jumping forward",o,"seconds because of gap starting at",i.end(n-1),"and ending at",s),this.video_.currentTime=s)}}}}}},shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE=.001,shaka.util.MediaReadyState=function(){},shaka.util.MediaReadyState.waitForReadyState=function(t,r,i,n){r==HTMLMediaElement.HAVE_NOTHING||t.readyState>=r?n():(r=shaka.util.MediaReadyState.READY_STATES_TO_EVENT_NAMES_.value().get(r),i.listenOnce(t,r,n))},shaka.util.MediaReadyState.READY_STATES_TO_EVENT_NAMES_=new shaka.util.Lazy(function(){return new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]])}),shaka.media.VideoWrapper=function(t,r,i){var n=this;this.video_=t,this.onSeek_=r,this.startTime_=i,this.started_=!1,this.eventManager_=new shaka.util.EventManager,this.mover_=new shaka.media.VideoWrapper.PlayheadMover(t,10),shaka.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,function(){n.setStartTime_(n.startTime_)})},shaka.media.VideoWrapper.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),this.mover_!=null&&(this.mover_.release(),this.mover_=null),this.onSeek_=function(){},this.video_=null},shaka.media.VideoWrapper.prototype.getTime=function(){return this.started_?this.video_.currentTime:this.startTime_},shaka.media.VideoWrapper.prototype.setTime=function(t){var r=this;0<this.video_.readyState?this.mover_.moveTo(t):shaka.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,function(){r.setStartTime_(r.startTime_)})},shaka.media.VideoWrapper.prototype.setStartTime_=function(t){var r=this;.001>Math.abs(this.video_.currentTime-t)?this.startListeningToSeeks_():(this.eventManager_.listenOnce(this.video_,"seeking",function(){r.startListeningToSeeks_()}),this.mover_.moveTo(this.video_.currentTime==0?t:this.video_.currentTime))},shaka.media.VideoWrapper.prototype.startListeningToSeeks_=function(){var t=this;goog.asserts.assert(0<this.video_.readyState,"The media element should be ready before we listen for seeking."),this.started_=!0,this.eventManager_.listen(this.video_,"seeking",function(){return t.onSeek_()})},shaka.media.VideoWrapper.PlayheadMover=function(t,r){var i=this;this.mediaElement_=t,this.maxAttempts_=r,this.targetTime_=this.originTime_=this.remainingAttempts_=0,this.timer_=new shaka.util.Timer(function(){return i.onTick_()})},shaka.media.VideoWrapper.PlayheadMover.prototype.release=function(){this.timer_&&(this.timer_.stop(),this.timer_=null),this.mediaElement_=null},shaka.media.VideoWrapper.PlayheadMover.prototype.moveTo=function(t){this.originTime_=this.mediaElement_.currentTime,this.targetTime_=t,this.remainingAttempts_=this.maxAttempts_,this.mediaElement_.currentTime=t,this.timer_.tickEvery(.1)},shaka.media.VideoWrapper.PlayheadMover.prototype.onTick_=function(){0>=this.remainingAttempts_?(shaka.log.warning(["Failed to move playhead from",this.originTime_,"to",this.targetTime_].join(" ")),this.timer_.stop()):this.mediaElement_.currentTime!=this.originTime_?this.timer_.stop():(this.mediaElement_.currentTime=this.targetTime_,this.remainingAttempts_--)},shaka.media.Playhead=function(){},shaka.media.Playhead.prototype.setStartTime=function(t){},shaka.media.Playhead.prototype.getTime=function(){},shaka.media.Playhead.prototype.notifyOfBufferingChange=function(){},shaka.media.SrcEqualsPlayhead=function(t){var r=this;this.mediaElement_=t,this.started_=!1,this.startTime_=null,this.eventManager_=new shaka.util.EventManager;var i=function(){r.startTime_==null||r.startTime_==0?r.started_=!0:(r.eventManager_.listenOnce(r.mediaElement_,"seeking",function(){r.started_=!0}),r.mediaElement_.currentTime=Math.max(0,r.mediaElement_.currentTime+r.startTime_))};shaka.util.MediaReadyState.waitForReadyState(this.mediaElement_,HTMLMediaElement.HAVE_CURRENT_DATA,this.eventManager_,function(){i()})},shaka.media.SrcEqualsPlayhead.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),this.mediaElement_=null},shaka.media.SrcEqualsPlayhead.prototype.setStartTime=function(t){this.startTime_=this.started_?this.startTime_:t},shaka.media.SrcEqualsPlayhead.prototype.getTime=function(){return(this.started_?this.mediaElement_.currentTime:this.startTime_)||0},shaka.media.SrcEqualsPlayhead.prototype.notifyOfBufferingChange=function(){},shaka.media.MediaSourcePlayhead=function(t,r,i,n,s,o){var l=this;this.minSeekRange_=3,this.mediaElement_=t,this.timeline_=r.presentationTimeline,this.minBufferTime_=r.minBufferTime||0,this.config_=i,this.onSeek_=s,this.lastCorrectiveSeek_=null,this.gapController_=new shaka.media.GapJumpingController(t,r.presentationTimeline,i,this.createStallDetector_(t,i),o),this.videoWrapper_=new shaka.media.VideoWrapper(t,function(){return l.onSeeking_()},this.getStartTime_(n)),this.checkWindowTimer_=new shaka.util.Timer(function(){l.onPollWindow_()}).tickEvery(.25)},shaka.media.MediaSourcePlayhead.prototype.release=function(){this.videoWrapper_&&(this.videoWrapper_.release(),this.videoWrapper_=null),this.gapController_&&(this.gapController_.release(),this.gapController_=null),this.checkWindowTimer_&&(this.checkWindowTimer_.stop(),this.checkWindowTimer_=null),this.mediaElement_=this.videoWrapper_=this.timeline_=this.config_=null,this.onSeek_=function(){}},shaka.media.MediaSourcePlayhead.prototype.setStartTime=function(t){this.videoWrapper_.setTime(t)},shaka.media.MediaSourcePlayhead.prototype.getTime=function(){var t=this.videoWrapper_.getTime();return 0<this.mediaElement_.readyState&&!this.mediaElement_.paused?this.clampTime_(t):t},shaka.media.MediaSourcePlayhead.prototype.getStartTime_=function(t){return t==null?t=1/0>this.timeline_.getDuration()?this.timeline_.getSeekRangeStart():this.timeline_.getSeekRangeEnd():0>t&&(t=this.timeline_.getSeekRangeEnd()+t),this.clampSeekToDuration_(this.clampTime_(t))},shaka.media.MediaSourcePlayhead.prototype.notifyOfBufferingChange=function(){this.gapController_.onSegmentAppended()},shaka.media.MediaSourcePlayhead.prototype.onPollWindow_=function(){if(this.mediaElement_.readyState!=0&&!this.mediaElement_.paused){var t=this.videoWrapper_.getTime(),r=this.timeline_.getSeekRangeStart(),i=this.timeline_.getSeekRangeEnd();i-r<this.minSeekRange_&&(r=i-this.minSeekRange_),t<r&&(r=this.reposition_(t),shaka.log.info("Jumping forward "+(r-t)+" seconds to catch up with the seek range."),this.mediaElement_.currentTime=r)}},shaka.media.MediaSourcePlayhead.prototype.onSeeking_=function(){this.gapController_.onSeeking();var t=this.videoWrapper_.getTime(),r=this.reposition_(t);if(Math.abs(r-t)>shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE){var i=Date.now()/1e3;if(!this.lastCorrectiveSeek_||this.lastCorrectiveSeek_<i-1){this.lastCorrectiveSeek_=i,this.videoWrapper_.setTime(r);return}}shaka.log.v1("Seek to "+t),this.onSeek_()},shaka.media.MediaSourcePlayhead.prototype.clampSeekToDuration_=function(t){var r=this.timeline_.getDuration();return t>=r?(goog.asserts.assert(0<=this.config_.durationBackoff,"Duration backoff must be non-negative!"),r-this.config_.durationBackoff):t},shaka.media.MediaSourcePlayhead.prototype.reposition_=function(t){goog.asserts.assert(this.config_,"Cannot reposition playhead when it has beeen destroyed");var r=Math.max(this.minBufferTime_,this.config_.rebufferingGoal),i=this.config_.safeSeekOffset,n=this.timeline_.getSeekRangeStart(),s=this.timeline_.getSeekRangeEnd(),o=this.timeline_.getDuration();s-n<this.minSeekRange_&&(n=s-this.minSeekRange_);var l=this.timeline_.getSafeSeekRangeStart(r),u=this.timeline_.getSafeSeekRangeStart(i);return r=this.timeline_.getSafeSeekRangeStart(r+i),t>=o?(shaka.log.v1("Playhead past duration."),this.clampSeekToDuration_(t)):t>s?(shaka.log.v1("Playhead past end."),s):t<n?shaka.media.TimeRangesUtils.isBuffered(this.mediaElement_.buffered,u)?(shaka.log.v1("Playhead before start & start is buffered"),u):(shaka.log.v1("Playhead before start & start is unbuffered"),r):t>=l||shaka.media.TimeRangesUtils.isBuffered(this.mediaElement_.buffered,t)?(shaka.log.v1("Playhead in safe region or in buffered region."),t):(shaka.log.v1("Playhead outside safe region & in unbuffered region."),r)},shaka.media.MediaSourcePlayhead.prototype.clampTime_=function(t){var r=this.timeline_.getSeekRangeStart();return t<r?r:(r=this.timeline_.getSeekRangeEnd(),t>r?r:t)},shaka.media.MediaSourcePlayhead.prototype.createStallDetector_=function(t,r){if(!r.stallEnabled)return null;var i=r.stallThreshold,n=r.stallSkip;return i=new shaka.media.StallDetector(new shaka.media.StallDetector.MediaElementImplementation(t),i),i.onStall(function(s,o){shaka.log.debug("Stall detected at "+s+" for "+o+" seconds."),n?(shaka.log.debug("Seeking forward "+n+" seconds to break stall."),t.currentTime+=n):(shaka.log.debug("Pausing and unpausing to break stall."),t.pause(),t.play())}),i},shaka.media.SegmentIndex=function(t){goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(t),this.references=t,this.timer_=null,this.numEvicted=0,this.immutable_=!1},shaka.media.SegmentIndex.prototype.destroy=function(){return shaka.Deprecate.deprecateFeature(4,"shaka.media.SegmentIndex","Please use release() instead of destroy()."),this.release(),Promise.resolve()},shaka.media.SegmentIndex.prototype.release=function(){this.immutable_||(this.references=[],this.timer_&&this.timer_.stop(),this.timer_=null)},shaka.media.SegmentIndex.prototype.markImmutable=function(){this.immutable_=!0},shaka.media.SegmentIndex.prototype.find=function(t){for(var r=this.references.length-1,i=r;0<=i;--i){var n=this.references[i],s=i<r?this.references[i+1].startTime:n.endTime;if(t>=n.startTime&&t<s)return i+this.numEvicted}return this.references.length&&t<this.references[0].startTime?this.numEvicted:null},shaka.media.SegmentIndex.prototype.get=function(t){return this.references.length==0?null:(t-=this.numEvicted,0>t||t>=this.references.length?null:this.references[t])},shaka.media.SegmentIndex.prototype.offset=function(t){if(!this.immutable_)for(var r=$jscomp.makeIterator(this.references),i=r.next();!i.done;i=r.next())i=i.value,i.startTime+=t,i.endTime+=t,i.timestampOffset+=t},shaka.media.SegmentIndex.prototype.merge=function(t){goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(t),!this.immutable_&&t.length&&(this.references=this.references.filter(function(r){return r.startTime<t[0].startTime}),this.references.push.apply(this.references,$jscomp.arrayFromIterable(t)),goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(this.references))},shaka.media.SegmentIndex.prototype.mergeAndEvict=function(t,r){var i=this;t=t.filter(function(o){return o.endTime>r&&(i.references.length==0||o.endTime>i.references[0].startTime)});var n=this.references[0];this.merge(t);var s=this.references[0];n&&goog.asserts.assert(n.startTime==s.startTime,"SegmentIndex.merge should not change the first reference time!"),this.evict(r)},shaka.media.SegmentIndex.prototype.evict=function(t){if(!this.immutable_){var r=this.references.length;this.references=this.references.filter(function(i){return i.endTime>t}),this.numEvicted+=r-this.references.length}},shaka.media.SegmentIndex.prototype.fit=function(t,r,i){if(i=i===void 0?!1:i,goog.asserts.assert(r!=null,"Content duration must be known for static content!"),goog.asserts.assert(r!=1/0,"Content duration must be finite for static content!"),!this.immutable_){for(;this.references.length&&this.references[this.references.length-1].startTime>=r;)this.references.pop();for(;this.references.length&&this.references[0].endTime<=t;)this.references.shift(),i||this.numEvicted++;this.references.length!=0&&(t=this.references[this.references.length-1],this.references[this.references.length-1]=new shaka.media.SegmentReference(t.startTime,r,t.getUrisInner,t.startByte,t.endByte,t.initSegmentReference,t.timestampOffset,t.appendWindowStart,t.appendWindowEnd,t.partialReferences,t.tilesLayout,t.tileDuration))}},shaka.media.SegmentIndex.prototype.updateEvery=function(t,r){var i=this;goog.asserts.assert(!this.timer_,"SegmentIndex timer already started!"),this.immutable_||(this.timer_&&this.timer_.stop(),this.timer_=new shaka.util.Timer(function(){var n=r();n?i.references.push.apply(i.references,$jscomp.arrayFromIterable(n)):(i.timer_.stop(),i.timer_=null)}),this.timer_.tickEvery(t))},shaka.media.SegmentIndex.prototype[Symbol.iterator]=function(){var t=this.getIteratorForTime(0);return goog.asserts.assert(t!=null,"Iterator for 0 should never be null!"),t},shaka.media.SegmentIndex.prototype.getIteratorForTime=function(t){var r=this.find(t);if(r==null)return null;r--;var i=this.get(r+1),n=-1;if(i&&i.hasPartialSegments())for(var s=i.partialReferences.length-1;0<=s;--s){var o=i.partialReferences[s];if(t>=o.startTime&&t<o.endTime){r++,n=s-1;break}}return new shaka.media.SegmentIterator(this,r,n)},shaka.media.SegmentIndex.prototype.isEmpty=function(){return this.references.length==0},shaka.media.SegmentIndex.forSingleSegment=function(t,r,i){return t=new shaka.media.SegmentReference(t,t+r,function(){return i},0,null,null,t,t,t+r),new shaka.media.SegmentIndex([t])},goog.exportSymbol("shaka.media.SegmentIndex",shaka.media.SegmentIndex),goog.exportProperty(shaka.media.SegmentIndex,"forSingleSegment",shaka.media.SegmentIndex.forSingleSegment),goog.exportProperty(shaka.media.SegmentIndex.prototype,"getIteratorForTime",shaka.media.SegmentIndex.prototype.getIteratorForTime),goog.exportProperty(shaka.media.SegmentIndex.prototype,"updateEvery",shaka.media.SegmentIndex.prototype.updateEvery),goog.exportProperty(shaka.media.SegmentIndex.prototype,"fit",shaka.media.SegmentIndex.prototype.fit),goog.exportProperty(shaka.media.SegmentIndex.prototype,"evict",shaka.media.SegmentIndex.prototype.evict),goog.exportProperty(shaka.media.SegmentIndex.prototype,"mergeAndEvict",shaka.media.SegmentIndex.prototype.mergeAndEvict),goog.exportProperty(shaka.media.SegmentIndex.prototype,"merge",shaka.media.SegmentIndex.prototype.merge),goog.exportProperty(shaka.media.SegmentIndex.prototype,"offset",shaka.media.SegmentIndex.prototype.offset),goog.exportProperty(shaka.media.SegmentIndex.prototype,"get",shaka.media.SegmentIndex.prototype.get),goog.exportProperty(shaka.media.SegmentIndex.prototype,"find",shaka.media.SegmentIndex.prototype.find),goog.exportProperty(shaka.media.SegmentIndex.prototype,"markImmutable",shaka.media.SegmentIndex.prototype.markImmutable),goog.exportProperty(shaka.media.SegmentIndex.prototype,"release",shaka.media.SegmentIndex.prototype.release),goog.exportProperty(shaka.media.SegmentIndex.prototype,"destroy",shaka.media.SegmentIndex.prototype.destroy),goog.DEBUG&&(shaka.media.SegmentIndex.assertCorrectReferences_=function(t){goog.asserts.assert(t.every(function(r,i){if(i==0)return!0;var n=t[i-1];return n.startTime<r.startTime?!0:n.startTime>r.startTime?!1:n.endTime<=r.endTime}),"SegmentReferences are incorrect")}),shaka.media.SegmentIterator=function(t,r,i){this.segmentIndex_=t,this.currentPosition_=r,this.currentPartialPosition_=i},shaka.media.SegmentIterator.prototype.seek=function(t){return shaka.Deprecate.deprecateFeature(4,"shaka.media.SegmentIterator","Please use SegmentIndex.getIteratorForTime instead of seek()."),(t=this.segmentIndex_.getIteratorForTime(t))?(this.currentPosition_=t.currentPosition_,this.currentPartialPosition_=t.currentPartialPosition_):(this.currentPosition_=Number.MAX_VALUE,this.currentPartialPosition_=0),this.next().value},shaka.media.SegmentIterator.prototype.current=function(){var t=this.segmentIndex_.get(this.currentPosition_);return t&&t.hasPartialSegments()&&t.getUris().length&&this.currentPartialPosition_>=t.partialReferences.length&&(this.currentPosition_++,this.currentPartialPosition_=0,t=this.segmentIndex_.get(this.currentPosition_)),t&&t.hasPartialSegments()?t.partialReferences[this.currentPartialPosition_]:t},shaka.media.SegmentIterator.prototype.next=function(){var t=this.segmentIndex_.get(this.currentPosition_);return t&&t.hasPartialSegments()?(this.currentPartialPosition_++,t.getUris().length&&this.currentPartialPosition_==t.partialReferences.length&&(this.currentPosition_++,this.currentPartialPosition_=0)):(this.currentPosition_++,this.currentPartialPosition_=0),t=this.current(),{value:t,done:!t}},goog.exportSymbol("shaka.media.SegmentIterator",shaka.media.SegmentIterator),goog.exportProperty(shaka.media.SegmentIterator.prototype,"next",shaka.media.SegmentIterator.prototype.next),goog.exportProperty(shaka.media.SegmentIterator.prototype,"current",shaka.media.SegmentIterator.prototype.current),goog.exportProperty(shaka.media.SegmentIterator.prototype,"seek",shaka.media.SegmentIterator.prototype.seek),shaka.media.MetaSegmentIndex=function(){shaka.media.SegmentIndex.call(this,[]),this.indexes_=[]},$jscomp.inherits(shaka.media.MetaSegmentIndex,shaka.media.SegmentIndex),shaka.media.MetaSegmentIndex.prototype.appendSegmentIndex=function(t){goog.asserts.assert(this.indexes_.length==0||t.numEvicted==0,"Should not append a new segment index with already-evicted segments"),this.indexes_.push(t)},shaka.media.MetaSegmentIndex.prototype.clone=function(){var t=new shaka.media.MetaSegmentIndex;return t.indexes_=this.indexes_.slice(),t},shaka.media.MetaSegmentIndex.prototype.release=function(){for(var t=$jscomp.makeIterator(this.indexes_),r=t.next();!r.done;r=t.next())r.value.release();this.indexes_=[]},shaka.media.MetaSegmentIndex.prototype.find=function(t){for(var r=0,i=$jscomp.makeIterator(this.indexes_),n=i.next();!n.done;n=i.next()){n=n.value;var s=n.find(t);if(s!=null)return s+r;r+=n.numEvicted+n.references.length}return null},shaka.media.MetaSegmentIndex.prototype.get=function(t){for(var r=0,i=!1,n=$jscomp.makeIterator(this.indexes_),s=n.next();!s.done;s=n.next()){s=s.value,goog.asserts.assert(!i||s.numEvicted==0,"Should not see evicted segments after available segments");var o=s.get(t-r);if(o)return o;r+=s.numEvicted+s.references.length,i=i||s.references.length!=0}return null},shaka.media.MetaSegmentIndex.prototype.offset=function(t){goog.asserts.assert(!1,"offset() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.merge=function(t){goog.asserts.assert(!1,"merge() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.evict=function(t){goog.asserts.assert(!1,"evict() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.mergeAndEvict=function(t,r){goog.asserts.assert(!1,"mergeAndEvict() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.fit=function(t,r){goog.asserts.assert(!1,"fit() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.updateEvery=function(t,r){goog.asserts.assert(!1,"updateEvery() should not be used in MetaSegmentIndex!")},goog.exportSymbol("shaka.media.MetaSegmentIndex",shaka.media.MetaSegmentIndex),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"updateEvery",shaka.media.MetaSegmentIndex.prototype.updateEvery),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"fit",shaka.media.MetaSegmentIndex.prototype.fit),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"mergeAndEvict",shaka.media.MetaSegmentIndex.prototype.mergeAndEvict),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"evict",shaka.media.MetaSegmentIndex.prototype.evict),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"merge",shaka.media.MetaSegmentIndex.prototype.merge),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"offset",shaka.media.MetaSegmentIndex.prototype.offset),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"get",shaka.media.MetaSegmentIndex.prototype.get),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"find",shaka.media.MetaSegmentIndex.prototype.find),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"release",shaka.media.MetaSegmentIndex.prototype.release),shaka.media.PlayRateController=function(t){var r=this;this.harness_=t,this.isBuffering_=!1,this.rate_=this.harness_.getRate(),this.pollRate_=.25,this.timer_=new shaka.util.Timer(function(){r.harness_.movePlayhead(r.rate_*r.pollRate_)})},shaka.media.PlayRateController.prototype.release=function(){this.timer_&&(this.timer_.stop(),this.timer_=null),this.harness_=null},shaka.media.PlayRateController.prototype.setBuffering=function(t){this.isBuffering_=t,this.apply_()},shaka.media.PlayRateController.prototype.set=function(t){goog.asserts.assert(t!=0,"Should never set rate of 0 explicitly!"),this.rate_=t,this.apply_()},shaka.media.PlayRateController.prototype.getRealRate=function(){return this.rate_},shaka.media.PlayRateController.prototype.getDefaultRate=function(){return this.harness_.getDefaultRate()},shaka.media.PlayRateController.prototype.apply_=function(){this.timer_.stop();var t=this.calculateCurrentRate_();if(shaka.log.v1("Changing effective playback rate to",t),0<=t)try{this.applyRate_(t);return}catch{}this.timer_.tickEvery(this.pollRate_),this.applyRate_(0)},shaka.media.PlayRateController.prototype.calculateCurrentRate_=function(){return this.isBuffering_?0:this.rate_},shaka.media.PlayRateController.prototype.applyRate_=function(t){var r=this.harness_.getRate();return r!=t&&this.harness_.setRate(t),r!=t},shaka.media.IPlayheadObserver=function(){},shaka.media.IPlayheadObserver.prototype.poll=function(t,r){},shaka.media.PlayheadObserverManager=function(t){var r=this;this.mediaElement_=t,this.observers_=new Set,this.pollingLoop_=new shaka.util.Timer(function(){r.pollAllObservers_(!1)}).tickEvery(.25)},shaka.media.PlayheadObserverManager.prototype.release=function(){this.pollingLoop_.stop();for(var t=$jscomp.makeIterator(this.observers_),r=t.next();!r.done;r=t.next())r.value.release();this.observers_.clear()},shaka.media.PlayheadObserverManager.prototype.manage=function(t){this.observers_.add(t)},shaka.media.PlayheadObserverManager.prototype.notifyOfSeek=function(){this.pollAllObservers_(!0)},shaka.media.PlayheadObserverManager.prototype.pollAllObservers_=function(t){for(var r=$jscomp.makeIterator(this.observers_),i=r.next();!i.done;i=r.next())i.value.poll(this.mediaElement_.currentTime,t)},shaka.media.QualityObserver=function(t){shaka.util.FakeEventTarget.call(this),this.contentTypeStates_=new Map,this.getBufferedInfo_=t},$jscomp.inherits(shaka.media.QualityObserver,shaka.util.FakeEventTarget),shaka.media.QualityObserver.prototype.release=function(){this.contentTypeStates_.clear(),shaka.util.FakeEventTarget.prototype.release.call(this)},shaka.media.QualityObserver.prototype.getContentTypeState_=function(t){var r=this.contentTypeStates_.get(t);return r||(r={qualityChangePositions:[],currentQuality:null,contentType:t},this.contentTypeStates_.set(t,r)),r},shaka.media.QualityObserver.prototype.addMediaQualityChange=function(t,r){var i=this.getContentTypeState_(t.contentType);this.purgeQualityChangePositions_(i);var n={mediaQuality:t,position:r};i=i.qualityChangePositions;var s=i.findIndex(function(o){return o.position>=r});0<=s?i.splice(s,i[s].position==r?1:0,n):i.push(n)},shaka.media.QualityObserver.getMediaQualityAtPosition_=function(t,r){for(var i=r.qualityChangePositions,n=i.length-1;0<=n;n--){var s=i[n];if(s.position<=t)return s.mediaQuality}return null},shaka.media.QualityObserver.mediaQualitiesAreTheSame_=function(t,r){return t===r?!0:t&&r?t.bandwidth==r.bandwidth&&t.audioSamplingRate==r.audioSamplingRate&&t.codecs==r.codecs&&t.contentType==r.contentType&&t.frameRate==r.frameRate&&t.height==r.height&&t.mimeType==r.mimeType&&t.channelsCount==r.channelsCount&&t.pixelAspectRatio==r.pixelAspectRatio&&t.width==r.width:!1},shaka.media.QualityObserver.prototype.poll=function(t,r){for(var i=$jscomp.makeIterator(this.contentTypeStates_.values()),n=i.next();!n.done;n=i.next()){n=n.value;var s=shaka.media.QualityObserver.getMediaQualityAtPosition_(t,n);s&&!shaka.media.QualityObserver.mediaQualitiesAreTheSame_(n.currentQuality,s)&&this.positionIsBuffered_(t,s.contentType)&&(n.currentQuality=s,shaka.log.debug("Media quality changed at position "+t+" "+JSON.stringify(s)),n=new shaka.util.FakeEvent("qualitychange",new Map([["quality",s],["position",t]])),this.dispatchEvent(n))}},shaka.media.QualityObserver.prototype.positionIsBuffered_=function(t,r){var i=this.getBufferedInfo_()[r];if(i&&0<i.length){var n=i[i.length-1].end;if(t>=i[0].start&&t<n)return!0}return!1},shaka.media.QualityObserver.prototype.purgeQualityChangePositions_=function(t){var r=this.getBufferedInfo_()[t.contentType];if(r&&0<r.length){var i=r[0].start,n=r[r.length-1].end,s=t.qualityChangePositions;t.qualityChangePositions=s.filter(function(o,l){return!(o.position<=i&&l+1<s.length&&s[l+1].position<=i||o.position>=n)})}else t.qualityChangePositions=[]},shaka.media.RegionTimeline=function(t){shaka.util.FakeEventTarget.call(this);var r=this;this.regions_=new Set,this.getSeekRange_=t,this.filterTimer_=new shaka.util.Timer(function(){r.filterBySeekRange_()}).tickEvery(shaka.media.RegionTimeline.REGION_FILTER_INTERVAL)},$jscomp.inherits(shaka.media.RegionTimeline,shaka.util.FakeEventTarget),shaka.media.RegionTimeline.prototype.release=function(){this.regions_.clear(),this.filterTimer_.stop(),shaka.util.FakeEventTarget.prototype.release.call(this)},shaka.media.RegionTimeline.prototype.addRegion=function(t){this.findSimilarRegion_(t)==null&&(this.regions_.add(t),t=new shaka.util.FakeEvent("regionadd",new Map([["region",t]])),this.dispatchEvent(t))},shaka.media.RegionTimeline.prototype.filterBySeekRange_=function(){for(var t=this.getSeekRange_(),r=$jscomp.makeIterator(this.regions_),i=r.next();!i.done;i=r.next())i=i.value,i.endTime<t.start&&(this.regions_.delete(i),i=new shaka.util.FakeEvent("regionremove",new Map([["region",i]])),this.dispatchEvent(i))},shaka.media.RegionTimeline.prototype.findSimilarRegion_=function(t){for(var r=$jscomp.makeIterator(this.regions_),i=r.next();!i.done;i=r.next())if(i=i.value,i.schemeIdUri==t.schemeIdUri&&i.id==t.id&&i.startTime==t.startTime&&i.endTime==t.endTime)return i;return null},shaka.media.RegionTimeline.prototype.regions=function(){return this.regions_},shaka.media.RegionTimeline.REGION_FILTER_INTERVAL=2,shaka.media.RegionObserver=function(t){shaka.util.FakeEventTarget.call(this);var r=this;this.timeline_=t,this.oldPosition_=new Map;var i=shaka.media.RegionObserver.RelativePosition_;t=i.BEFORE_THE_REGION;var n=i.IN_THE_REGION;i=i.AFTER_THE_REGION,this.rules_=[{weWere:null,weAre:n,invoke:function(s,o){return r.onEvent_("enter",s,o)}},{weWere:t,weAre:n,invoke:function(s,o){return r.onEvent_("enter",s,o)}},{weWere:i,weAre:n,invoke:function(s,o){return r.onEvent_("enter",s,o)}},{weWere:n,weAre:t,invoke:function(s,o){return r.onEvent_("exit",s,o)}},{weWere:n,weAre:i,invoke:function(s,o){return r.onEvent_("exit",s,o)}},{weWere:t,weAre:i,invoke:function(s,o){return r.onEvent_("skip",s,o)}},{weWere:i,weAre:t,invoke:function(s,o){return r.onEvent_("skip",s,o)}}],this.eventManager_=new shaka.util.EventManager,this.eventManager_.listen(this.timeline_,"regionremove",function(s){r.oldPosition_.delete(s.region)})},$jscomp.inherits(shaka.media.RegionObserver,shaka.util.FakeEventTarget),shaka.media.RegionObserver.prototype.release=function(){this.timeline_=null,this.oldPosition_.clear(),this.eventManager_.release(),this.eventManager_=null,shaka.util.FakeEventTarget.prototype.release.call(this)},shaka.media.RegionObserver.prototype.poll=function(t,r){for(var i=shaka.media.RegionObserver,n=$jscomp.makeIterator(this.timeline_.regions()),s=n.next();!s.done;s=n.next()){s=s.value;var o=this.oldPosition_.get(s),l=i.determinePositionRelativeTo_(s,t);this.oldPosition_.set(s,l);for(var u=$jscomp.makeIterator(this.rules_),m=u.next();!m.done;m=u.next())m=m.value,m.weWere==o&&m.weAre==l&&m.invoke(s,r)}},shaka.media.RegionObserver.prototype.onEvent_=function(t,r,i){t=new shaka.util.FakeEvent(t,new Map([["region",r],["seeking",i]])),this.dispatchEvent(t)},shaka.media.RegionObserver.determinePositionRelativeTo_=function(t,r){var i=shaka.media.RegionObserver.RelativePosition_;return r<t.startTime?i.BEFORE_THE_REGION:r>t.endTime?i.AFTER_THE_REGION:i.IN_THE_REGION},shaka.media.RegionObserver.RelativePosition_={BEFORE_THE_REGION:1,IN_THE_REGION:2,AFTER_THE_REGION:3},shaka.util.Networking=function(){},shaka.util.Networking.createSegmentRequest=function(t,r,i,n,s){return t=shaka.net.NetworkingEngine.makeRequest(t,n,s),(r!=0||i!=null)&&(t.headers.Range=i?"bytes="+r+"-"+i:"bytes="+r+"-"),t},shaka.media.StreamingEngine=function(t,r){var i=this;this.playerInterface_=r,this.manifest_=t,this.config_=null,this.bufferingGoalScale_=1,this.currentTextStream_=this.currentVariant_=null,this.mediaStates_=new Map,this.startupComplete_=!1,this.failureCallbackBackoff_=null,this.fatalError_=!1,this.destroyer_=new shaka.util.Destroyer(function(){return i.doDestroy_()})},shaka.media.StreamingEngine.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.media.StreamingEngine.prototype.doDestroy_=function(){var t=this,r,i,n,s;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){if(o.nextAddress==1){for(r=[],i=$jscomp.makeIterator(t.mediaStates_.values()),n=i.next();!n.done;n=i.next())s=n.value,t.cancelUpdate_(s),r.push(t.abortOperations_(s));return o.yield(Promise.all(r),2)}t.mediaStates_.clear(),t.playerInterface_=null,t.manifest_=null,t.config_=null,o.jumpToEnd()})},shaka.media.StreamingEngine.prototype.configure=function(t){this.config_=t,this.failureCallbackBackoff_=new shaka.net.Backoff({maxAttempts:Math.max(t.retryParameters.maxAttempts,2),baseDelay:t.retryParameters.baseDelay,backoffFactor:t.retryParameters.backoffFactor,fuzzFactor:t.retryParameters.fuzzFactor,timeout:0,stallTimeout:0,connectionTimeout:0},!0)},shaka.media.StreamingEngine.prototype.start=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(r.nextAddress==1)return goog.asserts.assert(t.config_,"StreamingEngine configure() must be called before init()!"),r.yield(t.initStreams_(),2);t.destroyer_.ensureNotDestroyed(),shaka.log.debug("init: completed initial Stream setup"),t.startupComplete_=!0,r.jumpToEnd()})},shaka.media.StreamingEngine.prototype.getCurrentVariant=function(){return this.currentVariant_},shaka.media.StreamingEngine.prototype.getCurrentTextStream=function(){return this.currentTextStream_},shaka.media.StreamingEngine.prototype.loadNewTextStream_=function(t){var r=this,i,n,s,o,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){switch(m.nextAddress){case 1:return i=shaka.util.ManifestParserUtils.ContentType,goog.asserts.assert(!r.mediaStates_.has(i.TEXT),"Should not call loadNewTextStream_ while streaming text!"),m.setCatchFinallyBlocks(2),m.yield(r.playerInterface_.mediaSourceEngine.clear(i.TEXT),4);case 4:m.leaveTryBlock(3);break;case 2:n=m.enterCatchBlock(),r.playerInterface_&&r.playerInterface_.onError(n);case 3:s=shaka.util.MimeUtils.getFullType(t.mimeType,t.codecs),r.playerInterface_.mediaSourceEngine.reinitText(s),o=r.playerInterface_.mediaSourceEngine.getTextDisplayer(),(l=o.isTextVisible()||r.config_.alwaysStreamText)&&(u=r.createMediaState_(t),r.mediaStates_.set(i.TEXT,u),r.scheduleUpdate_(u,0)),m.jumpToEnd()}})},shaka.media.StreamingEngine.prototype.unloadTextStream=function(){var t=shaka.util.ManifestParserUtils.ContentType,r=this.mediaStates_.get(t.TEXT);r&&(this.cancelUpdate_(r),this.abortOperations_(r).catch(function(){}),this.mediaStates_.delete(t.TEXT)),this.currentTextStream_=null},shaka.media.StreamingEngine.prototype.setTrickPlay=function(t){var r=this.mediaStates_.get(shaka.util.ManifestParserUtils.ContentType.VIDEO);if(r){var i=r.stream;i&&(shaka.log.debug("setTrickPlay",t),t?(t=i.trickModeVideo)&&!r.restoreStreamAfterTrickPlay&&(shaka.log.debug("Engaging trick mode stream",t),this.switchInternal_(t,!1,0,!1),r.restoreStreamAfterTrickPlay=i):(i=r.restoreStreamAfterTrickPlay)&&(shaka.log.debug("Restoring non-trick-mode stream",i),r.restoreStreamAfterTrickPlay=null,this.switchInternal_(i,!0,0,!1)))}},shaka.media.StreamingEngine.prototype.switchVariant=function(t,r,i,n){r=r===void 0?!1:r,i=i===void 0?0:i,n=n===void 0?!1:n,this.currentVariant_=t,this.startupComplete_&&(t.video&&this.switchInternal_(t.video,r,i,n),t.audio&&this.switchInternal_(t.audio,r,i,n))},shaka.media.StreamingEngine.prototype.switchTextStream=function(t){if(this.currentTextStream_=t,this.startupComplete_){var r=shaka.util.ManifestParserUtils.ContentType;goog.asserts.assert(t&&t.type==r.TEXT,"Wrong stream type passed to switchTextStream!"),this.switchInternal_(t,!0,0,!1)}},shaka.media.StreamingEngine.prototype.reloadTextStream=function(){var t=this.mediaStates_.get(shaka.util.ManifestParserUtils.ContentType.TEXT);t&&this.switchInternal_(t.stream,!0,0,!0)},shaka.media.StreamingEngine.prototype.switchInternal_=function(t,r,i,n){var s=this,o=shaka.util.ManifestParserUtils.ContentType,l=this.mediaStates_.get(t.type);l||t.type!=o.TEXT?(goog.asserts.assert(l,"switch: expected mediaState to exist"),l&&(l.restoreStreamAfterTrickPlay&&(shaka.log.debug("switch during trick play mode",t),t.trickModeVideo?(l.restoreStreamAfterTrickPlay=t,t=t.trickModeVideo,shaka.log.debug("switch found trick play stream",t)):(l.restoreStreamAfterTrickPlay=null,shaka.log.debug("switch found no special trick play stream"))),l.stream!=t||n?(t.type==o.TEXT&&(n=shaka.util.MimeUtils.getFullType(t.mimeType,t.codecs),this.playerInterface_.mediaSourceEngine.reinitText(n)),l.stream.closeSegmentIndex&&l.stream.closeSegmentIndex(),l.stream=t,l.segmentIterator=null,t=shaka.media.StreamingEngine.logPrefix_(l),shaka.log.debug("switch: switching to Stream "+t),r&&(l.clearingBuffer?l.waitingToFlushBuffer=!0:l.performingUpdate?(l.waitingToClearBuffer=!0,l.clearBufferSafeMargin=i,l.waitingToFlushBuffer=!0):(this.cancelUpdate_(l),this.clearBuffer_(l,!0,i).catch(function(u){s.playerInterface_&&(goog.asserts.assert(u instanceof shaka.util.Error,"Wrong error type!"),s.playerInterface_.onError(u))}))),this.makeAbortDecision_(l).catch(function(u){s.playerInterface_&&(goog.asserts.assert(u instanceof shaka.util.Error,"Wrong error type!"),s.playerInterface_.onError(u))})):(r=shaka.media.StreamingEngine.logPrefix_(l),shaka.log.debug("switch: Stream "+r+" already active")))):this.loadNewTextStream_(t)},shaka.media.StreamingEngine.prototype.makeAbortDecision_=function(t){var r=this,i,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){if(s.nextAddress==1)return t.operation?(i=t.stream,n=t.operation,i.segmentIndex?s.jumpTo(2):s.yield(i.createSegmentIndex(),2)):s.return();if(t.operation!=n||t.stream!=i)return s.return();goog.asserts.assert(t.stream.segmentIndex,"Segment index should exist by now!"),r.shouldAbortCurrentRequest_(t)&&(shaka.log.info("Aborting current segment request."),t.operation.abort()),s.jumpToEnd()})},shaka.media.StreamingEngine.prototype.shouldAbortCurrentRequest_=function(t){goog.asserts.assert(t.operation,"Abort logic requires an ongoing operation!"),goog.asserts.assert(t.stream&&t.stream.segmentIndex,"Abort logic requires a segment index");var r=this.playerInterface_.getPresentationTime(),i=this.playerInterface_.mediaSourceEngine.bufferEnd(t.type),n=this.getTimeNeeded_(t,r);n=t.stream.segmentIndex.find(n);var s=n==null?null:t.stream.segmentIndex.get(n);return n=s?s.getSize():null,s&&!n&&(n=(s.getEndTime()-s.getStartTime())*(t.stream.bandwidth||0)/8),n?((s=s.initSegmentReference)&&(n+=s.getSize()||0),s=this.playerInterface_.getBandwidthEstimate(),8*n/s<(i||0)-r-Math.max(this.manifest_.minBufferTime||0,this.config_.rebufferingGoal)||t.operation.getBytesRemaining()>n):!1},shaka.media.StreamingEngine.prototype.seeked=function(){for(var t=this.playerInterface_.getPresentationTime(),r=this.config_.smallGapLimit,i=shaka.util.ManifestParserUtils.ContentType,n=!1,s=$jscomp.makeIterator(this.mediaStates_.keys()),o=s.next();!o.done;o=s.next()){o=o.value;var l=this.mediaStates_.get(o),u=shaka.media.StreamingEngine.logPrefix_(l);l.segmentIterator=null,this.playerInterface_.mediaSourceEngine.isBuffered(o,t,r)||((this.playerInterface_.mediaSourceEngine.bufferEnd(o)!=null||l.performingUpdate)&&(this.forceClearBuffer_(l),n=!0),l.operation&&(l.operation.abort(),shaka.log.debug(u,"Aborting operation due to seek"),l.operation=null),o===i.TEXT&&this.playerInterface_.mediaSourceEngine.resetCaptionParser())}n||shaka.log.debug("(all): seeked: buffered seek: presentationTime="+t)},shaka.media.StreamingEngine.prototype.forceClearBuffer_=function(t){var r=this,i=shaka.media.StreamingEngine.logPrefix_(t);t.clearingBuffer?shaka.log.debug(i,"clear: already clearing the buffer"):t.waitingToClearBuffer?shaka.log.debug(i,"clear: already waiting"):t.performingUpdate?(shaka.log.debug(i,"clear: currently updating"),t.waitingToClearBuffer=!0,t.clearBufferSafeMargin=0):this.playerInterface_.mediaSourceEngine.bufferStart(t.type)==null?(shaka.log.debug(i,"clear: nothing buffered"),t.updateTimer==null&&this.scheduleUpdate_(t,0)):(shaka.log.debug(i,"clear: handling right now"),this.cancelUpdate_(t),this.clearBuffer_(t,!1,0).catch(function(n){r.playerInterface_&&(goog.asserts.assert(n instanceof shaka.util.Error,"Wrong error type!"),r.playerInterface_.onError(n))}))},shaka.media.StreamingEngine.prototype.initStreams_=function(){var t=this,r,i,n,s,o,l,u,m,E,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(D){if(D.nextAddress==1){if(r=shaka.util.ManifestParserUtils.ContentType,goog.asserts.assert(t.config_,"StreamingEngine configure() must be called before init()!"),!t.currentVariant_)throw shaka.log.error("init: no Streams chosen"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STREAMING,shaka.util.Error.Code.STREAMING_ENGINE_STARTUP_INVALID_STATE);return i=new Map,n=new Set,t.currentVariant_.audio&&(i.set(r.AUDIO,t.currentVariant_.audio),n.add(t.currentVariant_.audio)),t.currentVariant_.video&&(i.set(r.VIDEO,t.currentVariant_.video),n.add(t.currentVariant_.video)),t.currentTextStream_&&(i.set(r.TEXT,t.currentTextStream_),n.add(t.currentTextStream_)),s=t.playerInterface_.mediaSourceEngine,o=t.config_.forceTransmuxTS,D.yield(s.init(i,o),2)}for(t.destroyer_.ensureNotDestroyed(),t.setDuration_(),l=$jscomp.makeIterator(i.keys()),u=l.next();!u.done;u=l.next())m=u.value,E=i.get(m),t.mediaStates_.has(m)||(y=t.createMediaState_(E),t.mediaStates_.set(m,y),t.scheduleUpdate_(y,0));D.jumpToEnd()})},shaka.media.StreamingEngine.prototype.createMediaState_=function(t){return{stream:t,type:t.type,segmentIterator:null,lastSegmentReference:null,lastInitSegmentReference:null,lastTimestampOffset:null,lastAppendWindowStart:null,lastAppendWindowEnd:null,restoreStreamAfterTrickPlay:null,endOfStream:!1,performingUpdate:!1,updateTimer:null,waitingToClearBuffer:!1,clearBufferSafeMargin:0,waitingToFlushBuffer:!1,clearingBuffer:!1,recovering:!1,hasError:!1,operation:null}},shaka.media.StreamingEngine.prototype.setDuration_=function(){var t=this.manifest_.presentationTimeline.getDuration();1/0>t?this.playerInterface_.mediaSourceEngine.setDuration(t):this.playerInterface_.mediaSourceEngine.setDuration(Math.pow(2,32))},shaka.media.StreamingEngine.prototype.onUpdate_=function(t){var r=this,i,n,s,o,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){switch(m.nextAddress){case 1:if(r.destroyer_.ensureNotDestroyed(),i=shaka.media.StreamingEngine.logPrefix_(t),goog.asserts.assert(!t.performingUpdate&&t.updateTimer!=null,i+" unexpected call to onUpdate_()"),t.performingUpdate||t.updateTimer==null||(goog.asserts.assert(!t.clearingBuffer,i+" onUpdate_() should not be called when clearing the buffer"),t.clearingBuffer))return m.return();if(t.updateTimer=null,!t.waitingToClearBuffer){m.jumpTo(2);break}return shaka.log.debug(i,"skipping update and clearing the buffer"),m.yield(r.clearBuffer_(t,t.waitingToFlushBuffer,t.clearBufferSafeMargin),3);case 3:return m.return();case 2:if(t.stream.segmentIndex){m.jumpTo(4);break}return n=t.stream,m.yield(t.stream.createSegmentIndex(),5);case 5:if(n!=t.stream)return n.closeSegmentIndex&&(goog.asserts.assert(!t.stream.segmentIndex,"mediastate.stream should not have segmentIndex yet."),n.closeSegmentIndex()),t.updateTimer==null&&r.scheduleUpdate_(t,0),m.return();case 4:m.setCatchFinallyBlocks(6),s=r.update_(t),s!=null&&(r.scheduleUpdate_(t,s),t.hasError=!1),m.leaveTryBlock(7);break;case 6:return o=m.enterCatchBlock(),m.yield(r.handleStreamingError_(o),8);case 8:return m.return();case 7:if(l=Array.from(r.mediaStates_.values()),!r.startupComplete_||!l.every(function(E){return E.endOfStream})){m.jumpTo(0);break}return shaka.log.v1(i,"calling endOfStream()..."),m.yield(r.playerInterface_.mediaSourceEngine.endOfStream(),10);case 10:r.destroyer_.ensureNotDestroyed(),u=r.playerInterface_.mediaSourceEngine.getDuration(),u!=0&&u<r.manifest_.presentationTimeline.getDuration()&&r.manifest_.presentationTimeline.setDuration(u),m.jumpToEnd()}})},shaka.media.StreamingEngine.prototype.update_=function(t){goog.asserts.assert(this.manifest_,"manifest_ should not be null"),goog.asserts.assert(this.config_,"config_ should not be null");var r=shaka.util.ManifestParserUtils.ContentType;if(shaka.media.StreamingEngine.isEmbeddedText_(t))return this.playerInterface_.mediaSourceEngine.setSelectedClosedCaptionId(t.stream.originalId||""),null;t.type==r.TEXT&&this.playerInterface_.mediaSourceEngine.clearSelectedClosedCaptionId();var i=shaka.media.StreamingEngine.logPrefix_(t),n=this.playerInterface_.getPresentationTime(),s=this.getTimeNeeded_(t,n);shaka.log.v2(i,"timeNeeded="+s);var o=this.playerInterface_.mediaSourceEngine.bufferedAheadOf(t.type,n);shaka.log.v2(i,"update_:","presentationTime="+n,"bufferedAhead="+o);var l=Math.max(this.manifest_.minBufferTime||0,this.config_.rebufferingGoal,this.config_.bufferingGoal)*this.bufferingGoalScale_;if(1e-6>this.manifest_.presentationTimeline.getDuration()-s)return shaka.log.debug(i,"buffered to end of presentation"),t.endOfStream=!0,t.type==r.VIDEO&&(t=this.mediaStates_.get(r.TEXT))&&shaka.media.StreamingEngine.isEmbeddedText_(t)&&(t.endOfStream=!0),null;if(t.endOfStream=!1,o>=l)return shaka.log.v2(i,"buffering goal met"),this.config_.updateIntervalSeconds/2;if(r=this.playerInterface_.mediaSourceEngine.bufferEnd(t.type),r=this.getSegmentReferenceNeeded_(t,n,r),!r)return this.config_.updateIntervalSeconds;o=1/0,l=Array.from(this.mediaStates_.values()),l=$jscomp.makeIterator(l);for(var u=l.next();!u.done;u=l.next())u=u.value,shaka.media.StreamingEngine.isEmbeddedText_(u)||u.segmentIterator&&!u.segmentIterator.current()||(u=this.getTimeNeeded_(u,n),o=Math.min(o,u));return l=this.manifest_.presentationTimeline.getMaxSegmentDuration()*shaka.media.StreamingEngine.MAX_RUN_AHEAD_SEGMENTS_,s>=o+l?(shaka.log.v2(i,"waiting for other streams to buffer"),this.config_.updateIntervalSeconds):(this.fetchAndAppend_(t,n,r).catch(function(){}),null)},shaka.media.StreamingEngine.prototype.getTimeNeeded_=function(t,r){return t.lastSegmentReference?t.lastSegmentReference.endTime:r},shaka.media.StreamingEngine.prototype.getSegmentReferenceNeeded_=function(t,r,i){var n=shaka.media.StreamingEngine.logPrefix_(t);if(goog.asserts.assert(t.stream.segmentIndex,"segment index should have been generated already"),t.segmentIterator)return t.segmentIterator.current();if(t.lastSegmentReference||i)return r=t.lastSegmentReference?t.lastSegmentReference.endTime:i,goog.asserts.assert(r!=null,"Should have a time to search"),shaka.log.v1(n,"looking up segment from new stream endTime:",r),t.segmentIterator=t.stream.segmentIndex.getIteratorForTime(r),t=t.segmentIterator&&t.segmentIterator.next().value,t==null&&shaka.log.warning(n,"cannot find segment","endTime:",r),t;i=this.config_.inaccurateManifestTolerance;var s=Math.max(r-i,0);shaka.log.v1(n,"looking up segment","lookupTime:",s,"presentationTime:",r);var o=null;return i&&(t.segmentIterator=t.stream.segmentIndex.getIteratorForTime(s),o=t.segmentIterator&&t.segmentIterator.next().value),o||(t.segmentIterator=t.stream.segmentIndex.getIteratorForTime(r),o=t.segmentIterator&&t.segmentIterator.next().value),o==null&&shaka.log.warning(n,"cannot find segment","lookupTime:",s,"presentationTime:",r),o},shaka.media.StreamingEngine.prototype.fetchAndAppend_=function(t,r,i){var n=this,s,o,l,u,m,E,y,D,w,B,F,V,K,q,re;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ee){switch(ee.nextAddress){case 1:return s=shaka.util.ManifestParserUtils.ContentType,o=shaka.media.StreamingEngine,l=o.logPrefix_(t),shaka.log.v1(l,"fetchAndAppend_:","presentationTime="+r,"reference.startTime="+i.startTime,"reference.endTime="+i.endTime),u=t.stream,m=t.segmentIterator,t.performingUpdate=!0,ee.setCatchFinallyBlocks(2),ee.yield(n.initSourceBuffer_(t,i),4);case 4:return n.destroyer_.ensureNotDestroyed(),n.fatalError_?ee.return():(shaka.log.v2(l,"fetching segment"),E=u.mimeType=="video/mp4"||u.mimeType=="audio/mp4",y=window.ReadableStream,n.config_.lowLatencyMode&&y&&E?(B=new Uint8Array(0),F=function(H){var te,W,z;return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){return n.destroyer_.ensureNotDestroyed(),n.fatalError_?X.return():(B=n.concatArray_(B,H),te=!1,W=0,new shaka.util.Mp4Parser().box("mdat",function(Q){W=Q.size+Q.start,te=!0}).parse(B,!1,!0),te?(z=B.subarray(0,W),B=B.subarray(W),X.yield(n.append_(t,r,u,i,z),0)):X.jumpTo(0))})},ee.yield(n.fetch_(t,i,F),6)):(n.config_.lowLatencyMode&&!y&&shaka.log.warning("Low latency streaming mode is enabled, but ReadableStream is not supported by the browser."),D=n.fetch_(t,i),ee.yield(D,7)));case 7:return w=ee.yieldResult,n.destroyer_.ensureNotDestroyed(),n.fatalError_?ee.return():t.waitingToClearBuffer?(shaka.log.info(l,"waitingToClearBuffer, skip append"),t.performingUpdate=!1,n.scheduleUpdate_(t,0),ee.return()):ee.yield(n.append_(t,r,u,i,w),6);case 6:if(n.destroyer_.ensureNotDestroyed(),n.fatalError_)return ee.return();t.lastSegmentReference=i,V=m.next().value,shaka.log.v2(l,"advancing to next segment",V),t.performingUpdate=!1,t.recovering=!1,K=n.playerInterface_.mediaSourceEngine.getBufferedInfo(),q=K[t.type],shaka.log.v1(l,"finished fetch and append",JSON.stringify(q)),t.waitingToClearBuffer||n.playerInterface_.onSegmentAppended(),n.scheduleUpdate_(t,0),ee.leaveTryBlock(0);break;case 2:if(re=ee.enterCatchBlock(),n.destroyer_.ensureNotDestroyed(re),n.fatalError_)return ee.return();if(goog.asserts.assert(re instanceof shaka.util.Error,"Should only receive a Shaka error"),t.performingUpdate=!1,re.code==shaka.util.Error.Code.OPERATION_ABORTED)t.performingUpdate=!1,t.updateTimer=null,n.scheduleUpdate_(t,0),ee.jumpTo(0);else if(t.type==s.TEXT&&n.config_.ignoreTextStreamFailures)re.code==shaka.util.Error.Code.BAD_HTTP_STATUS?shaka.log.warning(l,"Text stream failed to download. Proceeding without it."):shaka.log.warning(l,"Text stream failed to parse. Proceeding without it."),n.mediaStates_.delete(s.TEXT),ee.jumpTo(0);else if(re.code==shaka.util.Error.Code.QUOTA_EXCEEDED_ERROR)n.handleQuotaExceeded_(t,re),ee.jumpTo(0);else if(re.code==shaka.util.Error.Code.BAD_HTTP_STATUS&&re.data&&re.data[1]==404)shaka.log.v2(l,"segment not available."),t.performingUpdate=!1,t.updateTimer=null,n.scheduleUpdate_(t,1),ee.jumpTo(0);else return shaka.log.error(l,"failed fetch and append: code="+re.code),t.hasError=!0,re.severity=shaka.util.Error.Severity.CRITICAL,ee.yield(n.handleStreamingError_(re),0)}})},shaka.media.StreamingEngine.prototype.retry=function(){if(this.destroyer_.destroyed())return shaka.log.error("Unable to retry after StreamingEngine is destroyed!"),!1;if(this.fatalError_)return shaka.log.error("Unable to retry after StreamingEngine encountered a fatal error!"),!1;for(var t=$jscomp.makeIterator(this.mediaStates_.values()),r=t.next();!r.done;r=t.next()){r=r.value;var i=shaka.media.StreamingEngine.logPrefix_(r);r.hasError&&(shaka.log.info(i,"Retrying after failure..."),r.hasError=!1,this.scheduleUpdate_(r,.1))}return!0},shaka.media.StreamingEngine.prototype.concatArray_=function(t,r){var i=new Uint8Array(t.length+r.length);return i.set(t),i.set(r,t.length),i},shaka.media.StreamingEngine.prototype.handleQuotaExceeded_=function(t,r){var i=shaka.media.StreamingEngine.logPrefix_(t);if(Array.from(this.mediaStates_.values()).some(function(s){return s!=t&&s.recovering}))shaka.log.debug(i,"MediaSource threw QuotaExceededError:","waiting for another stream to recover...");else{var n=Math.round(100*this.bufferingGoalScale_);if(20<n)this.bufferingGoalScale_-=.2;else if(4<n)this.bufferingGoalScale_-=.04;else{shaka.log.error(i,"MediaSource threw QuotaExceededError too many times"),this.fatalError_=t.hasError=!0,this.playerInterface_.onError(r);return}shaka.log.warning(i,"MediaSource threw QuotaExceededError:","reducing buffering goals by "+(100-Math.round(100*this.bufferingGoalScale_))+"%"),t.recovering=!0}this.scheduleUpdate_(t,4)},shaka.media.StreamingEngine.prototype.initSourceBuffer_=function(t,r){var i=this,n,s,o,l,u,m,E,y,D;return $jscomp.asyncExecutePromiseGeneratorProgram(function(w){return n=shaka.media.StreamingEngine,s=n.logPrefix_(t),o=[],l=Math.max(0,r.appendWindowStart-n.APPEND_WINDOW_START_FUDGE_),u=r.appendWindowEnd+n.APPEND_WINDOW_END_FUDGE_,goog.asserts.assert(r.startTime<=u,s+" segment should start before append window end"),m=r.timestampOffset,(m!=t.lastTimestampOffset||l!=t.lastAppendWindowStart||u!=t.lastAppendWindowEnd)&&(shaka.log.v1(s,"setting timestamp offset to "+m),shaka.log.v1(s,"setting append window start to "+l),shaka.log.v1(s,"setting append window end to "+u),E=function(){var B;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){if(F.nextAddress==1)return F.setCatchFinallyBlocks(2),t.lastAppendWindowStart=l,t.lastAppendWindowEnd=u,t.lastTimestampOffset=m,F.yield(i.playerInterface_.mediaSourceEngine.setStreamProperties(t.type,m,l,u),4);if(F.nextAddress!=2)return F.leaveTryBlock(0);throw B=F.enterCatchBlock(),t.lastAppendWindowStart=null,t.lastAppendWindowEnd=null,t.lastTimestampOffset=null,B})},o.push(E())),!shaka.media.InitSegmentReference.equal(r.initSegmentReference,t.lastInitSegmentReference)&&(t.lastInitSegmentReference=r.initSegmentReference)&&(shaka.log.v1(s,"fetching init segment"),y=i.fetch_(t,r.initSegmentReference),D=function(){var B,F,V;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){switch(K.nextAddress){case 1:return K.setCatchFinallyBlocks(2),K.yield(y,4);case 4:return B=K.yieldResult,i.destroyer_.ensureNotDestroyed(),shaka.log.v1(s,"appending init segment"),F=t.stream.closedCaptions&&0<t.stream.closedCaptions.size,K.yield(i.playerInterface_.mediaSourceEngine.appendBuffer(t.type,B,null,null,F),5);case 5:K.leaveTryBlock(0);break;case 2:throw V=K.enterCatchBlock(),t.lastInitSegmentReference=null,V}})},i.playerInterface_.onInitSegmentAppended(r.startTime,r.initSegmentReference),o.push(D())),w.yield(Promise.all(o),0)})},shaka.media.StreamingEngine.prototype.append_=function(t,r,i,n,s){var o=this,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){if(m.nextAddress==1)return l=shaka.media.StreamingEngine.logPrefix_(t),u=i.closedCaptions&&0<i.closedCaptions.size,(i.emsgSchemeIdUris!=null&&0<i.emsgSchemeIdUris.length||o.config_.dispatchAllEmsgBoxes)&&new shaka.util.Mp4Parser().fullBox("emsg",function(E){return o.parseEMSG_(n,i.emsgSchemeIdUris,E)}).parse(s),m.yield(o.evict_(t,r),2);if(m.nextAddress!=3)return o.destroyer_.ensureNotDestroyed(),shaka.log.v1(l,"appending media segment"),m.yield(o.playerInterface_.mediaSourceEngine.appendBuffer(t.type,s,n.startTime,n.endTime,u),3);o.destroyer_.ensureNotDestroyed(),shaka.log.v2(l,"appended media segment"),m.jumpToEnd()})},shaka.media.StreamingEngine.prototype.parseEMSG_=function(t,r,i){if(i.version===0)var n=i.reader.readTerminatedString(),s=i.reader.readTerminatedString(),o=i.reader.readUint32(),l=i.reader.readUint32(),u=i.reader.readUint32(),m=i.reader.readUint32(),E=t.startTime+l/o;else o=i.reader.readUint32(),E=i.reader.readUint64()/o+t.timestampOffset,l=E-t.startTime,u=i.reader.readUint32(),m=i.reader.readUint32(),n=i.reader.readTerminatedString(),s=i.reader.readTerminatedString();t=i.reader.readBytes(i.reader.getLength()-i.reader.getPosition()),(r&&r.includes(n)||this.config_.dispatchAllEmsgBoxes)&&(n=="urn:mpeg:dash:event:2012"?this.playerInterface_.onManifestUpdate():(o={startTime:E,endTime:E+u/o,schemeIdUri:n,value:s,timescale:o,presentationTimeDelta:l,eventDuration:u,id:m,messageData:t},r=shaka.Player.EventName.Emsg,o=new Map().set("detail",o),r=new shaka.util.FakeEvent(r,o),this.playerInterface_.onEvent(r)))},shaka.media.StreamingEngine.prototype.evict_=function(t,r){var i=this,n,s,o,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){if(m.nextAddress==1)return n=shaka.media.StreamingEngine.logPrefix_(t),shaka.log.v2(n,"checking buffer length"),s=Math.max(i.config_.bufferBehind,i.manifest_.presentationTimeline.getMaxSegmentDuration()),o=i.playerInterface_.mediaSourceEngine.bufferStart(t.type),o==null?(shaka.log.v2(n,"buffer behind okay because nothing buffered:","presentationTime="+r,"bufferBehind="+s),m.return()):(l=r-o,u=l-s,.01>=u?(shaka.log.v2(n,"buffer behind okay:","presentationTime="+r,"bufferedBehind="+l,"bufferBehind="+s,"underflow="+Math.abs(u)),m.return()):(shaka.log.v1(n,"buffer behind too large:","presentationTime="+r,"bufferedBehind="+l,"bufferBehind="+s,"overflow="+u),m.yield(i.playerInterface_.mediaSourceEngine.remove(t.type,o,o+u),2)));i.destroyer_.ensureNotDestroyed(),shaka.log.v1(n,"evicted "+u+" seconds"),m.jumpToEnd()})},shaka.media.StreamingEngine.isEmbeddedText_=function(t){var r=shaka.util.MimeUtils,i=r.CEA608_CLOSED_CAPTION_MIMETYPE;return r=r.CEA708_CLOSED_CAPTION_MIMETYPE,t&&t.type==shaka.util.ManifestParserUtils.ContentType.TEXT&&(t.stream.mimeType==i||t.stream.mimeType==r)},shaka.media.StreamingEngine.prototype.fetch_=function(t,r,i){var n=this,s,o,l,u,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return E.nextAddress==1?(s=shaka.net.NetworkingEngine.RequestType.SEGMENT,o=shaka.util.Networking.createSegmentRequest(r.getUris(),r.startByte,r.endByte,n.config_.retryParameters,i),shaka.log.v2("fetching: reference=",r),l=t.stream,n.playerInterface_.modifySegmentRequest(o,{type:l.type,init:r instanceof shaka.media.InitSegmentReference,duration:r.endTime-r.startTime,mimeType:l.mimeType,codecs:l.codecs,bandwidth:l.bandwidth}),u=n.playerInterface_.netEngine.request(s,o),t.operation=u,E.yield(u.promise,2)):(m=E.yieldResult,t.operation=null,E.return(m.data))})},shaka.media.StreamingEngine.prototype.clearBuffer_=function(t,r,i){var n=this,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){if(u.nextAddress==1)return s=shaka.media.StreamingEngine.logPrefix_(t),goog.asserts.assert(!t.performingUpdate&&t.updateTimer==null,s+" unexpected call to clearBuffer_()"),t.waitingToClearBuffer=!1,t.waitingToFlushBuffer=!1,t.clearBufferSafeMargin=0,t.clearingBuffer=!0,t.lastSegmentReference=null,t.lastInitSegmentReference=null,t.segmentIterator=null,shaka.log.debug(s,"clearing buffer"),i?(o=n.playerInterface_.getPresentationTime(),l=n.playerInterface_.mediaSourceEngine.getDuration(),u.yield(n.playerInterface_.mediaSourceEngine.remove(t.type,o+i,l),3)):u.yield(n.playerInterface_.mediaSourceEngine.clear(t.type),4);if(u.nextAddress!=3)return n.destroyer_.ensureNotDestroyed(),r?u.yield(n.playerInterface_.mediaSourceEngine.flush(t.type),3):u.jumpTo(3);n.destroyer_.ensureNotDestroyed(),shaka.log.debug(s,"cleared buffer"),t.clearingBuffer=!1,t.endOfStream=!1,n.scheduleUpdate_(t,0),u.jumpToEnd()})},shaka.media.StreamingEngine.prototype.scheduleUpdate_=function(t,r){var i=this,n=shaka.media.StreamingEngine.logPrefix_(t),s=t.type;s!=shaka.util.ManifestParserUtils.ContentType.TEXT||this.mediaStates_.has(s)?(shaka.log.v2(n,"updating in "+r+" seconds"),goog.asserts.assert(t.updateTimer==null,n+" did not expect update to be scheduled"),t.updateTimer=new shaka.util.DelayedTick(function(){var o;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(l.nextAddress==1)return l.setCatchFinallyBlocks(2),l.yield(i.onUpdate_(t),4);if(l.nextAddress!=2)return l.leaveTryBlock(0);o=l.enterCatchBlock(),i.playerInterface_&&i.playerInterface_.onError(o),l.jumpToEnd()})}).tickAfter(r)):shaka.log.v1(n,"Text stream is unloaded. No update is needed.")},shaka.media.StreamingEngine.prototype.cancelUpdate_=function(t){t.updateTimer!=null&&(t.updateTimer.stop(),t.updateTimer=null)},shaka.media.StreamingEngine.prototype.abortOperations_=function(t){return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return t.operation?r.yield(t.operation.abort(),0):r.jumpTo(0)})},shaka.media.StreamingEngine.prototype.handleStreamingError_=function(t){var r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){if(i.nextAddress==1)return i.yield(r.failureCallbackBackoff_.attempt(),2);r.destroyer_.ensureNotDestroyed(),r.playerInterface_.onError(t),t.handled||r.config_.failureCallback(t),i.jumpToEnd()})},shaka.media.StreamingEngine.logPrefix_=function(t){return"("+t.type+":"+t.stream.id+")"},shaka.media.StreamingEngine.APPEND_WINDOW_START_FUDGE_=.1,shaka.media.StreamingEngine.APPEND_WINDOW_END_FUDGE_=.01,shaka.media.StreamingEngine.MAX_RUN_AHEAD_SEGMENTS_=1,shaka.routing={},shaka.routing.Node={},shaka.routing.Payload={},shaka.routing.Walker=function(t,r,i){var n=this;this.implementation_=i,this.currentlyAt_=t,this.currentlyWith_=r,this.waitForWork_=null,this.requests_=[],this.currentStep_=this.currentRoute_=null,this.mainLoopPromise_=Promise.resolve().then(function(){return n.mainLoop_()}),this.destroyer_=new shaka.util.Destroyer(function(){return n.doDestroy_()})},shaka.routing.Walker.prototype.getCurrentPayload=function(){return this.currentlyWith_},shaka.routing.Walker.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.routing.Walker.prototype.doDestroy_=function(){var t=this,r,i,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){if(s.nextAddress==1)return t.currentStep_&&t.currentStep_.abort(),t.unblockMainLoop_(),s.yield(t.mainLoopPromise_,2);for(t.currentRoute_&&t.currentRoute_.listeners.onCancel(),r=$jscomp.makeIterator(t.requests_),i=r.next();!i.done;i=r.next())n=i.value,n.listeners.onCancel();t.currentRoute_=null,t.requests_=[],t.implementation_=null,s.jumpToEnd()})},shaka.routing.Walker.prototype.startNewRoute=function(t){var r={onStart:function(){},onEnd:function(){},onCancel:function(){},onError:function(i){},onSkip:function(){},onEnter:function(){}};return this.requests_.push({create:t,listeners:r}),this.currentStep_&&this.currentStep_.abort(),this.unblockMainLoop_(),r},shaka.routing.Walker.prototype.mainLoop_=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return t.destroyer_.destroyed()?r.jumpTo(0):r.yield(t.doOneThing_(),1)})},shaka.routing.Walker.prototype.doOneThing_=function(){return this.tryNewRoute_()?Promise.resolve():this.currentRoute_?this.takeNextStep_():(goog.asserts.assert(this.waitForWork_==null,"We should not have a promise yet."),this.implementation_.onIdle(this.currentlyAt_),this.waitForWork_=new shaka.util.PublicPromise)},shaka.routing.Walker.prototype.tryNewRoute_=function(){if(goog.asserts.assert(this.currentStep_==null,"We should never have a current step between taking steps."),this.requests_.length==0||this.currentRoute_&&!this.currentRoute_.interruptible)return!1;this.currentRoute_&&(this.currentRoute_.listeners.onCancel(),this.currentRoute_=null);var t=this.requests_.shift(),r=t.create(this.currentlyWith_);return r?(t.listeners.onStart(),this.currentRoute_={node:r.node,payload:r.payload,interruptible:r.interruptible,listeners:t.listeners}):t.listeners.onSkip(),!0},shaka.routing.Walker.prototype.takeNextStep_=function(){var t=this,r,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){switch(n.nextAddress){case 1:return goog.asserts.assert(t.currentRoute_,"We need a current route to take the next step."),t.currentlyAt_=t.implementation_.getNext(t.currentlyAt_,t.currentlyWith_,t.currentRoute_.node,t.currentRoute_.payload),t.currentRoute_.listeners.onEnter(t.currentlyAt_),n.setCatchFinallyBlocks(2),t.currentStep_=t.implementation_.enterNode(t.currentlyAt_,t.currentlyWith_,t.currentRoute_.payload),n.yield(t.currentStep_.promise,4);case 4:t.currentStep_=null,t.currentlyAt_==t.currentRoute_.node&&(t.currentRoute_.listeners.onEnd(),t.currentRoute_=null),n.leaveTryBlock(0);break;case 2:return r=n.enterCatchBlock(),r.code==shaka.util.Error.Code.OPERATION_ABORTED?(goog.asserts.assert(t.currentRoute_.interruptible,"Do not put abortable steps in non-interruptible routes!"),t.currentRoute_.listeners.onCancel()):t.currentRoute_.listeners.onError(r),t.currentRoute_=null,t.currentStep_=null,i=t,n.yield(t.implementation_.handleError(t.currentlyWith_,r),5);case 5:i.currentlyAt_=n.yieldResult,n.jumpToEnd()}})},shaka.routing.Walker.prototype.unblockMainLoop_=function(){this.waitForWork_&&(this.waitForWork_.resolve(),this.waitForWork_=null)},shaka.text.SimpleTextDisplayer=function(t){this.textTrack_=null;for(var r=$jscomp.makeIterator(Array.from(t.textTracks)),i=r.next();!i.done;i=r.next())i=i.value,i.mode="disabled",i.label==shaka.Player.TextTrackLabel&&(this.textTrack_=i);this.textTrack_||(this.textTrack_=t.addTextTrack("subtitles",shaka.Player.TextTrackLabel)),this.textTrack_.mode="hidden"},shaka.text.SimpleTextDisplayer.prototype.remove=function(t,r){return this.textTrack_?(shaka.text.SimpleTextDisplayer.removeWhere_(this.textTrack_,function(i){return i.startTime<r&&i.endTime>t}),!0):!1},shaka.text.SimpleTextDisplayer.prototype.append=function(t){var r=function(u){var m=[],E=u.fontWeight>=shaka.text.Cue.fontWeight.BOLD,y=u.fontStyle==shaka.text.Cue.fontStyle.ITALIC,D=u.textDecoration.includes(shaka.text.Cue.textDecoration.UNDERLINE);return E&&m.push("b"),y&&m.push("i"),D&&m.push("u"),E=m.reduce(function(w,B){return w+"<"+B+">"},""),m=m.reduceRight(function(w,B){return w+"</"+B+">"},""),u.lineBreak||u.spacer?(u.spacer&&shaka.Deprecate.deprecateFeature(4,"shaka.extern.Cue","Please use lineBreak instead of spacer."),`
`):u.nestedCues.length?u.nestedCues.map(r).join(""):E+u.payload+m},i=function(u,m){for(var E=$jscomp.makeIterator(u),y=E.next();!y.done;y=E.next())if(y=y.value,y.isContainer)i(y.nestedCues,m);else{var D=y.clone();D.nestedCues=[],D.payload=r(y),m.push(D)}return m},n=i(t,[]),s=[];t=this.textTrack_.cues?Array.from(this.textTrack_.cues):[];var o={};n=$jscomp.makeIterator(n);for(var l=n.next();!l.done;o={$jscomp$loop$prop$inCue$599:o.$jscomp$loop$prop$inCue$599},l=n.next())o.$jscomp$loop$prop$inCue$599=l.value,t.some(function(u){return function(m){return m.startTime==u.$jscomp$loop$prop$inCue$599.startTime&&m.endTime==u.$jscomp$loop$prop$inCue$599.endTime&&m.text==u.$jscomp$loop$prop$inCue$599.payload}}(o))||(l=shaka.text.SimpleTextDisplayer.convertToTextTrackCue_(o.$jscomp$loop$prop$inCue$599))&&s.push(l);for(t=s.slice().sort(function(u,m){return u.startTime!=m.startTime?u.startTime-m.startTime:u.endTime!=m.endTime?u.endTime-m.startTime:"line"in VTTCue.prototype?s.indexOf(m)-s.indexOf(u):s.indexOf(u)-s.indexOf(m)}),t=$jscomp.makeIterator(t),o=t.next();!o.done;o=t.next())this.textTrack_.addCue(o.value)},shaka.text.SimpleTextDisplayer.prototype.destroy=function(){return this.textTrack_&&(shaka.text.SimpleTextDisplayer.removeWhere_(this.textTrack_,function(t){return!0}),this.textTrack_.mode="disabled"),this.textTrack_=null,Promise.resolve()},shaka.text.SimpleTextDisplayer.prototype.isTextVisible=function(){return this.textTrack_.mode=="showing"},shaka.text.SimpleTextDisplayer.prototype.setTextVisibility=function(t){this.textTrack_.mode=t?"showing":"hidden"},shaka.text.SimpleTextDisplayer.convertToTextTrackCue_=function(t){if(t.startTime>=t.endTime)return shaka.log.warning("Invalid cue times: "+t.startTime+" - "+t.endTime),null;var r=shaka.text.Cue,i=new VTTCue(t.startTime,t.endTime,t.payload);i.lineAlign=t.lineAlign,i.positionAlign=t.positionAlign,t.size&&(i.size=t.size);try{i.align=t.textAlign}catch{}return t.textAlign=="center"&&i.align!="center"&&(i.align="middle"),t.writingMode==r.writingMode.VERTICAL_LEFT_TO_RIGHT?i.vertical="lr":t.writingMode==r.writingMode.VERTICAL_RIGHT_TO_LEFT&&(i.vertical="rl"),t.lineInterpretation==r.lineInterpretation.PERCENTAGE&&(i.snapToLines=!1),t.line!=null&&(i.line=t.line),t.position!=null&&(i.position=t.position),i},shaka.text.SimpleTextDisplayer.removeWhere_=function(t,r){var i=t.mode,n=i=="showing"?"showing":"hidden";t.mode=n,goog.asserts.assert(t.cues,'Cues should be accessible when mode is set to "'+n+'".'),n=$jscomp.makeIterator(Array.from(t.cues));for(var s=n.next();!s.done;s=n.next())(s=s.value)&&r(s)&&t.removeCue(s);t.mode=i},goog.exportSymbol("shaka.text.SimpleTextDisplayer",shaka.text.SimpleTextDisplayer),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"setTextVisibility",shaka.text.SimpleTextDisplayer.prototype.setTextVisibility),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"isTextVisible",shaka.text.SimpleTextDisplayer.prototype.isTextVisible),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"destroy",shaka.text.SimpleTextDisplayer.prototype.destroy),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"append",shaka.text.SimpleTextDisplayer.prototype.append),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"remove",shaka.text.SimpleTextDisplayer.prototype.remove),shaka.util.Dom=function(){},shaka.util.Dom.createHTMLElement=function(t){return document.createElement(t)},shaka.util.Dom.createButton=function(){return document.createElement("button")},shaka.util.Dom.asHTMLElement=function(t){return t},shaka.util.Dom.asHTMLMediaElement=function(t){return t},shaka.util.Dom.getElementByClassName=function(t,r){var i=r.getElementsByClassName(t);return goog.asserts.assert(i.length==1,"Should only be one element with class name "+t),shaka.util.Dom.asHTMLElement(i[0])},shaka.util.Dom.removeAllChildren=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},goog.exportSymbol("shaka.util.Dom",shaka.util.Dom),goog.exportProperty(shaka.util.Dom,"removeAllChildren",shaka.util.Dom.removeAllChildren),shaka.text.UITextDisplayer=function(t,r){var i=this;goog.asserts.assert(r,"videoContainer should be valid."),this.isTextVisible_=!1,this.cues_=[],this.video_=t,this.videoContainer_=r,this.textContainer_=shaka.util.Dom.createHTMLElement("div"),this.textContainer_.classList.add("shaka-text-container"),this.textContainer_.style.textAlign="center",this.textContainer_.style.display="flex",this.textContainer_.style.flexDirection="column",this.textContainer_.style.alignItems="center",this.textContainer_.style.justifyContent="flex-end",this.videoContainer_.appendChild(this.textContainer_),this.captionsTimer_=new shaka.util.Timer(function(){i.updateCaptions_()}).tickEvery(.25),this.currentCuesMap_=new Map,this.eventManager_=new shaka.util.EventManager,this.eventManager_.listen(document,"fullscreenchange",function(){i.updateCaptions_(!0)}),this.resizeObserver_=null,"ResizeObserver"in window&&(this.resizeObserver_=new ResizeObserver(function(){i.updateCaptions_(!0)}),this.resizeObserver_.observe(this.textContainer_)),this.regionElements_=new Map},shaka.text.UITextDisplayer.prototype.append=function(t){var r=[].concat($jscomp.arrayFromIterable(this.cues_)),i={};t=$jscomp.makeIterator(t);for(var n=t.next();!n.done;i={$jscomp$loop$prop$cue$601:i.$jscomp$loop$prop$cue$601},n=t.next())i.$jscomp$loop$prop$cue$601=n.value,r.some(function(s){return function(o){return shaka.text.Cue.equal(o,s.$jscomp$loop$prop$cue$601)}}(i))||this.cues_.push(i.$jscomp$loop$prop$cue$601);this.updateCaptions_()},shaka.text.UITextDisplayer.prototype.destroy=function(){this.videoContainer_.removeChild(this.textContainer_),this.textContainer_=null,this.isTextVisible_=!1,this.cues_=[],this.captionsTimer_&&this.captionsTimer_.stop(),this.currentCuesMap_.clear(),this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),this.resizeObserver_&&(this.resizeObserver_.disconnect(),this.resizeObserver_=null)},shaka.text.UITextDisplayer.prototype.remove=function(t,r){if(!this.textContainer_)return!1;var i=this.cues_.length;return this.cues_=this.cues_.filter(function(n){return n.startTime<t||n.endTime>=r}),this.updateCaptions_(i>this.cues_.length),!0},shaka.text.UITextDisplayer.prototype.isTextVisible=function(){return this.isTextVisible_},shaka.text.UITextDisplayer.prototype.setTextVisibility=function(t){this.isTextVisible_=t},shaka.text.UITextDisplayer.prototype.updateCuesRecursive_=function(t,r,i,n){var s=!1,o=[],l=[];t=$jscomp.makeIterator(t);for(var u=t.next();!u.done;u=t.next()){u=u.value,n.push(u);var m=this.currentCuesMap_.get(u),E=u.startTime<=i&&u.endTime>i,y=m?m.wrapper:null;m&&(o.push(m.cueElement),m.regionElement&&o.push(m.regionElement),E||(s=!0,this.currentCuesMap_.delete(u),m=null)),E&&(l.push(u),m||(this.createCue_(u,n),m=this.currentCuesMap_.get(u),y=m.wrapper,s=!0)),0<u.nestedCues.length&&y&&this.updateCuesRecursive_(u.nestedCues,y,i,n),m=n.pop(),goog.asserts.assert(m==u,"Parent cues should be kept in order")}if(s){for(i=$jscomp.makeIterator(o),n=i.next();!n.done;n=i.next())n=n.value,n.parentElement&&n.parentElement.removeChild(n);for(l.sort(function(D,w){return D.startTime!=w.startTime?D.startTime-w.startTime:D.endTime-w.endTime}),l=$jscomp.makeIterator(l),u=l.next();!u.done;u=l.next())i=this.currentCuesMap_.get(u.value),goog.asserts.assert(i,"cueRegistry should exist."),i.regionElement?(r.appendChild(i.regionElement),i.regionElement.appendChild(i.cueElement)):r.appendChild(i.cueElement)}},shaka.text.UITextDisplayer.prototype.updateCaptions_=function(t){if(this.textContainer_){var r=this.video_.currentTime;if(!this.isTextVisible_||t!==void 0&&t){t=$jscomp.makeIterator(this.regionElements_.values());for(var i=t.next();!i.done;i=t.next())shaka.util.Dom.removeAllChildren(i.value);shaka.util.Dom.removeAllChildren(this.textContainer_),this.currentCuesMap_.clear(),this.regionElements_.clear()}if(this.isTextVisible_){t=new Map,i=$jscomp.makeIterator(this.currentCuesMap_.keys());for(var n=i.next();!n.done;n=i.next())n=n.value,t.set(n,this.currentCuesMap_.get(n));if(this.updateCuesRecursive_(this.cues_,this.textContainer_,r,[]),goog.DEBUG)for(r=$jscomp.makeIterator(t.keys()),n=r.next();!n.done;n=r.next())i=n.value,this.currentCuesMap_.has(i)||(i=t.get(i).cueElement,goog.asserts.assert(!i.parentNode,"Cue was not properly removed!"))}}},shaka.text.UITextDisplayer.prototype.getRegionElement_=function(t){var r=t.region;if(this.regionElements_.has(r.id))return this.regionElements_.get(r.id);var i=shaka.util.Dom.createHTMLElement("span"),n=shaka.text.CueRegion.units.PERCENTAGE,s=r.heightUnits==n?"%":"px",o=r.widthUnits==n?"%":"px";return n=r.viewportAnchorUnits==n?"%":"px",i.id="shaka-text-region---"+r.id,i.classList.add("shaka-text-region"),i.style.height=r.height+s,i.style.width=r.width+o,i.style.position="absolute",i.style.top=r.viewportAnchorY+n,i.style.left=r.viewportAnchorX+n,i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.justifyContent=t.displayAlign==shaka.text.Cue.displayAlign.BEFORE?"flex-start":t.displayAlign==shaka.text.Cue.displayAlign.CENTER?"center":"flex-end",this.regionElements_.set(r.id,i),i},shaka.text.UITextDisplayer.prototype.createCue_=function(t,r){var i=1<r.length,n=i?"span":"div";(t.lineBreak||t.spacer)&&(t.spacer&&shaka.Deprecate.deprecateFeature(4,"shaka.extern.Cue","Please use lineBreak instead of spacer."),n="br"),i=!i&&0<t.nestedCues.length;var s=shaka.util.Dom.createHTMLElement(n);n!="br"&&this.setCaptionStyles_(s,t,r,i),n=null,t.region&&t.region.id&&(n=this.getRegionElement_(t));var o=s;i&&(o=shaka.util.Dom.createHTMLElement("span"),o.classList.add("shaka-text-wrapper"),o.style.backgroundColor=t.backgroundColor,s.appendChild(o)),this.currentCuesMap_.set(t,{cueElement:s,wrapper:o,regionElement:n})},shaka.text.UITextDisplayer.prototype.setCaptionStyles_=function(t,r,i,n){var s=shaka.text.Cue,o=t.style,l=r.nestedCues.length==0,u=1<i.length;o.whiteSpace="pre-wrap";var m=r.payload.replace(/\s+$/g,function(y){return"\xA0".repeat(y.length)});if(o.webkitTextStrokeColor=r.textStrokeColor,o.webkitTextStrokeWidth=r.textStrokeWidth,o.color=r.color,o.direction=r.direction,o.opacity=r.opacity,o.paddingLeft=shaka.text.UITextDisplayer.convertLengthValue_(r.linePadding,r,this.videoContainer_),o.paddingRight=shaka.text.UITextDisplayer.convertLengthValue_(r.linePadding,r,this.videoContainer_),r.backgroundImage)o.backgroundImage="url('"+r.backgroundImage+"')",o.backgroundRepeat="no-repeat",o.backgroundSize="contain",o.backgroundPosition="center";else{if(r.nestedCues.length)var E=t;else E=shaka.util.Dom.createHTMLElement("span"),t.appendChild(E);r.border&&(E.style.border=r.border),n||((t=shaka.text.UITextDisplayer.inheritProperty_(i,function(y){return y.backgroundColor}))?E.style.backgroundColor=t:m&&(E.style.backgroundColor="rgba(0, 0, 0, 0.8)")),m&&(E.textContent=m)}u&&!i[i.length-1].isContainer?o.display="inline":(o.display="flex",o.flexDirection="column",o.alignItems="center",o.justifyContent=r.displayAlign==s.displayAlign.BEFORE?"flex-start":r.displayAlign==s.displayAlign.CENTER?"center":"flex-end"),l||(o.margin="0"),o.fontFamily=r.fontFamily,o.fontWeight=r.fontWeight.toString(),o.fontStyle=r.fontStyle,o.letterSpacing=r.letterSpacing,o.fontSize=shaka.text.UITextDisplayer.convertLengthValue_(r.fontSize,r,this.videoContainer_),r.line&&r.lineInterpretation==s.lineInterpretation.PERCENTAGE&&(o.position="absolute",o.left="0",o.top="0",r.writingMode==s.writingMode.HORIZONTAL_TOP_TO_BOTTOM?(o.width="100%",r.lineAlign==s.lineAlign.START?o.top=r.line+"%":r.lineAlign==s.lineAlign.END&&(o.bottom=r.line+"%")):r.writingMode==s.writingMode.VERTICAL_LEFT_TO_RIGHT?(o.height="100%",r.lineAlign==s.lineAlign.START?o.left=r.line+"%":r.lineAlign==s.lineAlign.END&&(o.right=r.line+"%")):(o.height="100%",r.lineAlign==s.lineAlign.START?o.right=r.line+"%":r.lineAlign==s.lineAlign.END&&(o.left=r.line+"%"))),o.lineHeight=r.lineHeight,r.position&&(r.writingMode==s.writingMode.HORIZONTAL_TOP_TO_BOTTOM?o.paddingLeft=r.position:o.paddingTop=r.position),r.positionAlign==s.positionAlign.LEFT?o.cssFloat="left":r.positionAlign==s.positionAlign.RIGHT&&(o.cssFloat="right"),o.textAlign=r.textAlign,o.textDecoration=r.textDecoration.join(" "),o.writingMode=r.writingMode,"writingMode"in document.documentElement.style&&o.writingMode==r.writingMode||(o.webkitWritingMode=r.writingMode),r.size&&(r.writingMode==s.writingMode.HORIZONTAL_TOP_TO_BOTTOM?o.width=r.size+"%":o.height=r.size+"%")},shaka.text.UITextDisplayer.getLengthValueInfo_=function(t){return(t=new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(t))?{value:Number(t[1]),unit:t[2]}:null},shaka.text.UITextDisplayer.convertLengthValue_=function(t,r,i){var n=shaka.text.UITextDisplayer.getLengthValueInfo_(t);if(!n)return t;var s=n.value;switch(n.unit){case"%":return shaka.text.UITextDisplayer.getAbsoluteLengthInPixels_(s/100,r,i);case"c":return shaka.text.UITextDisplayer.getAbsoluteLengthInPixels_(s,r,i);default:return t}},shaka.text.UITextDisplayer.getAbsoluteLengthInPixels_=function(t,r,i){return i.clientHeight*t/r.cellResolution.rows+"px"},shaka.text.UITextDisplayer.inheritProperty_=function(t,r){for(var i=t.length-1;0<=i;i--){var n=r(t[i]);if(n||n===0)return n}return null},goog.exportSymbol("shaka.text.UITextDisplayer",shaka.text.UITextDisplayer),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"setTextVisibility",shaka.text.UITextDisplayer.prototype.setTextVisibility),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"isTextVisible",shaka.text.UITextDisplayer.prototype.isTextVisible),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"remove",shaka.text.UITextDisplayer.prototype.remove),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"destroy",shaka.text.UITextDisplayer.prototype.destroy),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"append",shaka.text.UITextDisplayer.prototype.append),shaka.text.WebVttGenerator=function(){},shaka.text.WebVttGenerator.convert=function(t,r){var i=function(u){var m=[],E=u.fontWeight>=shaka.text.Cue.fontWeight.BOLD,y=u.fontStyle==shaka.text.Cue.fontStyle.ITALIC,D=u.textDecoration.includes(shaka.text.Cue.textDecoration.UNDERLINE);return E&&m.push("b"),y&&m.push("i"),D&&m.push("u"),E=m.reduce(function(w,B){return w+"<"+B+">"},""),m=m.reduceRight(function(w,B){return w+"</"+B+">"},""),u.lineBreak||u.spacer?(u.spacer&&shaka.Deprecate.deprecateFeature(4,"shaka.text.Cue","Please use lineBreak instead of spacer."),`
`):u.nestedCues.length?u.nestedCues.map(i).join(""):E+u.payload+m},n=function(u){for(var m=u,E=$jscomp.makeIterator(r),y=E.next();!y.done;y=E.next())y=y.value,y.end&&y.start<u&&(m+=y.end-y.start);return u=Math.floor(m/3600),E=Math.floor(m/60%60),y=Math.floor(m%60),m=Math.floor(1e3*m%1e3),(10>u?"0":"")+u+":"+(10>E?"0":"")+E+":"+(10>y?"0":"")+y+"."+(100>m?10>m?"00":"0":"")+m},s=t.map(function(u){if(u.nestedCues.length){var m=u.clone();return m.nestedCues=[],m.payload=i(u),m}return u}),o=`WEBVTT

`;s=$jscomp.makeIterator(s);for(var l=s.next();!l.done;l=s.next())l=l.value,o+=n(l.startTime)+" --> "+n(l.endTime)+function(u){var m=[],E=shaka.text.Cue;switch(u.textAlign){case E.textAlign.LEFT:m.push("align:left");break;case E.textAlign.RIGHT:m.push("align:right");break;case E.textAlign.CENTER:m.push("align:middle");break;case E.textAlign.START:m.push("align:start");break;case E.textAlign.END:m.push("align:end")}switch(u.writingMode){case E.writingMode.VERTICAL_LEFT_TO_RIGHT:m.push("vertical:lr");break;case E.writingMode.VERTICAL_RIGHT_TO_LEFT:m.push("vertical:rl")}return m.length?" "+m.join(" "):""}(l)+`
`,o+=l.payload+`

`;return o},goog.exportSymbol("shaka.text.WebVttGenerator",shaka.text.WebVttGenerator),shaka.util.CmcdManager=function(t,r){this.playerInterface_=t,this.config_=r,this.sid_="",this.sf_=void 0,this.playbackStarted_=!1,this.buffering_=!0,this.starved_=!1},shaka.util.CmcdManager.prototype.setBuffering=function(t){t||this.playbackStarted_||(this.playbackStarted_=!0),this.playbackStarted_&&t&&(this.starved_=!0),this.buffering_=t},shaka.util.CmcdManager.prototype.applyManifestData=function(t,r){try{this.config_.enabled&&(this.sf_=r.format,this.apply_(t,{ot:shaka.util.CmcdManager.ObjectType.MANIFEST,su:!this.playbackStarted_}))}catch(i){shaka.log.warnOnce("CMCD_MANIFEST_ERROR","Could not generate manifest CMCD data.",i)}},shaka.util.CmcdManager.prototype.applySegmentData=function(t,r){try{if(this.config_.enabled){var i={d:1e3*r.duration,st:this.getStreamType_()};i.ot=this.getObjectType_(r);var n=shaka.util.CmcdManager.ObjectType,s=i.ot===n.VIDEO||i.ot===n.AUDIO||i.ot===n.MUXED||i.ot===n.TIMED_TEXT;s&&(i.bl=this.getBufferLength_(r.type)),r.bandwidth&&(i.br=r.bandwidth/1e3),s&&i.ot!==n.TIMED_TEXT&&(i.tb=this.getTopBandwidth_(i.ot)/1e3),this.apply_(t,i)}}catch(o){shaka.log.warnOnce("CMCD_SEGMENT_ERROR","Could not generate segment CMCD data.",o)}},shaka.util.CmcdManager.prototype.applyTextData=function(t){try{this.config_.enabled&&this.apply_(t,{ot:shaka.util.CmcdManager.ObjectType.CAPTION,su:!0})}catch(r){shaka.log.warnOnce("CMCD_TEXT_ERROR","Could not generate text CMCD data.",r)}},shaka.util.CmcdManager.prototype.appendSrcData=function(t,r){try{if(!this.config_.enabled)return t;var i=this.createData_();i.ot=this.getObjectTypeFromMimeType_(r),i.su=!0;var n=shaka.util.CmcdManager.toQuery(i);return shaka.util.CmcdManager.appendQueryToUri(t,n)}catch(s){return shaka.log.warnOnce("CMCD_SRC_ERROR","Could not generate src CMCD data.",s),t}},shaka.util.CmcdManager.prototype.appendTextTrackData=function(t){try{if(!this.config_.enabled)return t;var r=this.createData_();r.ot=shaka.util.CmcdManager.ObjectType.CAPTION,r.su=!0;var i=shaka.util.CmcdManager.toQuery(r);return shaka.util.CmcdManager.appendQueryToUri(t,i)}catch(n){return shaka.log.warnOnce("CMCD_TEXT_TRACK_ERROR","Could not generate text track CMCD data.",n),t}},shaka.util.CmcdManager.prototype.createData_=function(){return this.sid_||(this.sid_=this.config_.sessionId||window.crypto.randomUUID()),{v:shaka.util.CmcdManager.Version,sf:this.sf_,sid:this.sid_,cid:this.config_.contentId,mtp:this.playerInterface_.getBandwidthEstimate()/1e3}},shaka.util.CmcdManager.prototype.apply_=function(t,r,i){if(r=r===void 0?{}:r,i=i===void 0?this.config_.useHeaders:i,this.config_.enabled){Object.assign(r,this.createData_()),r.pr=this.playerInterface_.getPlaybackRate();var n=r.ot===shaka.util.CmcdManager.ObjectType.VIDEO||r.ot===shaka.util.CmcdManager.ObjectType.MUXED;if(this.starved_&&n&&(r.bs=!0,r.su=!0,this.starved_=!1),r.su==null&&(r.su=this.buffering_),i)r=shaka.util.CmcdManager.toHeaders(r),Object.keys(r).length&&Object.assign(t.headers,r);else{var s=shaka.util.CmcdManager.toQuery(r);s&&(t.uris=t.uris.map(function(o){return shaka.util.CmcdManager.appendQueryToUri(o,s)}))}}},shaka.util.CmcdManager.prototype.getObjectType_=function(t){var r=t.type;if(t.init)return shaka.util.CmcdManager.ObjectType.INIT;if(r=="video")return t.codecs.includes(",")?shaka.util.CmcdManager.ObjectType.MUXED:shaka.util.CmcdManager.ObjectType.VIDEO;if(r=="audio")return shaka.util.CmcdManager.ObjectType.AUDIO;if(r=="text")return t.mimeType==="application/mp4"?shaka.util.CmcdManager.ObjectType.TIMED_TEXT:shaka.util.CmcdManager.ObjectType.CAPTION},shaka.util.CmcdManager.prototype.getObjectTypeFromMimeType_=function(t){switch(t){case"video/webm":case"video/mp4":return shaka.util.CmcdManager.ObjectType.MUXED;case"application/x-mpegurl":return shaka.util.CmcdManager.ObjectType.MANIFEST}},shaka.util.CmcdManager.prototype.getBufferLength_=function(t){if(t=this.playerInterface_.getBufferedInfo()[t],!t.length)return NaN;var r=this.playerInterface_.getCurrentTime();return(t=t.find(function(i){return i.start<=r&&i.end>=r}))?1e3*(t.end-r):NaN},shaka.util.CmcdManager.prototype.getStreamType_=function(){return this.playerInterface_.isLive()?shaka.util.CmcdManager.StreamType.LIVE:shaka.util.CmcdManager.StreamType.VOD},shaka.util.CmcdManager.prototype.getTopBandwidth_=function(t){var r=this.playerInterface_.getVariantTracks();if(!r.length)return NaN;var i=r[0];r=$jscomp.makeIterator(r);for(var n=r.next();!n.done;n=r.next())n=n.value,n.type==="variant"&&n.bandwidth>i.bandwidth&&(i=n);switch(r=shaka.util.CmcdManager.ObjectType,t){case r.VIDEO:return i.videoBandwidth||NaN;case r.AUDIO:return i.audioBandwidth||NaN;default:return i.bandwidth}},shaka.util.CmcdManager.serialize=function(t){var r=[],i=function(y){return!Number.isNaN(y)&&y!=null&&y!==""&&y!==!1},n=function(y){return Math.round(y)},s=function(y){return 100*n(y/100)};s={br:n,d:n,bl:s,dl:s,mtp:s,nor:function(y){return encodeURIComponent(y)},rtp:s,tb:n};var o=Object.keys(t||{}).sort();o=$jscomp.makeIterator(o);for(var l=o.next();!l.done;l=o.next()){l=l.value;var u=t[l];if(i(u)&&(l!=="v"||u!==1)&&(l!="pr"||u!==1)){var m=s[l];m&&(u=m(u)),m=typeof u;var E=void 0;E=m==="string"&&l!=="ot"&&l!=="sf"&&l!=="st"?l+"="+JSON.stringify(u):m==="boolean"?l:m==="symbol"?l+"="+u.description:l+"="+u,r.push(E)}}return r.join(",")},shaka.util.CmcdManager.toHeaders=function(t){var r=Object.keys(t),i={},n=["Object","Request","Session","Status"],s=[{},{},{},{}],o={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};r=$jscomp.makeIterator(r);for(var l=r.next();!l.done;l=r.next())l=l.value,s[o[l]!=null?o[l]:1][l]=t[l];for(t=0;t<s.length;t++)(o=shaka.util.CmcdManager.serialize(s[t]))&&(i["CMCD-"+n[t]]=o);return i},shaka.util.CmcdManager.toQuery=function(t){return shaka.util.CmcdManager.serialize(t)},shaka.util.CmcdManager.appendQueryToUri=function(t,r){if(!r||t.includes("offline:"))return t;var i=new goog.Uri(t);return i.getQueryData().set("CMCD",r),i.toString()},shaka.util.CmcdManager.ObjectType={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},shaka.util.CmcdManager.StreamType={VOD:"v",LIVE:"l"},shaka.util.CmcdManager.StreamingFormat={DASH:"d",HLS:"h",SMOOTH:"s",OTHER:"o"},goog.exportSymbol("shaka.util.CmcdManager.StreamingFormat",shaka.util.CmcdManager.StreamingFormat),shaka.util.CmcdManager.Version=1,shaka.util.ConfigUtils=function(){},shaka.util.ConfigUtils.mergeConfigObjects=function(t,r,i,n,s){goog.asserts.assert(t,"Destination config must not be null!");var o=s in n,l=!0,u;for(u in r){var m=s+"."+u,E=o?n[s]:i[u];o||u in i?r[u]===void 0?E===void 0||o?delete t[u]:t[u]=shaka.util.ObjectUtils.cloneObject(E):E.constructor==Object&&r[u]&&r[u].constructor==Object?(t[u]||(t[u]=shaka.util.ObjectUtils.cloneObject(E)),m=shaka.util.ConfigUtils.mergeConfigObjects(t[u],r[u],E,n,m),l=l&&m):typeof r[u]!=typeof E||r[u]==null||typeof r[u]!="function"&&r[u].constructor!=E.constructor?(shaka.log.alwaysError("Invalid config, wrong type for "+m),l=!1):(typeof i[u]=="function"&&i[u].length!=r[u].length&&shaka.log.alwaysWarn("Unexpected number of arguments for "+m),t[u]=r[u]):(shaka.log.alwaysError("Invalid config, unrecognized key "+m),l=!1)}return l},shaka.util.ConfigUtils.convertToConfigObject=function(t,r){for(var i={},n=i,s=0,o=0;s=t.indexOf(".",s),!(0>s);)(s==0||t[s-1]!="\\")&&(o=t.substring(o,s).replace(/\\\./g,"."),n[o]={},n=n[o],o=s+1),s+=1;return n[t.substring(o).replace(/\\\./g,".")]=r,i},shaka.util.ConfigUtils.referenceParametersAndReturn=function(t,r){return t&&r},goog.exportSymbol("shaka.util.ConfigUtils",shaka.util.ConfigUtils),goog.exportProperty(shaka.util.ConfigUtils,"convertToConfigObject",shaka.util.ConfigUtils.convertToConfigObject),goog.exportProperty(shaka.util.ConfigUtils,"mergeConfigObjects",shaka.util.ConfigUtils.mergeConfigObjects),shaka.util.PlayerConfiguration=function(){},shaka.util.PlayerConfiguration.createDefault=function(){var t=1/0;navigator.connection&&navigator.connection.saveData&&(t=360);var r={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:shaka.media.DrmEngine.defaultInitDataTransform,logLicenseExchange:!1,updateExpirationTime:1,preferredKeySystems:[]},i={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,disableThumbnails:!1,defaultPresentationDelay:0,dash:{clockSyncUri:"",ignoreDrmInfo:!1,disableXlinkProcessing:!1,xlinkFailGracefully:!1,ignoreMinBufferTime:!1,autoCorrectDrift:!0,initialSegmentLimit:1e3,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1,ignoreMaxSegmentDuration:!1,keySystemsByURI:{"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},manifestPreprocessor:function(l){return shaka.util.ConfigUtils.referenceParametersAndReturn([l],l)}},hls:{ignoreTextStreamFailures:!1,ignoreImageStreamFailures:!1,useFullSegmentsForStartTime:!1,defaultAudioCodec:"mp4a.40.2",defaultVideoCodec:"avc1.42E01E"}},n={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),failureCallback:function(l){return shaka.log.error("Unhandled streaming error",l),shaka.util.ConfigUtils.referenceParametersAndReturn([l],void 0)},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,gapDetectionThreshold:.1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0,inaccurateManifestTolerance:2,lowLatencyMode:!1,autoLowLatencyMode:!1,forceHTTPS:!1,preferNativeHls:!1,updateIntervalSeconds:1,dispatchAllEmsgBoxes:!1,observeQualityChanges:!1};(shaka.util.Platform.isLegacyEdge()||shaka.util.Platform.isTizen()||shaka.util.Platform.isChromecast())&&(n.gapDetectionThreshold=.5),(shaka.util.Platform.isWebOS()||shaka.util.Platform.isTizen()||shaka.util.Platform.isChromecast())&&(n.stallSkip=0);var s={trackSelectionCallback:function(l){return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){return u.return(l)})},downloadSizeCallback:function(l){var u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){return m.nextAddress==1?navigator.storage&&navigator.storage.estimate?m.yield(navigator.storage.estimate(),3):m.return(!0):(u=m.yieldResult,m.return(u.usage+l<.95*u.quota))})},progressCallback:function(l,u){return shaka.util.ConfigUtils.referenceParametersAndReturn([l,u],void 0)},usePersistentLicense:!0},o={drm:r,manifest:i,streaming:n,offline:s,abrFactory:function(){return new shaka.abr.SimpleAbrManager},abr:{enabled:!0,useNetworkInformation:!0,defaultBandwidthEstimate:1e6,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:t,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},advanced:{minTotalBytes:128e3,minBytes:16e3,fastHalfLife:2,slowHalfLife:5}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,preferredVideoCodecs:[],preferredAudioCodecs:[],preferForcedSubs:!1,preferredDecodingAttributes:[],restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null},cmcd:{enabled:!1,sessionId:"",contentId:"",useHeaders:!1}};return s.trackSelectionCallback=function(l){return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){return u.return(shaka.util.PlayerConfiguration.defaultTrackSelect(l,o.preferredAudioLanguage))})},o},shaka.util.PlayerConfiguration.mergeConfigObjects=function(t,r,i){var n={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",sessionType:"",serverCertificate:new Uint8Array(0),serverCertificateUri:"",individualizationServer:""}};return shaka.util.ConfigUtils.mergeConfigObjects(t,r,i||shaka.util.PlayerConfiguration.createDefault(),n,"")},shaka.util.PlayerConfiguration.defaultTrackSelect=function(t,r){var i=shaka.util.ManifestParserUtils.ContentType,n=shaka.util.LanguageUtils,s=t.filter(function(E){return E.type=="variant"}),o=[],l=n.findClosestLocale(r,s.map(function(E){return E.language}));l&&(o=s.filter(function(E){return n.normalize(E.language)==l})),o.length==0&&(o=s.filter(function(E){return E.primary})),o.length==0&&(1<new Set(s.map(function(E){return E.language})).size&&shaka.log.warning("Could not choose a good audio track based on language preferences or primary tracks.  An arbitrary language will be stored!"),o=s);var u=o.filter(function(E){return E.height&&480>=E.height});if(u.length&&(u.sort(function(E,y){return goog.asserts.assert(E.height!=null,"Null height"),goog.asserts.assert(y.height!=null,"Null height"),y.height-E.height}),o=u.filter(function(E){return E.height==u[0].height})),s=[],o.length){var m=Math.floor(o.length/2);o.sort(function(E,y){return E.bandwidth-y.bandwidth}),s.push(o[m])}for(o=$jscomp.makeIterator(t),m=o.next();!m.done;m=o.next())m=m.value,m.type!=i.TEXT&&m.type!=i.IMAGE||s.push(m);return s},goog.exportSymbol("shaka.util.PlayerConfiguration",shaka.util.PlayerConfiguration),goog.exportProperty(shaka.util.PlayerConfiguration,"mergeConfigObjects",shaka.util.PlayerConfiguration.mergeConfigObjects),shaka.util.StateHistory=function(){this.open_=null,this.closed_=[]},shaka.util.StateHistory.prototype.update=function(t){this.open_==null?this.start_(t):this.update_(t)},shaka.util.StateHistory.prototype.getTimeSpentIn=function(t){var r=0;this.open_&&this.open_.state==t&&(r+=this.open_.duration);for(var i=$jscomp.makeIterator(this.closed_),n=i.next();!n.done;n=i.next())n=n.value,r+=n.state==t?n.duration:0;return r},shaka.util.StateHistory.prototype.getCopy=function(){for(var t=function(s){return{timestamp:s.timestamp,state:s.state,duration:s.duration}},r=[],i=$jscomp.makeIterator(this.closed_),n=i.next();!n.done;n=i.next())r.push(t(n.value));return this.open_&&r.push(t(this.open_)),r},shaka.util.StateHistory.prototype.start_=function(t){goog.asserts.assert(this.open_==null,"There must be no open entry in order when we start"),shaka.log.v1("Changing Player state to",t),this.open_={timestamp:this.getNowInSeconds_(),state:t,duration:0}},shaka.util.StateHistory.prototype.update_=function(t){goog.asserts.assert(this.open_,"There must be an open entry in order to update it");var r=this.getNowInSeconds_();this.open_.duration=r-this.open_.timestamp,this.open_.state!=t&&(shaka.log.v1("Changing Player state to",t),this.closed_.push(this.open_),this.open_={timestamp:r,state:t,duration:0})},shaka.util.StateHistory.prototype.getNowInSeconds_=function(){return Date.now()/1e3},shaka.util.SwitchHistory=function(){this.currentText_=this.currentVariant_=null,this.history_=[]},shaka.util.SwitchHistory.prototype.updateCurrentVariant=function(t,r){this.currentVariant_!=t&&(this.currentVariant_=t,this.history_.push({timestamp:this.getNowInSeconds_(),id:t.id,type:"variant",fromAdaptation:r,bandwidth:t.bandwidth}))},shaka.util.SwitchHistory.prototype.updateCurrentText=function(t,r){this.currentText_!=t&&(this.currentText_=t,this.history_.push({timestamp:this.getNowInSeconds_(),id:t.id,type:"text",fromAdaptation:r,bandwidth:null}))},shaka.util.SwitchHistory.prototype.getCopy=function(){for(var t=[],r=$jscomp.makeIterator(this.history_),i=r.next();!i.done;i=r.next())t.push(this.clone_(i.value));return t},shaka.util.SwitchHistory.prototype.getNowInSeconds_=function(){return Date.now()/1e3},shaka.util.SwitchHistory.prototype.clone_=function(t){return{timestamp:t.timestamp,id:t.id,type:t.type,fromAdaptation:t.fromAdaptation,bandwidth:t.bandwidth}},shaka.util.Stats=function(){this.bandwidthEstimate_=this.currentStreamBandwidth_=this.maxSegmentDurationSeconds_=this.liveLatencySeconds_=this.licenseTimeSeconds_=this.drmTimeSeconds_=this.manifestTimeSeconds_=this.loadLatencySeconds_=this.completionPercent_=this.totalCorruptedFrames_=this.totalDecodedFrames_=this.totalDroppedFrames_=this.height_=this.width_=NaN,this.stateHistory_=new shaka.util.StateHistory,this.switchHistory_=new shaka.util.SwitchHistory},shaka.util.Stats.prototype.setDroppedFrames=function(t,r){this.totalDroppedFrames_=t,this.totalDecodedFrames_=r},shaka.util.Stats.prototype.setCorruptedFrames=function(t){this.totalCorruptedFrames_=t},shaka.util.Stats.prototype.setResolution=function(t,r){this.width_=t,this.height_=r},shaka.util.Stats.prototype.setLoadLatency=function(t){this.loadLatencySeconds_=t},shaka.util.Stats.prototype.setManifestTime=function(t){this.manifestTimeSeconds_=t},shaka.util.Stats.prototype.setCompletionPercent=function(t){isNaN(this.completionPercent_)?this.completionPercent_=t:this.completionPercent_=Math.max(this.completionPercent_,t)},shaka.util.Stats.prototype.setDrmTime=function(t){this.drmTimeSeconds_=t},shaka.util.Stats.prototype.setLicenseTime=function(t){this.licenseTimeSeconds_=t},shaka.util.Stats.prototype.setLiveLatency=function(t){this.liveLatencySeconds_=t},shaka.util.Stats.prototype.setMaxSegmentDuration=function(t){this.maxSegmentDurationSeconds_=t},shaka.util.Stats.prototype.setCurrentStreamBandwidth=function(t){this.currentStreamBandwidth_=t},shaka.util.Stats.prototype.setBandwidthEstimate=function(t){this.bandwidthEstimate_=t},shaka.util.Stats.prototype.getStateHistory=function(){return this.stateHistory_},shaka.util.Stats.prototype.getSwitchHistory=function(){return this.switchHistory_},shaka.util.Stats.prototype.getBlob=function(){return{width:this.width_,height:this.height_,streamBandwidth:this.currentStreamBandwidth_,decodedFrames:this.totalDecodedFrames_,droppedFrames:this.totalDroppedFrames_,corruptedFrames:this.totalCorruptedFrames_,estimatedBandwidth:this.bandwidthEstimate_,completionPercent:this.completionPercent_,loadLatency:this.loadLatencySeconds_,manifestTimeSeconds:this.manifestTimeSeconds_,drmTimeSeconds:this.drmTimeSeconds_,playTime:this.stateHistory_.getTimeSpentIn("playing"),pauseTime:this.stateHistory_.getTimeSpentIn("paused"),bufferingTime:this.stateHistory_.getTimeSpentIn("buffering"),licenseTime:this.licenseTimeSeconds_,liveLatency:this.liveLatencySeconds_,maxSegmentDuration:this.maxSegmentDurationSeconds_,stateHistory:this.stateHistory_.getCopy(),switchHistory:this.switchHistory_.getCopy()}},shaka.util.Stats.getEmptyBlob=function(){return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,estimatedBandwidth:NaN,completionPercent:NaN,loadLatency:NaN,manifestTimeSeconds:NaN,drmTimeSeconds:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,liveLatency:NaN,maxSegmentDuration:NaN,switchHistory:[],stateHistory:[]}},shaka.Player=function(t,r){shaka.util.FakeEventTarget.call(this);var i=this;this.loadMode_=shaka.Player.LoadMode.NOT_LOADED,this.videoContainer_=this.video_=null,this.isTextVisible_=!1,this.globalEventManager_=new shaka.util.EventManager,this.attachEventManager_=new shaka.util.EventManager,this.loadEventManager_=new shaka.util.EventManager,this.abrManagerFactory_=this.abrManager_=this.assetUri_=this.manifest_=this.parserFactory_=this.parser_=this.streamingEngine_=this.qualityObserver_=this.cmcdManager_=this.regionTimeline_=this.bufferObserver_=this.bufferPoller_=this.playRateController_=this.playheadObservers_=this.playhead_=this.mediaSourceEngine_=this.drmEngine_=this.networkingEngine_=null,this.nextExternalStreamId_=1e9,this.config_=this.defaultConfig_(),this.maxHwRes_={width:1/0,height:1/0},this.stats_=null,this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(this.config_.preferredAudioLanguage,this.config_.preferredVariantRole,this.config_.preferredAudioChannelCount),this.currentTextLanguage_=this.config_.preferredTextLanguage,this.currentTextRole_=this.config_.preferredTextRole,this.currentTextForced_=this.config_.preferForcedSubs,this.cleanupOnUnload_=[],this.updatedStartTime_=null,r&&r(this),this.networkingEngine_=this.createNetworkingEngine(),this.networkingEngine_.setForceHTTPS(this.config_.streaming.forceHTTPS),this.adManager_=null,shaka.Player.adManagerFactory_&&(this.adManager_=shaka.util.Functional.callFactory(shaka.Player.adManagerFactory_)),this.globalEventManager_.listen(window,"online",function(){i.retryStreaming()}),this.detachNode_={name:"detach"},this.attachNode_={name:"attach"},this.unloadNode_={name:"unload"},this.parserNode_={name:"manifest-parser"},this.manifestNode_={name:"manifest"},this.mediaSourceNode_={name:"media-source"},this.drmNode_={name:"drm-engine"},this.loadNode_={name:"load"},this.srcEqualsDrmNode_={name:"src-equals-drm-engine"},this.srcEqualsNode_={name:"src-equals"};var n=shaka.util.AbortableOperation,s=new Map;s.set(this.attachNode_,function(o,l){return n.notAbortable(i.onAttach_(o,l))}),s.set(this.detachNode_,function(o,l){return n.notAbortable(i.onDetach_(o,l))}),s.set(this.unloadNode_,function(o,l){return n.notAbortable(i.onUnload_(o,l))}),s.set(this.mediaSourceNode_,function(o,l){var u=i.onInitializeMediaSourceEngine_(o,l);return n.notAbortable(u)}),s.set(this.parserNode_,function(o,l){var u=i.onInitializeParser_(o,l);return n.notAbortable(u)}),s.set(this.manifestNode_,function(o,l){return i.onParseManifest_(o,l)}),s.set(this.drmNode_,function(o,l){var u=i.onInitializeDrm_(o,l);return n.notAbortable(u)}),s.set(this.loadNode_,function(o,l){return n.notAbortable(i.onLoad_(o,l))}),s.set(this.srcEqualsDrmNode_,function(o,l){var u=i.onInitializeSrcEqualsDrm_(o,l);return n.notAbortable(u)}),s.set(this.srcEqualsNode_,function(o,l){return i.onSrcEquals_(o,l)}),this.walker_=new shaka.routing.Walker(this.detachNode_,shaka.Player.createEmptyPayload_(),{getNext:function(o,l,u,m){return i.getNextStep_(o,l,u,m)},enterNode:function(o,l,u){return i.dispatchEvent(i.makeEvent_(shaka.Player.EventName.OnStateChange,new Map().set("state",o.name))),s.get(o)(l,u)},handleError:function(o,l){return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){return u.nextAddress==1?(shaka.log.warning("The walker saw an error:"),l instanceof shaka.util.Error?shaka.log.warning("Error Code:",l.code):(shaka.log.warning("Error Message:",l.message),shaka.log.warning("Error Stack:",l.stack)),u.yield(i.onUnload_(o,shaka.Player.createEmptyPayload_()),2)):u.return(o.mediaElement?i.attachNode_:i.detachNode_)})},onIdle:function(o){i.dispatchEvent(i.makeEvent_(shaka.Player.EventName.OnStateIdle,new Map().set("state",o.name)))}}),t&&this.attach(t,!0)},$jscomp.inherits(shaka.Player,shaka.util.FakeEventTarget),shaka.Player.prototype.makeEvent_=function(t,r){return new shaka.util.FakeEvent(t,r)},shaka.Player.prototype.destroy=function(){var t=this,r;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){switch(i.nextAddress){case 1:return t.loadMode_==shaka.Player.LoadMode.DESTROYED?i.return():(t.loadMode_=shaka.Player.LoadMode.DESTROYED,r=t.walker_.startNewRoute(function(n){return{node:t.detachNode_,payload:shaka.Player.createEmptyPayload_(),interruptible:!1}}),i.yield(new Promise(function(n){r.onStart=function(){shaka.log.info("Preparing to destroy walker...")},r.onEnd=function(){n()},r.onCancel=function(){goog.asserts.assert(!1,"Our final detach call should never be cancelled."),n()},r.onError=function(){goog.asserts.assert(!1,"Our final detach call should never see an error"),n()},r.onSkip=function(){goog.asserts.assert(!1,"Our final detach call should never be skipped"),n()}}),2));case 2:return i.yield(t.walker_.destroy(),3);case 3:if(t.globalEventManager_&&(t.globalEventManager_.release(),t.globalEventManager_=null),t.attachEventManager_&&(t.attachEventManager_.release(),t.attachEventManager_=null),t.loadEventManager_&&(t.loadEventManager_.release(),t.loadEventManager_=null),t.abrManagerFactory_=null,t.abrManager_=null,t.config_=null,t.stats_=null,t.videoContainer_=null,t.cmcdManager_=null,!t.networkingEngine_){i.jumpTo(4);break}return i.yield(t.networkingEngine_.destroy(),5);case 5:t.networkingEngine_=null;case 4:shaka.util.FakeEventTarget.prototype.release.call(t),i.jumpToEnd()}})},shaka.Player.registerSupportPlugin=function(t,r){shaka.Player.supportPlugins_[t]=r},shaka.Player.setAdManagerFactory=function(t){shaka.Player.adManagerFactory_=t},shaka.Player.isBrowserSupported=function(){if(window.Promise||shaka.log.alwaysWarn("A Promise implementation or polyfill is required"),!(window.Promise&&window.Uint8Array&&Array.prototype.forEach)||shaka.util.Platform.isIE())return!1;var t=shaka.util.Platform.safariVersion();return t&&12>t||!shaka.media.DrmEngine.isBrowserSupported()?!1:shaka.util.Platform.supportsMediaSource()?!0:shaka.util.Platform.supportsMediaType("application/x-mpegurl")},shaka.Player.probeSupport=function(t){t=t===void 0?!0:t;var r,i,n,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){if(u.nextAddress==1)return goog.asserts.assert(shaka.Player.isBrowserSupported(),"Must have basic support"),r={},t?u.yield(shaka.media.DrmEngine.probeSupport(),3):u.jumpTo(2);u.nextAddress!=2&&(r=u.yieldResult),i=shaka.media.ManifestParser.probeSupport(),n=shaka.media.MediaSourceEngine.probeSupport(),s={manifest:i,media:n,drm:r},o=shaka.Player.supportPlugins_;for(l in o)s[l]=o[l]();return u.return(s)})},shaka.Player.prototype.attach=function(t,r){if(r=r===void 0?!0:r,this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());var i=shaka.Player.createEmptyPayload_();i.mediaElement=t,shaka.util.Platform.supportsMediaSource()||(r=!1);var n=r?this.mediaSourceNode_:this.attachNode_,s=this.walker_.startNewRoute(function(o){return{node:n,payload:i,interruptible:!1}});return s.onStart=function(){return shaka.log.info("Starting attach...")},this.wrapWalkerListenersWithPromise_(s)},shaka.Player.prototype.detach=function(){var t=this;if(this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());var r=this.walker_.startNewRoute(function(i){return{node:t.detachNode_,payload:shaka.Player.createEmptyPayload_(),interruptible:!1}});return r.onStart=function(){return shaka.log.info("Starting detach...")},this.wrapWalkerListenersWithPromise_(r)},shaka.Player.prototype.unload=function(t){var r=this;if(t=t===void 0?!0:t,this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());shaka.util.Platform.supportsMediaSource()||(t=!1);var i=shaka.Player.createEmptyPayload_(),n=this.walker_.startNewRoute(function(s){var o=s.mediaElement&&t?r.mediaSourceNode_:s.mediaElement?r.attachNode_:r.detachNode_;return goog.asserts.assert(o,"We should have picked a destination."),i.mediaElement=s.mediaElement,{node:o,payload:i,interruptible:!1}});return n.onStart=function(){return shaka.log.info("Starting unload...")},this.wrapWalkerListenersWithPromise_(n)},shaka.Player.prototype.updateStartTime=function(t){this.updatedStartTime_=t},shaka.Player.prototype.load=function(t,r,i){var n=this;if(this.updatedStartTime_=null,this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.Loading));var s=shaka.Player.createEmptyPayload_();s.uri=t,s.startTimeOfLoad=Date.now()/1e3,i&&(s.mimeType=i),r!==void 0&&(s.startTime=r);var o=this.shouldUseSrcEquals_(s)?this.srcEqualsNode_:this.loadNode_,l=this.walker_.startNewRoute(function(u){return u.mediaElement==null?null:(s.mediaElement=u.mediaElement,{node:o,payload:s,interruptible:!0})});return this.stats_=new shaka.util.Stats,this.cmcdManager_=this.createCmcd_(),l.onStart=function(){return shaka.log.info("Starting load of "+t+"...")},new Promise(function(u,m){l.onSkip=function(){return m(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.NO_VIDEO_ELEMENT))},l.onEnd=function(){u(),n.dispatchEvent(n.makeEvent_(shaka.Player.EventName.Loaded))},l.onCancel=function(){return m(n.createAbortLoadError_())},l.onError=function(E){return m(E)}})},shaka.Player.prototype.shouldUseSrcEquals_=function(t){var r=shaka.util.Platform;if(!r.supportsMediaSource())return!0;var i=t.mimeType,n=t.uri||"";if(i||(i=shaka.media.ManifestParser.getExtension(n),i=shaka.Player.SRC_EQUAL_EXTENSIONS_TO_MIME_TYPES_[i]),i){if(t=(t.mediaElement||r.anyMediaElement()).canPlayType(i)!="",!t)return!1;if(n=shaka.media.ManifestParser.isSupported(n,i),!n||(goog.asserts.assert(t&&n,"Both native and MSE playback should be possible!"),this.config_.streaming.preferNativeHls))return!0;if(r.isApple())return this.config_.streaming.useNativeHlsOnSafari}return!1},shaka.Player.prototype.onAttach_=function(t,r){var i=this;return goog.asserts.assert(t.mediaElement==null||t.mediaElement==r.mediaElement,"The routing logic failed. MediaElement requirement failed."),t.mediaElement==null&&(t.mediaElement=r.mediaElement,this.attachEventManager_.listen(t.mediaElement,"error",function(n){return i.onVideoError_(n)})),this.video_=t.mediaElement,Promise.resolve()},shaka.Player.prototype.onDetach_=function(t,r){return t.mediaElement&&(this.attachEventManager_.removeAll(),t.mediaElement=null),this.adManager_&&this.adManager_.release(),this.video_=null,Promise.resolve()},shaka.Player.prototype.onUnload_=function(t,r){var i=this,n,s,o,l,u,m,E,y,D;return $jscomp.asyncExecutePromiseGeneratorProgram(function(w){switch(w.nextAddress){case 1:return i.loadMode_!=shaka.Player.LoadMode.DESTROYED&&(i.loadMode_=shaka.Player.LoadMode.NOT_LOADED),n=i.cleanupOnUnload_.map(function(B){return B()}),i.cleanupOnUnload_=[],w.yield(Promise.all(n),2);case 2:if(i.dispatchEvent(i.makeEvent_(shaka.Player.EventName.Unloading)),t.mimeType=null,t.startTime=null,t.uri=null,t.mediaElement&&i.loadEventManager_.removeAll(),i.playheadObservers_&&(i.playheadObservers_.release(),i.playheadObservers_=null),i.bufferPoller_&&(i.bufferPoller_.stop(),i.bufferPoller_=null),!i.parser_){w.jumpTo(3);break}return w.yield(i.parser_.stop(),4);case 4:i.parser_=null,i.parserFactory_=null;case 3:if(!i.abrManager_){w.jumpTo(5);break}return w.yield(i.abrManager_.stop(),5);case 5:if(!i.streamingEngine_){w.jumpTo(7);break}return w.yield(i.streamingEngine_.destroy(),8);case 8:i.streamingEngine_=null;case 7:if(i.playRateController_&&(i.playRateController_.release(),i.playRateController_=null),i.playhead_&&(i.playhead_.release(),i.playhead_=null),!i.mediaSourceEngine_){w.jumpTo(9);break}return w.yield(i.mediaSourceEngine_.destroy(),10);case 10:i.mediaSourceEngine_=null;case 9:if(i.adManager_&&i.adManager_.onAssetUnload(),!t.mediaElement||!t.mediaElement.src){w.jumpTo(11);break}return w.yield(new Promise(function(B){return new shaka.util.Timer(B).tickAfter(.1)}),12);case 12:for(t.mediaElement.removeAttribute("src"),t.mediaElement.load();t.mediaElement.lastChild;)t.mediaElement.removeChild(t.mediaElement.firstChild);case 11:if(!i.drmEngine_){w.jumpTo(13);break}return w.yield(i.drmEngine_.destroy(),14);case 14:i.drmEngine_=null;case 13:if(i.assetUri_=null,i.bufferObserver_=null,i.manifest_){for(s=$jscomp.makeIterator(i.manifest_.variants),o=s.next();!o.done;o=s.next())for(l=o.value,u=$jscomp.makeIterator([l.audio,l.video]),m=u.next();!m.done;m=u.next())(E=m.value)&&E.segmentIndex&&E.segmentIndex.release();for(y=$jscomp.makeIterator(i.manifest_.textStreams),m=y.next();!m.done;m=y.next())D=m.value,D.segmentIndex&&D.segmentIndex.release()}i.manifest_=null,i.stats_=new shaka.util.Stats,i.lastTextFactory_=null,i.updateBufferState_(),w.jumpToEnd()}})},shaka.Player.prototype.onInitializeMediaSourceEngine_=function(t,r){var i=this,n,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){if(u.nextAddress==1)return goog.asserts.assert(shaka.util.Platform.supportsMediaSource(),"We should not be initializing media source on a platform that does not support media source."),goog.asserts.assert(t.mediaElement,"We should have a media element when initializing media source."),goog.asserts.assert(t.mediaElement==r.mediaElement,"|has| and |wants| should have the same media element when initializing media source."),goog.asserts.assert(i.mediaSourceEngine_==null,"We should not have a media source engine yet."),n=new shaka.media.ClosedCaptionParser,s=i.config_.textDisplayFactory,o=shaka.util.Functional.callFactory(s),i.lastTextFactory_=s,l=i.createMediaSourceEngine(t.mediaElement,n,o,function(m,E,y){i.processTimedMetadataMediaSrc_(m,E,y)}),u.yield(l.open(),2);i.mediaSourceEngine_=l,u.jumpToEnd()})},shaka.Player.prototype.onInitializeParser_=function(t,r){var i=this,n,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){if(u.nextAddress==1)return goog.asserts.assert(t.mediaElement,"We should have a media element when initializing the parser."),goog.asserts.assert(t.mediaElement==r.mediaElement,"|has| and |wants| should have the same media element when initializing the parser."),goog.asserts.assert(i.networkingEngine_,"Need networking engine when initializing the parser."),goog.asserts.assert(i.config_,"Need player config when initializing the parser."),t.mimeType=r.mimeType,t.uri=r.uri,goog.asserts.assert(t.uri,"We should have an asset uri when initializing the parsing."),n=t.uri,s=i.networkingEngine_,i.assetUri_=n,o=i,u.yield(shaka.media.ManifestParser.getFactory(n,s,i.config_.manifest.retryParameters,t.mimeType),2);o.parserFactory_=u.yieldResult,goog.asserts.assert(i.parserFactory_,"Must have manifest parser"),i.parser_=shaka.util.Functional.callFactory(i.parserFactory_),l=shaka.util.ObjectUtils.cloneObject(i.config_.manifest),r.mediaElement&&r.mediaElement.nodeName==="AUDIO"&&(l.disableVideo=!0),i.parser_.configure(l),u.jumpToEnd()})},shaka.Player.prototype.onParseManifest_=function(t,r){var i=this;goog.asserts.assert(t.mimeType==r.mimeType,"|has| and |wants| should have the same mime type when parsing."),goog.asserts.assert(t.uri==r.uri,"|has| and |wants| should have the same uri when parsing."),goog.asserts.assert(t.uri,"|has| should have a valid uri when parsing."),goog.asserts.assert(t.uri==this.assetUri_,"|has.uri| should match the cached asset uri."),goog.asserts.assert(this.networkingEngine_,"Need networking engine to parse manifest."),goog.asserts.assert(this.cmcdManager_,"Need CMCD manager to populate manifest request data."),goog.asserts.assert(this.config_,"Need player config to parse manifest."),goog.asserts.assert(this.parser_,"|this.parser_| should have been set in an earlier step.");var n=t.uri,s=this.networkingEngine_;this.regionTimeline_=new shaka.media.RegionTimeline(function(){return i.seekRange()}),this.regionTimeline_.addEventListener("regionadd",function(u){u=u.region,i.onRegionEvent_(shaka.Player.EventName.TimelineRegionAdded,u),i.adManager_&&i.adManager_.onDashTimedMetadata(u)}),this.qualityObserver_=null,this.config_.streaming.observeQualityChanges&&(this.qualityObserver_=new shaka.media.QualityObserver(function(){return i.getBufferedInfo()}),this.qualityObserver_.addEventListener("qualitychange",function(u){i.onMediaQualityChange_(u.quality,u.position)}));var o={networkingEngine:s,modifyManifestRequest:function(u,m){i.cmcdManager_.applyManifestData(u,m)},modifySegmentRequest:function(u,m){i.cmcdManager_.applySegmentData(u,m)},filter:function(u){return i.filterManifest_(u)},makeTextStreamsForClosedCaptions:function(u){return i.makeTextStreamsForClosedCaptions_(u)},onTimelineRegionAdded:function(u){return i.regionTimeline_.addRegion(u)},onEvent:function(u){return i.dispatchEvent(u)},onError:function(u){return i.onError_(u)},isLowLatencyMode:function(){return i.isLowLatencyMode_()},isAutoLowLatencyMode:function(){return i.isAutoLowLatencyMode_()},enableLowLatencyMode:function(){i.configure("streaming.lowLatencyMode",!0)}},l=Date.now()/1e3;return new shaka.util.AbortableOperation(function(){var u,m,E,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(D){if(D.nextAddress==1)return u=i,D.yield(i.parser_.start(n,o),2);if(u.manifest_=D.yieldResult,m=i.makeEvent_(shaka.Player.EventName.ManifestParsed),i.dispatchEvent(m),i.manifest_.variants.length==0)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.NO_VARIANTS);shaka.Player.filterForAVVariants_(i.manifest_),E=Date.now()/1e3,y=E-l,i.stats_.setManifestTime(y),D.jumpToEnd()})}(),function(){return shaka.log.info("Aborting parser step..."),i.parser_.stop()})},shaka.Player.prototype.onInitializeDrm_=function(t,r){var i=this,n,s;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return o.nextAddress==1?(goog.asserts.assert(t.mimeType==r.mimeType,"The load graph should have ensured the mime types matched."),goog.asserts.assert(t.uri==r.uri,"The load graph should have ensured the uris matched"),goog.asserts.assert(i.networkingEngine_,"|onInitializeDrm_| should never be called after |destroy|"),goog.asserts.assert(i.config_,"|onInitializeDrm_| should never be called after |destroy|"),goog.asserts.assert(i.manifest_,"|this.manifest_| should have been set in an earlier step."),goog.asserts.assert(t.mediaElement,"We should have a media element when initializing the DRM Engine."),n=Date.now()/1e3,s=!0,i.drmEngine_=i.createDrmEngine({netEngine:i.networkingEngine_,onError:function(l){i.onError_(l)},onKeyStatus:function(l){i.onKeyStatus_(l)},onExpirationUpdated:function(l,u){i.onExpirationUpdated_(l,u)},onEvent:function(l){i.dispatchEvent(l),l.type==shaka.Player.EventName.DrmSessionUpdate&&s&&(s=!1,l=Date.now()/1e3-n,i.stats_.setDrmTime(l))}}),i.drmEngine_.configure(i.config_.drm),o.yield(i.drmEngine_.initForPlayback(i.manifest_.variants,i.manifest_.offlineSessionIds),2)):o.nextAddress!=3?o.yield(i.drmEngine_.attach(t.mediaElement),3):o.yield(i.filterManifest_(i.manifest_),0)})},shaka.Player.prototype.onLoad_=function(t,r){var i=this,n,s,o,l,u,m,E,y,D,w,B,F,V;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){switch(K.nextAddress){case 1:if(goog.asserts.assert(t.mimeType==r.mimeType,"|has| and |wants| should have the same mime type when loading."),goog.asserts.assert(t.uri==r.uri,"|has| and |wants| should have the same uri when loading."),goog.asserts.assert(t.mediaElement,"We should have a media element when loading."),goog.asserts.assert(!isNaN(r.startTimeOfLoad),"|wants| should tell us when the load was originally requested"),t.startTime=r.startTime,i.updatedStartTime_!=null&&(t.startTime=i.updatedStartTime_,i.updatedStartTime_=null),n=t.mediaElement,s=t.uri,i.assetUri_=s,i.playRateController_=new shaka.media.PlayRateController({getRate:function(){return n.playbackRate},getDefaultRate:function(){return n.defaultPlaybackRate},setRate:function(q){n.playbackRate=q},movePlayhead:function(q){n.currentTime+=q}}),o=function(){return i.updateStateHistory_()},l=function(){return i.onRateChange_()},i.loadEventManager_.listen(n,"playing",o),i.loadEventManager_.listen(n,"pause",o),i.loadEventManager_.listen(n,"ended",o),i.loadEventManager_.listen(n,"ratechange",l),u=i.config_.abrFactory,i.abrManager_&&i.abrManagerFactory_==u||(i.abrManagerFactory_=u,i.abrManager_=shaka.util.Functional.callFactory(u),typeof i.abrManager_.playbackRateChanged!="function"&&(shaka.Deprecate.deprecateFeature(4,"AbrManager","Please use an AbrManager with playbackRateChanged function."),i.abrManager_.playbackRateChanged=function(q){}),i.abrManager_.configure(i.config_.abr)),i.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(i.config_.preferredAudioLanguage,i.config_.preferredVariantRole,i.config_.preferredAudioChannelCount),i.currentTextLanguage_=i.config_.preferredTextLanguage,i.currentTextRole_=i.config_.preferredTextRole,i.currentTextForced_=i.config_.preferForcedSubs,shaka.Player.applyPlayRange_(i.manifest_.presentationTimeline,i.config_.playRangeStart,i.config_.playRangeEnd),i.abrManager_.init(function(q,re,ee){return i.switch_(q,re,ee)}),i.playhead_=i.createPlayhead(t.startTime),i.playheadObservers_=i.createPlayheadObserversForMSE_(),m=Math.max(i.manifest_.minBufferTime,i.config_.streaming.rebufferingGoal),i.startBufferManagement_(m),shaka.util.StreamUtils.chooseCodecsAndFilterManifest(i.manifest_,i.config_.preferredVideoCodecs,i.config_.preferredAudioCodecs,i.config_.preferredAudioChannelCount,i.config_.preferredDecodingAttributes),i.streamingEngine_=i.createStreamingEngine(),i.streamingEngine_.configure(i.config_.streaming),i.loadMode_=shaka.Player.LoadMode.MEDIA_SOURCE,n.textTracks&&i.loadEventManager_.listen(n.textTracks,"addtrack",function(q){if(q.track)switch(q=q.track,goog.asserts.assert(q instanceof TextTrack,"Wrong track type!"),q.kind){case"chapters":i.activateChaptersTrack_(q)}}),i.dispatchEvent(i.makeEvent_(shaka.Player.EventName.Streaming)),E=null,y=i.getVariantTracks().find(function(q){return q.active})){K.jumpTo(2);break}if(E=i.chooseVariant_(),goog.asserts.assert(E,"Must choose an initial variant!"),i.switchVariant_(E,!0,!1,0),!i.config_.streaming.startAtSegmentBoundary){K.jumpTo(3);break}return D=i.playhead_.getTime(),K.yield(i.adjustStartTime_(E,D),4);case 4:w=K.yieldResult,i.playhead_.setStartTime(w);case 3:i.onAdaptation_(null,shaka.util.StreamUtils.variantToTrack(E));case 2:return B=i.getTextTracks().find(function(q){return q.active}),B||((F=i.chooseTextStream_())&&i.addTextStreamToSwitchHistory_(F,!0),E&&i.setInitialTextState_(E,F),F&&i.shouldStreamText_()&&i.streamingEngine_.switchTextStream(F)),K.yield(i.streamingEngine_.start(),5);case 5:i.config_.abr.enabled&&(i.abrManager_.enable(),i.onAbrStatusChanged_()),i.filterManifestByCurrentVariant_(),i.onTracksChanged_(),i.updateAbrManagerVariants_(),V=i.manifest_.variants.some(function(q){return q.primary}),i.config_.preferredAudioLanguage||V||shaka.log.warning("No preferred audio language set.  We have chosen an arbitrary language initially"),i.loadEventManager_.listenOnce(n,"loadedmetadata",function(){var q=Date.now()/1e3-r.startTimeOfLoad;i.stats_.setLoadLatency(q)}),K.jumpToEnd()}})},shaka.Player.prototype.onInitializeSrcEqualsDrm_=function(t,r){var i=this,n,s,o,l,u,m,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){return y.nextAddress==1?(n=shaka.util.ManifestParserUtils.ContentType,goog.asserts.assert(i.networkingEngine_,"|onInitializeSrcEqualsDrm_| should never be called after |destroy|"),goog.asserts.assert(i.config_,"|onInitializeSrcEqualsDrm_| should never be called after |destroy|"),s=Date.now()/1e3,o=!0,i.drmEngine_=i.createDrmEngine({netEngine:i.networkingEngine_,onError:function(D){i.onError_(D)},onKeyStatus:function(D){i.onKeyStatus_(D)},onExpirationUpdated:function(D,w){i.onExpirationUpdated_(D,w)},onEvent:function(D){i.dispatchEvent(D),D.type==shaka.Player.EventName.DrmSessionUpdate&&o&&(o=!1,D=Date.now()/1e3-s,i.stats_.setDrmTime(D))}}),i.drmEngine_.configure(i.config_.drm),l=r.uri||"",u=shaka.media.ManifestParser.getExtension(l),m=shaka.Player.SRC_EQUAL_EXTENSIONS_TO_MIME_TYPES_[u],m=="application/x-mpegurl"&&shaka.util.Platform.isApple()&&(m="application/vnd.apple.mpegurl"),m||(m="video/mp4"),E={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:r.mimeType?shaka.util.MimeUtils.getBasicType(r.mimeType):m,codecs:r.mimeType?shaka.util.MimeUtils.getCodecs(r.mimeType):"",encrypted:!0,drmInfos:[],keyIds:new Set,language:"und",label:null,type:n.VIDEO,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},bandwidth:100,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},i.drmEngine_.setSrcEquals(!0),y.yield(i.drmEngine_.initForPlayback([E],[]),2)):y.yield(i.drmEngine_.attach(t.mediaElement),0)})},shaka.Player.prototype.onSrcEquals_=function(t,r){var i=this;goog.asserts.assert(t.mediaElement,"We should have a media element when loading."),goog.asserts.assert(r.uri,"|has| should have a valid uri when loading."),goog.asserts.assert(!isNaN(r.startTimeOfLoad),"|wants| should tell us when the load was originally requested"),goog.asserts.assert(this.video_==t.mediaElement,"The video element should match our media element"),t.uri=r.uri,t.startTime=r.startTime,this.assetUri_=t.uri;var n=t.mediaElement;this.playhead_=new shaka.media.SrcEqualsPlayhead(n);var s=!1;this.cleanupOnUnload_.push(function(){s=!0}),t.startTime!=null&&this.playhead_.setStartTime(t.startTime),this.playRateController_=new shaka.media.PlayRateController({getRate:function(){return n.playbackRate},getDefaultRate:function(){return n.defaultPlaybackRate},setRate:function(u){n.playbackRate=u},movePlayhead:function(u){n.currentTime+=u}}),this.startBufferManagement_(this.config_.streaming.rebufferingGoal);var o=function(){return i.updateStateHistory_()};this.loadEventManager_.listen(n,"playing",o),this.loadEventManager_.listen(n,"pause",o),this.loadEventManager_.listen(n,"ended",o),this.loadEventManager_.listen(n,"ratechange",function(){return i.onRateChange_()}),n.preload!="none"&&this.loadEventManager_.listenOnce(n,"loadedmetadata",function(){var u=Date.now()/1e3-r.startTimeOfLoad;i.stats_.setLoadLatency(u)}),n.audioTracks&&(this.loadEventManager_.listen(n.audioTracks,"addtrack",function(){return i.onTracksChanged_()}),this.loadEventManager_.listen(n.audioTracks,"removetrack",function(){return i.onTracksChanged_()}),this.loadEventManager_.listen(n.audioTracks,"change",function(){return i.onTracksChanged_()})),n.textTracks&&(this.loadEventManager_.listen(n.textTracks,"addtrack",function(u){if(u.track)switch(u=u.track,goog.asserts.assert(u instanceof TextTrack,"Wrong track type!"),u.kind){case"metadata":i.processTimedMetadataSrcEqls_(u);break;case"chapters":i.activateChaptersTrack_(u);break;default:i.onTracksChanged_()}}),this.loadEventManager_.listen(n.textTracks,"removetrack",function(){return i.onTracksChanged_()}),this.loadEventManager_.listen(n.textTracks,"change",function(){return i.onTracksChanged_()})),o=shaka.media.ManifestParser.getExtension(t.uri),n.src=this.cmcdManager_.appendSrcData(t.uri,shaka.Player.SRC_EQUAL_EXTENSIONS_TO_MIME_TYPES_[o]),(shaka.util.Platform.isTizen()||shaka.util.Platform.isWebOS())&&n.load(),this.loadMode_=shaka.Player.LoadMode.SRC_EQUALS,this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.Streaming));var l=new shaka.util.PublicPromise;return shaka.util.MediaReadyState.waitForReadyState(n,HTMLMediaElement.HAVE_METADATA,this.loadEventManager_,function(){l.resolve()}),shaka.util.MediaReadyState.waitForReadyState(n,HTMLMediaElement.HAVE_CURRENT_DATA,this.loadEventManager_,function(){var u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){if(m.nextAddress==1)return i.setupPreferredAudioOnSrc_(),u=i.getFilteredTextTracks_(),u.find(function(E){return E.mode!="disabled"})?m.jumpTo(2):m.yield(new Promise(function(E){i.loadEventManager_.listenOnce(n.textTracks,"change",E),new shaka.util.Timer(E).tickAfter(1)}),2);if(s)return m.return();i.setupPreferredTextOnSrc_(),m.jumpToEnd()})}),n.error?l.reject(this.videoErrorToShakaError_()):n.preload=="none"&&(shaka.log.alwaysWarn('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),l.resolve()),this.loadEventManager_.listenOnce(n,"error",function(){l.reject(i.videoErrorToShakaError_())}),new shaka.util.AbortableOperation(l,function(){var u=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);return l.reject(u),Promise.resolve()})},shaka.Player.prototype.setupPreferredAudioOnSrc_=function(){var t=this.config_.preferredAudioLanguage;if(t!=""){this.selectAudioLanguage(t);var r=this.config_.preferredVariantRole;r!=""&&this.selectAudioLanguage(t,r)}},shaka.Player.prototype.setupPreferredTextOnSrc_=function(){var t=this.config_.preferredTextLanguage,r=this.config_.preferForcedSubs;if(t!=""){this.selectTextLanguage(t,"",r);var i=this.config_.preferredTextRole;i!=""&&this.selectTextLanguage(t,i,r)}},shaka.Player.prototype.processTimedMetadataSrcEqls_=function(t){var r=this;if(t.kind=="metadata"){t.mode="hidden",this.loadEventManager_.listen(t,"cuechange",function(){if(t.activeCues)for(var n=$jscomp.makeIterator(t.activeCues),s=n.next();!s.done;s=n.next())s=s.value,r.dispatchMetadataEvent_(s.startTime,s.endTime,s.type,s.value),r.adManager_&&r.adManager_.onCueMetadataChange(s.value)});var i=new shaka.util.Timer(function(){var n=r.getMetadataTracks_();n=$jscomp.makeIterator(n);for(var s=n.next();!s.done;s=n.next())s.value.mode="hidden"}).tickNow().tickAfter(.5);this.cleanupOnUnload_.push(function(){i.stop()})}},shaka.Player.prototype.processTimedMetadataMediaSrc_=function(t,r,i){t=$jscomp.makeIterator(t);for(var n=t.next();!n.done;n=t.next())if(n=n.value,n.data&&n.cueTime&&n.frames){for(var s=n.cueTime+r,o=i,l=$jscomp.makeIterator(n.frames),u=l.next();!u.done;u=l.next())this.dispatchMetadataEvent_(s,o,"ID3",u.value);this.adManager_&&this.adManager_.onHlsTimedMetadata(n,s)}},shaka.Player.prototype.dispatchMetadataEvent_=function(t,r,i,n){goog.asserts.assert(!r||t<=r,"Metadata start time should be less or equal to the end time!");var s=shaka.Player.EventName.Metadata;t=new Map().set("startTime",t).set("endTime",r).set("metadataType",i).set("payload",n),this.dispatchEvent(this.makeEvent_(s,t))},shaka.Player.prototype.activateChaptersTrack_=function(t){if(t&&t.kind=="chapters"){t.mode="hidden";var r=new shaka.util.Timer(function(){t.mode="hidden"}).tickNow().tickAfter(.5);this.cleanupOnUnload_.push(function(){r.stop()})}},shaka.Player.filterForAVVariants_=function(t){var r=function(i){return i.video&&i.audio||i.video&&i.video.codecs.includes(",")};t.variants.some(r)&&(shaka.log.debug("Found variant with audio and video content, so filtering out audio-only content."),t.variants=t.variants.filter(r))},shaka.Player.prototype.createDrmEngine=function(t){return new shaka.media.DrmEngine(t,this.config_.drm.updateExpirationTime)},shaka.Player.prototype.createNetworkingEngine=function(){var t=this;return new shaka.net.NetworkingEngine(function(r,i){t.abrManager_&&t.abrManager_.segmentDownloaded(r,i)},function(r,i,n){var s=shaka.Player.EventName.DownloadHeadersReceived;r=new Map().set("headers",r).set("request",i).set("requestType",n),t.dispatchEvent(t.makeEvent_(s,r))},function(r,i,n,s){var o=shaka.Player.EventName.DownloadFailed;r=new Map().set("request",r).set("error",i).set("httpResponseCode",n).set("aborted",s),t.dispatchEvent(t.makeEvent_(o,r))})},shaka.Player.prototype.createPlayhead=function(t){var r=this;return goog.asserts.assert(this.manifest_,"Must have manifest"),goog.asserts.assert(this.video_,"Must have video"),new shaka.media.MediaSourcePlayhead(this.video_,this.manifest_,this.config_.streaming,t,function(){return r.onSeek_()},function(i){return r.dispatchEvent(i)})},shaka.Player.prototype.createPlayheadObserversForMSE_=function(){var t=this;goog.asserts.assert(this.manifest_,"Must have manifest"),goog.asserts.assert(this.regionTimeline_,"Must have region timeline"),goog.asserts.assert(this.video_,"Must have video element");var r=new shaka.media.RegionObserver(this.regionTimeline_);r.addEventListener("enter",function(n){t.onRegionEvent_(shaka.Player.EventName.TimelineRegionEnter,n.region)}),r.addEventListener("exit",function(n){t.onRegionEvent_(shaka.Player.EventName.TimelineRegionExit,n.region)}),r.addEventListener("skip",function(n){var s=n.region;n.seeking||(t.onRegionEvent_(shaka.Player.EventName.TimelineRegionEnter,s),t.onRegionEvent_(shaka.Player.EventName.TimelineRegionExit,s))});var i=new shaka.media.PlayheadObserverManager(this.video_);return i.manage(r),this.qualityObserver_&&i.manage(this.qualityObserver_),i},shaka.Player.prototype.startBufferManagement_=function(t){var r=this;goog.asserts.assert(!this.bufferObserver_,"No buffering observer should exist before initialization."),goog.asserts.assert(!this.bufferPoller_,"No buffer timer should exist before initialization."),this.bufferObserver_=new shaka.media.BufferingObserver(1,2),this.bufferObserver_.setState(shaka.media.BufferingObserver.State.STARVING),this.updateBufferingSettings_(t),this.updateBufferState_(),this.bufferPoller_=new shaka.util.Timer(function(){r.pollBufferState_()}).tickEvery(.25)},shaka.Player.prototype.updateBufferingSettings_=function(t){this.bufferObserver_.setThresholds(t,Math.min(shaka.Player.TYPICAL_BUFFERING_THRESHOLD_,t/2))},shaka.Player.prototype.pollBufferState_=function(){switch(goog.asserts.assert(this.video_,"Need a media element to update the buffering observer"),goog.asserts.assert(this.bufferObserver_,"Need a buffering observer to update"),this.loadMode_){case shaka.Player.LoadMode.SRC_EQUALS:var t=this.isBufferedToEndSrc_();break;case shaka.Player.LoadMode.MEDIA_SOURCE:t=this.isBufferedToEndMS_();break;default:t=!1}var r=shaka.media.TimeRangesUtils.bufferedAheadOf(this.video_.buffered,this.video_.currentTime);this.bufferObserver_.update(r,t)&&this.updateBufferState_()},shaka.Player.prototype.createMediaSourceEngine=function(t,r,i,n){return new shaka.media.MediaSourceEngine(t,r,i,n)},shaka.Player.prototype.createCmcd_=function(){var t=this;return new shaka.util.CmcdManager({getBandwidthEstimate:function(){return t.abrManager_?t.abrManager_.getBandwidthEstimate():NaN},getBufferedInfo:function(){return t.getBufferedInfo()},getCurrentTime:function(){return t.video_?t.video_.currentTime:0},getVariantTracks:function(){return t.getVariantTracks()},getPlaybackRate:function(){return t.getPlaybackRate()},isLive:function(){return t.isLive()}},this.config_.cmcd)},shaka.Player.prototype.createStreamingEngine=function(){var t=this;return goog.asserts.assert(this.playhead_&&this.abrManager_&&this.mediaSourceEngine_&&this.cmcdManager_&&this.manifest_,"Must not be destroyed"),new shaka.media.StreamingEngine(this.manifest_,{getPresentationTime:function(){return t.playhead_.getTime()},getBandwidthEstimate:function(){return t.abrManager_.getBandwidthEstimate()},modifySegmentRequest:function(r,i){t.cmcdManager_.applySegmentData(r,i)},mediaSourceEngine:this.mediaSourceEngine_,netEngine:this.networkingEngine_,onError:function(r){return t.onError_(r)},onEvent:function(r){return t.dispatchEvent(r)},onManifestUpdate:function(){return t.onManifestUpdate_()},onSegmentAppended:function(){return t.onSegmentAppended_()},onInitSegmentAppended:function(r,i){var n=i.getMediaQuality();n&&t.qualityObserver_&&t.qualityObserver_.addMediaQualityChange(n,r)}})},shaka.Player.prototype.configure=function(t,r){goog.asserts.assert(this.config_,"Config must not be null!"),goog.asserts.assert(typeof t=="object"||arguments.length==2,"String configs should have values!"),arguments.length==2&&typeof t=="string"&&(t=shaka.util.ConfigUtils.convertToConfigObject(t,r)),goog.asserts.assert(typeof t=="object","Should be an object!"),t.manifest&&t.manifest.dash&&"defaultPresentationDelay"in t.manifest.dash&&(shaka.Deprecate.deprecateFeature(4,"manifest.dash.defaultPresentationDelay configuration","Please Use manifest.defaultPresentationDelay instead."),t.manifest.defaultPresentationDelay=t.manifest.dash.defaultPresentationDelay,delete t.manifest.dash.defaultPresentationDelay),t.streaming&&t.streaming.lowLatencyMode&&(t.streaming.inaccurateManifestTolerance==null&&(t.streaming.inaccurateManifestTolerance=0),t.streaming.rebufferingGoal==null&&(t.streaming.rebufferingGoal=.01));var i=shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,t,this.defaultConfig_());return this.applyConfig_(),i},shaka.Player.prototype.applyConfig_=function(){if(this.parser_){var t=shaka.util.ObjectUtils.cloneObject(this.config_.manifest);this.video_&&this.video_.nodeName==="AUDIO"&&(t.disableVideo=!0),this.parser_.configure(t)}if(this.drmEngine_&&this.drmEngine_.configure(this.config_.drm),this.streamingEngine_){this.streamingEngine_.configure(this.config_.streaming);try{this.filterManifestWithRestrictions_(this.manifest_)}catch(i){this.onError_(i)}this.abrManager_&&this.updateAbrManagerVariants_(),!(t=this.streamingEngine_.getCurrentVariant())||t.allowedByApplication&&t.allowedByKeySystem||(shaka.log.debug("Choosing new variant after changing configuration"),this.chooseVariantAndSwitch_())}if(this.networkingEngine_&&this.networkingEngine_.setForceHTTPS(this.config_.streaming.forceHTTPS),this.mediaSourceEngine_&&(t=this.config_.textDisplayFactory,this.lastTextFactory_!=t)){var r=shaka.util.Functional.callFactory(t);this.mediaSourceEngine_.setTextDisplayer(r),this.lastTextFactory_=t,this.streamingEngine_&&this.streamingEngine_.reloadTextStream()}this.abrManager_&&(this.abrManager_.configure(this.config_.abr),this.config_.abr.enabled?this.abrManager_.enable():this.abrManager_.disable(),this.onAbrStatusChanged_()),this.bufferObserver_&&(t=this.config_.streaming.rebufferingGoal,this.manifest_&&(t=Math.max(t,this.manifest_.minBufferTime)),this.updateBufferingSettings_(t)),this.manifest_&&shaka.Player.applyPlayRange_(this.manifest_.presentationTimeline,this.config_.playRangeStart,this.config_.playRangeEnd)},shaka.Player.prototype.getConfiguration=function(){goog.asserts.assert(this.config_,"Config must not be null!");var t=this.defaultConfig_();return shaka.util.PlayerConfiguration.mergeConfigObjects(t,this.config_,this.defaultConfig_()),t},shaka.Player.prototype.getSharedConfiguration=function(){return goog.asserts.assert(this.config_,"Cannot call getSharedConfiguration after call destroy!"),this.config_},shaka.Player.prototype.getBufferFullness=function(){if(this.video_){var t=this.video_.buffered.length;t=t?this.video_.buffered.end(t-1):0;var r=this.getConfiguration().streaming.bufferingGoal;if(r=Math.min(this.video_.currentTime+r,this.seekRange().end),t>=r)return 1;if(!(t<=this.video_.currentTime)&&t<r)return(t-this.video_.currentTime)/(r-this.video_.currentTime)}return 0},shaka.Player.prototype.resetConfiguration=function(){goog.asserts.assert(this.config_,"Cannot be destroyed");for(var t in this.config_)delete this.config_[t];shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,this.defaultConfig_(),this.defaultConfig_()),this.applyConfig_()},shaka.Player.prototype.getLoadMode=function(){return this.loadMode_},shaka.Player.prototype.getMediaElement=function(){return this.video_},shaka.Player.prototype.getNetworkingEngine=function(){return this.networkingEngine_},shaka.Player.prototype.getAssetUri=function(){return this.assetUri_},shaka.Player.prototype.getAdManager=function(){return this.adManager_?this.adManager_:null},shaka.Player.prototype.isLive=function(){return this.manifest_?this.manifest_.presentationTimeline.isLive():this.video_&&this.video_.src?this.video_.duration==1/0:!1},shaka.Player.prototype.isInProgress=function(){return this.manifest_?this.manifest_.presentationTimeline.isInProgress():!1},shaka.Player.prototype.isAudioOnly=function(){if(this.manifest_){var t=this.manifest_.variants;return t.length?!t[0].video:!1}return this.video_&&this.video_.src?this.video_.videoTracks?this.video_.videoTracks.length==0:this.video_.videoHeight==0:!1},shaka.Player.prototype.isLowLatencyMode_=function(){return this.config_.streaming.lowLatencyMode},shaka.Player.prototype.isAutoLowLatencyMode_=function(){return this.config_.streaming.autoLowLatencyMode},shaka.Player.prototype.seekRange=function(){if(this.manifest_){var t=this.manifest_.presentationTimeline;return{start:t.getSeekRangeStart(),end:t.getSeekRangeEnd()}}return this.video_&&this.video_.src&&(t=this.video_.seekable,t.length)?{start:t.start(0),end:t.end(t.length-1)}:{start:0,end:0}},shaka.Player.prototype.goToLive=function(){this.isLive()?this.video_.currentTime=this.seekRange().end:shaka.log.warning("goToLive is for live streams!")},shaka.Player.prototype.keySystem=function(){return shaka.media.DrmEngine.keySystem(this.drmInfo())},shaka.Player.prototype.drmInfo=function(){return this.drmEngine_?this.drmEngine_.getDrmInfo():null},shaka.Player.prototype.getDrmEngine=function(){return this.drmEngine_},shaka.Player.prototype.getExpiration=function(){return this.drmEngine_?this.drmEngine_.getExpiration():1/0},shaka.Player.prototype.getKeyStatuses=function(){return this.drmEngine_?this.drmEngine_.getKeyStatuses():{}},shaka.Player.prototype.isBuffering=function(){var t=shaka.media.BufferingObserver.State;return this.bufferObserver_?this.bufferObserver_.getState()==t.STARVING:!1},shaka.Player.prototype.getPlaybackRate=function(){return this.video_?this.playRateController_?this.playRateController_.getRealRate():1:0},shaka.Player.prototype.trickPlay=function(t){goog.asserts.assert(t!=0,"Should never set a trick play rate of 0!"),t==0?shaka.log.alwaysWarn("A trick play rate of 0 is unsupported!"):(this.video_.paused&&this.video_.play(),this.playRateController_.set(t),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&(this.abrManager_.playbackRateChanged(t),this.streamingEngine_.setTrickPlay(1<Math.abs(t))))},shaka.Player.prototype.cancelTrickPlay=function(){var t=this.playRateController_.getDefaultRate();this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS&&this.playRateController_.set(t),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&(this.playRateController_.set(t),this.abrManager_.playbackRateChanged(t),this.streamingEngine_.setTrickPlay(!1))},shaka.Player.prototype.getVariantTracks=function(){if(this.manifest_){for(var t=this.streamingEngine_?this.streamingEngine_.getCurrentVariant():null,r=[],i=0,n=$jscomp.makeIterator(this.manifest_.variants),s=n.next();!s.done;s=n.next())if(s=s.value,shaka.util.StreamUtils.isPlayable(s)){var o=shaka.util.StreamUtils.variantToTrack(s);o.active=s==t,o.active||i==1||t==null||s.video!=t.video||s.audio!=t.audio||(o.active=!0),o.active&&i++,r.push(o)}return goog.asserts.assert(1>=i,"It should only have one active track"),r}return this.video_&&this.video_.audioTracks?Array.from(this.video_.audioTracks).map(function(l){return shaka.util.StreamUtils.html5AudioTrackToTrack(l)}):[]},shaka.Player.prototype.getTextTracks=function(){if(this.manifest_){for(var t=this.streamingEngine_?this.streamingEngine_.getCurrentTextStream():null,r=[],i=$jscomp.makeIterator(this.manifest_.textStreams),n=i.next();!n.done;n=i.next()){n=n.value;var s=shaka.util.StreamUtils.textStreamToTrack(n);s.active=n==t,r.push(s)}return r}if(this.video_&&this.video_.src&&this.video_.textTracks){t=this.getFilteredTextTracks_();var o=shaka.util.StreamUtils;return t.map(function(l){return o.html5TextTrackToTrack(l)})}return[]},shaka.Player.prototype.getImageTracks=function(){if(this.manifest_){var t=shaka.util.StreamUtils;return this.manifest_.imageStreams.map(function(r){return t.imageStreamToTrack(r)})}return[]},shaka.Player.prototype.getThumbnails=function(t,r){var i=this,n,s,o,l,u,m,E,y,D,w,B,F,V,K,q,re,ee,H;return $jscomp.asyncExecutePromiseGeneratorProgram(function(te){return te.nextAddress==1?i.manifest_?(n=i.manifest_.imageStreams.find(function(W){return W.id==t}))?n.segmentIndex?te.jumpTo(3):te.yield(n.createSegmentIndex(),3):te.return(null):te.jumpTo(2):te.nextAddress!=2?(s=n.segmentIndex.find(r),s==null?te.return(null):(o=n.segmentIndex.get(s),l=o.getTilesLayout()||n.tilesLayout,u=/(\d+)x(\d+)/.exec(l),u?(m=n.width||0,E=n.height||0,y=parseInt(u[1],10),D=parseInt(u[2],10),w=m/y,B=E/D,F=y*D,V=o.trueEndTime-o.startTime,K=o.getTileDuration()||V/F,q=o.startTime,ee=re=0,1<F&&(H=Math.floor((r-o.startTime)/K),q=o.startTime+H*K,re=H%y*w,ee=Math.floor(H/y)*B),te.return({imageHeight:E,imageWidth:m,height:B,positionX:re,positionY:ee,startTime:q,duration:K,uris:o.getUris(),width:w})):(shaka.log.warning("Tiles layout does not contain a valid format  (columns x rows)"),te.return(null)))):te.return(null)})},shaka.Player.prototype.selectTextTrack=function(t){if(this.manifest_&&this.streamingEngine_){var r=this.manifest_.textStreams.find(function(n){return n.id==t.id});r?r==this.streamingEngine_.getCurrentTextStream()?shaka.log.debug("Text track already selected."):(this.addTextStreamToSwitchHistory_(r,!1),this.streamingEngine_.switchTextStream(r),this.onTextChanged_(),this.currentTextLanguage_=r.language):shaka.log.error("No stream with id",t.id)}else if(this.video_&&this.video_.src&&this.video_.textTracks){r=this.getFilteredTextTracks_(),r=$jscomp.makeIterator(r);for(var i=r.next();!i.done;i=r.next())i=i.value,shaka.util.StreamUtils.html5TrackId(i)==t.id?i.mode=this.isTextVisible_?"showing":"hidden":i.mode="disabled";this.onTextChanged_()}},shaka.Player.prototype.selectVariantTrack=function(t,r,i){if(r=r===void 0?!1:r,i=i===void 0?0:i,this.manifest_&&this.streamingEngine_){this.config_.abr.enabled&&shaka.log.alwaysWarn("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var n=this.manifest_.variants.find(function(s){return s.id==t.id});n?shaka.util.StreamUtils.isPlayable(n)?(this.switchVariant_(n,!1,r,i),this.currentAdaptationSetCriteria_=new shaka.media.ExampleBasedCriteria(n),this.updateAbrManagerVariants_()):shaka.log.error("Unable to switch to restricted track",t.id):shaka.log.error("No variant with id",t.id)}else if(this.video_&&this.video_.audioTracks){for(r=Array.from(this.video_.audioTracks),r=$jscomp.makeIterator(r),i=r.next();!i.done;i=r.next())if(i=i.value,shaka.util.StreamUtils.html5TrackId(i)==t.id){this.switchHtml5Track_(i);break}}},shaka.Player.prototype.getAudioLanguagesAndRoles=function(){return shaka.Player.getLanguageAndRolesFrom_(this.getVariantTracks())},shaka.Player.prototype.getTextLanguagesAndRoles=function(){return shaka.Player.getLanguageAndRolesFrom_(this.getTextTracks())},shaka.Player.prototype.getAudioLanguages=function(){return Array.from(shaka.Player.getLanguagesFrom_(this.getVariantTracks()))},shaka.Player.prototype.getTextLanguages=function(){return Array.from(shaka.Player.getLanguagesFrom_(this.getTextTracks()))},shaka.Player.prototype.selectAudioLanguage=function(t,r){var i=shaka.util.LanguageUtils;if(this.manifest_&&this.playhead_){this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(t,r||"",0,""),i=function(E,y){return E.video||y.video?E.video&&y.video?Math.abs((E.video.height||0)-(y.video.height||0))+Math.abs((E.video.width||0)-(y.video.width||0)):1/0:0};var n=this.streamingEngine_.getCurrentVariant(),s=this.currentAdaptationSetCriteria_.create(this.manifest_.variants),o=null;s=$jscomp.makeIterator(s.values());for(var l=s.next();!l.done;l=s.next())l=l.value,(!o||i(o,n)>i(l,n))&&(o=l);o?(i=shaka.util.StreamUtils.variantToTrack(o),this.selectVariantTrack(i,!0)):this.chooseVariantAndSwitch_()}else if(this.video_&&this.video_.audioTracks){l=Array.from(this.video_.audioTracks),n=i.normalize(t),s=o=null,l=$jscomp.makeIterator(l);for(var u=l.next();!u.done;u=l.next()){u=u.value;var m=shaka.util.StreamUtils.html5AudioTrackToTrack(u);i.normalize(m.language)==n&&(o=u,r?m.roles.includes(r)&&(s=u):m.roles.length==0&&(s=u))}s?this.switchHtml5Track_(s):o&&this.switchHtml5Track_(o)}},shaka.Player.prototype.selectTextLanguage=function(t,r,i){i=i===void 0?!1:i;var n=shaka.util.LanguageUtils;if(this.manifest_&&this.playhead_)this.currentTextLanguage_=t,this.currentTextRole_=r||"",this.currentTextForced_=i,(t=this.chooseTextStream_())&&(t==this.streamingEngine_.getCurrentTextStream()?shaka.log.debug("Text track already selected."):(this.addTextStreamToSwitchHistory_(t,!1),this.shouldStreamText_()&&(this.streamingEngine_.switchTextStream(t),this.onTextChanged_())));else{var s=n.normalize(t);(t=this.getTextTracks().find(function(o){return n.normalize(o.language)==s&&(!r||o.roles.includes(r))&&o.forced==i}))&&this.selectTextTrack(t)}},shaka.Player.prototype.selectVariantsByLabel=function(t){if(this.manifest_&&this.playhead_){for(var r=null,i=$jscomp.makeIterator(this.manifest_.variants),n=i.next();!n.done;n=i.next())if(n=n.value,n.audio.label==t){r=n;break}r==null?shaka.log.warning("No variants were found with label: "+t+". Ignoring the request to switch."):(this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(r.language,"",0,t),this.chooseVariantAndSwitch_())}},shaka.Player.prototype.isTextTrackVisible=function(){var t=this.isTextVisible_;if(this.mediaSourceEngine_){var r=this.mediaSourceEngine_.getTextDisplayer().isTextVisible();return goog.asserts.assert(r==t,"text visibility has fallen out of sync"),r}return this.video_&&this.video_.src&&this.video_.textTracks?this.getFilteredTextTracks_().some(function(i){return i.mode=="showing"}):t},shaka.Player.prototype.getChaptersTracks=function(){if(this.video_&&this.video_.src&&this.video_.textTracks){var t=this.getChaptersTracks_(),r=shaka.util.StreamUtils;return t.map(function(i){return r.html5TextTrackToTrack(i)})}return[]},shaka.Player.prototype.getChapters=function(t){var r=shaka.util.LanguageUtils,i=r.normalize(t),n=this.getChaptersTracks_().filter(function(l){return r.normalize(l.language)==i});if(!n||!n.length)return[];t=[],n=$jscomp.makeIterator(n);for(var s=n.next();!s.done;s=n.next())if((s=s.value)&&s.cues){s=$jscomp.makeIterator(s.cues);for(var o=s.next();!o.done;o=s.next())o=o.value,t.push({title:o.text,startTime:o.startTime,endTime:o.endTime})}return t},shaka.Player.prototype.getFilteredTextTracks_=function(){return goog.asserts.assert(this.video_.textTracks,"TextTracks should be valid."),Array.from(this.video_.textTracks).filter(function(t){return t.kind!="metadata"&&t.kind!="chapters"&&t.label!=shaka.Player.TextTrackLabel})},shaka.Player.prototype.getMetadataTracks_=function(){return goog.asserts.assert(this.video_.textTracks,"TextTracks should be valid."),Array.from(this.video_.textTracks).filter(function(t){return t.kind=="metadata"})},shaka.Player.prototype.getChaptersTracks_=function(){return goog.asserts.assert(this.video_.textTracks,"TextTracks should be valid."),Array.from(this.video_.textTracks).filter(function(t){return t.kind=="chapters"})},shaka.Player.prototype.setTextTrackVisibility=function(t){if(t=!!t,this.isTextVisible_!=t){if(this.isTextVisible_=t,this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE)this.mediaSourceEngine_.getTextDisplayer().setTextVisibility(t),this.config_.streaming.alwaysStreamText||(t?this.streamingEngine_.getCurrentTextStream()||(t=shaka.util.StreamUtils.filterStreamsByLanguageAndRole(this.manifest_.textStreams,this.currentTextLanguage_,this.currentTextRole_,this.currentTextForced_),0<t.length&&(this.streamingEngine_.switchTextStream(t[0]),this.onTextChanged_())):this.streamingEngine_.unloadTextStream());else if(this.video_&&this.video_.src&&this.video_.textTracks){var r=this.getFilteredTextTracks_();r=$jscomp.makeIterator(r);for(var i=r.next();!i.done;i=r.next())i=i.value,i.mode!="disabled"&&(i.mode=t?"showing":"hidden")}this.onTextTrackVisibility_()}},shaka.Player.prototype.getPlayheadTimeAsDate=function(){if(!this.isLive())return shaka.log.warning("getPlayheadTimeAsDate is for live streams!"),null;var t=this.walker_.getCurrentPayload(),r=0;if(this.playhead_)r=this.playhead_.getTime();else if(t){if(t.startTime==null)return new Date;r=t.startTime}return this.manifest_?(t=this.manifest_.presentationTimeline.getPresentationStartTime(),new Date(1e3*(t+r))):this.video_&&this.video_.getStartDate?(t=this.video_.getStartDate(),isNaN(t.getTime())?(shaka.log.warning("EXT-X-PROGRAM-DATETIME required to get playhead time as Date!"),null):new Date(t.getTime()+1e3*r)):(shaka.log.warning("No way to get playhead time as Date!"),null)},shaka.Player.prototype.getPresentationStartTimeAsDate=function(){if(!this.isLive())return shaka.log.warning("getPresentationStartTimeAsDate is for live streams!"),null;if(this.manifest_){var t=this.manifest_.presentationTimeline.getPresentationStartTime();return goog.asserts.assert(t!=null,"Presentation start time should not be null!"),new Date(1e3*t)}return this.video_&&this.video_.getStartDate?(t=this.video_.getStartDate(),isNaN(t.getTime())?(shaka.log.warning("EXT-X-PROGRAM-DATETIME required to get presentation start time as Date!"),null):t):(shaka.log.warning("No way to get presentation start time as Date!"),null)},shaka.Player.prototype.getBufferedInfo=function(){if(this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE)return this.mediaSourceEngine_.getBufferedInfo();var t={total:[],audio:[],video:[],text:[]};return this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS&&(t.total=shaka.media.TimeRangesUtils.getBufferedInfo(this.video_.buffered)),t},shaka.Player.prototype.getStats=function(){if(this.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE&&this.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS)return shaka.util.Stats.getEmptyBlob();this.updateStateHistory_(),goog.asserts.assert(this.video_,"If we have stats, we should have video_");var t=this.video_,r=t.currentTime/t.duration;return isNaN(r)||this.stats_.setCompletionPercent(Math.round(100*r)),t.getVideoPlaybackQuality&&(t=t.getVideoPlaybackQuality(),this.stats_.setDroppedFrames(Number(t.droppedVideoFrames),Number(t.totalVideoFrames)),this.stats_.setCorruptedFrames(Number(t.corruptedVideoFrames))),t=this.drmEngine_?this.drmEngine_.getLicenseTime():NaN,this.stats_.setLicenseTime(t),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&((t=this.streamingEngine_.getCurrentVariant())&&(r=(this.playRateController_?this.playRateController_.getRealRate():1)*t.bandwidth,this.stats_.setCurrentStreamBandwidth(r)),t&&t.video&&this.stats_.setResolution(t.video.width||NaN,t.video.height||NaN),this.isLive()&&(t=this.getPresentationStartTimeAsDate().valueOf()+1e3*this.seekRange().end,t=(Date.now()-t)/1e3,this.stats_.setLiveLatency(t)),this.manifest_&&this.manifest_.presentationTimeline&&(t=this.manifest_.presentationTimeline.getMaxSegmentDuration(),this.stats_.setMaxSegmentDuration(t)),t=this.abrManager_.getBandwidthEstimate(),this.stats_.setBandwidthEstimate(t)),this.stats_.getBlob()},shaka.Player.prototype.addTextTrack=function(t,r,i,n,s,o,l){if(l=l===void 0?!1:l,shaka.Deprecate.deprecateFeature(4,"addTextTrack","Please use an addTextTrackAsync."),this.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE&&this.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS)throw shaka.log.error("Must call load() and wait for it to resolve before adding text tracks."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.CONTENT_NOT_LOADED);if(!n){var u=shaka.media.ManifestParser.getExtension(t);if(n=shaka.Player.TEXT_EXTENSIONS_TO_MIME_TYPES_[u],!n)throw shaka.log.error("The mimeType has not been provided and it could not be deduced from its extension."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.TEXT_COULD_NOT_GUESS_MIME_TYPE,u)}if(this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS){if(n!="text/vtt")throw shaka.log.error("Only WebVTT is supported when using src="),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.TEXT_ONLY_WEBVTT_SRC_EQUALS,n);if(l&&(i="forced"),n=document.createElement("track"),n.src=this.cmcdManager_.appendTextTrackData(t),n.label=o||"",n.kind=i,n.srclang=r,this.video_.getAttribute("crossorigin")||this.video_.setAttribute("crossorigin","anonymous"),this.video_.appendChild(n),n=this.getTextTracks().find(function(E){return E.language==r&&E.label==(o||"")&&E.kind==i}))return this.onTracksChanged_(),n;throw shaka.log.error("Cannot add this text when loaded with src="),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS)}u=shaka.util.ManifestParserUtils.ContentType;var m=this.manifest_.presentationTimeline.getDuration();if(m==1/0)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM);if(t={id:this.nextExternalStreamId_++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:shaka.media.SegmentIndex.forSingleSegment(0,m,[t]),mimeType:n||"",codecs:s||"",kind:i,encrypted:!1,drmInfos:[],keyIds:new Set,language:r,label:o||null,type:u.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!!l,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},s=shaka.util.MimeUtils.getFullType(t.mimeType,t.codecs),!shaka.text.TextEngine.isTypeSupported(s))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.MISSING_TEXT_PLUGIN,n);return this.manifest_.textStreams.push(t),this.onTracksChanged_(),shaka.util.StreamUtils.textStreamToTrack(t)},shaka.Player.prototype.addTextTrackAsync=function(t,r,i,n,s,o,l){l=l===void 0?!1:l;var u=this,m,E,y,D,w,B,F,V,K,q,re;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ee){switch(ee.nextAddress){case 1:if(u.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE&&u.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS)throw shaka.log.error("Must call load() and wait for it to resolve before adding text tracks."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.CONTENT_NOT_LOADED);if(n){ee.jumpTo(2);break}return ee.yield(u.getTextMimetype_(t),3);case 3:n=ee.yieldResult;case 2:if(m=[],u.adManager_)try{m=u.adManager_.getServerSideCuePoints()}catch{}if(u.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS){ee.jumpTo(4);break}return l&&(i="forced"),ee.yield(u.addSrcTrackElement_(t,r,i,n,o||"",m),5);case 5:if(E=u.getTextTracks(),y=E.find(function(H){return H.language==r&&H.label==(o||"")&&H.kind==i}))return u.onTracksChanged_(),ee.return(y);throw shaka.log.error("Cannot add this text when loaded with src="),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS);case 4:if(D=shaka.util.ManifestParserUtils.ContentType,w=u.manifest_.presentationTimeline.getDuration(),w==1/0)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM);if(!m.length){ee.jumpTo(6);break}return goog.asserts.assert(u.networkingEngine_,"Need networking engine."),ee.yield(u.getTextData_(t,u.networkingEngine_,u.config_.streaming.retryParameters),7);case 7:B=ee.yieldResult,F=u.convertToWebVTT_(B,n,m),V=new Blob([F],{type:"text/vtt"}),t=shaka.media.MediaSourceEngine.createObjectURL(V),n="text/vtt";case 6:if(K={id:u.nextExternalStreamId_++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:shaka.media.SegmentIndex.forSingleSegment(0,w,[t]),mimeType:n||"",codecs:s||"",kind:i,encrypted:!1,drmInfos:[],keyIds:new Set,language:r,label:o||null,type:D.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!!l,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},q=shaka.util.MimeUtils.getFullType(K.mimeType,K.codecs),re=shaka.text.TextEngine.isTypeSupported(q),!re)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.MISSING_TEXT_PLUGIN,n);return u.manifest_.textStreams.push(K),u.onTracksChanged_(),ee.return(shaka.util.StreamUtils.textStreamToTrack(K))}})},shaka.Player.prototype.addChaptersTrack=function(t,r,i){var n=this,s,o,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){switch(m.nextAddress){case 1:if(n.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE&&n.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS)throw shaka.log.error("Must call load() and wait for it to resolve before adding chapters tracks."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.CONTENT_NOT_LOADED);if(i){m.jumpTo(2);break}return m.yield(n.getTextMimetype_(t),3);case 3:i=m.yieldResult;case 2:if(s=[],n.adManager_)try{s=n.adManager_.getServerSideCuePoints()}catch{}return m.yield(n.addSrcTrackElement_(t,r,"chapters",i,"",s),4);case 4:if(o=m.yieldResult,l=n.getChaptersTracks(),u=l.find(function(E){return E.language==r}),!u){m.jumpTo(5);break}return m.yield(new Promise(function(E,y){n.loadEventManager_.listenOnce(o,"load",E),n.loadEventManager_.listenOnce(o,"error",function(D){y(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.CHAPTERS_TRACK_FAILED))})}),6);case 6:return m.return(u);case 5:throw shaka.log.error("Cannot add this text when loaded with src="),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS)}})},shaka.Player.prototype.getTextMimetype_=function(t){var r=this,i,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){switch(s.nextAddress){case 1:return i=shaka.media.ManifestParser.getExtension(t),(n=shaka.Player.TEXT_EXTENSIONS_TO_MIME_TYPES_[i])?s.return(n):(s.setCatchFinallyBlocks(2),goog.asserts.assert(r.networkingEngine_,"Need networking engine."),s.yield(shaka.media.ManifestParser.getMimeType(t,r.networkingEngine_,r.config_.streaming.retryParameters),4));case 4:n=s.yieldResult,s.leaveTryBlock(3);break;case 2:s.enterCatchBlock();case 3:if(n)return s.return(n);throw shaka.log.error("The mimeType has not been provided and it could not be deduced from its extension."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.TEXT_COULD_NOT_GUESS_MIME_TYPE,i)}})},shaka.Player.prototype.addSrcTrackElement_=function(t,r,i,n,s,o){var l=this,u,m,E,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(D){return D.nextAddress==1?n=="text/vtt"&&!o.length?D.jumpTo(2):(goog.asserts.assert(l.networkingEngine_,"Need networking engine."),D.yield(l.getTextData_(t,l.networkingEngine_,l.config_.streaming.retryParameters),3)):(D.nextAddress!=2&&(u=D.yieldResult,m=l.convertToWebVTT_(u,n,o),E=new Blob([m],{type:"text/vtt"}),t=shaka.media.MediaSourceEngine.createObjectURL(E),n="text/vtt"),y=document.createElement("track"),y.src=l.cmcdManager_.appendTextTrackData(t),y.label=s,y.kind=i,y.srclang=r,l.video_.getAttribute("crossorigin")||l.video_.setAttribute("crossorigin","anonymous"),l.video_.appendChild(y),D.return(y))})},shaka.Player.prototype.getTextData_=function(t,r,i){var n=this,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){return u.nextAddress==1?(s=shaka.net.NetworkingEngine.RequestType.SEGMENT,o=shaka.net.NetworkingEngine.makeRequest([t],i),o.method="GET",n.cmcdManager_.applyTextData(o),u.yield(r.request(s,o).promise,2)):(l=u.yieldResult,u.return(l.data))})},shaka.Player.prototype.convertToWebVTT_=function(t,r,i){var n=shaka.text.TextEngine.findParser(r);if(n)return r=n(),n={periodStart:0,segmentStart:0,segmentEnd:this.video_.duration},t=shaka.util.BufferUtils.toUint8(t),t=r.parseMedia(t,n),shaka.text.WebVttGenerator.convert(t,i);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.MISSING_TEXT_PLUGIN,r)},shaka.Player.prototype.setMaxHardwareResolution=function(t,r){this.maxHwRes_.width=t,this.maxHwRes_.height=r},shaka.Player.prototype.retryStreaming=function(){return this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE?this.streamingEngine_.retry():!1},shaka.Player.prototype.getManifest=function(){return shaka.log.alwaysWarn("Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for."),this.manifest_},shaka.Player.prototype.getManifestParserFactory=function(){return this.parserFactory_},shaka.Player.prototype.addVariantToSwitchHistory_=function(t,r){this.stats_.getSwitchHistory().updateCurrentVariant(t,r)},shaka.Player.prototype.addTextStreamToSwitchHistory_=function(t,r){this.stats_.getSwitchHistory().updateCurrentText(t,r)},shaka.Player.prototype.defaultConfig_=function(){var t=this,r=shaka.util.PlayerConfiguration.createDefault();return r.streaming.failureCallback=function(i){t.defaultStreamingFailureCallback_(i)},r.textDisplayFactory=function(){return t.videoContainer_?new shaka.text.UITextDisplayer(t.video_,t.videoContainer_):new shaka.text.SimpleTextDisplayer(t.video_)},r},shaka.Player.prototype.setVideoContainer=function(t){this.videoContainer_=t},shaka.Player.prototype.defaultStreamingFailureCallback_=function(t){var r=[shaka.util.Error.Code.BAD_HTTP_STATUS,shaka.util.Error.Code.HTTP_ERROR,shaka.util.Error.Code.TIMEOUT];this.isLive()&&r.includes(t.code)&&(t.severity=shaka.util.Error.Severity.RECOVERABLE,shaka.log.warning("Live streaming error.  Retrying automatically..."),this.retryStreaming())},shaka.Player.prototype.makeTextStreamsForClosedCaptions_=function(t){for(var r=shaka.util.ManifestParserUtils.ContentType,i=shaka.util.ManifestParserUtils.TextStreamKind,n=shaka.util.MimeUtils.CEA608_CLOSED_CAPTION_MIMETYPE,s=shaka.util.MimeUtils.CEA708_CLOSED_CAPTION_MIMETYPE,o=new Set,l=$jscomp.makeIterator(t.textStreams),u=l.next();!u.done;u=l.next())u=u.value,u.mimeType!=n&&u.mimeType!=s||o.add(u.originalId);for(l=$jscomp.makeIterator(t.variants),u=l.next();!u.done;u=l.next())if((u=u.value.video)&&u.closedCaptions){for(var m=$jscomp.makeIterator(u.closedCaptions.keys()),E=m.next();!E.done;E=m.next())if(E=E.value,!o.has(E)){var y=E.startsWith("CC")?n:s,D=new shaka.media.MetaSegmentIndex;y={id:this.nextExternalStreamId_++,originalId:E,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:D,mimeType:y,codecs:"",kind:i.CLOSED_CAPTION,encrypted:!1,drmInfos:[],keyIds:new Set,language:u.closedCaptions.get(E),label:null,type:r.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:u.roles,forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},t.textStreams.push(y),o.add(E)}}},shaka.Player.prototype.filterManifest_=function(t){var r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){if(i.nextAddress==1)return i.yield(r.filterManifestWithStreamUtils_(t),2);r.filterManifestWithRestrictions_(t),i.jumpToEnd()})},shaka.Player.prototype.filterManifestWithStreamUtils_=function(t){var r=this,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(n.nextAddress==1)return goog.asserts.assert(t,"Manifest should exist!"),goog.asserts.assert(r.video_,"Must not be destroyed"),i=r.streamingEngine_?r.streamingEngine_.getCurrentVariant():null,n.yield(shaka.util.StreamUtils.filterManifest(r.drmEngine_,i,t),2);r.checkPlayableVariants_(t),n.jumpToEnd()})},shaka.Player.prototype.filterManifestWithRestrictions_=function(t){if(this.loadMode_!=shaka.Player.LoadMode.DESTROYED){shaka.util.StreamUtils.applyRestrictions(t.variants,this.config_.restrictions,this.maxHwRes_)&&this.streamingEngine_&&this.onTracksChanged_();var r=this.drmEngine_?this.drmEngine_.getDrmInfo():null;if(r&&this.drmEngine_.getMediaKeys())for(var i=$jscomp.makeIterator(t.variants),n=i.next();!n.done;n=i.next()){n=n.value,n=(n.video?n.video.drmInfos:[]).concat(n.audio?n.audio.drmInfos:[]),n=$jscomp.makeIterator(n);for(var s=n.next();!s.done;s=n.next())if(s=s.value,s.keySystem==r.keySystem){s=$jscomp.makeIterator(s.initData||[]);for(var o=s.next();!o.done;o=s.next())o=o.value,this.drmEngine_.newInitData(o.initDataType,o.initData)}}this.checkRestrictedVariants_(t)}},shaka.Player.prototype.filterManifestByCurrentVariant_=function(){goog.asserts.assert(this.manifest_,"Manifest should be valid"),goog.asserts.assert(this.streamingEngine_,"StreamingEngine should be valid");var t=this.streamingEngine_?this.streamingEngine_.getCurrentVariant():null;shaka.util.StreamUtils.filterManifestByCurrentVariant(t,this.manifest_),this.checkPlayableVariants_(this.manifest_)},shaka.Player.prototype.adjustStartTime_=function(t,r){var i,n,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){return u.nextAddress==1?(i=t.audio,n=t.video,s=function(m,E){var y,D,w;return $jscomp.asyncExecutePromiseGeneratorProgram(function(B){return B.nextAddress==1?m?B.yield(m.createSegmentIndex(),2):B.return(null):(D=(y=m.segmentIndex.getIteratorForTime(E))?y.next().value:null,D?(w=D.startTime,goog.asserts.assert(w<=E,"Segment should start before target time!"),B.return(w)):B.return(null))})},u.yield(s(i,r),2)):u.nextAddress!=3?(o=u.yieldResult,u.yield(s(n,r),3)):(l=u.yieldResult,l!=null&&o!=null?u.return(Math.max(l,o)):l!=null?u.return(l):o!=null?u.return(o):u.return(r))})},shaka.Player.prototype.updateBufferState_=function(){var t=this.isBuffering();shaka.log.v2("Player changing buffering state to",t),this.stats_&&this.bufferObserver_&&this.playhead_&&(this.playRateController_.setBuffering(t),this.cmcdManager_&&this.cmcdManager_.setBuffering(t),this.updateStateHistory_());var r=shaka.Player.EventName.Buffering;t=new Map().set("buffering",t),this.dispatchEvent(this.makeEvent_(r,t))},shaka.Player.prototype.onRateChange_=function(){var t=this.video_.playbackRate;t!=0&&(this.playRateController_&&this.playRateController_.set(t),t=this.makeEvent_(shaka.Player.EventName.RateChange),this.dispatchEvent(t))},shaka.Player.prototype.updateStateHistory_=function(){if(this.stats_&&this.bufferObserver_){var t=shaka.media.BufferingObserver.State,r=this.stats_.getStateHistory();this.bufferObserver_.getState()==t.STARVING?r.update("buffering"):this.video_.paused?r.update("paused"):this.video_.ended?r.update("ended"):r.update("playing")}},shaka.Player.prototype.onSeek_=function(){this.playheadObservers_&&this.playheadObservers_.notifyOfSeek(),this.streamingEngine_&&this.streamingEngine_.seeked(),this.bufferObserver_&&this.pollBufferState_()},shaka.Player.prototype.updateAbrManagerVariants_=function(){try{goog.asserts.assert(this.manifest_,"Manifest should exist by now!"),this.checkRestrictedVariants_(this.manifest_)}catch(r){return this.onError_(r),!1}var t=this.manifest_.variants.filter(function(r){return shaka.util.StreamUtils.isPlayable(r)});return t=this.currentAdaptationSetCriteria_.create(t),this.abrManager_.setVariants(Array.from(t.values())),!0},shaka.Player.prototype.chooseVariant_=function(){return this.updateAbrManagerVariants_()?this.abrManager_.chooseVariant():null},shaka.Player.prototype.chooseTextStream_=function(){return shaka.util.StreamUtils.filterStreamsByLanguageAndRole(this.manifest_.textStreams,this.currentTextLanguage_,this.currentTextRole_,this.currentTextForced_)[0]||null},shaka.Player.prototype.chooseVariantAndSwitch_=function(){goog.asserts.assert(this.config_,"Must not be destroyed");var t=this.chooseVariant_();t&&this.switchVariant_(t,!0,!0,0)},shaka.Player.prototype.switchVariant_=function(t,r,i,n){var s=this.streamingEngine_.getCurrentVariant();t==s?(shaka.log.debug("Variant already selected."),i&&this.streamingEngine_.switchVariant(t,i,n,!0)):(this.addVariantToSwitchHistory_(t,r),this.streamingEngine_.switchVariant(t,i,n),i=null,s&&(i=shaka.util.StreamUtils.variantToTrack(s)),t=shaka.util.StreamUtils.variantToTrack(t),r?this.onAdaptation_(i,t):this.onVariantChanged_(i,t))},shaka.Player.prototype.switchHtml5Track_=function(t){goog.asserts.assert(this.video_&&this.video_.audioTracks,"Video and video.audioTracks should not be null!");var r=Array.from(this.video_.audioTracks).find(function(i){return i.enabled});t.enabled=!0,t.id!==r.id&&(r.enabled=!1),r=shaka.util.StreamUtils.html5AudioTrackToTrack(r),t=shaka.util.StreamUtils.html5AudioTrackToTrack(t),this.onVariantChanged_(r,t)},shaka.Player.prototype.setInitialTextState_=function(t,r){r?(t.audio&&this.shouldInitiallyShowText_(t.audio,r)&&(this.isTextVisible_=!0),this.isTextVisible_&&(this.mediaSourceEngine_.getTextDisplayer().setTextVisibility(!0),goog.asserts.assert(this.shouldStreamText_(),"Should be streaming text")),this.onTextTrackVisibility_()):this.isTextVisible_=!1},shaka.Player.prototype.shouldInitiallyShowText_=function(t,r){var i=shaka.util.LanguageUtils,n=i.normalize(this.config_.preferredTextLanguage),s=i.normalize(t.language),o=i.normalize(r.language);return i.areLanguageCompatible(o,n)&&!i.areLanguageCompatible(s,o)},shaka.Player.prototype.onManifestUpdate_=function(){this.parser_&&this.parser_.update&&this.parser_.update()},shaka.Player.prototype.onSegmentAppended_=function(){this.playhead_&&this.playhead_.notifyOfBufferingChange(),this.pollBufferState_()},shaka.Player.prototype.switch_=function(t,r,i){r=r===void 0?!1:r,i=i===void 0?0:i,shaka.log.debug("switch_"),goog.asserts.assert(this.config_.abr.enabled,"AbrManager should not call switch while disabled!"),goog.asserts.assert(this.manifest_,"We need a manifest to switch variants."),this.streamingEngine_&&t!=this.streamingEngine_.getCurrentVariant()&&this.switchVariant_(t,!0,r,i)},shaka.Player.prototype.onAdaptation_=function(t,r){var i=new Map().set("oldTrack",t).set("newTrack",r);i=this.makeEvent_(shaka.Player.EventName.Adaptation,i),this.delayDispatchEvent_(i)},shaka.Player.prototype.onTracksChanged_=function(){var t=this.makeEvent_(shaka.Player.EventName.TracksChanged);this.delayDispatchEvent_(t)},shaka.Player.prototype.onVariantChanged_=function(t,r){var i=new Map().set("oldTrack",t).set("newTrack",r);i=this.makeEvent_(shaka.Player.EventName.VariantChanged,i),this.delayDispatchEvent_(i)},shaka.Player.prototype.onTextChanged_=function(){var t=this.makeEvent_(shaka.Player.EventName.TextChanged);this.delayDispatchEvent_(t)},shaka.Player.prototype.onTextTrackVisibility_=function(){var t=this.makeEvent_(shaka.Player.EventName.TextTrackVisibility);this.delayDispatchEvent_(t)},shaka.Player.prototype.onAbrStatusChanged_=function(){var t=new Map().set("newStatus",this.config_.abr.enabled);this.delayDispatchEvent_(this.makeEvent_(shaka.Player.EventName.AbrStatusChanged,t))},shaka.Player.prototype.onError_=function(t){if(goog.asserts.assert(t instanceof shaka.util.Error,"Wrong error type!"),this.loadMode_!=shaka.Player.LoadMode.DESTROYED){var r=this.makeEvent_(shaka.Player.EventName.Error,new Map().set("detail",t));this.dispatchEvent(r),r.defaultPrevented&&(t.handled=!0)}},shaka.Player.prototype.onRegionEvent_=function(t,r){var i={schemeIdUri:r.schemeIdUri,value:r.value,startTime:r.startTime,endTime:r.endTime,id:r.id,eventElement:r.eventElement};i=new Map().set("detail",i),this.dispatchEvent(this.makeEvent_(t,i))},shaka.Player.prototype.onMediaQualityChange_=function(t,r){var i={bandwidth:t.bandwidth,audioSamplingRate:t.audioSamplingRate,codecs:t.codecs,contentType:t.contentType,frameRate:t.frameRate,height:t.height,mimeType:t.mimeType,channelsCount:t.channelsCount,pixelAspectRatio:t.pixelAspectRatio,width:t.width};i=new Map().set("mediaQuality",i).set("position",r),this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.MediaQualityChanged,i))},shaka.Player.prototype.videoErrorToShakaError_=function(){if(goog.asserts.assert(this.video_.error,"Video error expected, but missing!"),!this.video_.error)return null;var t=this.video_.error.code;if(t==1)return null;var r=this.video_.error.msExtendedCode;return r&&(0>r&&(r+=Math.pow(2,32)),r=r.toString(16)),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.VIDEO_ERROR,t,r,this.video_.error.message)},shaka.Player.prototype.onVideoError_=function(t){(t=this.videoErrorToShakaError_())&&this.onError_(t)},shaka.Player.prototype.onKeyStatus_=function(t){if(this.streamingEngine_){var r=Object.keys(t);r.length==0&&shaka.log.warning("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var i=r.length==1&&r[0]=="00";i&&shaka.log.warning("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var n=shaka.Player.restrictedStatuses_,s=!1;if(r.length){r=$jscomp.makeIterator(this.manifest_.variants);for(var o=r.next();!o.done;o=r.next()){o=o.value;var l=shaka.util.StreamUtils.getVariantStreams(o);l=$jscomp.makeIterator(l);for(var u=l.next();!u.done;u=l.next()){var m=u.value;if(u=o.allowedByKeySystem,m.keyIds.size){o.allowedByKeySystem=!0,m=$jscomp.makeIterator(m.keyIds);for(var E=m.next();!E.done;E=m.next())E=E.value,E=t[i?"00":E],o.allowedByKeySystem=o.allowedByKeySystem&&!!E&&!n.includes(E)}u!=o.allowedByKeySystem&&(s=!0)}}}(!s||this.updateAbrManagerVariants_())&&((t=this.streamingEngine_.getCurrentVariant())&&!t.allowedByKeySystem&&(shaka.log.debug("Choosing new streams after key status changed"),this.chooseVariantAndSwitch_()),s&&this.onTracksChanged_())}},shaka.Player.prototype.onExpirationUpdated_=function(t,r){this.parser_&&this.parser_.onExpirationUpdated&&this.parser_.onExpirationUpdated(t,r);var i=this.makeEvent_(shaka.Player.EventName.ExpirationUpdated);this.dispatchEvent(i)},shaka.Player.prototype.shouldStreamText_=function(){return this.config_.streaming.alwaysStreamText||this.isTextTrackVisible()},shaka.Player.applyPlayRange_=function(t,r,i){0<r&&(t.isLive()?shaka.log.warning("|playRangeStart| has been configured for live content. Ignoring the setting."):t.setUserSeekStart(r)),r=t.getDuration(),i<r&&(t.isLive()?shaka.log.warning("|playRangeEnd| has been configured for live content. Ignoring the setting."):t.setDuration(i))},shaka.Player.prototype.checkRestrictedVariants_=function(t){var r=shaka.Player.restrictedStatuses_,i=this.drmEngine_?this.drmEngine_.getKeyStatuses():{},n=Object.keys(i);n=n.length&&n[0]=="00";var s=!1,o=!1,l=new Set,u=new Set;t=$jscomp.makeIterator(t.variants);for(var m=t.next();!m.done;m=t.next()){m=m.value;var E=[];m.audio&&E.push(m.audio),m.video&&E.push(m.video),E=$jscomp.makeIterator(E);for(var y=E.next();!y.done;y=E.next())if(y=y.value,y.keyIds.size){y=$jscomp.makeIterator(y.keyIds);for(var D=y.next();!D.done;D=y.next()){D=D.value;var w=i[n?"00":D];w?r.includes(w)&&u.add(w):l.add(D)}}m.allowedByApplication?m.allowedByKeySystem&&(s=!0):o=!0}if(!s)throw r={hasAppRestrictions:o,missingKeys:Array.from(l),restrictedKeyStatuses:Array.from(u)},new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.RESTRICTIONS_CANNOT_BE_MET,r)},shaka.Player.prototype.checkPlayableVariants_=function(t){if(!t.variants.some(shaka.util.StreamUtils.isPlayable))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.CONTENT_UNSUPPORTED_BY_BROWSER)},shaka.Player.prototype.delayDispatchEvent_=function(t){var r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){if(i.nextAddress==1)return i.yield(Promise.resolve(),2);r.loadMode_!=shaka.Player.LoadMode.DESTROYED&&r.dispatchEvent(t),i.jumpToEnd()})},shaka.Player.getLanguagesFrom_=function(t){var r=new Set;t=$jscomp.makeIterator(t);for(var i=t.next();!i.done;i=t.next())i=i.value,i.language?r.add(shaka.util.LanguageUtils.normalize(i.language)):r.add("und");return r},shaka.Player.getLanguageAndRolesFrom_=function(t){var r=new Map,i=new Map;t=$jscomp.makeIterator(t);for(var n=t.next();!n.done;n=t.next()){n=n.value;var s="und",o=[];n.language&&(s=shaka.util.LanguageUtils.normalize(n.language)),(o=n.type=="variant"?n.audioRoles:n.roles)&&o.length||(o=[""]),r.has(s)||r.set(s,new Set),o=$jscomp.makeIterator(o);for(var l=o.next();!l.done;l=o.next())l=l.value,r.get(s).add(l),n.label&&(i.has(s)||i.set(s,new Map),i.get(s).set(l,n.label))}var u=[];return r.forEach(function(m,E){for(var y=$jscomp.makeIterator(m),D=y.next();!D.done;D=y.next()){D=D.value;var w=null;i.has(E)&&i.get(E).has(D)&&(w=i.get(E).get(D)),u.push({language:E,role:D,label:w})}}),u},shaka.Player.prototype.isBufferedToEndMS_=function(){if(goog.asserts.assert(this.video_,"We need a video element to get buffering information"),goog.asserts.assert(this.mediaSourceEngine_,"We need a media source engine to get buffering information"),goog.asserts.assert(this.manifest_,"We need a manifest to get buffering information"),this.video_.ended||this.mediaSourceEngine_.ended())return!0;if(this.manifest_.presentationTimeline.isLive()){var t=this.manifest_.presentationTimeline.getSegmentAvailabilityEnd(),r=shaka.media.TimeRangesUtils.bufferEnd(this.video_.buffered);if(r!=null&&r>=t)return!0}return!1},shaka.Player.prototype.isBufferedToEndSrc_=function(){if(goog.asserts.assert(this.video_,"We need a video element to get buffering information"),this.video_.ended)return!0;var t=shaka.media.TimeRangesUtils.bufferEnd(this.video_.buffered);return t!=null&&t>=this.video_.duration-1},shaka.Player.prototype.createAbortLoadError_=function(){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.LOAD_INTERRUPTED)},shaka.Player.prototype.getNextStep_=function(t,r,i,n){var s=null;return t==this.detachNode_&&(s=i==this.detachNode_?this.detachNode_:this.attachNode_),t==this.attachNode_&&(s=this.getNextAfterAttach_(i,r,n)),t==this.mediaSourceNode_&&(s=this.getNextAfterMediaSource_(i,r,n)),t==this.parserNode_&&(s=this.getNextMatchingAllDependencies_(this.loadNode_,this.manifestNode_,this.unloadNode_,i,r,n)),t==this.manifestNode_&&(s=this.getNextMatchingAllDependencies_(this.loadNode_,this.drmNode_,this.unloadNode_,i,r,n)),t==this.drmNode_&&(s=this.getNextMatchingAllDependencies_(this.loadNode_,this.loadNode_,this.unloadNode_,i,r,n)),t==this.srcEqualsDrmNode_&&(s=i==this.srcEqualsNode_&&r.mediaElement==n.mediaElement?this.srcEqualsNode_:this.unloadNode_),(t==this.loadNode_||t==this.srcEqualsNode_)&&(s=this.unloadNode_),t==this.unloadNode_&&(s=this.getNextAfterUnload_(i,r,n)),goog.asserts.assert(s,"Missing next step!"),s},shaka.Player.prototype.getNextAfterAttach_=function(t,r,i){return t==this.detachNode_||r.mediaElement!=i.mediaElement?this.detachNode_:t==this.attachNode_?this.attachNode_:t==this.mediaSourceNode_||t==this.loadNode_?this.mediaSourceNode_:t==this.srcEqualsNode_?this.srcEqualsDrmNode_:null},shaka.Player.prototype.getNextAfterMediaSource_=function(t,r,i){return t==this.loadNode_&&r.mediaElement==i.mediaElement?this.parserNode_:this.unloadNode_},shaka.Player.prototype.getNextAfterUnload_=function(t,r,i){return i.mediaElement&&r.mediaElement==i.mediaElement?this.attachNode_:this.detachNode_},shaka.Player.prototype.getNextMatchingAllDependencies_=function(t,r,i,n,s,o){return n==t&&s.mediaElement==o.mediaElement&&s.uri==o.uri&&s.mimeType==o.mimeType?r:i},shaka.Player.createEmptyPayload_=function(){return{mediaElement:null,mimeType:null,startTime:null,startTimeOfLoad:NaN,uri:null}},shaka.Player.prototype.wrapWalkerListenersWithPromise_=function(t){var r=this;return new Promise(function(i,n){t.onCancel=function(){return n(r.createAbortLoadError_())},t.onEnd=function(){return i()},t.onError=function(s){return n(s)},t.onSkip=function(){return n(r.createAbortLoadError_())}})},goog.exportSymbol("shaka.Player",shaka.Player),goog.exportProperty(shaka.Player.prototype,"setVideoContainer",shaka.Player.prototype.setVideoContainer),goog.exportProperty(shaka.Player.prototype,"getManifestParserFactory",shaka.Player.prototype.getManifestParserFactory),goog.exportProperty(shaka.Player.prototype,"getManifest",shaka.Player.prototype.getManifest),goog.exportProperty(shaka.Player.prototype,"retryStreaming",shaka.Player.prototype.retryStreaming),goog.exportProperty(shaka.Player.prototype,"setMaxHardwareResolution",shaka.Player.prototype.setMaxHardwareResolution),goog.exportProperty(shaka.Player.prototype,"addChaptersTrack",shaka.Player.prototype.addChaptersTrack),goog.exportProperty(shaka.Player.prototype,"addTextTrackAsync",shaka.Player.prototype.addTextTrackAsync),goog.exportProperty(shaka.Player.prototype,"addTextTrack",shaka.Player.prototype.addTextTrack),goog.exportProperty(shaka.Player.prototype,"getStats",shaka.Player.prototype.getStats),goog.exportProperty(shaka.Player.prototype,"getBufferedInfo",shaka.Player.prototype.getBufferedInfo),goog.exportProperty(shaka.Player.prototype,"getPresentationStartTimeAsDate",shaka.Player.prototype.getPresentationStartTimeAsDate),goog.exportProperty(shaka.Player.prototype,"getPlayheadTimeAsDate",shaka.Player.prototype.getPlayheadTimeAsDate),goog.exportProperty(shaka.Player.prototype,"setTextTrackVisibility",shaka.Player.prototype.setTextTrackVisibility),goog.exportProperty(shaka.Player.prototype,"getChapters",shaka.Player.prototype.getChapters),goog.exportProperty(shaka.Player.prototype,"getChaptersTracks",shaka.Player.prototype.getChaptersTracks),goog.exportProperty(shaka.Player.prototype,"isTextTrackVisible",shaka.Player.prototype.isTextTrackVisible),goog.exportProperty(shaka.Player.prototype,"selectVariantsByLabel",shaka.Player.prototype.selectVariantsByLabel),goog.exportProperty(shaka.Player.prototype,"selectTextLanguage",shaka.Player.prototype.selectTextLanguage),goog.exportProperty(shaka.Player.prototype,"selectAudioLanguage",shaka.Player.prototype.selectAudioLanguage),goog.exportProperty(shaka.Player.prototype,"getTextLanguages",shaka.Player.prototype.getTextLanguages),goog.exportProperty(shaka.Player.prototype,"getAudioLanguages",shaka.Player.prototype.getAudioLanguages),goog.exportProperty(shaka.Player.prototype,"getTextLanguagesAndRoles",shaka.Player.prototype.getTextLanguagesAndRoles),goog.exportProperty(shaka.Player.prototype,"getAudioLanguagesAndRoles",shaka.Player.prototype.getAudioLanguagesAndRoles),goog.exportProperty(shaka.Player.prototype,"selectVariantTrack",shaka.Player.prototype.selectVariantTrack),goog.exportProperty(shaka.Player.prototype,"selectTextTrack",shaka.Player.prototype.selectTextTrack),goog.exportProperty(shaka.Player.prototype,"getThumbnails",shaka.Player.prototype.getThumbnails),goog.exportProperty(shaka.Player.prototype,"getImageTracks",shaka.Player.prototype.getImageTracks),goog.exportProperty(shaka.Player.prototype,"getTextTracks",shaka.Player.prototype.getTextTracks),goog.exportProperty(shaka.Player.prototype,"getVariantTracks",shaka.Player.prototype.getVariantTracks),goog.exportProperty(shaka.Player.prototype,"cancelTrickPlay",shaka.Player.prototype.cancelTrickPlay),goog.exportProperty(shaka.Player.prototype,"trickPlay",shaka.Player.prototype.trickPlay),goog.exportProperty(shaka.Player.prototype,"getPlaybackRate",shaka.Player.prototype.getPlaybackRate),goog.exportProperty(shaka.Player.prototype,"isBuffering",shaka.Player.prototype.isBuffering),goog.exportProperty(shaka.Player.prototype,"getKeyStatuses",shaka.Player.prototype.getKeyStatuses),goog.exportProperty(shaka.Player.prototype,"getExpiration",shaka.Player.prototype.getExpiration),goog.exportProperty(shaka.Player.prototype,"drmInfo",shaka.Player.prototype.drmInfo),goog.exportProperty(shaka.Player.prototype,"keySystem",shaka.Player.prototype.keySystem),goog.exportProperty(shaka.Player.prototype,"goToLive",shaka.Player.prototype.goToLive),goog.exportProperty(shaka.Player.prototype,"seekRange",shaka.Player.prototype.seekRange),goog.exportProperty(shaka.Player.prototype,"isAudioOnly",shaka.Player.prototype.isAudioOnly),goog.exportProperty(shaka.Player.prototype,"isInProgress",shaka.Player.prototype.isInProgress),goog.exportProperty(shaka.Player.prototype,"isLive",shaka.Player.prototype.isLive),goog.exportProperty(shaka.Player.prototype,"getAdManager",shaka.Player.prototype.getAdManager),goog.exportProperty(shaka.Player.prototype,"getAssetUri",shaka.Player.prototype.getAssetUri),goog.exportProperty(shaka.Player.prototype,"getNetworkingEngine",shaka.Player.prototype.getNetworkingEngine),goog.exportProperty(shaka.Player.prototype,"getMediaElement",shaka.Player.prototype.getMediaElement),goog.exportProperty(shaka.Player.prototype,"getLoadMode",shaka.Player.prototype.getLoadMode),goog.exportProperty(shaka.Player.prototype,"resetConfiguration",shaka.Player.prototype.resetConfiguration),goog.exportProperty(shaka.Player.prototype,"getBufferFullness",shaka.Player.prototype.getBufferFullness),goog.exportProperty(shaka.Player.prototype,"getConfiguration",shaka.Player.prototype.getConfiguration),goog.exportProperty(shaka.Player.prototype,"configure",shaka.Player.prototype.configure),goog.exportProperty(shaka.Player.prototype,"load",shaka.Player.prototype.load),goog.exportProperty(shaka.Player.prototype,"updateStartTime",shaka.Player.prototype.updateStartTime),goog.exportProperty(shaka.Player.prototype,"unload",shaka.Player.prototype.unload),goog.exportProperty(shaka.Player.prototype,"detach",shaka.Player.prototype.detach),goog.exportProperty(shaka.Player.prototype,"attach",shaka.Player.prototype.attach),goog.exportProperty(shaka.Player,"probeSupport",shaka.Player.probeSupport),goog.exportProperty(shaka.Player,"isBrowserSupported",shaka.Player.isBrowserSupported),goog.exportProperty(shaka.Player,"setAdManagerFactory",shaka.Player.setAdManagerFactory),goog.exportProperty(shaka.Player,"registerSupportPlugin",shaka.Player.registerSupportPlugin),goog.exportProperty(shaka.Player.prototype,"destroy",shaka.Player.prototype.destroy),shaka.Player.EventName={AbrStatusChanged:"abrstatuschanged",Adaptation:"adaptation",Buffering:"buffering",DownloadFailed:"downloadfailed",DownloadHeadersReceived:"downloadheadersreceived",DrmSessionUpdate:"drmsessionupdate",Emsg:"emsg",Error:"error",ExpirationUpdated:"expirationupdated",LargeGap:"largegap",Loaded:"loaded",Loading:"loading",ManifestParsed:"manifestparsed",MediaQualityChanged:"mediaqualitychanged",Metadata:"metadata",OnStateChange:"onstatechange",OnStateIdle:"onstateidle",RateChange:"ratechange",SessionDataEvent:"sessiondata",Streaming:"streaming",TextChanged:"textchanged",TextTrackVisibility:"texttrackvisibility",TimelineRegionAdded:"timelineregionadded",TimelineRegionEnter:"timelineregionenter",TimelineRegionExit:"timelineregionexit",TracksChanged:"trackschanged",Unloading:"unloading",VariantChanged:"variantchanged"},shaka.Player.LoadMode={DESTROYED:0,NOT_LOADED:1,MEDIA_SOURCE:2,SRC_EQUALS:3},goog.exportProperty(shaka.Player,"LoadMode",shaka.Player.LoadMode),shaka.Player.TYPICAL_BUFFERING_THRESHOLD_=.5,shaka.Player.version="v3.3.9-debug",goog.exportProperty(shaka.Player,"version",shaka.Player.version),shaka.Deprecate.init(shaka.Player.version),shaka.Player.restrictedStatuses_=["output-restricted","internal-error"],shaka.Player.supportPlugins_={},shaka.Player.adManagerFactory_=null,shaka.Player.SRC_EQUAL_EXTENSIONS_TO_MIME_TYPES_={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mpd:"application/dash+xml",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"},shaka.Player.TEXT_EXTENSIONS_TO_MIME_TYPES_={sbv:"text/x-subviewer",srt:"text/srt",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml",lrc:"application/x-subtitle-lrc",ssa:"text/x-ssa",ass:"text/x-ssa"},shaka.Player.TextTrackLabel="Shaka Player TextTrack",shaka.ads={},shaka.ads.AdsStats=function(){this.loadTimes_=[],this.skipped_=this.playedCompletely_=this.started_=0},shaka.ads.AdsStats.prototype.addLoadTime=function(t){this.loadTimes_.push(t)},shaka.ads.AdsStats.prototype.incrementStarted=function(){this.started_++},shaka.ads.AdsStats.prototype.incrementPlayedCompletely=function(){this.playedCompletely_++},shaka.ads.AdsStats.prototype.incrementSkipped=function(){this.skipped_++},shaka.ads.AdsStats.prototype.getBlob=function(){return{loadTimes:this.loadTimes_,started:this.started_,playedCompletely:this.playedCompletely_,skipped:this.skipped_}},shaka.ads.ClientSideAd=function(t,r){var i=this;this.ad_=t,this.manager_=r,this.isPaused_=!1,this.volume_=this.manager_.getVolume(),this.eventManager_=new shaka.util.EventManager,this.eventManager_.listen(this.manager_,google.ima.AdEvent.Type.PAUSED,function(){i.isPaused_=!0}),this.eventManager_.listen(this.manager_,google.ima.AdEvent.Type.RESUMED,function(){i.isPaused_=!1})},shaka.ads.ClientSideAd.prototype.getDuration=function(){return this.ad_.getDuration()},shaka.ads.ClientSideAd.prototype.getMinSuggestedDuration=function(){return this.ad_.getMinSuggestedDuration()},shaka.ads.ClientSideAd.prototype.getRemainingTime=function(){return this.manager_.getRemainingTime()},shaka.ads.ClientSideAd.prototype.isPaused=function(){return this.isPaused_},shaka.ads.ClientSideAd.prototype.isSkippable=function(){return 0<=this.ad_.getSkipTimeOffset()},shaka.ads.ClientSideAd.prototype.getTimeUntilSkippable=function(){var t=this.ad_.getSkipTimeOffset();return t=this.getRemainingTime()-t,Math.max(t,0)},shaka.ads.ClientSideAd.prototype.canSkipNow=function(){return this.manager_.getAdSkippableState()},shaka.ads.ClientSideAd.prototype.skip=function(){return this.manager_.skip()},shaka.ads.ClientSideAd.prototype.setPaused=function(t){this.isPaused_=t},shaka.ads.ClientSideAd.prototype.pause=function(){return this.manager_.pause()},shaka.ads.ClientSideAd.prototype.play=function(){return this.manager_.resume()},shaka.ads.ClientSideAd.prototype.getVolume=function(){return this.manager_.getVolume()},shaka.ads.ClientSideAd.prototype.setVolume=function(t){return this.manager_.setVolume(t)},shaka.ads.ClientSideAd.prototype.isMuted=function(){return this.manager_.getVolume()==0},shaka.ads.ClientSideAd.prototype.isLinear=function(){return this.ad_.isLinear()},shaka.ads.ClientSideAd.prototype.resize=function(t,r){this.manager_.resize(t,r,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},shaka.ads.ClientSideAd.prototype.setMuted=function(t){t?(this.volume_=this.getVolume(),this.setVolume(0)):this.setVolume(this.volume_)},shaka.ads.ClientSideAd.prototype.getSequenceLength=function(){var t=this.ad_.getAdPodInfo();return t==null?1:t.getTotalAds()},shaka.ads.ClientSideAd.prototype.getPositionInSequence=function(){var t=this.ad_.getAdPodInfo();return t==null?1:t.getAdPosition()},shaka.ads.ClientSideAd.prototype.release=function(){this.manager_=this.ad_=null},goog.exportSymbol("shaka.ads.ClientSideAd",shaka.ads.ClientSideAd),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"release",shaka.ads.ClientSideAd.prototype.release),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getPositionInSequence",shaka.ads.ClientSideAd.prototype.getPositionInSequence),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getSequenceLength",shaka.ads.ClientSideAd.prototype.getSequenceLength),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"setMuted",shaka.ads.ClientSideAd.prototype.setMuted),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"resize",shaka.ads.ClientSideAd.prototype.resize),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"isLinear",shaka.ads.ClientSideAd.prototype.isLinear),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"isMuted",shaka.ads.ClientSideAd.prototype.isMuted),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"setVolume",shaka.ads.ClientSideAd.prototype.setVolume),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getVolume",shaka.ads.ClientSideAd.prototype.getVolume),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"play",shaka.ads.ClientSideAd.prototype.play),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"pause",shaka.ads.ClientSideAd.prototype.pause),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"skip",shaka.ads.ClientSideAd.prototype.skip),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"canSkipNow",shaka.ads.ClientSideAd.prototype.canSkipNow),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getTimeUntilSkippable",shaka.ads.ClientSideAd.prototype.getTimeUntilSkippable),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"isSkippable",shaka.ads.ClientSideAd.prototype.isSkippable),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"isPaused",shaka.ads.ClientSideAd.prototype.isPaused),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getRemainingTime",shaka.ads.ClientSideAd.prototype.getRemainingTime),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getMinSuggestedDuration",shaka.ads.ClientSideAd.prototype.getMinSuggestedDuration),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getDuration",shaka.ads.ClientSideAd.prototype.getDuration),shaka.ads.ClientSideAdManager=function(t,r,i,n){var s=this;this.adContainer_=t,this.video_=r,this.resizeObserver_=null,this.requestAdsStartTime_=NaN,this.onEvent_=n,this.ad_=null,this.eventManager_=new shaka.util.EventManager,google.ima.settings.setLocale(i),t=new google.ima.AdDisplayContainer(this.adContainer_,this.video_),t.initialize(),this.adsLoader_=new google.ima.AdsLoader(t),this.adsLoader_.getSettings().setPlayerType("shaka-player"),this.adsLoader_.getSettings().setPlayerVersion(shaka.Player.version),this.imaAdsManager_=null,this.eventManager_.listenOnce(this.adsLoader_,google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(o){s.onAdsManagerLoaded_(o)}),this.eventManager_.listen(this.adsLoader_,google.ima.AdErrorEvent.Type.AD_ERROR,function(o){s.onAdError_(o)}),this.video_.onended=function(){s.adsLoader_.contentComplete()}},shaka.ads.ClientSideAdManager.prototype.requestAds=function(t){goog.asserts.assert(t.adTagUrl||t.adsResponse,"The ad tag needs to be set up before requesting ads, or adsResponse must be filled."),this.requestAdsStartTime_=Date.now()/1e3,this.adsLoader_.requestAds(t)},shaka.ads.ClientSideAdManager.prototype.stop=function(){this.imaAdsManager_&&this.imaAdsManager_.stop(),this.adContainer_&&shaka.util.Dom.removeAllChildren(this.adContainer_)},shaka.ads.ClientSideAdManager.prototype.release=function(){this.stop(),this.resizeObserver_&&this.resizeObserver_.disconnect(),this.eventManager_&&this.eventManager_.release(),this.imaAdsManager_&&this.imaAdsManager_.destroy(),this.adsLoader_.destroy()},shaka.ads.ClientSideAdManager.prototype.onAdError_=function(t){shaka.log.warning("There was an ad error from the IMA SDK: "+t.getError()),shaka.log.warning("Resuming playback."),this.onAdComplete_(null),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.CUEPOINTS_CHANGED,new Map().set("cuepoints",[])))},shaka.ads.ClientSideAdManager.prototype.onAdsManagerLoaded_=function(t){var r=this;goog.asserts.assert(this.video_!=null,"Video should not be null!");var i=Date.now()/1e3-this.requestAdsStartTime_;if(this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.ADS_LOADED,new Map().set("loadTime",i))),this.imaAdsManager_=t.getAdsManager(this.video_),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.IMA_AD_MANAGER_LOADED,new Map().set("imaAdManager",this.imaAdsManager_))),i=this.imaAdsManager_.getCuePoints(),i.length){t=[],i=$jscomp.makeIterator(i);for(var n=i.next();!n.done;n=i.next())t.push({start:n.value,end:null});this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.CUEPOINTS_CHANGED,new Map().set("cuepoints",t)))}this.addImaEventListeners_();try{this.imaAdsManager_.init(this.video_.offsetWidth,this.video_.offsetHeight,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),this.eventManager_.listen(this.video_,"loadeddata",function(){r.imaAdsManager_.resize(r.video_.offsetWidth,r.video_.offsetHeight,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),"ResizeObserver"in window&&(this.resizeObserver_=new ResizeObserver(function(){r.imaAdsManager_.resize(r.video_.offsetWidth,r.video_.offsetHeight,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),this.resizeObserver_.observe(this.video_)),this.imaAdsManager_.start()}catch{this.onAdComplete_(null)}},shaka.ads.ClientSideAdManager.prototype.addImaEventListeners_=function(){var t=this,r=function(i,n){var s=new Map().set("originalEvent",i);t.onEvent_(new shaka.util.FakeEvent(n,s))};this.eventManager_.listen(this.imaAdsManager_,google.ima.AdErrorEvent.Type.AD_ERROR,function(i){t.onAdError_(i)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(i){t.onAdStart_(i)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.STARTED,function(i){t.onAdStart_(i)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.FIRST_QUARTILE,function(i){r(i,shaka.ads.AdManager.AD_FIRST_QUARTILE)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.MIDPOINT,function(i){r(i,shaka.ads.AdManager.AD_MIDPOINT)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.THIRD_QUARTILE,function(i){r(i,shaka.ads.AdManager.AD_THIRD_QUARTILE)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.COMPLETE,function(i){r(i,shaka.ads.AdManager.AD_COMPLETE)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(i){t.onAdComplete_(i)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(i){t.onAdComplete_(i)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.SKIPPED,function(i){r(i,shaka.ads.AdManager.AD_SKIPPED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.VOLUME_CHANGED,function(i){r(i,shaka.ads.AdManager.AD_VOLUME_CHANGED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.VOLUME_MUTED,function(i){r(i,shaka.ads.AdManager.AD_MUTED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.PAUSED,function(i){goog.asserts.assert(t.ad_!=null,"Ad should not be null!"),t.ad_.setPaused(!0),r(i,shaka.ads.AdManager.AD_PAUSED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.RESUMED,function(i){goog.asserts.assert(t.ad_!=null,"Ad should not be null!"),t.ad_.setPaused(!1),r(i,shaka.ads.AdManager.AD_RESUMED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,function(i){goog.asserts.assert(t.ad_!=null,"Ad should not be null!"),r(i,shaka.ads.AdManager.AD_SKIP_STATE_CHANGED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.CLICK,function(i){r(i,shaka.ads.AdManager.AD_CLICKED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_PROGRESS,function(i){r(i,shaka.ads.AdManager.AD_PROGRESS)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_BUFFERING,function(i){r(i,shaka.ads.AdManager.AD_BUFFERING)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.IMPRESSION,function(i){r(i,shaka.ads.AdManager.AD_IMPRESSION)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.DURATION_CHANGE,function(i){r(i,shaka.ads.AdManager.AD_DURATION_CHANGED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.USER_CLOSE,function(i){r(i,shaka.ads.AdManager.AD_CLOSED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.LOADED,function(i){r(i,shaka.ads.AdManager.AD_LOADED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(i){r(i,shaka.ads.AdManager.ALL_ADS_COMPLETED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.LINEAR_CHANGED,function(i){r(i,shaka.ads.AdManager.AD_LINEAR_CHANGED)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_METADATA,function(i){r(i,shaka.ads.AdManager.AD_METADATA)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.LOG,function(i){r(i,shaka.ads.AdManager.AD_RECOVERABLE_ERROR)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_BREAK_READY,function(i){r(i,shaka.ads.AdManager.AD_BREAK_READY)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.INTERACTION,function(i){r(i,shaka.ads.AdManager.AD_INTERACTION)})},shaka.ads.ClientSideAdManager.prototype.onAdStart_=function(t){goog.asserts.assert(this.imaAdsManager_,"Should have an ads manager at this point!");var r=t.getAd();this.ad_=new shaka.ads.ClientSideAd(r,this.imaAdsManager_),t=new Map().set("ad",this.ad_).set("sdkAdObject",r).set("originalEvent",t),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STARTED,t)),this.ad_.isLinear()&&(this.adContainer_.setAttribute("ad-active","true"),this.video_.pause())},shaka.ads.ClientSideAdManager.prototype.onAdComplete_=function(t){this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED,new Map().set("originalEvent",t))),this.ad_&&this.ad_.isLinear()&&(this.adContainer_.removeAttribute("ad-active"),this.video_.play())},shaka.ads.ServerSideAd=function(t,r){this.ad_=t,this.adProgressData_=null,this.video_=r},shaka.ads.ServerSideAd.prototype.setProgressData=function(t){this.adProgressData_=t},shaka.ads.ServerSideAd.prototype.getDuration=function(){return this.adProgressData_?this.adProgressData_.duration:-1},shaka.ads.ServerSideAd.prototype.getMinSuggestedDuration=function(){return this.getDuration()},shaka.ads.ServerSideAd.prototype.getRemainingTime=function(){return this.adProgressData_?this.adProgressData_.duration-this.adProgressData_.currentTime:-1},shaka.ads.ServerSideAd.prototype.isPaused=function(){return this.video_.paused},shaka.ads.ServerSideAd.prototype.isSkippable=function(){return this.ad_.isSkippable()},shaka.ads.ServerSideAd.prototype.getTimeUntilSkippable=function(){var t=this.ad_.getSkipTimeOffset();return t=this.getRemainingTime()-t,Math.max(t,0)},shaka.ads.ServerSideAd.prototype.canSkipNow=function(){return this.getTimeUntilSkippable()==0},shaka.ads.ServerSideAd.prototype.skip=function(){this.video_.currentTime+=this.getRemainingTime()},shaka.ads.ServerSideAd.prototype.pause=function(){return this.video_.pause()},shaka.ads.ServerSideAd.prototype.play=function(){return this.video_.play()},shaka.ads.ServerSideAd.prototype.getVolume=function(){return this.video_.volume},shaka.ads.ServerSideAd.prototype.setVolume=function(t){this.video_.volume=t},shaka.ads.ServerSideAd.prototype.isMuted=function(){return this.video_.muted},shaka.ads.ServerSideAd.prototype.isLinear=function(){return!0},shaka.ads.ServerSideAd.prototype.resize=function(t,r){},shaka.ads.ServerSideAd.prototype.setMuted=function(t){this.video_.muted=t},shaka.ads.ServerSideAd.prototype.getSequenceLength=function(){var t=this.ad_.getAdPodInfo();return t==null?1:t.getTotalAds()},shaka.ads.ServerSideAd.prototype.getPositionInSequence=function(){var t=this.ad_.getAdPodInfo();return t==null?1:t.getAdPosition()},shaka.ads.ServerSideAd.prototype.release=function(){this.video_=this.adProgressData_=this.ad_=null},goog.exportSymbol("shaka.ads.ServerSideAd",shaka.ads.ServerSideAd),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"release",shaka.ads.ServerSideAd.prototype.release),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getPositionInSequence",shaka.ads.ServerSideAd.prototype.getPositionInSequence),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getSequenceLength",shaka.ads.ServerSideAd.prototype.getSequenceLength),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"setMuted",shaka.ads.ServerSideAd.prototype.setMuted),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"resize",shaka.ads.ServerSideAd.prototype.resize),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"isLinear",shaka.ads.ServerSideAd.prototype.isLinear),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"isMuted",shaka.ads.ServerSideAd.prototype.isMuted),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"setVolume",shaka.ads.ServerSideAd.prototype.setVolume),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getVolume",shaka.ads.ServerSideAd.prototype.getVolume),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"play",shaka.ads.ServerSideAd.prototype.play),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"pause",shaka.ads.ServerSideAd.prototype.pause),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"skip",shaka.ads.ServerSideAd.prototype.skip),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"canSkipNow",shaka.ads.ServerSideAd.prototype.canSkipNow),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getTimeUntilSkippable",shaka.ads.ServerSideAd.prototype.getTimeUntilSkippable),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"isSkippable",shaka.ads.ServerSideAd.prototype.isSkippable),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"isPaused",shaka.ads.ServerSideAd.prototype.isPaused),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getRemainingTime",shaka.ads.ServerSideAd.prototype.getRemainingTime),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getMinSuggestedDuration",shaka.ads.ServerSideAd.prototype.getMinSuggestedDuration),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getDuration",shaka.ads.ServerSideAd.prototype.getDuration),shaka.ads.ServerSideAdManager=function(t,r,i,n){var s=this;this.adContainer_=t,this.video_=r,this.streamPromise_=null,this.streamRequestStartTime_=NaN,this.onEvent_=n,this.isLiveContent_=!1,this.adProgressData_=this.ad_=this.snapForwardTime_=null,this.backupUrl_="",this.currentCuePoints_=[],this.eventManager_=new shaka.util.EventManager,t=new google.ima.dai.api.UiSettings,t.setLocale(i),this.streamManager_=new google.ima.dai.api.StreamManager(this.video_,this.adContainer_,t),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.IMA_STREAM_MANAGER_LOADED,new Map().set("imaStreamManager",this.streamManager_))),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.LOADED,function(o){shaka.log.info("Ad SS Loaded"),s.onLoaded_(o)}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.ERROR,function(){shaka.log.info("Ad SS Error"),s.onError_()}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,function(){shaka.log.info("Ad Break Started")}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.STARTED,function(o){shaka.log.info("Ad Started"),s.onAdStart_(o)}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,function(){shaka.log.info("Ad Break Ended"),s.onAdBreakEnded_()}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,function(o){s.onAdProgress_(o)}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,function(){shaka.log.info("Ad event: First Quartile"),s.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_FIRST_QUARTILE))}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.MIDPOINT,function(){shaka.log.info("Ad event: Midpoint"),s.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_MIDPOINT))}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE,function(){shaka.log.info("Ad event: Third Quartile"),s.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_THIRD_QUARTILE))}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.COMPLETE,function(){shaka.log.info("Ad event: Complete"),s.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_COMPLETE)),s.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED)),s.adContainer_.removeAttribute("ad-active"),s.ad_=null}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.SKIPPED,function(){shaka.log.info("Ad event: Skipped"),s.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_SKIPPED)),s.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED))}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED,function(o){shaka.log.info("Ad event: Cue points changed"),s.onCuePointsChanged_(o)})},shaka.ads.ServerSideAdManager.prototype.streamRequest=function(t,r){return this.streamPromise_?Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.CURRENT_DAI_REQUEST_NOT_FINISHED)):(t instanceof google.ima.dai.api.LiveStreamRequest&&(this.isLiveContent_=!0),this.streamPromise_=new shaka.util.PublicPromise,this.streamManager_.requestStream(t),this.backupUrl_=r||"",this.streamRequestStartTime_=Date.now()/1e3,this.streamPromise_)},shaka.ads.ServerSideAdManager.prototype.replaceAdTagParameters=function(t){this.streamManager_.replaceAdTagParameters(t)},shaka.ads.ServerSideAdManager.prototype.stop=function(){this.backupUrl_="",this.snapForwardTime_=null,this.currentCuePoints_=[]},shaka.ads.ServerSideAdManager.prototype.release=function(){this.stop(),this.eventManager_&&this.eventManager_.release()},shaka.ads.ServerSideAdManager.prototype.onTimedMetadata=function(t,r,i){this.streamManager_.processMetadata(t,r,i)},shaka.ads.ServerSideAdManager.prototype.onCueMetadataChange=function(t){if(t.key&&t.data){var r={};r[t.key]=t.data,this.streamManager_.onTimedMetadata(r)}},shaka.ads.ServerSideAdManager.prototype.getCuePoints=function(){return this.currentCuePoints_},shaka.ads.ServerSideAdManager.prototype.checkForSnapback_=function(){var t=this.video_.currentTime;if(t!=0){this.streamManager_.streamTimeForContentTime(t);var r=this.streamManager_.previousCuePointForStreamTime(t);r&&!r.played&&(shaka.log.info("Seeking back to the start of the ad break at "+r.start+" and will return to "+t),this.snapForwardTime_=t,this.video_.currentTime=r.start)}},shaka.ads.ServerSideAdManager.prototype.onAdStart_=function(t){goog.asserts.assert(this.streamManager_,"Should have a stream manager at this point!"),t=t.getAd(),this.ad_=new shaka.ads.ServerSideAd(t,this.video_),this.adProgressData_&&this.ad_.setProgressData(this.adProgressData_),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STARTED,new Map().set("ad",this.ad_))),this.adContainer_.setAttribute("ad-active","true")},shaka.ads.ServerSideAdManager.prototype.onAdBreakEnded_=function(){this.adContainer_.removeAttribute("ad-active");var t=this.video_.currentTime;this.snapForwardTime_&&this.snapForwardTime_>t&&(this.video_.currentTime=this.snapForwardTime_,this.snapForwardTime_=null)},shaka.ads.ServerSideAdManager.prototype.onLoaded_=function(t){var r=this,i=Date.now()/1e3-this.streamRequestStartTime_;this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.ADS_LOADED,new Map().set("loadTime",i))),t=t.getStreamData().url,this.streamPromise_.resolve(t),this.streamPromise_=null,this.isLiveContent_||this.eventManager_.listen(this.video_,"seeked",function(){r.checkForSnapback_()})},shaka.ads.ServerSideAdManager.prototype.onError_=function(){this.backupUrl_.length?(shaka.log.warning("IMA stream request returned an error. Falling back to the backup asset uri."),this.streamPromise_.resolve(this.backupUrl_)):this.streamPromise_.reject("IMA Stream request returned an error and there was no backup asset uri provided."),this.streamPromise_=null},shaka.ads.ServerSideAdManager.prototype.onAdProgress_=function(t){this.adProgressData_=t.getStreamData().adProgressData,this.ad_&&this.ad_.setProgressData(this.adProgressData_)},shaka.ads.ServerSideAdManager.prototype.onCuePointsChanged_=function(t){var r=t.getStreamData();t=[],r=$jscomp.makeIterator(r.cuepoints);for(var i=r.next();!i.done;i=r.next())i=i.value,t.push({start:i.start,end:i.end});this.currentCuePoints_=t,this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.CUEPOINTS_CHANGED,new Map().set("cuepoints",t)))},shaka.ads.AdManager=function(){shaka.util.FakeEventTarget.call(this),this.ssAdManager_=this.csAdManager_=null,this.stats_=new shaka.ads.AdsStats,this.locale_=navigator.language},$jscomp.inherits(shaka.ads.AdManager,shaka.util.FakeEventTarget),shaka.ads.AdManager.prototype.setLocale=function(t){this.locale_=t},shaka.ads.AdManager.prototype.initClientSide=function(t,r){var i=this;if(!window.google||!google.ima||!google.ima.AdsLoader)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.ADS,shaka.util.Error.Code.CS_IMA_SDK_MISSING);this.csAdManager_&&this.csAdManager_.release(),this.csAdManager_=new shaka.ads.ClientSideAdManager(t,r,this.locale_,function(n){if(n&&n.type)switch(n.type){case shaka.ads.AdManager.ADS_LOADED:i.stats_.addLoadTime(n.loadTime);break;case shaka.ads.AdManager.AD_STARTED:i.stats_.incrementStarted();break;case shaka.ads.AdManager.AD_COMPLETE:i.stats_.incrementPlayedCompletely();break;case shaka.ads.AdManager.AD_SKIPPED:i.stats_.incrementSkipped()}i.dispatchEvent(n)})},shaka.ads.AdManager.prototype.release=function(){this.csAdManager_&&(this.csAdManager_.release(),this.csAdManager_=null),this.ssAdManager_&&(this.ssAdManager_.release(),this.ssAdManager_=null),shaka.util.FakeEventTarget.prototype.release.call(this)},shaka.ads.AdManager.prototype.onAssetUnload=function(){this.csAdManager_&&this.csAdManager_.stop(),this.ssAdManager_&&this.ssAdManager_.stop(),this.dispatchEvent(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED)),this.stats_=new shaka.ads.AdsStats},shaka.ads.AdManager.prototype.requestClientSideAds=function(t){if(!this.csAdManager_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.CS_AD_MANAGER_NOT_INITIALIZED);this.csAdManager_.requestAds(t)},shaka.ads.AdManager.prototype.initServerSide=function(t,r){var i=this;if(!window.google||!google.ima||!google.ima.dai)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.ADS,shaka.util.Error.Code.SS_IMA_SDK_MISSING);this.ssAdManager_&&this.ssAdManager_.release(),this.ssAdManager_=new shaka.ads.ServerSideAdManager(t,r,this.locale_,function(n){if(n&&n.type)switch(n.type){case shaka.ads.AdManager.ADS_LOADED:i.stats_.addLoadTime(n.loadTime);break;case shaka.ads.AdManager.AD_STARTED:i.stats_.incrementStarted();break;case shaka.ads.AdManager.AD_COMPLETE:i.stats_.incrementPlayedCompletely();break;case shaka.ads.AdManager.AD_SKIPPED:i.stats_.incrementSkipped()}i.dispatchEvent(n)})},shaka.ads.AdManager.prototype.requestServerSideStream=function(t,r){if(r=r===void 0?"":r,!this.ssAdManager_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.SS_AD_MANAGER_NOT_INITIALIZED);t.adTagParameters||(t.adTagParameters={});var i=t.adTagParameters;return(i.mpt||i.mpv)&&shaka.log.alwaysWarn('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),t.adTagParameters.mpt="shaka-player",t.adTagParameters.mpv=shaka.Player.version,this.ssAdManager_.streamRequest(t,r)},shaka.ads.AdManager.prototype.replaceServerSideAdTagParameters=function(t){if(!this.ssAdManager_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.SS_AD_MANAGER_NOT_INITIALIZED);(t.mpt||t.mpv)&&shaka.log.alwaysWarn('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),t.mpt="Shaka Player",t.mpv=shaka.Player.version,this.ssAdManager_.replaceAdTagParameters(t)},shaka.ads.AdManager.prototype.getServerSideCuePoints=function(){if(!this.ssAdManager_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.SS_AD_MANAGER_NOT_INITIALIZED);return this.ssAdManager_.getCuePoints()},shaka.ads.AdManager.prototype.getStats=function(){return this.stats_.getBlob()},shaka.ads.AdManager.prototype.onDashTimedMetadata=function(t){if(this.ssAdManager_&&t.schemeIdUri=="urn:google:dai:2018"){var r=t.schemeIdUri,i=t.eventElement?t.eventElement.getAttribute("messageData"):null;this.ssAdManager_.onTimedMetadata(r,i,t.startTime)}},shaka.ads.AdManager.prototype.onHlsTimedMetadata=function(t,r){this.ssAdManager_?this.ssAdManager_.onTimedMetadata("ID3",t.data,r):shaka.log.warning("ID3 metadata processing was called without initializing server side ad logic. Ad-related metadata will not take effect")},shaka.ads.AdManager.prototype.onCueMetadataChange=function(t){this.ssAdManager_?this.ssAdManager_.onCueMetadataChange(t):shaka.log.warning("ID3 metadata processing was called without initializing server side ad logic. Ad-related metadata will not take effect")},goog.exportSymbol("shaka.ads.AdManager",shaka.ads.AdManager),goog.exportProperty(shaka.ads.AdManager.prototype,"onCueMetadataChange",shaka.ads.AdManager.prototype.onCueMetadataChange),goog.exportProperty(shaka.ads.AdManager.prototype,"onHlsTimedMetadata",shaka.ads.AdManager.prototype.onHlsTimedMetadata),goog.exportProperty(shaka.ads.AdManager.prototype,"onDashTimedMetadata",shaka.ads.AdManager.prototype.onDashTimedMetadata),goog.exportProperty(shaka.ads.AdManager.prototype,"getStats",shaka.ads.AdManager.prototype.getStats),goog.exportProperty(shaka.ads.AdManager.prototype,"getServerSideCuePoints",shaka.ads.AdManager.prototype.getServerSideCuePoints),goog.exportProperty(shaka.ads.AdManager.prototype,"replaceServerSideAdTagParameters",shaka.ads.AdManager.prototype.replaceServerSideAdTagParameters),goog.exportProperty(shaka.ads.AdManager.prototype,"requestServerSideStream",shaka.ads.AdManager.prototype.requestServerSideStream),goog.exportProperty(shaka.ads.AdManager.prototype,"initServerSide",shaka.ads.AdManager.prototype.initServerSide),goog.exportProperty(shaka.ads.AdManager.prototype,"requestClientSideAds",shaka.ads.AdManager.prototype.requestClientSideAds),goog.exportProperty(shaka.ads.AdManager.prototype,"onAssetUnload",shaka.ads.AdManager.prototype.onAssetUnload),goog.exportProperty(shaka.ads.AdManager.prototype,"release",shaka.ads.AdManager.prototype.release),goog.exportProperty(shaka.ads.AdManager.prototype,"initClientSide",shaka.ads.AdManager.prototype.initClientSide),goog.exportProperty(shaka.ads.AdManager.prototype,"setLocale",shaka.ads.AdManager.prototype.setLocale),shaka.ads.AdManager.ADS_LOADED="ads-loaded",goog.exportProperty(shaka.ads.AdManager,"ADS_LOADED",shaka.ads.AdManager.ADS_LOADED),shaka.ads.AdManager.AD_STARTED="ad-started",goog.exportProperty(shaka.ads.AdManager,"AD_STARTED",shaka.ads.AdManager.AD_STARTED),shaka.ads.AdManager.AD_FIRST_QUARTILE="ad-first-quartile",goog.exportProperty(shaka.ads.AdManager,"AD_FIRST_QUARTILE",shaka.ads.AdManager.AD_FIRST_QUARTILE),shaka.ads.AdManager.AD_MIDPOINT="ad-midpoint",goog.exportProperty(shaka.ads.AdManager,"AD_MIDPOINT",shaka.ads.AdManager.AD_MIDPOINT),shaka.ads.AdManager.AD_THIRD_QUARTILE="ad-third-quartile",goog.exportProperty(shaka.ads.AdManager,"AD_THIRD_QUARTILE",shaka.ads.AdManager.AD_THIRD_QUARTILE),shaka.ads.AdManager.AD_COMPLETE="ad-complete",goog.exportProperty(shaka.ads.AdManager,"AD_COMPLETE",shaka.ads.AdManager.AD_COMPLETE),shaka.ads.AdManager.AD_STOPPED="ad-stopped",goog.exportProperty(shaka.ads.AdManager,"AD_STOPPED",shaka.ads.AdManager.AD_STOPPED),shaka.ads.AdManager.AD_SKIPPED="ad-skipped",goog.exportProperty(shaka.ads.AdManager,"AD_SKIPPED",shaka.ads.AdManager.AD_SKIPPED),shaka.ads.AdManager.AD_VOLUME_CHANGED="ad-volume-changed",goog.exportProperty(shaka.ads.AdManager,"AD_VOLUME_CHANGED",shaka.ads.AdManager.AD_VOLUME_CHANGED),shaka.ads.AdManager.AD_MUTED="ad-muted",goog.exportProperty(shaka.ads.AdManager,"AD_MUTED",shaka.ads.AdManager.AD_MUTED),shaka.ads.AdManager.AD_PAUSED="ad-paused",goog.exportProperty(shaka.ads.AdManager,"AD_PAUSED",shaka.ads.AdManager.AD_PAUSED),shaka.ads.AdManager.AD_RESUMED="ad-resumed",goog.exportProperty(shaka.ads.AdManager,"AD_RESUMED",shaka.ads.AdManager.AD_RESUMED),shaka.ads.AdManager.AD_SKIP_STATE_CHANGED="ad-skip-state-changed",goog.exportProperty(shaka.ads.AdManager,"AD_SKIP_STATE_CHANGED",shaka.ads.AdManager.AD_SKIP_STATE_CHANGED),shaka.ads.AdManager.CUEPOINTS_CHANGED="ad-cue-points-changed",goog.exportProperty(shaka.ads.AdManager,"CUEPOINTS_CHANGED",shaka.ads.AdManager.CUEPOINTS_CHANGED),shaka.ads.AdManager.IMA_AD_MANAGER_LOADED="ima-ad-manager-loaded",goog.exportProperty(shaka.ads.AdManager,"IMA_AD_MANAGER_LOADED",shaka.ads.AdManager.IMA_AD_MANAGER_LOADED),shaka.ads.AdManager.IMA_STREAM_MANAGER_LOADED="ima-stream-manager-loaded",goog.exportProperty(shaka.ads.AdManager,"IMA_STREAM_MANAGER_LOADED",shaka.ads.AdManager.IMA_STREAM_MANAGER_LOADED),shaka.ads.AdManager.AD_CLICKED="ad-clicked",goog.exportProperty(shaka.ads.AdManager,"AD_CLICKED",shaka.ads.AdManager.AD_CLICKED),shaka.ads.AdManager.AD_PROGRESS="ad-progress",goog.exportProperty(shaka.ads.AdManager,"AD_PROGRESS",shaka.ads.AdManager.AD_PROGRESS),shaka.ads.AdManager.AD_BUFFERING="ad-buffering",goog.exportProperty(shaka.ads.AdManager,"AD_BUFFERING",shaka.ads.AdManager.AD_BUFFERING),shaka.ads.AdManager.AD_IMPRESSION="ad-impression",goog.exportProperty(shaka.ads.AdManager,"AD_IMPRESSION",shaka.ads.AdManager.AD_IMPRESSION),shaka.ads.AdManager.AD_DURATION_CHANGED="ad-duration-changed",goog.exportProperty(shaka.ads.AdManager,"AD_DURATION_CHANGED",shaka.ads.AdManager.AD_DURATION_CHANGED),shaka.ads.AdManager.AD_CLOSED="ad-closed",goog.exportProperty(shaka.ads.AdManager,"AD_CLOSED",shaka.ads.AdManager.AD_CLOSED),shaka.ads.AdManager.AD_LOADED="ad-loaded",goog.exportProperty(shaka.ads.AdManager,"AD_LOADED",shaka.ads.AdManager.AD_LOADED),shaka.ads.AdManager.ALL_ADS_COMPLETED="all-ads-completed",goog.exportProperty(shaka.ads.AdManager,"ALL_ADS_COMPLETED",shaka.ads.AdManager.ALL_ADS_COMPLETED),shaka.ads.AdManager.AD_LINEAR_CHANGED="ad-linear-changed",goog.exportProperty(shaka.ads.AdManager,"AD_LINEAR_CHANGED",shaka.ads.AdManager.AD_LINEAR_CHANGED),shaka.ads.AdManager.AD_METADATA="ad-metadata",goog.exportProperty(shaka.ads.AdManager,"AD_METADATA",shaka.ads.AdManager.AD_METADATA),shaka.ads.AdManager.AD_RECOVERABLE_ERROR="ad-recoverable-error",goog.exportProperty(shaka.ads.AdManager,"AD_RECOVERABLE_ERROR",shaka.ads.AdManager.AD_RECOVERABLE_ERROR),shaka.ads.AdManager.AD_BREAK_READY="ad-break-ready",goog.exportProperty(shaka.ads.AdManager,"AD_BREAK_READY",shaka.ads.AdManager.AD_BREAK_READY),shaka.ads.AdManager.AD_INTERACTION="ad-interaction",goog.exportProperty(shaka.ads.AdManager,"AD_INTERACTION",shaka.ads.AdManager.AD_INTERACTION),shaka.Player.setAdManagerFactory(function(){return new shaka.ads.AdManager}),shaka.cast={},shaka.cast.CastUtils=function(){},shaka.cast.CastUtils.serialize=function(t){return JSON.stringify(t,function(r,i){if(typeof i!="function"){if(i instanceof Event||i instanceof shaka.util.FakeEvent){var n={},s;for(s in i){var o=i[s];o&&typeof o=="object"?s=="detail"&&(n[s]=o):s in Event||(n[s]=o)}return n}return i instanceof Error?shaka.cast.CastUtils.unpackError_(i):i instanceof TimeRanges?shaka.cast.CastUtils.unpackTimeRanges_(i):i instanceof Uint8Array?shaka.cast.CastUtils.unpackUint8Array_(i):typeof i=="number"?isNaN(i)?"NaN":isFinite(i)?i:0>i?"-Infinity":"Infinity":i}})},shaka.cast.CastUtils.deserialize=function(t){return JSON.parse(t,function(r,i){return i=="NaN"?NaN:i=="-Infinity"?-1/0:i=="Infinity"?1/0:i&&typeof i=="object"&&i.__type__=="TimeRanges"?shaka.cast.CastUtils.simulateTimeRanges_(i):i&&typeof i=="object"&&i.__type__=="Uint8Array"?shaka.cast.CastUtils.makeUint8Array_(i):i&&typeof i=="object"&&i.__type__=="Error"?shaka.cast.CastUtils.makeError_(i):i})},shaka.cast.CastUtils.unpackTimeRanges_=function(t){var r={__type__:"TimeRanges",length:t.length,start:[],end:[]};t=$jscomp.makeIterator(shaka.media.TimeRangesUtils.getBufferedInfo(t));for(var i=t.next();!i.done;i=t.next()){i=i.value;var n=i.end;r.start.push(i.start),r.end.push(n)}return r},shaka.cast.CastUtils.simulateTimeRanges_=function(t){return{length:t.length,start:function(r){return t.start[r]},end:function(r){return t.end[r]}}},shaka.cast.CastUtils.unpackUint8Array_=function(t){return{__type__:"Uint8Array",entries:Array.from(t)}},shaka.cast.CastUtils.makeUint8Array_=function(t){return new Uint8Array(t.entries)},shaka.cast.CastUtils.unpackError_=function(t){var r=new Set(["name","message","stack"]),i;for(i in t)r.add(i);var n=$jscomp.makeIterator(Object.getOwnPropertyNames(t));for(i=n.next();!i.done;i=n.next())r.add(i.value);for(n={},r=$jscomp.makeIterator(r),i=r.next();!i.done;i=r.next())i=i.value,n[i]=t[i];return{__type__:"Error",contents:n}},shaka.cast.CastUtils.makeError_=function(t){t=t.contents;var r=Error(t.message),i;for(i in t)r[i]=t[i];return r},shaka.cast.CastUtils.VideoEvents="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),shaka.cast.CastUtils.VideoAttributes="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),shaka.cast.CastUtils.VideoInitStateAttributes=["loop","playbackRate"],shaka.cast.CastUtils.VideoVoidMethods=["pause","play"],shaka.cast.CastUtils.PlayerGetterMethods={getAssetUri:2,getAudioLanguages:4,getAudioLanguagesAndRoles:4,getBufferFullness:1,getBufferedInfo:2,getConfiguration:4,getExpiration:2,getKeyStatuses:2,getPlaybackRate:2,getTextLanguages:4,getTextLanguagesAndRoles:4,getTextTracks:2,getStats:5,getVariantTracks:2,getImageTracks:2,getThumbnails:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,getLoadMode:10},shaka.cast.CastUtils.PlayerGetterMethodsThatRequireLive={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},shaka.cast.CastUtils.PlayerInitState=[["getConfiguration","configure"]],shaka.cast.CastUtils.PlayerInitAfterLoadState=[["isTextTrackVisible","setTextTrackVisibility"]],shaka.cast.CastUtils.PlayerVoidMethods="addChaptersTrack addTextTrack addTextTrackAsync cancelTrickPlay configure getChapters getChaptersTracks resetConfiguration retryStreaming selectAudioLanguage selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay updateStartTime goToLive".split(" "),shaka.cast.CastUtils.PlayerPromiseMethods=["attach","detach","load","unload"],shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE="urn:x-cast:com.google.shaka.v2",shaka.cast.CastUtils.GENERIC_MESSAGE_NAMESPACE="urn:x-cast:com.google.cast.media",shaka.cast.CastSender=function(t,r,i,n,s,o){var l=this;this.receiverAppId_=t,this.statusChangeTimer_=new shaka.util.Timer(r),this.onFirstCastStateUpdate_=i,this.hasJoinedExistingSession_=!1,this.onRemoteEvent_=n,this.onResumeLocal_=s,this.onInitStateRequired_=o,this.isCasting_=this.apiReady_=!1,this.receiverName_="",this.appData_=null,this.onConnectionStatusChangedBound_=function(){return l.onConnectionStatusChanged_()},this.onMessageReceivedBound_=function(u,m){return l.onMessageReceived_(u,m)},this.cachedProperties_={video:{},player:{}},this.nextAsyncCallId_=0,this.asyncCallPromises_={},this.castPromise_=null,shaka.cast.CastSender.instances_.add(this)},shaka.cast.CastSender.prototype.destroy=function(){return shaka.cast.CastSender.instances_.delete(this),this.rejectAllPromises_(),shaka.cast.CastSender.session_&&this.removeListeners_(),this.statusChangeTimer_&&(this.statusChangeTimer_.stop(),this.statusChangeTimer_=null),this.onResumeLocal_=this.onRemoteEvent_=null,this.isCasting_=this.apiReady_=!1,this.onMessageReceivedBound_=this.onConnectionStatusChangedBound_=this.castPromise_=this.asyncCallPromises_=this.cachedProperties_=this.appData_=null,Promise.resolve()},shaka.cast.CastSender.prototype.apiReady=function(){return this.apiReady_},shaka.cast.CastSender.prototype.hasReceivers=function(){return shaka.cast.CastSender.hasReceivers_},shaka.cast.CastSender.prototype.isCasting=function(){return this.isCasting_},shaka.cast.CastSender.prototype.receiverName=function(){return this.receiverName_},shaka.cast.CastSender.prototype.hasRemoteProperties=function(){return Object.keys(this.cachedProperties_.video).length!=0},shaka.cast.CastSender.prototype.init=function(){var t=shaka.cast.CastSender;if(this.receiverAppId_.length)if(window.chrome&&chrome.cast&&chrome.cast.isAvailable){this.apiReady_=!0,this.statusChangeTimer_.tickNow();var r=new chrome.cast.SessionRequest(this.receiverAppId_);r=new chrome.cast.ApiConfig(r,function(i){return t.onExistingSessionJoined_(i)},function(i){return t.onReceiverStatusChanged_(i)},"origin_scoped"),chrome.cast.initialize(r,function(){shaka.log.debug("CastSender: init")},function(i){shaka.log.error("CastSender: init error",i)}),shaka.cast.CastSender.hasReceivers_&&this.statusChangeTimer_.tickAfter(shaka.cast.CastSender.STATUS_DELAY),(r=shaka.cast.CastSender.session_)&&r.status!=chrome.cast.SessionStatus.STOPPED?(shaka.log.debug("CastSender: re-using existing connection"),this.onExistingSessionJoined_(r)):shaka.cast.CastSender.session_=null}else window.__onGCastApiAvailable||(window.__onGCastApiAvailable=shaka.cast.CastSender.onSdkLoaded_),window.__onGCastApiAvailable!=shaka.cast.CastSender.onSdkLoaded_&&shaka.log.alwaysWarn("A global Cast SDK hook is already installed! Shaka Player will be unable to receive a notification when the Cast SDK is ready.")},shaka.cast.CastSender.prototype.setAppData=function(t){this.appData_=t,this.isCasting_&&this.sendMessage_({type:"appData",appData:this.appData_})},shaka.cast.CastSender.prototype.cast=function(t){var r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){if(!r.apiReady_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.CAST_API_UNAVAILABLE);if(!shaka.cast.CastSender.hasReceivers_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.NO_CAST_RECEIVERS);if(r.isCasting_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.ALREADY_CASTING);return r.castPromise_=new shaka.util.PublicPromise,chrome.cast.requestSession(function(n){return r.onSessionInitiated_(t,n)},function(n){return r.onConnectionError_(n)}),i.yield(r.castPromise_,0)})},shaka.cast.CastSender.prototype.showDisconnectDialog=function(){var t=this;if(this.isCasting_){var r=this.onInitStateRequired_();chrome.cast.requestSession(function(i){return t.onSessionInitiated_(r,i)},function(i){return t.onConnectionError_(i)})}},shaka.cast.CastSender.prototype.forceDisconnect=function(){if(this.isCasting_){if(this.rejectAllPromises_(),shaka.cast.CastSender.session_){this.removeListeners_();try{shaka.cast.CastSender.session_.stop(function(){},function(){})}catch{}shaka.cast.CastSender.session_=null}this.onConnectionStatusChanged_()}},shaka.cast.CastSender.prototype.get=function(t,r){var i=this;goog.asserts.assert(t=="video"||t=="player","Unexpected target name");var n=shaka.cast.CastUtils;if(t=="video"){if(n.VideoVoidMethods.includes(r))return function(){var o=$jscomp.getRestArguments.apply(0,arguments);return i.remoteCall_.apply(i,[t,r].concat($jscomp.arrayFromIterable(o)))}}else if(t=="player"){if(n.PlayerGetterMethodsThatRequireLive[r]){var s=this.get("player","isLive")();if(goog.asserts.assert(s,r+" should be called on a live stream!"),!s)return function(){}}if(n.PlayerVoidMethods.includes(r))return function(){var o=$jscomp.getRestArguments.apply(0,arguments);return i.remoteCall_.apply(i,[t,r].concat($jscomp.arrayFromIterable(o)))};if(n.PlayerPromiseMethods.includes(r))return function(){var o=$jscomp.getRestArguments.apply(0,arguments);return i.remoteAsyncCall_.apply(i,[t,r].concat($jscomp.arrayFromIterable(o)))};if(n.PlayerGetterMethods[r])return function(){return i.propertyGetter_(t,r)}}return this.propertyGetter_(t,r)},shaka.cast.CastSender.prototype.set=function(t,r,i){goog.asserts.assert(t=="video"||t=="player","Unexpected target name"),this.cachedProperties_[t][r]=i,this.sendMessage_({type:"set",targetName:t,property:r,value:i})},shaka.cast.CastSender.prototype.onSessionInitiated_=function(t,r){shaka.log.debug("CastSender: onSessionInitiated"),this.onSessionCreated_(r),this.sendMessage_({type:"init",initState:t,appData:this.appData_}),this.castPromise_.resolve()},shaka.cast.CastSender.prototype.onConnectionError_=function(t){var r=shaka.util.Error.Code.UNEXPECTED_CAST_ERROR;switch(t.code){case"cancel":r=shaka.util.Error.Code.CAST_CANCELED_BY_USER;break;case"timeout":r=shaka.util.Error.Code.CAST_CONNECTION_TIMED_OUT;break;case"receiver_unavailable":r=shaka.util.Error.Code.CAST_RECEIVER_APP_UNAVAILABLE}this.castPromise_.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.CAST,r,t))},shaka.cast.CastSender.prototype.propertyGetter_=function(t,r){return goog.asserts.assert(t=="video"||t=="player","Unexpected target name"),this.cachedProperties_[t][r]},shaka.cast.CastSender.prototype.remoteCall_=function(t,r){var i=$jscomp.getRestArguments.apply(2,arguments);goog.asserts.assert(t=="video"||t=="player","Unexpected target name"),this.sendMessage_({type:"call",targetName:t,methodName:r,args:i})},shaka.cast.CastSender.prototype.remoteAsyncCall_=function(t,r){var i=$jscomp.getRestArguments.apply(2,arguments);goog.asserts.assert(t=="video"||t=="player","Unexpected target name");var n=new shaka.util.PublicPromise,s=this.nextAsyncCallId_.toString();this.nextAsyncCallId_++,this.asyncCallPromises_[s]=n;try{this.sendMessage_({type:"asyncCall",targetName:t,methodName:r,args:i,id:s})}catch(o){n.reject(o)}return n},shaka.cast.CastSender.onExistingSessionJoined_=function(t){for(var r=$jscomp.makeIterator(shaka.cast.CastSender.instances_),i=r.next();!i.done;i=r.next())i.value.onExistingSessionJoined_(t)},shaka.cast.CastSender.prototype.onExistingSessionJoined_=function(t){shaka.log.debug("CastSender: onExistingSessionJoined");var r=this.onInitStateRequired_();this.castPromise_=new shaka.util.PublicPromise,this.hasJoinedExistingSession_=!0,this.onSessionInitiated_(r,t)},shaka.cast.CastSender.onReceiverStatusChanged_=function(t){for(var r=$jscomp.makeIterator(shaka.cast.CastSender.instances_),i=r.next();!i.done;i=r.next())i.value.onReceiverStatusChanged_(t)},shaka.cast.CastSender.prototype.onReceiverStatusChanged_=function(t){shaka.log.debug("CastSender: receiver status",t),shaka.cast.CastSender.hasReceivers_=t=="available",this.statusChangeTimer_.tickNow()},shaka.cast.CastSender.prototype.onSessionCreated_=function(t){shaka.cast.CastSender.session_=t,t.addUpdateListener(this.onConnectionStatusChangedBound_),t.addMessageListener(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,this.onMessageReceivedBound_),this.onConnectionStatusChanged_()},shaka.cast.CastSender.prototype.removeListeners_=function(){var t=shaka.cast.CastSender.session_;t.removeUpdateListener(this.onConnectionStatusChangedBound_),t.removeMessageListener(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,this.onMessageReceivedBound_)},shaka.cast.CastSender.prototype.onConnectionStatusChanged_=function(){var t=shaka.cast.CastSender.session_?shaka.cast.CastSender.session_.status=="connected":!1;if(shaka.log.debug("CastSender: connection status",t),this.isCasting_&&!t){this.onResumeLocal_();for(var r in this.cachedProperties_)this.cachedProperties_[r]={};this.rejectAllPromises_()}this.receiverName_=(this.isCasting_=t)?shaka.cast.CastSender.session_.receiver.friendlyName:"",this.statusChangeTimer_.tickNow()},shaka.cast.CastSender.prototype.rejectAllPromises_=function(){for(var t in this.asyncCallPromises_){var r=this.asyncCallPromises_[t];delete this.asyncCallPromises_[t],r.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.LOAD_INTERRUPTED))}},shaka.cast.CastSender.prototype.onMessageReceived_=function(t,r){var i=shaka.cast.CastUtils.deserialize(r);switch(shaka.log.v2("CastSender: message",i),i.type){case"event":var n=i.targetName;i=shaka.util.FakeEvent.fromRealEvent(i.event),this.onRemoteEvent_(n,i);break;case"update":n=i.update;for(var s in n){i=this.cachedProperties_[s]||{};for(var o in n[s])i[o]=n[s][o]}this.hasJoinedExistingSession_&&(this.onFirstCastStateUpdate_(),this.hasJoinedExistingSession_=!1);break;case"asyncComplete":if(s=i.id,i=i.error,o=this.asyncCallPromises_[s],delete this.asyncCallPromises_[s],goog.asserts.assert(o,"Unexpected async id"),o)if(i){s=new shaka.util.Error(i.severity,i.category,i.code);for(n in i)s[n]=i[n];o.reject(s)}else o.resolve()}},shaka.cast.CastSender.prototype.sendMessage_=function(t){t=shaka.cast.CastUtils.serialize(t);var r=shaka.cast.CastSender.session_;try{r.sendMessage(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,t,function(){},shaka.log.error)}catch(i){throw shaka.log.error("Cast session sendMessage threw",i),t=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.CAST,shaka.util.Error.Code.CAST_CONNECTION_TIMED_OUT,i),r=new shaka.util.FakeEvent("error",new Map().set("detail",t)),this.onRemoteEvent_("player",r),this.forceDisconnect(),t}},shaka.cast.CastSender.STATUS_DELAY=.02,shaka.cast.CastSender.hasReceivers_=!1,shaka.cast.CastSender.session_=null,shaka.cast.CastSender.instances_=new Set,shaka.cast.CastSender.onSdkLoaded_=function(t){if(t){t=$jscomp.makeIterator(shaka.cast.CastSender.instances_);for(var r=t.next();!r.done;r=t.next())r.value.init()}},shaka.cast.CastProxy=function(t,r,i){shaka.util.FakeEventTarget.call(this);var n=this;this.localVideo_=t,this.localPlayer_=r,this.eventManager_=this.playerEventTarget_=this.videoEventTarget_=this.playerProxy_=this.videoProxy_=null,this.receiverAppId_=i,this.compiledToExternNames_=new Map,this.sender_=new shaka.cast.CastSender(i,function(){return n.onCastStatusChanged_()},function(){return n.onFirstCastStateUpdate_()},function(s,o){return n.onRemoteEvent_(s,o)},function(){return n.onResumeLocal_()},function(){return n.getInitState_()}),this.init_()},$jscomp.inherits(shaka.cast.CastProxy,shaka.util.FakeEventTarget),shaka.cast.CastProxy.prototype.destroy=function(t){return t&&this.sender_.forceDisconnect(),this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),t=[],this.localPlayer_&&(t.push(this.localPlayer_.destroy()),this.localPlayer_=null),this.sender_&&(t.push(this.sender_.destroy()),this.sender_=null),this.playerProxy_=this.videoProxy_=this.localVideo_=null,shaka.util.FakeEventTarget.prototype.release.call(this),Promise.all(t)},shaka.cast.CastProxy.prototype.getVideo=function(){return this.videoProxy_},shaka.cast.CastProxy.prototype.getPlayer=function(){return this.playerProxy_},shaka.cast.CastProxy.prototype.canCast=function(){return this.sender_.apiReady()&&this.sender_.hasReceivers()},shaka.cast.CastProxy.prototype.isCasting=function(){return this.sender_.isCasting()},shaka.cast.CastProxy.prototype.receiverName=function(){return this.sender_.receiverName()},shaka.cast.CastProxy.prototype.cast=function(){var t=this,r;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return i.nextAddress==1?(r=t.getInitState_(),i.yield(t.sender_.cast(r),2)):t.localPlayer_?i.yield(t.localPlayer_.unload(),0):i.return()})},shaka.cast.CastProxy.prototype.setAppData=function(t){this.sender_.setAppData(t)},shaka.cast.CastProxy.prototype.suggestDisconnect=function(){this.sender_.showDisconnectDialog()},shaka.cast.CastProxy.prototype.forceDisconnect=function(){this.sender_.forceDisconnect()},shaka.cast.CastProxy.prototype.changeReceiverId=function(t){var r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){if(i.nextAddress==1)return t==r.receiverAppId_?i.return():(r.receiverAppId_=t,r.sender_.forceDisconnect(),i.yield(r.sender_.destroy(),2));r.sender_=null,r.sender_=new shaka.cast.CastSender(t,function(){return r.onCastStatusChanged_()},function(){return r.onFirstCastStateUpdate_()},function(n,s){return r.onRemoteEvent_(n,s)},function(){return r.onResumeLocal_()},function(){return r.getInitState_()}),r.sender_.init(),i.jumpToEnd()})},shaka.cast.CastProxy.prototype.init_=function(){var t=this;this.sender_.init(),this.eventManager_=new shaka.util.EventManager;for(var r=$jscomp.makeIterator(shaka.cast.CastUtils.VideoEvents),i=r.next();!i.done;i=r.next())this.eventManager_.listen(this.localVideo_,i.value,function(o){return t.videoProxyLocalEvent_(o)});for(var n in shaka.Player.EventName)this.eventManager_.listen(this.localPlayer_,shaka.Player.EventName[n],function(o){return t.playerProxyLocalEvent_(o)});this.videoProxy_={},r={};for(var s in this.localVideo_)r.$jscomp$loop$prop$k$604=s,Object.defineProperty(this.videoProxy_,r.$jscomp$loop$prop$k$604,{configurable:!1,enumerable:!0,get:function(o){return function(){return t.videoProxyGet_(o.$jscomp$loop$prop$k$604)}}(r),set:function(o){return function(l){t.videoProxySet_(o.$jscomp$loop$prop$k$604,l)}}(r)}),r={$jscomp$loop$prop$k$604:r.$jscomp$loop$prop$k$604};this.playerProxy_={},this.iterateOverPlayerMethods_(function(o,l){goog.asserts.assert(t.playerProxy_,"Must have player proxy!"),Object.defineProperty(t.playerProxy_,o,{configurable:!1,enumerable:!0,get:function(){return t.playerProxyGet_(o)}})}),COMPILED&&this.mapCompiledToUncompiledPlayerMethodNames_(),this.videoEventTarget_=new shaka.util.FakeEventTarget,this.videoEventTarget_.dispatchTarget=this.videoProxy_,this.playerEventTarget_=new shaka.util.FakeEventTarget,this.playerEventTarget_.dispatchTarget=this.playerProxy_},shaka.cast.CastProxy.prototype.mapCompiledToUncompiledPlayerMethodNames_=function(){var t=this,r=new Map;this.iterateOverPlayerMethods_(function(i,n){if(r.has(n)){var s=r.get(n);i.length<s.length?t.compiledToExternNames_.set(i,s):t.compiledToExternNames_.set(s,i)}else r.set(n,i)})},shaka.cast.CastProxy.prototype.iterateOverPlayerMethods_=function(t){function r(m){return m=="constructor"||typeof i[m]!="function"?!1:!n.has(m)}goog.asserts.assert(this.localPlayer_,"Must have player!");var i=this.localPlayer_,n=new Set;for(s in i)r(s)&&(n.add(s),t(s,i[s]));for(var s=Object.getPrototypeOf(i),o=Object.getPrototypeOf({});s&&s!=o;){for(var l=$jscomp.makeIterator(Object.getOwnPropertyNames(s)),u=l.next();!u.done;u=l.next())u=u.value,r(u)&&(n.add(u),t(u,i[u]));s=Object.getPrototypeOf(s)}},shaka.cast.CastProxy.prototype.getInitState_=function(){var t={video:{},player:{},playerAfterLoad:{},manifest:this.localPlayer_.getAssetUri(),startTime:null};this.localVideo_.pause();for(var r=$jscomp.makeIterator(shaka.cast.CastUtils.VideoInitStateAttributes),i=r.next();!i.done;i=r.next())i=i.value,t.video[i]=this.localVideo_[i];for(this.localVideo_.ended||(t.startTime=this.localVideo_.currentTime),r=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitState),i=r.next();!i.done;i=r.next()){var n=i.value;i=n[1],n=this.localPlayer_[n[0]](),t.player[i]=n}for(r=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitAfterLoadState),i=r.next();!i.done;i=r.next())n=i.value,i=n[1],n=this.localPlayer_[n[0]](),t.playerAfterLoad[i]=n;return t},shaka.cast.CastProxy.prototype.onCastStatusChanged_=function(){var t=new shaka.util.FakeEvent("caststatuschanged");this.dispatchEvent(t)},shaka.cast.CastProxy.prototype.onFirstCastStateUpdate_=function(){var t=new shaka.util.FakeEvent(this.videoProxy_.paused?"pause":"play");this.videoEventTarget_.dispatchEvent(t)},shaka.cast.CastProxy.prototype.onResumeLocal_=function(){for(var t=this,r=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitState),i=r.next();!i.done;i=r.next()){var n=i.value;i=n[1],n=this.sender_.get("player",n[0])(),this.localPlayer_[i](n)}var s=this.sender_.get("player","getAssetUri")();i=this.sender_.get("video","ended"),r=Promise.resolve();var o=this.localVideo_.autoplay;n=null,i||(n=this.sender_.get("video","currentTime")),s&&(this.localVideo_.autoplay=!1,r=this.localPlayer_.load(s,n));var l={};for(i=$jscomp.makeIterator(shaka.cast.CastUtils.VideoInitStateAttributes),n=i.next();!n.done;n=i.next())n=n.value,l[n]=this.sender_.get("video",n);r.then(function(){if(t.localVideo_){for(var u=$jscomp.makeIterator(shaka.cast.CastUtils.VideoInitStateAttributes),m=u.next();!m.done;m=u.next())m=m.value,t.localVideo_[m]=l[m];for(u=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitAfterLoadState),m=u.next();!m.done;m=u.next()){var E=m.value;m=E[1],E=t.sender_.get("player",E[0])(),t.localPlayer_[m](E)}t.localVideo_.autoplay=o,s&&t.localVideo_.play()}},function(u){goog.asserts.assert(u instanceof shaka.util.Error,"Wrong error type!");var m=shaka.Player.EventName.Error;u=new Map().set("detail",u),m=new shaka.util.FakeEvent(m,u),t.localPlayer_.dispatchEvent(m)})},shaka.cast.CastProxy.prototype.videoProxyGet_=function(t){var r=this;if(t=="addEventListener")return function(n,s,o){return r.videoEventTarget_.addEventListener(n,s,o)};if(t=="removeEventListener")return function(n,s,o){return r.videoEventTarget_.removeEventListener(n,s,o)};if(this.sender_.isCasting()&&!this.sender_.hasRemoteProperties()){var i=this.localVideo_[t];if(typeof i!="function")return i}return this.sender_.isCasting()?this.sender_.get("video",t):(t=this.localVideo_[t],typeof t=="function"&&(t=t.bind(this.localVideo_)),t)},shaka.cast.CastProxy.prototype.videoProxySet_=function(t,r){this.sender_.isCasting()?this.sender_.set("video",t,r):this.localVideo_[t]=r},shaka.cast.CastProxy.prototype.videoProxyLocalEvent_=function(t){this.sender_.isCasting()||(t=shaka.util.FakeEvent.fromRealEvent(t),this.videoEventTarget_.dispatchEvent(t))},shaka.cast.CastProxy.prototype.playerProxyGet_=function(t){var r=this;if(this.compiledToExternNames_.has(t)&&(t=this.compiledToExternNames_.get(t)),t=="addEventListener")return function(n,s,o){return r.playerEventTarget_.addEventListener(n,s,o)};if(t=="removeEventListener")return function(n,s,o){return r.playerEventTarget_.removeEventListener(n,s,o)};if(t=="getMediaElement")return function(){return r.videoProxy_};if(t=="getSharedConfiguration")return shaka.log.warning("Can't share configuration across a network. Returning copy."),this.sender_.get("player","getConfiguration");if(t=="getNetworkingEngine")return this.sender_.isCasting()&&shaka.log.warning("NOTE: getNetworkingEngine() is always local!"),function(){return r.localPlayer_.getNetworkingEngine()};if(t=="getDrmEngine")return this.sender_.isCasting()&&shaka.log.warning("NOTE: getDrmEngine() is always local!"),function(){return r.localPlayer_.getDrmEngine()};if(t=="getAdManager")return this.sender_.isCasting()&&shaka.log.warning("NOTE: getAdManager() is always local!"),function(){return r.localPlayer_.getAdManager()};if(t=="setVideoContainer")return this.sender_.isCasting()&&shaka.log.warning("NOTE: setVideoContainer() is always local!"),function(n){return r.localPlayer_.setVideoContainer(n)};if(this.sender_.isCasting()){if(t=="getManifest"||t=="drmInfo")return function(){return shaka.log.alwaysWarn(t+"() does not work while casting!"),null};if(t=="attach"||t=="detach")return function(){return shaka.log.alwaysWarn(t+"() does not work while casting!"),Promise.resolve()}}if(this.sender_.isCasting()&&!this.sender_.hasRemoteProperties()&&shaka.cast.CastUtils.PlayerGetterMethods[t]){var i=this.localPlayer_[t];return goog.asserts.assert(typeof i=="function","only methods on Player"),i.bind(this.localPlayer_)}return this.sender_.isCasting()?this.sender_.get("player",t):(i=this.localPlayer_[t],goog.asserts.assert(typeof i=="function","only methods on Player"),i.bind(this.localPlayer_))},shaka.cast.CastProxy.prototype.playerProxyLocalEvent_=function(t){this.sender_.isCasting()||this.playerEventTarget_.dispatchEvent(t)},shaka.cast.CastProxy.prototype.onRemoteEvent_=function(t,r){goog.asserts.assert(this.sender_.isCasting(),"Should only receive remote events while casting"),this.sender_.isCasting()&&(t=="video"?this.videoEventTarget_.dispatchEvent(r):t=="player"&&this.playerEventTarget_.dispatchEvent(r))},goog.exportSymbol("shaka.cast.CastProxy",shaka.cast.CastProxy),goog.exportProperty(shaka.cast.CastProxy.prototype,"changeReceiverId",shaka.cast.CastProxy.prototype.changeReceiverId),goog.exportProperty(shaka.cast.CastProxy.prototype,"forceDisconnect",shaka.cast.CastProxy.prototype.forceDisconnect),goog.exportProperty(shaka.cast.CastProxy.prototype,"suggestDisconnect",shaka.cast.CastProxy.prototype.suggestDisconnect),goog.exportProperty(shaka.cast.CastProxy.prototype,"setAppData",shaka.cast.CastProxy.prototype.setAppData),goog.exportProperty(shaka.cast.CastProxy.prototype,"cast",shaka.cast.CastProxy.prototype.cast),goog.exportProperty(shaka.cast.CastProxy.prototype,"receiverName",shaka.cast.CastProxy.prototype.receiverName),goog.exportProperty(shaka.cast.CastProxy.prototype,"isCasting",shaka.cast.CastProxy.prototype.isCasting),goog.exportProperty(shaka.cast.CastProxy.prototype,"canCast",shaka.cast.CastProxy.prototype.canCast),goog.exportProperty(shaka.cast.CastProxy.prototype,"getPlayer",shaka.cast.CastProxy.prototype.getPlayer),goog.exportProperty(shaka.cast.CastProxy.prototype,"getVideo",shaka.cast.CastProxy.prototype.getVideo),goog.exportProperty(shaka.cast.CastProxy.prototype,"destroy",shaka.cast.CastProxy.prototype.destroy),shaka.cast.CastReceiver=function(t,r,i,n){shaka.util.FakeEventTarget.call(this);var s=this;this.video_=t,this.player_=r,this.eventManager_=new shaka.util.EventManager,this.targets_={video:t,player:r},this.appDataCallback_=i||function(){},this.contentIdCallback_=n||function(o){return o},this.metadata_=null,this.isConnected_=!1,this.isIdle_=!0,this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1,this.initialStatusUpdatePending_=!0,this.genericBus_=this.shakaBus_=null,this.pollTimer_=new shaka.util.Timer(function(){s.pollAttributes_()}),this.init_()},$jscomp.inherits(shaka.cast.CastReceiver,shaka.util.FakeEventTarget),shaka.cast.CastReceiver.prototype.isConnected=function(){return this.isConnected_},shaka.cast.CastReceiver.prototype.isIdle=function(){return this.isIdle_},shaka.cast.CastReceiver.prototype.setContentMetadata=function(t){this.metadata_=t},shaka.cast.CastReceiver.prototype.clearContentMetadata=function(){this.metadata_=null},shaka.cast.CastReceiver.prototype.setContentTitle=function(t){this.metadata_||(this.metadata_={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.metadata_.title=t},shaka.cast.CastReceiver.prototype.setContentImage=function(t){this.metadata_||(this.metadata_={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.metadata_.images=[{url:t}]},shaka.cast.CastReceiver.prototype.setContentArtist=function(t){this.metadata_||(this.metadata_={}),this.metadata_.artist=t,this.metadata_.metadataType=cast.receiver.media.MetadataType.MUSIC_TRACK},shaka.cast.CastReceiver.prototype.destroy=function(){var t=this,r,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(n.nextAddress==1)return t.eventManager_&&(t.eventManager_.release(),t.eventManager_=null),r=[],t.player_&&(r.push(t.player_.destroy()),t.player_=null),t.pollTimer_&&(t.pollTimer_.stop(),t.pollTimer_=null),t.video_=null,t.targets_=null,t.appDataCallback_=null,t.isConnected_=!1,t.isIdle_=!0,t.shakaBus_=null,t.genericBus_=null,shaka.util.FakeEventTarget.prototype.release.call(t),n.yield(Promise.all(r),2);i=cast.receiver.CastReceiverManager.getInstance(),i.stop(),n.jumpToEnd()})},shaka.cast.CastReceiver.prototype.init_=function(){var t=this,r=cast.receiver.CastReceiverManager.getInstance();r.onSenderConnected=function(){return t.onSendersChanged_()},r.onSenderDisconnected=function(){return t.onSendersChanged_()},r.onSystemVolumeChanged=function(){return t.fakeVolumeChangeEvent_()},this.genericBus_=r.getCastMessageBus(shaka.cast.CastUtils.GENERIC_MESSAGE_NAMESPACE),this.genericBus_.onMessage=function(s){return t.onGenericMessage_(s)},this.shakaBus_=r.getCastMessageBus(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE),this.shakaBus_.onMessage=function(s){return t.onShakaMessage_(s)},goog.DEBUG?shaka.util.Platform.isChromecast()&&r.start():r.start(),r=$jscomp.makeIterator(shaka.cast.CastUtils.VideoEvents);for(var i=r.next();!i.done;i=r.next())this.eventManager_.listen(this.video_,i.value,function(s){return t.proxyEvent_("video",s)});for(var n in shaka.Player.EventName)this.eventManager_.listen(this.player_,shaka.Player.EventName[n],function(s){return t.proxyEvent_("player",s)});cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?this.player_.setMaxHardwareResolution(3840,2160):this.player_.setMaxHardwareResolution(1920,1080),this.eventManager_.listen(this.video_,"loadeddata",function(){t.startUpdatingUpdateNumber_=!0}),this.eventManager_.listen(this.player_,"loading",function(){t.isIdle_=!1,t.onCastStatusChanged_()}),this.eventManager_.listen(this.video_,"playing",function(){t.isIdle_=!1,t.onCastStatusChanged_()}),this.eventManager_.listen(this.video_,"pause",function(){t.onCastStatusChanged_()}),this.eventManager_.listen(this.player_,"unloading",function(){t.isIdle_=!0,t.onCastStatusChanged_()}),this.eventManager_.listen(this.video_,"ended",function(){new shaka.util.Timer(function(){t.video_&&t.video_.ended&&(t.isIdle_=!0,t.onCastStatusChanged_())}).tickAfter(shaka.cast.CastReceiver.IDLE_INTERVAL)})},shaka.cast.CastReceiver.prototype.onSendersChanged_=function(){this.updateNumber_=0,this.initialStatusUpdatePending_=!0,this.isConnected_=cast.receiver.CastReceiverManager.getInstance().getSenders().length!=0,this.onCastStatusChanged_()},shaka.cast.CastReceiver.prototype.onCastStatusChanged_=function(){var t=this,r;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){if(i.nextAddress==1)return i.yield(Promise.resolve(),2);if(!t.player_)return i.return();r=new shaka.util.FakeEvent("caststatuschanged"),t.dispatchEvent(r),t.maybeSendMediaInfoMessage_()||t.sendMediaStatus_(),i.jumpToEnd()})},shaka.cast.CastReceiver.prototype.initState_=function(t,r){var i=this,n,s,o,l,u,m,E,y,D,w,B;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){switch(F.nextAddress){case 1:for(n in t.player)s=t.player[n],i.player_[n](s);return i.appDataCallback_(r),o=i.video_.autoplay,t.manifest?(i.video_.autoplay=!1,F.setCatchFinallyBlocks(5),F.yield(i.player_.load(t.manifest,t.startTime),7)):F.yield(Promise.resolve(),3);case 7:F.leaveTryBlock(3);break;case 5:return l=F.enterCatchBlock(),goog.asserts.assert(l instanceof shaka.util.Error,"Wrong error type!"),u=shaka.Player.EventName.Error,m=new Map().set("detail",l),E=new shaka.util.FakeEvent(u,m),i.player_&&i.player_.dispatchEvent(E),F.return();case 3:if(!i.player_)return F.return();for(y in t.video)D=t.video[y],i.video_[y]=D;for(w in t.playerAfterLoad)B=t.playerAfterLoad[w],i.player_[w](B);i.video_.autoplay=o,t.manifest&&(i.video_.play(),i.sendMediaStatus_()),F.jumpToEnd()}})},shaka.cast.CastReceiver.prototype.proxyEvent_=function(t,r){this.player_&&(this.pollAttributes_(),this.sendMessage_({type:"event",targetName:t,event:r},this.shakaBus_))},shaka.cast.CastReceiver.prototype.pollAttributes_=function(){this.pollTimer_.tickAfter(shaka.cast.CastReceiver.POLL_INTERVAL);for(var t={video:{},player:{}},r=$jscomp.makeIterator(shaka.cast.CastUtils.VideoAttributes),i=r.next();!i.done;i=r.next())i=i.value,t.video[i]=this.video_[i];if(this.player_.isLive()){r=shaka.cast.CastUtils.PlayerGetterMethodsThatRequireLive;for(var n in r)this.updateNumber_%r[n]==0&&(t.player[n]=this.player_[n]())}for(var s in shaka.cast.CastUtils.PlayerGetterMethods)this.updateNumber_%shaka.cast.CastUtils.PlayerGetterMethods[s]==0&&(t.player[s]=this.player_[s]());(n=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(t.video.volume=n.level,t.video.muted=n.muted),this.startUpdatingUpdateNumber_&&(this.updateNumber_+=1),this.sendMessage_({type:"update",update:t},this.shakaBus_),this.maybeSendMediaInfoMessage_()},shaka.cast.CastReceiver.prototype.maybeSendMediaInfoMessage_=function(){return this.initialStatusUpdatePending_&&(this.video_.duration||this.player_.isLive())?(this.sendMediaInfoMessage_(),this.initialStatusUpdatePending_=!1,!0):!1},shaka.cast.CastReceiver.prototype.sendMediaInfoMessage_=function(t){t=t===void 0?0:t;var r={contentId:this.player_.getAssetUri(),streamType:this.player_.isLive()?"LIVE":"BUFFERED",contentType:""};this.player_.isLive()||(r.duration=this.video_.duration),this.metadata_&&(r.metadata=this.metadata_),this.sendMediaStatus_(t,r)},shaka.cast.CastReceiver.prototype.fakeVolumeChangeEvent_=function(){var t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();goog.asserts.assert(t,"System volume should not be null!"),t&&this.sendMessage_({type:"update",update:{video:{volume:t.level,muted:t.muted}}},this.shakaBus_),this.sendMessage_({type:"event",targetName:"video",event:{type:"volumechange"}},this.shakaBus_)},shaka.cast.CastReceiver.prototype.onShakaMessage_=function(t){var r=this,i=shaka.cast.CastUtils.deserialize(t.data);switch(shaka.log.debug("CastReceiver: message",i),i.type){case"init":this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1,this.initialStatusUpdatePending_=!0,this.initState_(i.initState,i.appData),this.pollAttributes_();break;case"appData":this.appDataCallback_(i.appData);break;case"set":var n=i.targetName,s=i.property;if(i=i.value,n=="video"){if(t=cast.receiver.CastReceiverManager.getInstance(),s=="volume"){t.setSystemVolumeLevel(i);break}else if(s=="muted"){t.setSystemVolumeMuted(i);break}}this.targets_[n][s]=i;break;case"call":n=this.targets_[i.targetName],n[i.methodName].apply(n,i.args);break;case"asyncCall":n=i.targetName,s=i.methodName,n=="player"&&s=="load"&&(this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1);var o=i.id,l=t.senderId;t=this.targets_[n],i=t[s].apply(t,i.args),n=="player"&&s=="load"&&(i=i.then(function(){r.initialStatusUpdatePending_=!0})),i.then(function(){return r.sendAsyncComplete_(l,o,null)},function(u){return r.sendAsyncComplete_(l,o,u)})}},shaka.cast.CastReceiver.prototype.onGenericMessage_=function(t){var r=this,i=shaka.cast.CastUtils.deserialize(t.data);switch(shaka.log.debug("CastReceiver: message",i),i.type){case"PLAY":this.video_.play(),this.sendMediaStatus_();break;case"PAUSE":this.video_.pause(),this.sendMediaStatus_();break;case"SEEK":t=i.currentTime;var n=i.resumeState;t!=null&&(this.video_.currentTime=Number(t)),n&&n=="PLAYBACK_START"?(this.video_.play(),this.sendMediaStatus_()):n&&n=="PLAYBACK_PAUSE"&&(this.video_.pause(),this.sendMediaStatus_());break;case"STOP":this.player_.unload().then(function(){r.player_&&r.sendMediaStatus_()});break;case"GET_STATUS":this.sendMediaInfoMessage_(Number(i.requestId));break;case"VOLUME":n=i.volume,t=n.level,n=n.muted;var s=this.video_.volume,o=this.video_.muted;t!=null&&(this.video_.volume=Number(t)),n!=null&&(this.video_.muted=n),s==this.video_.volume&&o==this.video_.muted||this.sendMediaStatus_();break;case"LOAD":this.updateNumber_=0,this.initialStatusUpdatePending_=this.startUpdatingUpdateNumber_=!1,t=i.media,n=i.currentTime,s=this.contentIdCallback_(t.contentId),o=i.autoplay||!0,this.appDataCallback_(t.customData),o&&(this.video_.autoplay=!0),this.player_.load(s,n).then(function(){r.player_&&r.sendMediaInfoMessage_()}).catch(function(l){goog.asserts.assert(l instanceof shaka.util.Error,"Wrong error type!");var u="LOAD_FAILED";l.category==shaka.util.Error.Category.PLAYER&&l.code==shaka.util.Error.Code.LOAD_INTERRUPTED&&(u="LOAD_CANCELLED"),r.sendMessage_({requestId:Number(i.requestId),type:u},r.genericBus_)});break;default:shaka.log.warning("Unrecognized message type from the generic Chromecast controller!",i.type),this.sendMessage_({requestId:Number(i.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.genericBus_)}},shaka.cast.CastReceiver.prototype.sendAsyncComplete_=function(t,r,i){this.player_&&this.sendMessage_({type:"asyncComplete",id:r,error:i},this.shakaBus_,t)},shaka.cast.CastReceiver.prototype.sendMessage_=function(t,r,i){this.isConnected_&&(t=shaka.cast.CastUtils.serialize(t),i?r.getCastChannel(i).send(t):r.broadcast(t))},shaka.cast.CastReceiver.prototype.getPlayState_=function(){var t=shaka.cast.CastReceiver.PLAY_STATE;return this.isIdle_?t.IDLE:this.player_.isBuffering()?t.BUFFERING:this.video_.paused?t.PAUSED:t.PLAYING},shaka.cast.CastReceiver.prototype.sendMediaStatus_=function(t,r){t=t===void 0?0:t,r=r===void 0?null:r;var i={mediaSessionId:0,playbackRate:this.video_.playbackRate,playerState:this.getPlayState_(),currentTime:this.video_.currentTime,supportedMediaCommands:63,volume:{level:this.video_.volume,muted:this.video_.muted}};r&&(i.media=r),this.sendMessage_({requestId:t,type:"MEDIA_STATUS",status:[i]},this.genericBus_)},goog.exportSymbol("shaka.cast.CastReceiver",shaka.cast.CastReceiver),goog.exportProperty(shaka.cast.CastReceiver.prototype,"destroy",shaka.cast.CastReceiver.prototype.destroy),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentArtist",shaka.cast.CastReceiver.prototype.setContentArtist),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentImage",shaka.cast.CastReceiver.prototype.setContentImage),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentTitle",shaka.cast.CastReceiver.prototype.setContentTitle),goog.exportProperty(shaka.cast.CastReceiver.prototype,"clearContentMetadata",shaka.cast.CastReceiver.prototype.clearContentMetadata),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentMetadata",shaka.cast.CastReceiver.prototype.setContentMetadata),goog.exportProperty(shaka.cast.CastReceiver.prototype,"isIdle",shaka.cast.CastReceiver.prototype.isIdle),goog.exportProperty(shaka.cast.CastReceiver.prototype,"isConnected",shaka.cast.CastReceiver.prototype.isConnected),shaka.cast.CastReceiver.POLL_INTERVAL=.5,shaka.cast.CastReceiver.IDLE_INTERVAL=5,shaka.cast.CastReceiver.PLAY_STATE={IDLE:"IDLE",PLAYING:"PLAYING",BUFFERING:"BUFFERING",PAUSED:"PAUSED"},shaka.util.Pssh=function(t){var r=this;this.systemIds=[],this.cencKeyIds=[],this.data=[],new shaka.util.Mp4Parser().box("moov",shaka.util.Mp4Parser.children).fullBox("pssh",function(i){return r.parsePsshBox_(i)}).parse(t),this.data.length==0&&shaka.log.warning("No pssh box found!")},shaka.util.Pssh.prototype.parsePsshBox_=function(t){if(goog.asserts.assert(t.version!=null,"PSSH boxes are full boxes and must have a valid version"),goog.asserts.assert(t.flags!=null,"PSSH boxes are full boxes and must have a valid flag"),1<t.version)shaka.log.warning("Unrecognized PSSH version found!");else{var r=t.reader.getDataView();if(goog.asserts.assert(12<=r.byteOffset,"DataView at incorrect position"),r=shaka.util.BufferUtils.toUint8(r,-12,t.size),this.data.push(r),this.systemIds.push(shaka.util.Uint8ArrayUtils.toHex(t.reader.readBytes(16))),0<t.version){r=t.reader.readUint32();for(var i=0;i<r;i++){var n=shaka.util.Uint8ArrayUtils.toHex(t.reader.readBytes(16));this.cencKeyIds.push(n)}}}},shaka.util.Pssh.createPssh=function(t,r){goog.asserts.assert(r.byteLength==16,"Invalid system ID length");var i=t.length,n=12+r.length+4+i,s=new Uint8Array(n),o=shaka.util.BufferUtils.toDataView(s),l=0;return o.setUint32(l,n),l+=4,o.setUint32(l,1886614376),l+=4,o.setUint32(l,0),l+=4,s.set(r,l),l+=r.length,o.setUint32(l,i),l+=4,s.set(t,l),goog.asserts.assert(l+i===n,"PSSH invalid length."),s},shaka.util.Pssh.normaliseInitData=function(t){if(!t)return t;var r=new shaka.util.Pssh(t);if(1>=r.data.length)return t;t=[];var i={};r=$jscomp.makeIterator(r.data);for(var n=r.next();!n.done;i={$jscomp$loop$prop$initData$491$606:i.$jscomp$loop$prop$initData$491$606},n=r.next())i.$jscomp$loop$prop$initData$491$606=n.value,t.some(function(s){return function(o){return shaka.util.BufferUtils.equal(o,s.$jscomp$loop$prop$initData$491$606)}}(i))||t.push(i.$jscomp$loop$prop$initData$491$606);return shaka.util.Uint8ArrayUtils.concat.apply(shaka.util.Uint8ArrayUtils,$jscomp.arrayFromIterable(t))},shaka.util.XmlUtils=function(){},shaka.util.XmlUtils.findChild=function(t,r){var i=shaka.util.XmlUtils.findChildren(t,r);return i.length!=1?null:i[0]},shaka.util.XmlUtils.findChildNS=function(t,r,i){return t=shaka.util.XmlUtils.findChildrenNS(t,r,i),t.length!=1?null:t[0]},shaka.util.XmlUtils.findChildren=function(t,r){for(var i=[],n=$jscomp.makeIterator(t.childNodes),s=n.next();!s.done;s=n.next())s=s.value,s instanceof Element&&s.tagName==r&&i.push(s);return i},shaka.util.XmlUtils.getChildren=function(t){return Array.from(t.childNodes).filter(function(r){return r instanceof Element})},shaka.util.XmlUtils.findChildrenNS=function(t,r,i){var n=[];t=$jscomp.makeIterator(t.childNodes);for(var s=t.next();!s.done;s=t.next())s=s.value,s instanceof Element&&s.localName==i&&s.namespaceURI==r&&n.push(s);return n},shaka.util.XmlUtils.getAttributeNS=function(t,r,i){return t.hasAttributeNS(r,i)?t.getAttributeNS(r,i):null},shaka.util.XmlUtils.getAttributeNSList=function(t,r,i){r=$jscomp.makeIterator(r);for(var n=r.next();!n.done;n=r.next())if(n=n.value,t.hasAttributeNS(n,i))return t.getAttributeNS(n,i);return null},shaka.util.XmlUtils.getContents=function(t){var r=shaka.util.XmlUtils;return Array.from(t.childNodes).every(r.isText)?t.textContent.trim():null},shaka.util.XmlUtils.isText=function(t){return t.nodeType==Node.TEXT_NODE||t.nodeType==Node.CDATA_SECTION_NODE},shaka.util.XmlUtils.parseAttr=function(t,r,i,n){n=n===void 0?null:n;var s=null;return t=t.getAttribute(r),t!=null&&(s=i(t)),s??n},shaka.util.XmlUtils.parseDate=function(t){return t?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t)&&(t+="Z"),t=Date.parse(t),isNaN(t)?null:Math.floor(t/1e3)):null},shaka.util.XmlUtils.parseDuration=function(t){if(!t)return null;var r=RegExp("^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$").exec(t);return r?(t=31536e3*Number(r[1]||null)+2592e3*Number(r[2]||null)+86400*Number(r[3]||null)+3600*Number(r[4]||null)+60*Number(r[5]||null)+Number(r[6]||null),isFinite(t)?t:null):(shaka.log.warning("Invalid duration string:",t),null)},shaka.util.XmlUtils.parseRange=function(t){var r=/([0-9]+)-([0-9]+)/.exec(t);return!r||(t=Number(r[1]),!isFinite(t))?null:(r=Number(r[2]),isFinite(r)?{start:t,end:r}:null)},shaka.util.XmlUtils.parseInt=function(t){return t=Number(t),t%1===0?t:null},shaka.util.XmlUtils.parsePositiveInt=function(t){return t=Number(t),t%1===0&&0<t?t:null},shaka.util.XmlUtils.parseNonNegativeInt=function(t){return t=Number(t),t%1===0&&0<=t?t:null},shaka.util.XmlUtils.parseFloat=function(t){return t=Number(t),isNaN(t)?null:t},shaka.util.XmlUtils.evalDivision=function(t){var r,i=(r=t.match(/^(\d+)\/(\d+)$/))?Number(r[1])/Number(r[2]):Number(t);return isNaN(i)?null:i},shaka.util.XmlUtils.parseXmlString=function(t,r){var i=new DOMParser,n=null;try{n=i.parseFromString(t,"text/xml")}catch(o){return shaka.log.error("XML parsing exception:",o),null}if(goog.asserts.assert(n,"Parsed XML document cannot be null!"),i=n.documentElement,!i)return shaka.log.error("XML document was empty!"),null;var s=i.getElementsByTagName("parsererror");return s.length?(shaka.log.error("XML parser error found:",s[0]),null):n.documentElement.tagName!=r?(shaka.log.error('XML tag name does not match expected "'+r+'":',n.documentElement.tagName),null):i},shaka.util.XmlUtils.parseXml=function(t,r){try{var i=shaka.util.StringUtils.fromUTF8(t);return shaka.util.XmlUtils.parseXmlString(i,r)}catch(n){return shaka.log.error("parseXmlString threw!",n),null}},shaka.dash={},shaka.dash.ContentProtection=function(){},shaka.dash.ContentProtection.parseFromAdaptationSet=function(t,r,i){var n=shaka.dash.ContentProtection,s=shaka.util.ManifestParserUtils,o=n.parseElements_(t),l=null;t=[];var u=[],m=new Set(o.map(function(E){return E.keyId}));if(m.delete(null),1<m.size)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_CONFLICTING_KEY_IDS);if(r||(u=o.filter(function(E){return E.schemeUri==n.MP4Protection_?(goog.asserts.assert(!E.init||E.init.length,"Init data must be null or non-empty."),l=E.init||l,!1):!0}),u.length&&(t=n.convertElements_(l,u,i),t.length==0&&(t=[s.createDrmInfo("",l)]))),o.length&&(r||!u.length))for(t=[],r=$jscomp.makeIterator(Object.values(i)),i=r.next();!i.done;i=r.next())i=i.value,i!="org.w3.clearkey"&&(i=s.createDrmInfo(i,l),t.push(i));if(s=Array.from(m)[0]||null)for(m=$jscomp.makeIterator(t),r=m.next();!r.done;r=m.next())for(r=$jscomp.makeIterator(r.value.initData),i=r.next();!i.done;i=r.next())i.value.keyId=s;return{defaultKeyId:s,defaultInit:l,drmInfos:t,firstRepresentation:!0}},shaka.dash.ContentProtection.parseFromRepresentation=function(t,r,i,n){var s=shaka.dash.ContentProtection.parseFromAdaptationSet(t,i,n);if(r.firstRepresentation)t=r.drmInfos.length==1&&!r.drmInfos[0].keySystem,i=s.drmInfos.length==0,(r.drmInfos.length==0||t&&!i)&&(r.drmInfos=s.drmInfos),r.firstRepresentation=!1;else if(0<s.drmInfos.length&&(r.drmInfos=r.drmInfos.filter(function(o){return s.drmInfos.some(function(l){return l.keySystem==o.keySystem})}),r.drmInfos.length==0))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_COMMON_KEY_SYSTEM);return s.defaultKeyId||r.defaultKeyId},shaka.dash.ContentProtection.getWidevineLicenseUrl=function(t){return(t=shaka.util.XmlUtils.findChildNS(t.node,"urn:microsoft","laurl"))&&t.getAttribute("licenseUrl")||""},shaka.dash.ContentProtection.parseMsProRecords_=function(t,r){for(var i=[];r<t.byteLength-1;){var n=t.getUint16(r,!0);r+=2;var s=t.getUint16(r,!0);if(r+=2,s&1||s+r>t.byteLength)return shaka.log.warning("Malformed MS PRO object"),[];var o=shaka.util.BufferUtils.toUint8(t,r,s);i.push({type:n,value:o}),r+=s}return i},shaka.dash.ContentProtection.parseMsPro_=function(t){var r=0,i=shaka.util.BufferUtils.toDataView(t),n=i.getUint32(r,!0);return r+=4,n!=t.byteLength?(shaka.log.warning("PlayReady Object with invalid length encountered."),[]):shaka.dash.ContentProtection.parseMsProRecords_(i,r+2)},shaka.dash.ContentProtection.getLaurl_=function(t){t=$jscomp.makeIterator(t.getElementsByTagName("DATA"));for(var r=t.next();!r.done;r=t.next()){r=$jscomp.makeIterator(r.value.childNodes);for(var i=r.next();!i.done;i=r.next())if(i=i.value,i instanceof Element&&i.tagName=="LA_URL")return i.textContent}return""},shaka.dash.ContentProtection.getPlayReadyLicenseUrl=function(t){var r=shaka.util.XmlUtils.findChildNS(t.node,"urn:microsoft:playready","pro");if(!r)return"";t=shaka.dash.ContentProtection;var i=t.PLAYREADY_RECORD_TYPES;return r=shaka.util.Uint8ArrayUtils.fromBase64(r.textContent),r=t.parseMsPro_(r).filter(function(n){return n.type===i.RIGHTS_MANAGEMENT})[0],r?(r=shaka.util.StringUtils.fromUTF16(r.value,!0),(r=shaka.util.XmlUtils.parseXmlString(r,"WRMHEADER"))?t.getLaurl_(r):""):""},shaka.dash.ContentProtection.getInitDataFromPro_=function(t){var r=shaka.util.XmlUtils.findChildNS(t.node,"urn:microsoft:playready","pro");if(!r)return null;r=shaka.util.Uint8ArrayUtils.fromBase64(r.textContent);var i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);return[{initData:shaka.util.Pssh.createPssh(r,i),initDataType:"cenc",keyId:t.keyId}]},shaka.dash.ContentProtection.convertElements_=function(t,r,i){var n=shaka.dash.ContentProtection,s=shaka.util.ManifestParserUtils,o=n.licenseUrlParsers_,l=[];r=$jscomp.makeIterator(r);for(var u=r.next();!u.done;u=r.next()){u=u.value;var m=i[u.schemeUri];if(m){goog.asserts.assert(!u.init||u.init.length,"Init data must be null or non-empty.");var E=n.getInitDataFromPro_(u);E=s.createDrmInfo(m,u.init||t||E),(m=o.get(m))&&(E.licenseServerUri=m(u)),l.push(E)}}return l},shaka.dash.ContentProtection.parseElements_=function(t){var r=[];t=$jscomp.makeIterator(t);for(var i=t.next();!i.done;i=t.next())(i=shaka.dash.ContentProtection.parseElement_(i.value))&&r.push(i);return r},shaka.dash.ContentProtection.parseElement_=function(t){var r=shaka.dash.ContentProtection.CencNamespaceUri_,i=t.getAttribute("schemeIdUri"),n=shaka.util.XmlUtils.getAttributeNS(t,r,"default_KID");if(r=shaka.util.XmlUtils.findChildrenNS(t,r,"pssh").map(shaka.util.XmlUtils.getContents),!i)return shaka.log.error("Missing required schemeIdUri attribute on","ContentProtection element",t),null;if(i=i.toLowerCase(),n&&(n=n.replace(/-/g,"").toLowerCase(),n.includes(" ")))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED);var s=[];try{s=r.map(function(o){return{initDataType:"cenc",initData:shaka.util.Uint8ArrayUtils.fromBase64(o),keyId:null}})}catch{throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_PSSH_BAD_ENCODING)}return{node:t,schemeUri:i,keyId:n,init:0<s.length?s:null}},shaka.dash.ContentProtection.PLAYREADY_RECORD_TYPES={RIGHTS_MANAGEMENT:1,RESERVED:2,EMBEDDED_LICENSE:3},shaka.dash.ContentProtection.licenseUrlParsers_=new Map().set("com.widevine.alpha",shaka.dash.ContentProtection.getWidevineLicenseUrl).set("com.microsoft.playready",shaka.dash.ContentProtection.getPlayReadyLicenseUrl).set("com.microsoft.playready.recommendation",shaka.dash.ContentProtection.getPlayReadyLicenseUrl).set("com.microsoft.playready.software",shaka.dash.ContentProtection.getPlayReadyLicenseUrl).set("com.microsoft.playready.hardware",shaka.dash.ContentProtection.getPlayReadyLicenseUrl),shaka.dash.ContentProtection.MP4Protection_="urn:mpeg:dash:mp4protection:2011",shaka.dash.ContentProtection.CencNamespaceUri_="urn:mpeg:cenc:2013",shaka.dash.MpdUtils=function(){},shaka.dash.MpdUtils.fillUriTemplate=function(t,r,i,n,s){var o={RepresentationID:r,Number:i,Bandwidth:n,Time:s};return t.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(l,u,m,E){if(l=="$$")return"$";var y=o[u];if(goog.asserts.assert(y!==void 0,"Unrecognized identifier"),y==null)return shaka.log.warning("URL template does not have an available substitution for ",'identifier "'+u+'":',t),l;switch(u=="RepresentationID"&&m&&(shaka.log.warning("URL template should not contain a width specifier for identifier",'"RepresentationID":',t),m=void 0),u=="Time"&&(goog.asserts.assert(typeof y=="number","Time value should be a number!"),goog.asserts.assert(.2>Math.abs(y-Math.round(y)),"Calculated $Time$ values must be close to integers"),y=Math.round(y)),E){case void 0:case"d":case"i":case"u":l=y.toString();break;case"o":l=y.toString(8);break;case"x":l=y.toString(16);break;case"X":l=y.toString(16).toUpperCase();break;default:goog.asserts.assert(!1,"Unhandled format specifier"),l=y.toString()}return m=window.parseInt(m,10)||1,Array(Math.max(0,m-l.length)+1).join("0")+l})},shaka.dash.MpdUtils.createTimeline=function(t,r,i,n){goog.asserts.assert(0<r&&1/0>r,"timescale must be a positive, finite integer"),goog.asserts.assert(0<n,"period duration must be a positive integer");var s=shaka.util.XmlUtils;t=s.findChildren(t,"S");for(var o=[],l=-i,u=0;u<t.length;++u){var m=t[u],E=t[u+1],y=s.parseAttr(m,"t",s.parseNonNegativeInt),D=s.parseAttr(m,"d",s.parseNonNegativeInt),w=s.parseAttr(m,"r",s.parseInt);if(y!=null&&(y-=i),!D){shaka.log.warning('"S" element must have a duration:','ignoring the remaining "S" elements.',m);break}if(y=y??l,w=w||0,0>w)if(E){if(E=s.parseAttr(E,"t",s.parseNonNegativeInt),E==null){shaka.log.warning('An "S" element cannot have a negative repeat','if the next "S" element does not have a valid start time:','ignoring the remaining "S" elements.',m);break}else if(y>=E){shaka.log.warning('An "S" element cannot have a negative repeatif its start ',`time exceeds the next "S" element's start time:`,'ignoring the remaining "S" elements.',m);break}w=Math.ceil((E-y)/D)-1}else{if(n==1/0){shaka.log.warning('The last "S" element cannot have a negative repeat',"if the Period has an infinite duration:",'ignoring the last "S" element.',m);break}else if(y/r>=n){shaka.log.warning('The last "S" element cannot have a negative repeat',"if its start time exceeds the Period's duration:",'igoring the last "S" element.',m);break}w=Math.ceil((n*r-y)/D)-1}for(0<o.length&&y!=l&&(Math.abs((y-l)/r)>=shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS&&shaka.log.warning("SegmentTimeline contains a large gap/overlap:","the content may have errors in it.",m),o[o.length-1].end=y/r),m=0;m<=w;++m)l=y+D,o.push({start:y/r,end:l/r,unscaledStart:y}),y=l}return o},shaka.dash.MpdUtils.parseSegmentInfo=function(t,r){goog.asserts.assert(r(t.representation),"There must be at least one element of the given type.");var i=shaka.dash.MpdUtils,n=shaka.util.XmlUtils,s=i.inheritAttribute(t,r,"timescale"),o=1;s&&(o=n.parsePositiveInt(s)||1);var l=i.inheritAttribute(t,r,"duration");s=n.parsePositiveInt(l||""),t.representation.contentType==shaka.util.ManifestParserUtils.ContentType.IMAGE&&(s=n.parseFloat(l||"")),s&&(s/=o);var u=i.inheritAttribute(t,r,"startNumber");l=Number(i.inheritAttribute(t,r,"presentationTimeOffset"))||0,n=n.parseNonNegativeInt(u||""),(u==null||n==null)&&(n=1),u=i.inheritChild(t,r,"SegmentTimeline");var m=null;return u&&(m=i.createTimeline(u,o,l,t.periodInfo.duration||1/0)),{timescale:o,segmentDuration:s,startNumber:n,scaledPresentationTimeOffset:l/o||0,unscaledPresentationTimeOffset:l,timeline:m}},shaka.dash.MpdUtils.inheritAttribute=function(t,r,i){var n=shaka.util.Functional;return goog.asserts.assert(r(t.representation),"There must be at least one element of the given type"),[r(t.representation),r(t.adaptationSet),r(t.period)].filter(n.isNotNull).map(function(s){return s.getAttribute(i)}).reduce(function(s,o){return s||o})},shaka.dash.MpdUtils.inheritChild=function(t,r,i){var n=shaka.util.Functional;goog.asserts.assert(r(t.representation),"There must be at least one element of the given type"),t=[r(t.representation),r(t.adaptationSet),r(t.period)].filter(n.isNotNull);var s=shaka.util.XmlUtils;return t.map(function(o){return s.findChild(o,i)}).reduce(function(o,l){return o||l})},shaka.dash.MpdUtils.handleXlinkInElement_=function(t,r,i,n,s,o){var l=shaka.util.XmlUtils,u=shaka.util.Error,m=shaka.util.ManifestParserUtils,E=shaka.dash.MpdUtils.XlinkNamespaceUri_,y=l.getAttributeNS(t,E,"href");l=l.getAttributeNS(t,E,"actuate")||"onRequest";for(var D=$jscomp.makeIterator(Array.from(t.attributes)),w=D.next();!w.done;w=D.next())w=w.value,w.namespaceURI==E&&t.removeAttributeNS(w.namespaceURI,w.localName);if(5<=o)return shaka.util.AbortableOperation.failed(new u(u.Severity.CRITICAL,u.Category.MANIFEST,u.Code.DASH_XLINK_DEPTH_LIMIT));if(l!="onLoad")return shaka.util.AbortableOperation.failed(new u(u.Severity.CRITICAL,u.Category.MANIFEST,u.Code.DASH_UNSUPPORTED_XLINK_ACTUATE));var B=m.resolveUris([n],[y]);return n=shaka.net.NetworkingEngine.RequestType.MANIFEST,m=shaka.net.NetworkingEngine.makeRequest(B,r),n=s.request(n,m),goog.asserts.assert(n instanceof shaka.util.AbortableOperation,"Unexpected implementation of IAbortableOperation!"),n.chain(function(F){if(F=shaka.util.XmlUtils.parseXml(F.data,t.tagName),!F)return shaka.util.AbortableOperation.failed(new u(u.Severity.CRITICAL,u.Category.MANIFEST,u.Code.DASH_INVALID_XML,y));for(;t.childNodes.length;)t.removeChild(t.childNodes[0]);for(;F.childNodes.length;){var V=F.childNodes[0];F.removeChild(V),t.appendChild(V)}for(F=$jscomp.makeIterator(Array.from(F.attributes)),V=F.next();!V.done;V=F.next())t.setAttributeNode(V.value.cloneNode(!1));return shaka.dash.MpdUtils.processXlinks(t,r,i,B[0],s,o+1)})},shaka.dash.MpdUtils.processXlinks=function(t,r,i,n,s,o){o=o===void 0?0:o;var l=shaka.dash.MpdUtils,u=shaka.util.XmlUtils,m=l.XlinkNamespaceUri_;if(u.getAttributeNS(t,m,"href"))return u=l.handleXlinkInElement_(t,r,i,n,s,o),i&&(u=u.chain(void 0,function(w){return l.processXlinks(t,r,i,n,s,o)})),u;for(var E=[],y=$jscomp.makeIterator(Array.from(t.childNodes)),D=y.next();!D.done;D=y.next())D=D.value,D instanceof Element&&(u.getAttributeNS(D,m,"href")=="urn:mpeg:dash:resolve-to-zero:2013"?t.removeChild(D):D.tagName!="SegmentTimeline"&&E.push(shaka.dash.MpdUtils.processXlinks(D,r,i,n,s,o)));return shaka.util.AbortableOperation.all(E).chain(function(){return t})},shaka.dash.MpdUtils.XlinkNamespaceUri_="http://www.w3.org/1999/xlink",shaka.media.Mp4SegmentIndexParser=function(){},shaka.media.Mp4SegmentIndexParser.parse=function(t,r,i,n,s,o,l){var u=shaka.media.Mp4SegmentIndexParser,m,E=new shaka.util.Mp4Parser().fullBox("sidx",function(y){m=u.parseSIDX_(r,n,s,o,l,i,y)});if(t&&E.parse(t),m)return m;throw shaka.log.error('Invalid box type, expected "sidx".'),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_WRONG_BOX_TYPE)},shaka.media.Mp4SegmentIndexParser.parseSIDX_=function(t,r,i,n,s,o,l){goog.asserts.assert(l.version!=null,"SIDX is a full box and should have a valid version.");var u=[];l.reader.skip(4);var m=l.reader.readUint32();if(m==0)throw shaka.log.error("Invalid timescale."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_INVALID_TIMESCALE);if(l.version==0)var E=l.reader.readUint32(),y=l.reader.readUint32();else E=l.reader.readUint64(),y=l.reader.readUint64();l.reader.skip(2);var D=l.reader.readUint16();for(t=t+l.size+y,y=0;y<D;y++){var w=l.reader.readUint32(),B=(w&2147483648)>>>31;w&=2147483647;var F=l.reader.readUint32();if(l.reader.skip(4),B==1)throw shaka.log.error("Heirarchical SIDXs are not supported."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_TYPE_NOT_SUPPORTED);u.push(new shaka.media.SegmentReference(E/m+i,(E+F)/m+i,function(){return o},t,t+w-1,r,i,n,s)),E+=F,t+=w}return l.parser.stop(),u},shaka.util.EbmlParser=function(t){this.dataView_=shaka.util.BufferUtils.toDataView(t),this.reader_=new shaka.util.DataViewReader(this.dataView_,shaka.util.DataViewReader.Endianness.BIG_ENDIAN)},shaka.util.EbmlParser.prototype.hasMoreData=function(){return this.reader_.hasMoreData()},shaka.util.EbmlParser.prototype.parseElement=function(){var t=this.parseId_(),r=this.parseVint_();r=shaka.util.EbmlParser.isDynamicSizeValue_(r)?this.dataView_.byteLength-this.reader_.getPosition():shaka.util.EbmlParser.getVintValue_(r),r=this.reader_.getPosition()+r<=this.dataView_.byteLength?r:this.dataView_.byteLength-this.reader_.getPosition();var i=shaka.util.BufferUtils.toDataView(this.dataView_,this.reader_.getPosition(),r);return this.reader_.skip(r),new shaka.util.EbmlElement(t,i)},shaka.util.EbmlParser.prototype.parseId_=function(){var t=this.parseVint_();if(7<t.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);var r=0;t=$jscomp.makeIterator(t);for(var i=t.next();!i.done;i=t.next())r=256*r+i.value;return r},shaka.util.EbmlParser.prototype.parseVint_=function(){var t=this.reader_.getPosition(),r=this.reader_.readUint8();if(r==0)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);return r=8-Math.floor(Math.log2(r)),goog.asserts.assert(8>=r&&1<=r,"Incorrect log2 value"),this.reader_.skip(r-1),shaka.util.BufferUtils.toUint8(this.dataView_,t,r)},shaka.util.EbmlParser.getVintValue_=function(t){if(t.length==8&&t[1]&224)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);for(var r=0,i=0;i<t.length;i++){var n=t[i];r=i==0?n&(1<<8-t.length)-1:256*r+n}return r},shaka.util.EbmlParser.isDynamicSizeValue_=function(t){for(var r=shaka.util.BufferUtils,i=$jscomp.makeIterator(shaka.util.EbmlParser.DYNAMIC_SIZES),n=i.next();!n.done;n=i.next())if(r.equal(t,new Uint8Array(n.value)))return!0;return!1},shaka.util.EbmlParser.DYNAMIC_SIZES=[[255],[127,255],[63,255,255],[31,255,255,255],[15,255,255,255,255],[7,255,255,255,255,255],[3,255,255,255,255,255,255],[1,255,255,255,255,255,255,255]],shaka.util.EbmlElement=function(t,r){this.id=t,this.dataView_=r},shaka.util.EbmlElement.prototype.getOffset=function(){return this.dataView_.byteOffset},shaka.util.EbmlElement.prototype.createParser=function(){return new shaka.util.EbmlParser(this.dataView_)},shaka.util.EbmlElement.prototype.getUint=function(){if(8<this.dataView_.byteLength)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);if(this.dataView_.byteLength==8&&this.dataView_.getUint8(0)&224)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);for(var t=0,r=0;r<this.dataView_.byteLength;r++){var i=this.dataView_.getUint8(r);t=256*t+i}return t},shaka.util.EbmlElement.prototype.getFloat=function(){if(this.dataView_.byteLength==4)return this.dataView_.getFloat32(0);if(this.dataView_.byteLength==8)return this.dataView_.getFloat64(0);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_BAD_FLOATING_POINT_SIZE)},shaka.media.WebmSegmentIndexParser=function(){},shaka.media.WebmSegmentIndexParser.parse=function(t,r,i,n,s,o,l){if(r=shaka.media.WebmSegmentIndexParser.parseWebmContainer_(r),t=new shaka.util.EbmlParser(t).parseElement(),t.id!=shaka.media.WebmSegmentIndexParser.CUES_ID)throw shaka.log.error("Not a Cues element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUES_ELEMENT_MISSING);return shaka.media.WebmSegmentIndexParser.parseCues_(t,r.segmentOffset,r.timecodeScale,r.duration,i,n,s,o,l)},shaka.media.WebmSegmentIndexParser.parseWebmContainer_=function(t){if(t=new shaka.util.EbmlParser(t),t.parseElement().id!=shaka.media.WebmSegmentIndexParser.EBML_ID)throw shaka.log.error("Not an EBML element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_EBML_HEADER_ELEMENT_MISSING);var r=t.parseElement();if(r.id!=shaka.media.WebmSegmentIndexParser.SEGMENT_ID)throw shaka.log.error("Not a Segment element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_SEGMENT_ELEMENT_MISSING);return t=r.getOffset(),r=shaka.media.WebmSegmentIndexParser.parseSegment_(r),{segmentOffset:t,timecodeScale:r.timecodeScale,duration:r.duration}},shaka.media.WebmSegmentIndexParser.parseSegment_=function(t){t=t.createParser();for(var r=null;t.hasMoreData();){var i=t.parseElement();if(i.id==shaka.media.WebmSegmentIndexParser.INFO_ID){r=i;break}}if(!r)throw shaka.log.error("Not an Info element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_INFO_ELEMENT_MISSING);return shaka.media.WebmSegmentIndexParser.parseInfo_(r)},shaka.media.WebmSegmentIndexParser.parseInfo_=function(t){var r=t.createParser(),i=1e6;for(t=null;r.hasMoreData();){var n=r.parseElement();n.id==shaka.media.WebmSegmentIndexParser.TIMECODE_SCALE_ID?i=n.getUint():n.id==shaka.media.WebmSegmentIndexParser.DURATION_ID&&(t=n.getFloat())}if(t==null)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_DURATION_ELEMENT_MISSING);return r=i/1e9,{timecodeScale:r,duration:t*r}},shaka.media.WebmSegmentIndexParser.parseCues_=function(t,r,i,n,s,o,l,u,m){var E=[],y=function(){return s};t=t.createParser();for(var D=null,w=null;t.hasMoreData();){var B=t.parseElement();if(B.id==shaka.media.WebmSegmentIndexParser.CUE_POINT_ID){var F=shaka.media.WebmSegmentIndexParser.parseCuePoint_(B);F&&(B=i*F.unscaledTime,F=r+F.relativeOffset,D!=null&&(goog.asserts.assert(w!=null,"last offset cannot be null"),E.push(new shaka.media.SegmentReference(D+l,B+l,y,w,F-1,o,l,u,m))),D=B,w=F)}}return D!=null&&(goog.asserts.assert(w!=null,"last offset cannot be null"),E.push(new shaka.media.SegmentReference(D+l,n+l,y,w,null,o,l,u,m))),E},shaka.media.WebmSegmentIndexParser.parseCuePoint_=function(t){var r=t.createParser();if(t=r.parseElement(),t.id!=shaka.media.WebmSegmentIndexParser.CUE_TIME_ID)throw shaka.log.warning("Not a CueTime element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUE_TIME_ELEMENT_MISSING);if(t=t.getUint(),r=r.parseElement(),r.id!=shaka.media.WebmSegmentIndexParser.CUE_TRACK_POSITIONS_ID)throw shaka.log.warning("Not a CueTrackPositions element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING);r=r.createParser();for(var i=0;r.hasMoreData();){var n=r.parseElement();if(n.id==shaka.media.WebmSegmentIndexParser.CUE_CLUSTER_POSITION){i=n.getUint();break}}return{unscaledTime:t,relativeOffset:i}},shaka.media.WebmSegmentIndexParser.EBML_ID=440786851,shaka.media.WebmSegmentIndexParser.SEGMENT_ID=408125543,shaka.media.WebmSegmentIndexParser.INFO_ID=357149030,shaka.media.WebmSegmentIndexParser.TIMECODE_SCALE_ID=2807729,shaka.media.WebmSegmentIndexParser.DURATION_ID=17545,shaka.media.WebmSegmentIndexParser.CUES_ID=475249515,shaka.media.WebmSegmentIndexParser.CUE_POINT_ID=187,shaka.media.WebmSegmentIndexParser.CUE_TIME_ID=179,shaka.media.WebmSegmentIndexParser.CUE_TRACK_POSITIONS_ID=183,shaka.media.WebmSegmentIndexParser.CUE_CLUSTER_POSITION=241,shaka.dash.SegmentBase=function(){},shaka.dash.SegmentBase.createInitSegment=function(t,r){var i=shaka.util.XmlUtils,n=shaka.util.ManifestParserUtils,s=shaka.dash.MpdUtils.inheritChild(t,r,"Initialization");if(!s)return null;var o=t.representation.baseUris,l=s.getAttribute("sourceURL");return l&&(o=n.resolveUris(t.representation.baseUris,[l])),n=0,l=null,(i=i.parseAttr(s,"range",i.parseRange))&&(n=i.start,l=i.end),i=shaka.dash.SegmentBase.createQualityInfo(t),new shaka.media.InitSegmentReference(function(){return o},n,l,i)},shaka.dash.SegmentBase.createStreamInfo=function(t,r){goog.asserts.assert(t.representation.segmentBase,"Should only be called with SegmentBase");var i=shaka.dash.MpdUtils,n=shaka.dash.SegmentBase,s=shaka.util.XmlUtils,o=Number(i.inheritAttribute(t,n.fromInheritance_,"presentationTimeOffset"))||0;i=i.inheritAttribute(t,n.fromInheritance_,"timescale");var l=1;i&&(l=s.parsePositiveInt(i)||1);var u=o/l||0,m=n.createInitSegment(t,n.fromInheritance_);n.checkSegmentIndexRangeSupport_(t,m);var E=shaka.util.ObjectUtils.shallowCloneObject(t);return{generateSegmentIndex:function(){return n.generateSegmentIndex_(E,r,m,u)}}},shaka.dash.SegmentBase.generateSegmentIndexFromUris=function(t,r,i,n,s,o,l){var u,m,E,y,D,w,B,F,V,K,q,re,ee,H,te;return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){return W.nextAddress==1?(u=t.presentationTimeline,m=!t.dynamic||!t.periodInfo.isLastPeriod,E=t.periodInfo.start,y=t.periodInfo.duration,D=t.representation.mimeType.split("/")[1],w=r,B=null,F=[w(n,s,o),D=="webm"?w(i.getUris(),i.startByte,i.endByte):null],w=null,W.yield(Promise.all(F),2)):(V=W.yieldResult,K=V[0],q=V[1]||null,re=null,ee=E-l,H=E,te=y?E+y:1/0,D=="mp4"?re=shaka.media.Mp4SegmentIndexParser.parse(K,s,n,i,ee,H,te):(goog.asserts.assert(q,"WebM requires init data"),re=shaka.media.WebmSegmentIndexParser.parse(K,q,n,i,ee,H,te)),u.notifySegments(re),goog.asserts.assert(!B,"Should not call generateSegmentIndex twice"),B=new shaka.media.SegmentIndex(re),m&&B.fit(H,te,!0),W.return(B))})},shaka.dash.SegmentBase.fromInheritance_=function(t){return t.segmentBase},shaka.dash.SegmentBase.computeIndexRange_=function(t){var r=shaka.dash.MpdUtils,i=shaka.dash.SegmentBase,n=shaka.util.XmlUtils,s=r.inheritChild(t,i.fromInheritance_,"RepresentationIndex");return t=r.inheritAttribute(t,i.fromInheritance_,"indexRange"),t=n.parseRange(t||""),s&&(t=n.parseAttr(s,"range",n.parseRange,t)),t},shaka.dash.SegmentBase.computeIndexUris_=function(t){var r=shaka.util.ManifestParserUtils,i=shaka.dash.MpdUtils.inheritChild(t,shaka.dash.SegmentBase.fromInheritance_,"RepresentationIndex"),n=t.representation.baseUris;return i&&(i=i.getAttribute("sourceURL"))&&(n=r.resolveUris(t.representation.baseUris,[i])),n},shaka.dash.SegmentBase.checkSegmentIndexRangeSupport_=function(t,r){var i=shaka.dash.SegmentBase;if(i.checkSegmentIndexSupport(t,r),!i.computeIndexRange_(t))throw shaka.log.error("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentBase.checkSegmentIndexSupport=function(t,r){var i=shaka.util.ManifestParserUtils.ContentType,n=t.representation.contentType,s=t.representation.mimeType.split("/")[1];if(n!=i.TEXT&&s!="mp4"&&s!="webm")throw shaka.log.error("SegmentBase specifies an unsupported container type.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_UNSUPPORTED_CONTAINER);if(s=="webm"&&!r)throw shaka.log.error("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_WEBM_MISSING_INIT)},shaka.dash.SegmentBase.generateSegmentIndex_=function(t,r,i,n){var s=shaka.dash.SegmentBase,o=s.computeIndexUris_(t);return s=s.computeIndexRange_(t),goog.asserts.assert(s,"Index range should not be null!"),shaka.dash.SegmentBase.generateSegmentIndexFromUris(t,r,i,o,s.start,s.end,n)},shaka.dash.SegmentBase.createQualityInfo=function(t){var r=t.representation;return{bandwidth:t.bandwidth,audioSamplingRate:r.audioSamplingRate,codecs:r.codecs,contentType:r.contentType,frameRate:r.frameRate||null,height:r.height||null,mimeType:r.mimeType,channelsCount:r.numChannels,pixelAspectRatio:r.pixelAspectRatio||null,width:r.width||null}},shaka.dash.SegmentList=function(){},shaka.dash.SegmentList.createStreamInfo=function(t,r){goog.asserts.assert(t.representation.segmentList,"Should only be called with SegmentList");var i=shaka.dash.SegmentList,n=shaka.dash.SegmentBase.createInitSegment(t,i.fromInheritance_),s=i.parseSegmentListInfo_(t);i.checkSegmentListInfo_(t,s);var o=null,l=null;t.period.id&&t.representation.id&&(l=r[t.period.id+","+t.representation.id])&&(o=l.segmentIndex);var u=i.createSegmentReferences_(t.periodInfo.start,t.periodInfo.duration,s.startNumber,t.representation.baseUris,s,n);return i=!o,o?(n=t.presentationTimeline.getSegmentAvailabilityStart(),o.mergeAndEvict(u,n)):o=new shaka.media.SegmentIndex(u),t.presentationTimeline.notifySegments(u),t.dynamic&&t.periodInfo.isLastPeriod||o.fit(t.periodInfo.start,t.periodInfo.duration?t.periodInfo.start+t.periodInfo.duration:1/0,i),l&&(l.segmentIndex=o),{generateSegmentIndex:function(){return o&&!o.isEmpty()||o.merge(u),Promise.resolve(o)}}},shaka.dash.SegmentList.fromInheritance_=function(t){return t.segmentList},shaka.dash.SegmentList.parseSegmentListInfo_=function(t){var r=shaka.dash.SegmentList,i=shaka.dash.MpdUtils,n=r.parseMediaSegments_(t);return t=i.parseSegmentInfo(t,r.fromInheritance_),r=t.startNumber,r==0&&(shaka.log.warning("SegmentList@startNumber must be > 0"),r=1),i=0,t.segmentDuration?i=t.segmentDuration*(r-1):t.timeline&&0<t.timeline.length&&(i=t.timeline[0].start),{segmentDuration:t.segmentDuration,startTime:i,startNumber:r,scaledPresentationTimeOffset:t.scaledPresentationTimeOffset,timeline:t.timeline,mediaSegments:n}},shaka.dash.SegmentList.checkSegmentListInfo_=function(t,r){if(!r.segmentDuration&&!r.timeline&&1<r.mediaSegments.length)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,","but does not specify a segment duration or timeline.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(!r.segmentDuration&&!t.periodInfo.duration&&!r.timeline&&r.mediaSegments.length==1)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(r.timeline&&r.timeline.length==0)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentList.createSegmentReferences_=function(t,r,i,n,s,o){i=shaka.util.ManifestParserUtils;var l=s.mediaSegments.length;s.timeline&&s.timeline.length!=s.mediaSegments.length&&(l=Math.min(s.timeline.length,s.mediaSegments.length),shaka.log.warning("The number of items in the segment timeline and the number of ","segment URLs do not match, truncating",s.mediaSegments.length,"to",l));for(var u=t-s.scaledPresentationTimeOffset,m=r?t+r:1/0,E=[],y=s.startTime,D={},w=0;w<l;D={$jscomp$loop$prop$mediaUri$608:D.$jscomp$loop$prop$mediaUri$608},w++){var B=s.mediaSegments[w];D.$jscomp$loop$prop$mediaUri$608=i.resolveUris(n,[B.mediaUri]);var F=void 0;s.segmentDuration!=null?F=y+s.segmentDuration:s.timeline?F=s.timeline[w].end:(goog.asserts.assert(s.mediaSegments.length==1&&r,"There should be exactly one segment with a Period duration."),F=y+r);var V=function(K){return function(){return K.$jscomp$loop$prop$mediaUri$608}}(D);E.push(new shaka.media.SegmentReference(t+y,t+F,V,B.start,B.end,o,u,t,m)),y=F}return E},shaka.dash.SegmentList.parseMediaSegments_=function(t){var r=[t.representation.segmentList,t.adaptationSet.segmentList,t.period.segmentList].filter(shaka.util.Functional.isNotNull),i=shaka.util.XmlUtils;return r.map(function(n){return i.findChildren(n,"SegmentURL")}).reduce(function(n,s){return 0<n.length?n:s}).map(function(n){n.getAttribute("indexRange")&&!t.indexRangeWarningGiven&&(t.indexRangeWarningGiven=!0,shaka.log.warning("We do not support the SegmentURL@indexRange attribute on SegmentList.  We only use the SegmentList@duration attribute or SegmentTimeline, which must be accurate."));var s=n.getAttribute("media");return n=i.parseAttr(n,"mediaRange",i.parseRange,{start:0,end:null}),{mediaUri:s,start:n.start,end:n.end}})},shaka.dash.SegmentTemplate=function(){},shaka.dash.SegmentTemplate.createStreamInfo=function(t,r,i,n,s,o){goog.asserts.assert(t.representation.segmentTemplate,"Should only be called with SegmentTemplate");var l=shaka.dash.SegmentTemplate,u=l.createInitSegment_(t),m=l.parseSegmentTemplateInfo_(t);l.checkSegmentTemplateInfo_(t,m);var E=shaka.util.ObjectUtils.shallowCloneObject(t);if(m.indexTemplate)return shaka.dash.SegmentBase.checkSegmentIndexSupport(t,u),{generateSegmentIndex:function(){return l.generateSegmentIndexFromIndexTemplate_(E,r,u,m)}};if(m.segmentDuration)return n||(t.presentationTimeline.notifyMaxSegmentDuration(m.segmentDuration),t.presentationTimeline.notifyMinSegmentStartTime(t.periodInfo.start)),{generateSegmentIndex:function(){return l.generateSegmentIndexFromDuration_(E,m,s,u,o)}};var y=null;n=n=null,t.period.id&&t.representation.id&&(n=t.period.id+","+t.representation.id,n=i[n])&&(y=n.segmentIndex);var D=l.createFromTimeline_(E,m,u);i=t.periodInfo.start;var w=t.periodInfo.duration?t.periodInfo.start+t.periodInfo.duration:1/0,B=w!=1/0;return y?(B&&new shaka.media.SegmentIndex(D).fit(i,w,!0),y.mergeAndEvict(D,t.presentationTimeline.getSegmentAvailabilityStart())):y=new shaka.media.SegmentIndex(D),t.presentationTimeline.notifySegments(D),B&&y.fit(i,w),n&&t.dynamic&&(n.segmentIndex=y),{generateSegmentIndex:function(){return y&&!y.isEmpty()||y.merge(D),Promise.resolve(y)}}},shaka.dash.SegmentTemplate.fromInheritance_=function(t){return t.segmentTemplate},shaka.dash.SegmentTemplate.parseSegmentTemplateInfo_=function(t){var r=shaka.dash.SegmentTemplate,i=shaka.dash.MpdUtils,n=i.parseSegmentInfo(t,r.fromInheritance_),s=i.inheritAttribute(t,r.fromInheritance_,"media");return t=i.inheritAttribute(t,r.fromInheritance_,"index"),{segmentDuration:n.segmentDuration,timescale:n.timescale,startNumber:n.startNumber,scaledPresentationTimeOffset:n.scaledPresentationTimeOffset,unscaledPresentationTimeOffset:n.unscaledPresentationTimeOffset,timeline:n.timeline,mediaTemplate:s,indexTemplate:t}},shaka.dash.SegmentTemplate.checkSegmentTemplateInfo_=function(t,r){var i=r.indexTemplate?1:0;if(i+=r.timeline?1:0,i+=r.segmentDuration?1:0,i==0)throw shaka.log.error("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(i!=1&&(shaka.log.warning("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,","a SegmentTimeline or a segment duration.",t.representation),r.indexTemplate?(shaka.log.info("Using the index URL template by default."),r.timeline=null):(goog.asserts.assert(r.timeline,"There should be a timeline"),shaka.log.info("Using the SegmentTimeline by default.")),r.segmentDuration=null),!r.indexTemplate&&!r.mediaTemplate)throw shaka.log.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentTemplate.generateSegmentIndexFromIndexTemplate_=function(t,r,i,n){var s=shaka.dash.MpdUtils,o=shaka.util.ManifestParserUtils;return goog.asserts.assert(n.indexTemplate,"must be using index template"),s=s.fillUriTemplate(n.indexTemplate,t.representation.id,null,t.bandwidth||null,null),o=o.resolveUris(t.representation.baseUris,[s]),shaka.dash.SegmentBase.generateSegmentIndexFromUris(t,r,i,o,0,null,n.scaledPresentationTimeOffset)},shaka.dash.SegmentTemplate.generateSegmentIndexFromDuration_=function(t,r,i,n,s){goog.asserts.assert(r.mediaTemplate,"There should be a media template with duration");var o=shaka.dash.MpdUtils,l=shaka.util.ManifestParserUtils,u=t.presentationTimeline,m=t.periodInfo.start,E=t.period.id,y=t.periodInfo.duration,D=function(){var oe=E!=null&&s[E]||y;return oe?m+oe:1/0},w=r.segmentDuration;goog.asserts.assert(w!=null,"Segment duration must not be null!");var B=r.startNumber,F=r.timescale,V=r.mediaTemplate,K=t.bandwidth||null,q=t.representation.id,re=t.representation.baseUris,ee=m-r.scaledPresentationTimeOffset,H=function(){var oe=[Math.max(u.getSegmentAvailabilityStart(),m),Math.min(u.getSegmentAvailabilityEnd(),D())];return goog.asserts.assert(oe.every(isFinite),"Available presentation times must be finite!"),goog.asserts.assert(oe.every(function(ae){return 0<=ae}),"Available presentation times must be positive!"),goog.asserts.assert(w!=null,"Segment duration must not be null!"),oe=oe.map(function(ae){return ae-m}),[Math.ceil(oe[0]/w),Math.ceil(oe[1]/w)-1].map(function(ae){return ae+B})},te=H();t=t.dynamic?Math.max(te[0],te[1]-i+1):te[0],te=te[1],i=[];for(var W=function(oe){goog.asserts.assert(w!=null,"Segment duration must not be null!");var ae=(oe-B)*w,_e=ae+r.scaledPresentationTimeOffset,ve=ae+m;ae=ve+w;var Pe=Math.min(ae,D());return goog.asserts.assert(ve<Pe,"Generated a segment outside of the period!"),ve=new shaka.media.SegmentReference(ve,Pe,function(){var fe=o.fillUriTemplate(V,q,oe,K,_e*F);return l.resolveUris(re,[fe])},0,null,n,ee,m,D()),ve.trueEndTime=ae,ve},z=t;z<=te;++z){var X=W(z);i.push(X)}var Q=new shaka.media.SegmentIndex(i);if(i=u.getSegmentAvailabilityEnd()<D(),z=u.isLive(),i||z){var $=Math.max(t,te+1);Q.updateEvery(w,function(){var oe=u.getSegmentAvailabilityStart();Q.evict(oe);var ae=$jscomp.makeIterator(H());ae.next(),ae=ae.next().value;for(var _e=[];$<=ae;){var ve=W($);_e.push(ve),$++}return oe>D()&&!_e.length?null:_e})}return Promise.resolve(Q)},shaka.dash.SegmentTemplate.createFromTimeline_=function(t,r,i){var n=shaka.dash.MpdUtils,s=shaka.util.ManifestParserUtils,o=t.periodInfo.start,l=t.periodInfo.duration,u=o-r.scaledPresentationTimeOffset;l=l?o+l:1/0;for(var m=[],E={},y=0;y<r.timeline.length;E={$jscomp$loop$prop$mediaTemplate$610:E.$jscomp$loop$prop$mediaTemplate$610,$jscomp$loop$prop$repId$611:E.$jscomp$loop$prop$repId$611,$jscomp$loop$prop$segmentReplacement$612:E.$jscomp$loop$prop$segmentReplacement$612,$jscomp$loop$prop$bandwidth$613:E.$jscomp$loop$prop$bandwidth$613,$jscomp$loop$prop$timeReplacement$614:E.$jscomp$loop$prop$timeReplacement$614,$jscomp$loop$prop$baseUris$615:E.$jscomp$loop$prop$baseUris$615},y++){var D=r.timeline[y],w=D.start,B=D.unscaledStart;D=D.end,E.$jscomp$loop$prop$segmentReplacement$612=y+r.startNumber,E.$jscomp$loop$prop$timeReplacement$614=B+r.unscaledPresentationTimeOffset,E.$jscomp$loop$prop$repId$611=t.representation.id,E.$jscomp$loop$prop$bandwidth$613=t.bandwidth||null,E.$jscomp$loop$prop$mediaTemplate$610=r.mediaTemplate,E.$jscomp$loop$prop$baseUris$615=t.representation.baseUris,B=function(F){return function(){goog.asserts.assert(F.$jscomp$loop$prop$mediaTemplate$610,"There should be a media template with a timeline");var V=n.fillUriTemplate(F.$jscomp$loop$prop$mediaTemplate$610,F.$jscomp$loop$prop$repId$611,F.$jscomp$loop$prop$segmentReplacement$612,F.$jscomp$loop$prop$bandwidth$613||null,F.$jscomp$loop$prop$timeReplacement$614);return s.resolveUris(F.$jscomp$loop$prop$baseUris$615,[V]).map(function(K){return K.toString()})}}(E),m.push(new shaka.media.SegmentReference(o+w,o+D,B,0,null,i,u,o,l))}return m},shaka.dash.SegmentTemplate.createInitSegment_=function(t){var r=shaka.dash.MpdUtils,i=shaka.util.ManifestParserUtils,n=r.inheritAttribute(t,shaka.dash.SegmentTemplate.fromInheritance_,"initialization");if(!n)return null;var s=t.representation.id,o=t.bandwidth||null,l=t.representation.baseUris;return t=shaka.dash.SegmentBase.createQualityInfo(t),new shaka.media.InitSegmentReference(function(){goog.asserts.assert(n,"Should have returned earler");var u=r.fillUriTemplate(n,s,null,o,null);return i.resolveUris(l,[u])},0,null,t)},shaka.util.PeriodCombiner=function(){this.variants_=[],this.audioStreams_=[],this.videoStreams_=[],this.textStreams_=[],this.imageStreams_=[],this.usedPeriodIds_=new Set},shaka.util.PeriodCombiner.prototype.release=function(){var t=this.audioStreams_.concat(this.videoStreams_,this.textStreams_,this.imageStreams_);t=$jscomp.makeIterator(t);for(var r=t.next();!r.done;r=t.next())r=r.value,r.segmentIndex&&r.segmentIndex.release();this.audioStreams_=[],this.videoStreams_=[],this.textStreams_=[],this.imageStreams_=[],this.variants_=[]},shaka.util.PeriodCombiner.prototype.getVariants=function(){return this.variants_},shaka.util.PeriodCombiner.prototype.getTextStreams=function(){return this.textStreams_.slice()},shaka.util.PeriodCombiner.prototype.getImageStreams=function(){return this.imageStreams_},shaka.util.PeriodCombiner.prototype.combinePeriods=function(t,r){var i=this,n,s,o,l,u,m,E,y,D,w,B,F,V,K,q,re,ee,H,te,W,z,X,Q,$,oe,ae,_e,ve,Pe,fe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xe){switch(xe.nextAddress){case 1:if(n=shaka.util.ManifestParserUtils.ContentType,shaka.util.PeriodCombiner.filterOutAudioStreamDuplicates_(t),shaka.util.PeriodCombiner.filterOutVideoStreamDuplicates_(t),shaka.util.PeriodCombiner.filterOutTextStreamDuplicates_(t),shaka.util.PeriodCombiner.filterOutImageStreamDuplicates_(t),!r&&t.length==1){s=t[0],i.audioStreams_=s.audioStreams,i.videoStreams_=s.videoStreams,i.textStreams_=s.textStreams,i.imageStreams_=s.imageStreams,xe.jumpTo(2);break}for(o=-1,l=0;l<t.length;l++)u=t[l],i.usedPeriodIds_.has(u.id)||(i.usedPeriodIds_.add(u.id),o==-1&&(o=l));if(o==-1)return xe.return();for(m=t.map(function(Ce){return Ce.audioStreams}),E=t.map(function(Ce){return Ce.videoStreams}),y=t.map(function(Ce){return Ce.textStreams}),D=t.map(function(Ce){return Ce.imageStreams}),w=$jscomp.makeIterator(y),B=w.next();!B.done;B=w.next())F=B.value,F.push(shaka.util.PeriodCombiner.dummyStream_(n.TEXT));for(V=$jscomp.makeIterator(D),K=V.next();!K.done;K=V.next())q=K.value,q.push(shaka.util.PeriodCombiner.dummyStream_(n.IMAGE));return xe.yield(shaka.util.PeriodCombiner.combine_(i.audioStreams_,m,o,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),3);case 3:return xe.yield(shaka.util.PeriodCombiner.combine_(i.videoStreams_,E,o,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),4);case 4:return xe.yield(shaka.util.PeriodCombiner.combine_(i.textStreams_,y,o,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),5);case 5:return xe.yield(shaka.util.PeriodCombiner.combine_(i.imageStreams_,D,o,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),2);case 2:if(re=0,ee=[],i.videoStreams_.length&&i.audioStreams_.length)for(Q=$jscomp.makeIterator(i.audioStreams_),$=Q.next();!$.done;$=Q.next())for(oe=$.value,ae=$jscomp.makeIterator(i.videoStreams_),_e=ae.next();!_e.done;_e=ae.next())ve=_e.value,Pe=shaka.media.DrmEngine.getCommonDrmInfos(oe.drmInfos,ve.drmInfos),oe.drmInfos.length&&ve.drmInfos.length&&!Pe.length?shaka.log.warning("Incompatible DRM in audio & video, skipping variant creation.",oe,ve):(fe=re++,ee.push({id:fe,language:oe.language,primary:oe.primary,audio:oe,video:ve,bandwidth:(oe.bandwidth||0)+(ve.bandwidth||0),drmInfos:Pe,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]}));else for(H=i.videoStreams_.concat(i.audioStreams_),te=$jscomp.makeIterator(H),W=te.next();!W.done;W=te.next())z=W.value,X=re++,ee.push({id:X,language:z.language,primary:z.primary,audio:z.type==n.AUDIO?z:null,video:z.type==n.VIDEO?z:null,bandwidth:z.bandwidth||0,drmInfos:z.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});i.variants_=ee,xe.jumpToEnd()}})},shaka.util.PeriodCombiner.filterOutAudioStreamDuplicates_=function(t){var r=shaka.util.ArrayUtils;t=$jscomp.makeIterator(t);for(var i=t.next();!i.done;i=t.next()){i=i.value;for(var n=[],s=$jscomp.makeIterator(i.audioStreams),o=s.next();!o.done;o=s.next()){o=o.value;for(var l=!1,u=$jscomp.makeIterator(n),m=u.next();!m.done;m=u.next())m=m.value,o.id!=m.id&&o.channelsCount==m.channelsCount&&o.language==m.language&&o.bandwidth==m.bandwidth&&o.label==m.label&&o.codecs==m.codecs&&o.mimeType==m.mimeType&&r.hasSameElements(o.roles,m.roles)&&o.audioSamplingRate==m.audioSamplingRate&&o.primary==m.primary&&(l=!0);l||n.push(o)}i.audioStreams=n}},shaka.util.PeriodCombiner.filterOutTextStreamDuplicates_=function(t){var r=shaka.util.ArrayUtils;t=$jscomp.makeIterator(t);for(var i=t.next();!i.done;i=t.next()){i=i.value;for(var n=[],s=$jscomp.makeIterator(i.textStreams),o=s.next();!o.done;o=s.next()){o=o.value;for(var l=!1,u=$jscomp.makeIterator(n),m=u.next();!m.done;m=u.next())m=m.value,o.id!=m.id&&o.language==m.language&&o.label==m.label&&o.codecs==m.codecs&&o.mimeType==m.mimeType&&o.bandwidth==m.bandwidth&&r.hasSameElements(o.roles,m.roles)&&(l=!0);l||n.push(o)}i.textStreams=n}},shaka.util.PeriodCombiner.filterOutVideoStreamDuplicates_=function(t){var r=shaka.util.ArrayUtils,i=shaka.util.MapUtils;t=$jscomp.makeIterator(t);for(var n=t.next();!n.done;n=t.next()){n=n.value;for(var s=[],o=$jscomp.makeIterator(n.videoStreams),l=o.next();!l.done;l=o.next()){l=l.value;for(var u=!1,m=$jscomp.makeIterator(s),E=m.next();!E.done;E=m.next())E=E.value,l.id!=E.id&&l.width==E.width&&l.frameRate==E.frameRate&&l.codecs==E.codecs&&l.mimeType==E.mimeType&&l.label==E.label&&r.hasSameElements(l.roles,E.roles)&&i.hasSameElements(l.closedCaptions,E.closedCaptions)&&l.bandwidth==E.bandwidth&&(u=!0);u||s.push(l)}n.videoStreams=s}},shaka.util.PeriodCombiner.filterOutImageStreamDuplicates_=function(t){t=$jscomp.makeIterator(t);for(var r=t.next();!r.done;r=t.next()){r=r.value;for(var i=[],n=$jscomp.makeIterator(r.imageStreams),s=n.next();!s.done;s=n.next()){s=s.value;for(var o=!1,l=$jscomp.makeIterator(i),u=l.next();!u.done;u=l.next())u=u.value,s.id!=u.id&&s.width==u.width&&s.codecs==u.codecs&&s.mimeType==u.mimeType&&(o=!0);o||i.push(s)}r.imageStreams=i}},shaka.util.PeriodCombiner.combineDbStreams=function(t){var r,i,n,s,o,l,u,m,E,y,D,w,B,F,V,K,q,re,ee,H,te,W,z,X,Q,$,oe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ae){switch(ae.nextAddress){case 1:if(r=shaka.util.ManifestParserUtils.ContentType,t.length==1)return ae.return(t[0]);for(i=t.map(function(_e){return _e.filter(function(ve){return ve.type==r.AUDIO})}),n=t.map(function(_e){return _e.filter(function(ve){return ve.type==r.VIDEO})}),s=t.map(function(_e){return _e.filter(function(ve){return ve.type==r.TEXT})}),o=t.map(function(_e){return _e.filter(function(ve){return ve.type==r.IMAGE})}),l=$jscomp.makeIterator(s),u=l.next();!u.done;u=l.next())m=u.value,m.push(shaka.util.PeriodCombiner.dummyStreamDB_(r.TEXT));for(E=$jscomp.makeIterator(o),y=E.next();!y.done;y=E.next())D=y.value,D.push(shaka.util.PeriodCombiner.dummyStreamDB_(r.IMAGE));return ae.yield(shaka.util.PeriodCombiner.combine_([],i,0,shaka.util.PeriodCombiner.cloneStreamDB_,shaka.util.PeriodCombiner.concatenateStreamDBs_),2);case 2:return w=ae.yieldResult,ae.yield(shaka.util.PeriodCombiner.combine_([],n,0,shaka.util.PeriodCombiner.cloneStreamDB_,shaka.util.PeriodCombiner.concatenateStreamDBs_),3);case 3:return B=ae.yieldResult,ae.yield(shaka.util.PeriodCombiner.combine_([],s,0,shaka.util.PeriodCombiner.cloneStreamDB_,shaka.util.PeriodCombiner.concatenateStreamDBs_),4);case 4:return F=ae.yieldResult,ae.yield(shaka.util.PeriodCombiner.combine_([],o,0,shaka.util.PeriodCombiner.cloneStreamDB_,shaka.util.PeriodCombiner.concatenateStreamDBs_),5);case 5:if(V=ae.yieldResult,K=0,B.length&&w.length)for(te=$jscomp.makeIterator(w),W=te.next();!W.done;W=te.next())for(z=W.value,X=$jscomp.makeIterator(B),Q=X.next();!Q.done;Q=X.next())$=Q.value,oe=K++,$.variantIds.push(oe),z.variantIds.push(oe);else for(q=B.concat(w),re=$jscomp.makeIterator(q),ee=re.next();!ee.done;ee=re.next())H=ee.value,H.variantIds=[K++];return ae.return(B.concat(w).concat(F).concat(V))}})},shaka.util.PeriodCombiner.combine_=function(t,r,i,n,s){var o,l,u,m,E,y,D,w,B,F,V,K,q,re,ee,H,te,W,z,X,Q;return $jscomp.asyncExecutePromiseGeneratorProgram(function($){switch($.nextAddress){case 1:for(o=shaka.util.ManifestParserUtils.ContentType,l=[],u=0;u<r.length;u++)u>=i?l.push(new Set(r[u])):l.push(new Set);m=$jscomp.makeIterator(t),E=m.next();case 2:if(E.done){$.jumpTo(4);break}return y=E.value,$.yield(shaka.util.PeriodCombiner.extendExistingOutputStream_(y,r,i,s,l),5);case 5:if(D=$.yieldResult,!D)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.PERIOD_FLATTENING_FAILED);E=m.next(),$.jumpTo(2);break;case 4:for(w=$jscomp.makeIterator(l),B=w.next();!B.done;B=w.next())for(F=B.value,V=$jscomp.makeIterator(F),K=V.next();!K.done;K=V.next())q=K.value,(re=shaka.util.PeriodCombiner.createNewOutputStream_(q,r,n,s,l))&&t.push(re);for(ee=$jscomp.makeIterator(l),B=ee.next();!B.done;B=ee.next())for(H=B.value,te={},W=$jscomp.makeIterator(H),K=W.next();!K.done;te={$jscomp$loop$prop$stream$498$617:te.$jscomp$loop$prop$stream$498$617},K=W.next())if(te.$jscomp$loop$prop$stream$498$617=K.value,z=te.$jscomp$loop$prop$stream$498$617.type==o.TEXT&&!te.$jscomp$loop$prop$stream$498$617.language,X=te.$jscomp$loop$prop$stream$498$617.type==o.IMAGE&&!te.$jscomp$loop$prop$stream$498$617.tilesLayout,!z&&!X&&(Q=t.some(function(oe){return function(ae){return ae.mimeType==oe.$jscomp$loop$prop$stream$498$617.mimeType&&shaka.util.MimeUtils.getNormalizedCodec(ae.codecs)==shaka.util.MimeUtils.getNormalizedCodec(oe.$jscomp$loop$prop$stream$498$617.codecs)}}(te))))throw shaka.log.error("Unused stream in period-flattening!",te.$jscomp$loop$prop$stream$498$617,t),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.PERIOD_FLATTENING_FAILED);return $.return(t)}})},shaka.util.PeriodCombiner.extendExistingOutputStream_=function(t,r,i,n,s){return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return o.nextAddress==1?(shaka.util.PeriodCombiner.findMatchesInAllPeriods_(r,t),goog.asserts.assert(t.createSegmentIndex,"outputStream should be a Stream type!"),t.matchedStreams?t.segmentIndex?o.yield(shaka.util.PeriodCombiner.extendOutputSegmentIndex_(t,i),2):o.jumpTo(2):(shaka.log.error("No matches extending output stream!",t,r),o.return(!1))):(shaka.util.PeriodCombiner.extendOutputStream_(t,i,n,s),o.return(!0))})},shaka.util.PeriodCombiner.extendOutputSegmentIndex_=function(t,r){var i,n,s,o,l,u,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){if(E.nextAddress==1){for(i=[],n=t.matchedStreams,goog.asserts.assert(n,"matched streams should be valid"),s=$jscomp.makeIterator(n),o=s.next();!o.done;o=s.next())l=o.value,i.push(l.createSegmentIndex()),l.trickModeVideo&&!l.trickModeVideo.segmentIndex&&i.push(l.trickModeVideo.createSegmentIndex());return E.yield(Promise.all(i),2)}if(t.segmentIndex instanceof shaka.media.MetaSegmentIndex)for(u=0;u<n.length;u++)m=n[u],m.segmentIndex&&u>=r&&(goog.asserts.assert(m.segmentIndex,"stream should have a segmentIndex."),t.segmentIndex.appendSegmentIndex(m.segmentIndex));E.jumpToEnd()})},shaka.util.PeriodCombiner.createNewOutputStream_=function(t,r,i,n,s){var o=i(t);return shaka.util.PeriodCombiner.findMatchesInAllPeriods_(r,o),o.createSegmentIndex&&(o.createSegmentIndex=function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){return o.segmentIndex?l.jumpTo(0):(o.segmentIndex=new shaka.media.MetaSegmentIndex,l.yield(shaka.util.PeriodCombiner.extendOutputSegmentIndex_(o,0),0))})}),o.matchedStreams?(shaka.util.PeriodCombiner.extendOutputStream_(o,0,n,s),o):null},shaka.util.PeriodCombiner.extendOutputStream_=function(t,r,i,n){var s=shaka.util.ManifestParserUtils.ContentType,o=shaka.util.LanguageUtils,l=t.matchedStreams;goog.asserts.assert(t.matchedStreams,"matchedStreams should be non-null");for(var u=0;u<l.length;u++)if(u>=r){var m=l[u];i(t,m);var E=!0;t.type==s.AUDIO&&o.relatedness(t.language,m.language)==0&&(E=!1),E&&n[u].delete(m)}},shaka.util.PeriodCombiner.cloneStream_=function(t){var r=Object.assign({},t);return r.originalId=null,r.createSegmentIndex=function(){return Promise.resolve()},r.closeSegmentIndex=function(){if(r.segmentIndex&&(r.segmentIndex.release(),r.segmentIndex=null),r.matchedStreams)for(var i=$jscomp.makeIterator(r.matchedStreams),n=i.next();!n.done;n=i.next())n=n.value,n.segmentIndex&&(n.segmentIndex.release(),n.segmentIndex=null)},r.segmentIndex=null,r.emsgSchemeIdUris=[],r.keyIds=new Set,r.closedCaptions=null,r.trickModeVideo=null,r},shaka.util.PeriodCombiner.cloneStreamDB_=function(t){return t=Object.assign({},t),t.keyIds=new Set,t.segments=[],t.variantIds=[],t.closedCaptions=null,t},shaka.util.PeriodCombiner.concatenateStreams_=function(t,r){t.roles=Array.from(new Set(t.roles.concat(r.roles))),r.emsgSchemeIdUris&&(t.emsgSchemeIdUris=Array.from(new Set(t.emsgSchemeIdUris.concat(r.emsgSchemeIdUris)))),t.keyIds=function(o,l){return new Set([].concat($jscomp.arrayFromIterable(o),$jscomp.arrayFromIterable(l)))}(t.keyIds,r.keyIds),t.originalId=t.originalId==null?r.originalId:t.originalId+(","+(r.originalId||""));var i=shaka.media.DrmEngine.getCommonDrmInfos(t.drmInfos,r.drmInfos);if(r.drmInfos.length&&t.drmInfos.length&&!i.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.INCONSISTENT_DRM_ACROSS_PERIODS);if(t.drmInfos=i,t.encrypted=t.encrypted||r.encrypted,r.closedCaptions){t.closedCaptions||(t.closedCaptions=new Map),i=$jscomp.makeIterator(r.closedCaptions);for(var n=i.next();!n.done;n=i.next()){var s=$jscomp.makeIterator(n.value);n=s.next().value,s=s.next().value,t.closedCaptions.set(n,s)}}r.trickModeVideo?(t.trickModeVideo||(t.trickModeVideo=shaka.util.PeriodCombiner.cloneStream_(r.trickModeVideo),t.trickModeVideo.createSegmentIndex=function(){return goog.asserts.assert(t.segmentIndex instanceof shaka.media.MetaSegmentIndex,"The stream should have a MetaSegmentIndex."),t.trickModeVideo.segmentIndex=t.segmentIndex.clone(),Promise.resolve()}),shaka.util.PeriodCombiner.concatenateStreams_(t.trickModeVideo,r.trickModeVideo)):t.trickModeVideo&&shaka.util.PeriodCombiner.concatenateStreams_(t.trickModeVideo,r)},shaka.util.PeriodCombiner.concatenateStreamDBs_=function(t,r){t.roles=Array.from(new Set(t.roles.concat(r.roles)));var i=r.keyIds;if(i=new Set([].concat($jscomp.arrayFromIterable(t.keyIds),$jscomp.arrayFromIterable(i))),t.keyIds=i,t.encrypted=t.encrypted&&r.encrypted,t.segments.push.apply(t.segments,$jscomp.arrayFromIterable(r.segments)),r.closedCaptions){t.closedCaptions||(t.closedCaptions=new Map),i=$jscomp.makeIterator(r.closedCaptions);for(var n=i.next();!n.done;n=i.next()){var s=$jscomp.makeIterator(n.value);n=s.next().value,s=s.next().value,t.closedCaptions.set(n,s)}}},shaka.util.PeriodCombiner.findMatchesInAllPeriods_=function(t,r){for(var i=[],n=$jscomp.makeIterator(t),s=n.next();!s.done;s=n.next()){if(s=shaka.util.PeriodCombiner.findBestMatchInPeriod_(s.value,r),!s)return;i.push(s)}r.matchedStreams=i},shaka.util.PeriodCombiner.findBestMatchInPeriod_=function(t,r){for(var i={audio:shaka.util.PeriodCombiner.areAVStreamsCompatible_,video:shaka.util.PeriodCombiner.areAVStreamsCompatible_,text:shaka.util.PeriodCombiner.areTextStreamsCompatible_,image:shaka.util.PeriodCombiner.areImageStreamsCompatible_}[r.type],n={audio:shaka.util.PeriodCombiner.isAudioStreamBetterMatch_,video:shaka.util.PeriodCombiner.isVideoStreamBetterMatch_,text:shaka.util.PeriodCombiner.isTextStreamBetterMatch_,image:shaka.util.PeriodCombiner.isImageStreamBetterMatch_}[r.type],s=null,o=$jscomp.makeIterator(t),l=o.next();!l.done;l=o.next())l=l.value,!i(r,l)||s&&!n(r,s,l)||(s=l);return s},shaka.util.PeriodCombiner.areAVStreamsCompatible_=function(t,r){return!(r.mimeType!=t.mimeType||shaka.util.MimeUtils.getNormalizedCodec(r.codecs)!=shaka.util.MimeUtils.getNormalizedCodec(t.codecs)||t.drmInfos&&!shaka.media.DrmEngine.areDrmCompatible(t.drmInfos,r.drmInfos))},shaka.util.PeriodCombiner.areTextStreamsCompatible_=function(t,r){return t.language?r.language?!(shaka.util.LanguageUtils.relatedness(t.language,r.language)==0||r.kind!=t.kind):!0:!1},shaka.util.PeriodCombiner.areImageStreamsCompatible_=function(t,r){return!!t.tilesLayout},shaka.util.PeriodCombiner.isAudioStreamBetterMatch_=function(t,r,i){var n=shaka.util.LanguageUtils,s=shaka.util.PeriodCombiner.BetterOrWorse,o=s.BETTER;if(s=s.WORSE,t.id==i.id)return!0;var l=n.relatedness(t.language,r.language);return n=n.relatedness(t.language,i.language),n>l?!0:n<l?!1:!r.primary&&i.primary?!0:r.primary&&!i.primary?!1:t.roles.length?(o=r.roles.filter(function(u){return t.roles.includes(u)}),s=i.roles.filter(function(u){return t.roles.includes(u)}),s.length>o.length?!0:s.length<o.length?!1:i.roles.length<r.roles.length):!i.roles.length&&r.roles.length?!0:i.roles.length&&!r.roles.length?!1:(n=shaka.util.PeriodCombiner.compareClosestPreferLower(t.channelsCount,r.channelsCount,i.channelsCount),n==o?!0:n==s?!1:(n=shaka.util.PeriodCombiner.compareClosestPreferLower(t.audioSamplingRate,r.audioSamplingRate,i.audioSamplingRate),n==o?!0:n==s?!1:!!(t.bandwidth&&shaka.util.PeriodCombiner.compareClosestPreferMinimalAbsDiff_(t.bandwidth,r.bandwidth,i.bandwidth)==o)))},shaka.util.PeriodCombiner.isVideoStreamBetterMatch_=function(t,r,i){var n=shaka.util.PeriodCombiner.BetterOrWorse,s=n.BETTER;if(n=n.WORSE,t.id==i.id)return!0;var o=shaka.util.PeriodCombiner.compareClosestPreferLower(t.width*t.height,r.width*r.height,i.width*i.height);if(o==s)return!0;if(o==n)return!1;if(t.frameRate){if(o=shaka.util.PeriodCombiner.compareClosestPreferLower(t.frameRate,r.frameRate,i.frameRate),o==s)return!0;if(o==n)return!1}return!!(t.bandwidth&&shaka.util.PeriodCombiner.compareClosestPreferMinimalAbsDiff_(t.bandwidth,r.bandwidth,i.bandwidth)==s)},shaka.util.PeriodCombiner.isTextStreamBetterMatch_=function(t,r,i){var n=shaka.util.LanguageUtils;if(t.id==i.id)return!0;var s=n.relatedness(t.language,r.language);if(n=n.relatedness(t.language,i.language),n>s)return!0;if(n<s)return!1;if(!r.primary&&i.primary)return!0;if(r.primary&&!i.primary)return!1;if(t.roles.length){if(s=r.roles.filter(function(o){return t.roles.includes(o)}),n=i.roles.filter(function(o){return t.roles.includes(o)}),n.length>s.length)return!0;if(n.length<s.length)return!1}else{if(!i.roles.length&&r.roles.length)return!0;if(i.roles.length&&!r.roles.length)return!1}return!(i.mimeType!=t.mimeType||i.codecs!=t.codecs||r.mimeType==t.mimeType&&r.codecs==t.codecs)},shaka.util.PeriodCombiner.isImageStreamBetterMatch_=function(t,r,i){var n=shaka.util.PeriodCombiner.BetterOrWorse.BETTER;return t.id==i.id?!0:shaka.util.PeriodCombiner.compareClosestPreferLower(t.width*t.height,r.width*r.height,i.width*i.height)==n},shaka.util.PeriodCombiner.dummyStreamDB_=function(t){return{id:0,originalId:"",primary:!1,type:t,mimeType:"",codecs:"",language:"",label:null,width:null,height:null,encrypted:!1,keyIds:new Set,segments:[],variantIds:[],roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}},shaka.util.PeriodCombiner.dummyStream_=function(t){return{id:0,originalId:"",createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new shaka.media.SegmentIndex([]),mimeType:"",codecs:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"",label:null,type:t,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}},shaka.util.PeriodCombiner.compareClosestPreferLower=function(t,r,i){var n=shaka.util.PeriodCombiner.BetterOrWorse,s=n.BETTER,o=n.WORSE;if(r==t&&t!=i)return o;if(i==t&&t!=r)return s;if(r>t){if(i<=t||i-t<r-t)return s;if(i-t>r-t)return o}else{if(i>t)return o;if(t-i<t-r)return s;if(t-i>t-r)return o}return n.EQUAL},shaka.util.PeriodCombiner.compareClosestPreferMinimalAbsDiff_=function(t,r,i){var n=shaka.util.PeriodCombiner.BetterOrWorse,s=n.BETTER,o=n.WORSE;return r=Math.abs(t-r),t=Math.abs(t-i),t<r?s:r<t?o:n.EQUAL},shaka.util.PeriodCombiner.BetterOrWorse={BETTER:1,EQUAL:0,WORSE:-1},shaka.dash.DashParser=function(){var t=this;this.playerInterface_=this.config_=null,this.manifestUris_=[],this.manifest_=null,this.globalId_=1,this.streamMap_={},this.periodDurations_={},this.periodCombiner_=new shaka.util.PeriodCombiner,this.updatePeriod_=0,this.averageUpdateDuration_=new shaka.abr.Ewma(5),this.updateTimer_=new shaka.util.Timer(function(){t.onUpdate_()}),this.operationManager_=new shaka.util.OperationManager,this.largestPeriodStartTime_=null,this.lastManifestUpdatePeriodIds_=[],this.minTotalAvailabilityTimeOffset_=1/0,this.lowLatencyMode_=!1},shaka.dash.DashParser.prototype.configure=function(t){goog.asserts.assert(t.dash!=null,"DashManifestConfiguration should not be null!"),this.config_=t},shaka.dash.DashParser.prototype.start=function(t,r){var i=this,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){if(s.nextAddress==1)return goog.asserts.assert(i.config_,"Must call configure() before start()!"),i.lowLatencyMode_=r.isLowLatencyMode(),i.manifestUris_=[t],i.playerInterface_=r,s.yield(i.requestManifest_(),2);if(n=s.yieldResult,i.playerInterface_&&i.setUpdateTimer_(n),!i.playerInterface_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);return goog.asserts.assert(i.manifest_,"Manifest should be non-null!"),s.return(i.manifest_)})},shaka.dash.DashParser.prototype.stop=function(){for(var t=$jscomp.makeIterator(Object.values(this.streamMap_)),r=t.next();!r.done;r=t.next())r=r.value,r.segmentIndex&&r.segmentIndex.release();return this.periodCombiner_&&this.periodCombiner_.release(),this.config_=this.playerInterface_=null,this.manifestUris_=[],this.manifest_=null,this.streamMap_={},this.periodCombiner_=null,this.updateTimer_!=null&&(this.updateTimer_.stop(),this.updateTimer_=null),this.operationManager_.destroy()},shaka.dash.DashParser.prototype.update=function(){var t=this,r;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){if(i.nextAddress==1)return i.setCatchFinallyBlocks(2),i.yield(t.requestManifest_(),4);if(i.nextAddress!=2)return i.leaveTryBlock(0);if(r=i.enterCatchBlock(),!t.playerInterface_||!r)return i.return();goog.asserts.assert(r instanceof shaka.util.Error,"Bad error type"),t.playerInterface_.onError(r),i.jumpToEnd()})},shaka.dash.DashParser.prototype.onExpirationUpdated=function(t,r){},shaka.dash.DashParser.prototype.requestManifest_=function(){var t=this,r,i,n,s,o,l,u,m,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){return y.nextAddress==1?(r=shaka.net.NetworkingEngine.RequestType.MANIFEST,i=shaka.net.NetworkingEngine.makeRequest(t.manifestUris_,t.config_.retryParameters),n=t.playerInterface_.networkingEngine,s=shaka.util.CmcdManager.StreamingFormat.DASH,t.playerInterface_.modifyManifestRequest(i,{format:s}),o=Date.now(),l=n.request(r,i),t.operationManager_.manage(l),y.yield(l.promise,2)):y.nextAddress!=3?(u=y.yieldResult,t.playerInterface_?(u.uri&&!t.manifestUris_.includes(u.uri)&&t.manifestUris_.unshift(u.uri),y.yield(t.parseManifest_(u.data,u.uri),3)):y.return(0)):(m=Date.now(),E=(m-o)/1e3,t.averageUpdateDuration_.sample(1,E),y.return(E))})},shaka.dash.DashParser.prototype.parseManifest_=function(t,r){var i=this,n,s,o,l,u,m,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){if(y.nextAddress==1){if(n=shaka.util.Error,s=shaka.dash.MpdUtils,o=shaka.util.XmlUtils.parseXml(t,"MPD"),!o)throw new n(n.Severity.CRITICAL,n.Category.MANIFEST,n.Code.DASH_INVALID_XML,r);return(l=i.config_.dash.disableXlinkProcessing)?y.return(i.processManifest_(o,r)):(u=i.config_.dash.xlinkFailGracefully,m=s.processXlinks(o,i.config_.retryParameters,u,r,i.playerInterface_.networkingEngine),i.operationManager_.manage(m),y.yield(m.promise,2))}return E=y.yieldResult,y.return(i.processManifest_(E,r))})},shaka.dash.DashParser.prototype.processManifest_=function(t,r){var i=this,n,s,o,l,u,m,E,y,D,w,B,F,V,K,q,re,ee,H,te,W,z,X,Q,$,oe,ae,_e,ve,Pe,fe,xe,Ce,De,ke,Xe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(et){switch(et.nextAddress){case 1:if(n=shaka.util.Functional,s=shaka.util.XmlUtils,(o=i.config_.dash.manifestPreprocessor)&&o(t),l=[r],u=s.findChildren(t,"Location").map(s.getContents).filter(n.isNotNull),0<u.length&&(m=shaka.util.ManifestParserUtils.resolveUris(l,u),l=i.manifestUris_=m),E=s.findChildren(t,"BaseURL"),y=E.map(s.getContents),D=shaka.util.ManifestParserUtils.resolveUris(l,y),w=0,E&&E.length&&(w=s.parseAttr(E[0],"availabilityTimeOffset",s.parseFloat)||0),B=i.config_.dash.ignoreMinBufferTime,F=0,B||(F=s.parseAttr(t,"minBufferTime",s.parseDuration)||0),i.updatePeriod_=s.parseAttr(t,"minimumUpdatePeriod",s.parseDuration,-1),V=s.parseAttr(t,"availabilityStartTime",s.parseDate),K=s.parseAttr(t,"timeShiftBufferDepth",s.parseDuration),q=i.config_.dash.ignoreSuggestedPresentationDelay,re=null,q||(re=s.parseAttr(t,"suggestedPresentationDelay",s.parseDuration)),ee=i.config_.dash.ignoreMaxSegmentDuration,H=null,ee||(H=s.parseAttr(t,"maxSegmentDuration",s.parseDuration)),te=t.getAttribute("type")||"static",i.manifest_)for(W=i.manifest_.presentationTimeline,z=$jscomp.makeIterator(Object.values(i.streamMap_)),X=z.next();!X.done;X=z.next())Q=X.value,Q.segmentIndex&&Q.segmentIndex.evict(W.getSegmentAvailabilityStart());else $=i.config_.defaultPresentationDelay||1.5*F,oe=re??$,W=new shaka.media.PresentationTimeline(V,oe,i.config_.dash.autoCorrectDrift);return W.setStatic(te=="static"),(ae=W.isLive())&&!isNaN(i.config_.availabilityWindowOverride)&&(K=i.config_.availabilityWindowOverride),K==null&&(K=1/0),W.setSegmentAvailabilityDuration(K),_e=t.getAttribute("profiles")||"",ve={dynamic:te!="static",presentationTimeline:W,period:null,periodInfo:null,adaptationSet:null,representation:null,bandwidth:0,indexRangeWarningGiven:!1,availabilityTimeOffset:w,profiles:_e.split(",")},Pe=i.parsePeriods_(ve,D,t),fe=Pe.duration,xe=Pe.periods,te!="static"&&Pe.durationDerivedFromPeriods||W.setDuration(fe||1/0),i.minTotalAvailabilityTimeOffset_&&!i.lowLatencyMode_&&(Ce=i.playerInterface_.isAutoLowLatencyMode())&&(i.playerInterface_.enableLowLatencyMode(),i.lowLatencyMode_=i.playerInterface_.isLowLatencyMode()),i.lowLatencyMode_?W.setAvailabilityTimeOffset(i.minTotalAvailabilityTimeOffset_):i.minTotalAvailabilityTimeOffset_&&shaka.log.alwaysWarn("Low-latency DASH live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."),W.notifyMaxSegmentDuration(H||1),goog.DEBUG&&W.assertIsValid(),et.yield(i.periodCombiner_.combinePeriods(xe,ve.dynamic),2);case 2:if(i.manifest_){i.manifest_.variants=i.periodCombiner_.getVariants(),i.manifest_.textStreams=i.periodCombiner_.getTextStreams(),i.manifest_.imageStreams=i.periodCombiner_.getImageStreams(),i.playerInterface_.filter(i.manifest_),et.jumpTo(3);break}if(i.manifest_={presentationTimeline:W,variants:i.periodCombiner_.getVariants(),textStreams:i.periodCombiner_.getTextStreams(),imageStreams:i.periodCombiner_.getImageStreams(),offlineSessionIds:[],minBufferTime:F||0},!W.usingPresentationStartTime()){et.jumpTo(4);break}return De=shaka.util.XmlUtils,ke=De.findChildren(t,"UTCTiming"),et.yield(i.parseUtcTiming_(D,ke),5);case 5:if(Xe=et.yieldResult,!i.playerInterface_)return et.return();W.setClockOffset(Xe);case 4:W.lockStartTime();case 3:i.playerInterface_.makeTextStreamsForClosedCaptions(i.manifest_),et.jumpToEnd()}})},shaka.dash.DashParser.prototype.parsePeriods_=function(t,r,i){var n=shaka.util.XmlUtils,s=n.parseAttr(i,"mediaPresentationDuration",n.parseDuration),o=[],l=0;i=n.findChildren(i,"Period");for(var u=0;u<i.length;u++){var m=i[u],E=i[u+1],y=n.parseAttr(m,"start",n.parseDuration,l),D=m.id,w=n.parseAttr(m,"duration",n.parseDuration),B=null;if(E){var F=n.parseAttr(E,"start",n.parseDuration);F!=null&&(B=F-y)}else s!=null&&(B=s-y);if(F=shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS,B&&w&&Math.abs(B-w)>F&&shaka.log.warning("There is a gap/overlap between Periods",m),B==null&&(B=w),this.largestPeriodStartTime_!==null&&D!==null&&y!==null&&y<this.largestPeriodStartTime_&&!this.lastManifestUpdatePeriodIds_.includes(D)&&u+1!=i.length)shaka.log.debug("Skipping Period with ID "+D+" as its start time is smaller than the largest period start time that has been seen, and ID is unseen before");else{if(y!==null&&(this.largestPeriodStartTime_===null||y>this.largestPeriodStartTime_)&&(this.largestPeriodStartTime_=y),l=this.parsePeriod_(t,r,{start:y,duration:B,node:m,isLastPeriod:B==null||!E}),o.push(l),t.period.id&&B&&(this.periodDurations_[t.period.id]=B),B==null){E&&shaka.log.warning("Skipping Period",u+1,"and any subsequent Periods:","Period",u+1,"does not have a valid start time.",E),l=null;break}l=y+B}}return this.lastManifestUpdatePeriodIds_=o.map(function(V){return V.id}),s!=null?(l!=s&&shaka.log.warning("@mediaPresentationDuration does not match the total duration of ","all Periods."),{periods:o,duration:s,durationDerivedFromPeriods:!1}):{periods:o,duration:l,durationDerivedFromPeriods:!0}},shaka.dash.DashParser.prototype.parsePeriod_=function(t,r,i){var n=this,s=shaka.util.Functional,o=shaka.util.XmlUtils,l=shaka.util.ManifestParserUtils.ContentType;t.period=this.createFrame_(i.node,null,r),t.periodInfo=i,t.period.availabilityTimeOffset=t.availabilityTimeOffset,t.period.id||(shaka.log.info("No Period ID given for Period with start time "+i.start+",  Assigning a default"),t.period.id="__shaka_period_"+i.start);var u=o.findChildren(i.node,"EventStream");r=t.presentationTimeline.getSegmentAvailabilityStart(),u=$jscomp.makeIterator(u);for(var m=u.next();!m.done;m=u.next())this.parseEventStream_(i.start,i.duration,m.value,r);if(s=o.findChildren(i.node,"AdaptationSet").map(function(D){return n.parseAdaptationSet_(t,D)}).filter(s.isNotNull),t.dynamic){for(i=[],o=$jscomp.makeIterator(s),r=o.next();!r.done;r=o.next())for(r=$jscomp.makeIterator(r.value.representationIds),u=r.next();!u.done;u=r.next())i.push(u.value);if(o=new Set(i),i.length!=o.size)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_DUPLICATE_REPRESENTATION_ID)}for(i=s.filter(function(D){return!D.trickModeFor}),s=s.filter(function(D){return D.trickModeFor}),s=$jscomp.makeIterator(s),o=s.next();!o.done;o=s.next())for(o=o.value,r=o.trickModeFor.split(" "),u=$jscomp.makeIterator(i),m=u.next();!m.done;m=u.next()){var E=m.value;if(r.includes(E.id)){m={},E=$jscomp.makeIterator(E.streams);for(var y=E.next();!y.done;m={$jscomp$loop$prop$stream$619:m.$jscomp$loop$prop$stream$619},y=E.next())m.$jscomp$loop$prop$stream$619=y.value,m.$jscomp$loop$prop$stream$619.trickModeVideo=o.streams.find(function(D){return function(w){return shaka.util.MimeUtils.getNormalizedCodec(D.$jscomp$loop$prop$stream$619.codecs)==shaka.util.MimeUtils.getNormalizedCodec(w.codecs)}}(m))}}if(o=this.config_.disableAudio?[]:this.getSetsOfType_(i,l.AUDIO),r=this.config_.disableVideo?[]:this.getSetsOfType_(i,l.VIDEO),s=this.config_.disableText?[]:this.getSetsOfType_(i,l.TEXT),i=this.config_.disableThumbnails?[]:this.getSetsOfType_(i,l.IMAGE),!r.length&&!o.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_EMPTY_PERIOD);for(l=[],o=$jscomp.makeIterator(o),u=o.next();!u.done;u=o.next())l.push.apply(l,$jscomp.arrayFromIterable(u.value.streams));for(o=[],r=$jscomp.makeIterator(r),u=r.next();!u.done;u=r.next())o.push.apply(o,$jscomp.arrayFromIterable(u.value.streams));for(r=[],s=$jscomp.makeIterator(s),u=s.next();!u.done;u=s.next())r.push.apply(r,$jscomp.arrayFromIterable(u.value.streams));for(s=[],i=$jscomp.makeIterator(i),u=i.next();!u.done;u=i.next())s.push.apply(s,$jscomp.arrayFromIterable(u.value.streams));return{id:t.period.id,audioStreams:l,videoStreams:o,textStreams:r,imageStreams:s}},shaka.dash.DashParser.prototype.getSetsOfType_=function(t,r){return t.filter(function(i){return i.contentType==r})},shaka.dash.DashParser.prototype.parseAdaptationSet_=function(t,r){var i=this,n=shaka.util.XmlUtils,s=shaka.util.Functional,o=shaka.util.ManifestParserUtils,l=o.ContentType,u=shaka.dash.ContentProtection;t.adaptationSet=this.createFrame_(r,t.period,null);var m=!1,E=n.findChildren(r,"Role"),y=E.map(function($){return $.getAttribute("value")}).filter(s.isNotNull),D=void 0;(s=t.adaptationSet.contentType==l.TEXT)&&(D=o.TextStreamKind.SUBTITLE),E=$jscomp.makeIterator(E);for(var w=E.next();!w.done;w=E.next()){w=w.value;var B=w.getAttribute("schemeIdUri");if(B==null||B=="urn:mpeg:dash:role:2011")switch(w=w.getAttribute("value"),w){case"main":m=!0;break;case"caption":case"subtitle":D=w}}var F;B=function($){switch($){case 1:case 6:case 13:case 14:case 15:return"SDR";case 16:return"PQ";case 18:return"HLG"}};var V=n.findChildren(r,"EssentialProperty");E=null,w=!1,V=$jscomp.makeIterator(V);for(var K=V.next();!K.done;K=V.next()){K=K.value;var q=K.getAttribute("schemeIdUri");q=="http://dashif.org/guidelines/trickmode"?E=K.getAttribute("value"):q=="urn:mpeg:mpegB:cicp:TransferCharacteristics"?F=B(parseInt(K.getAttribute("value"),10)):w=!0}for(V=n.findChildren(r,"SupplementalProperty"),V=$jscomp.makeIterator(V),K=V.next();!K.done;K=V.next())K=K.value,K.getAttribute("schemeIdUri")=="urn:mpeg:mpegB:cicp:TransferCharacteristics"&&(F=B(parseInt(K.getAttribute("value"),10)));V=n.findChildren(r,"Accessibility"),B=shaka.util.LanguageUtils;var re=new Map;for(V=$jscomp.makeIterator(V),K=V.next();!K.done;K=V.next())if(q=K.value,K=q.getAttribute("schemeIdUri"),q=q.getAttribute("value"),K=="urn:scte:dash:cc:cea-608:2015")if(K=1,q!=null){q=q.split(";");for(var ee=$jscomp.makeIterator(q),H=ee.next();!H.done;H=ee.next()){var te=H.value,W=H=void 0;te.includes("=")?(te=te.split("="),H=te[0].startsWith("CC")?te[0]:"CC"+te[0],W=te[1]||"und"):(H="CC"+K,q.length==2?K+=2:K++,W=te),re.set(H,B.normalize(W))}}else re.set("CC1","und");else if(K=="urn:scte:dash:cc:cea-708:2015")if(K=1,q!=null)for(q=$jscomp.makeIterator(q.split(";")),H=q.next();!H.done;H=q.next())H=H.value,te=ee=void 0,H.includes("=")?(H=H.split("="),ee="svc"+H[0],te=H[1].split(",")[0].split(":").pop()):(ee="svc"+K,K++,te=H),re.set(ee,B.normalize(te));else re.set("svc1","und");else K=="urn:mpeg:dash:role:2011"&&q!=null&&(y.push(q),q=="captions"&&(D=o.TextStreamKind.CLOSED_CAPTION));if(w)return null;o=n.findChildren(r,"ContentProtection");var z=u.parseFromAdaptationSet(o,this.config_.dash.ignoreDrmInfo,this.config_.dash.keySystemsByURI),X=shaka.util.LanguageUtils.normalize(r.getAttribute("lang")||"und"),Q=r.getAttribute("label");if((u=n.findChildren(r,"Label"))&&u.length&&(u=u[0],u.textContent&&(Q=u.textContent)),u=n.findChildren(r,"Representation"),n=u.map(function($){return($=i.parseRepresentation_(t,z,D,X,Q,m,y,re,$))&&($.hdr=$.hdr||F),$}).filter(function($){return!!$}),n.length==0){if(E=t.adaptationSet.contentType==l.IMAGE,this.config_.dash.ignoreEmptyAdaptationSet||s||E)return null;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_EMPTY_ADAPTATION_SET)}if(!t.adaptationSet.contentType||t.adaptationSet.contentType==l.APPLICATION)for(t.adaptationSet.contentType=shaka.dash.DashParser.guessContentType_(n[0].mimeType,n[0].codecs),l=$jscomp.makeIterator(n),s=l.next();!s.done;s=l.next())s.value.type=t.adaptationSet.contentType;for(l=$jscomp.makeIterator(n),s=l.next();!s.done;s=l.next())for(s=s.value,o=$jscomp.makeIterator(z.drmInfos),w=o.next();!w.done;w=o.next())w=w.value,w.keyIds=w.keyIds&&s.keyIds?new Set([].concat($jscomp.arrayFromIterable(w.keyIds),$jscomp.arrayFromIterable(s.keyIds))):w.keyIds||s.keyIds;return l=u.map(function($){return $.getAttribute("id")}).filter(shaka.util.Functional.isNotNull),{id:t.adaptationSet.id||"__fake__"+this.globalId_++,contentType:t.adaptationSet.contentType,language:X,main:m,streams:n,drmInfos:z.drmInfos,trickModeFor:E,representationIds:l}},shaka.dash.DashParser.prototype.parseRepresentation_=function(t,r,i,n,s,o,l,u,m){var E=this,y=shaka.util.XmlUtils,D=shaka.util.ManifestParserUtils.ContentType;if(t.representation=this.createFrame_(m,t.adaptationSet,null),this.minTotalAvailabilityTimeOffset_=Math.min(this.minTotalAvailabilityTimeOffset_,t.representation.availabilityTimeOffset),!this.verifyRepresentation_(t.representation))return shaka.log.warning("Skipping Representation",t.representation),null;var w=t.periodInfo.start;t.bandwidth=y.parseAttr(m,"bandwidth",y.parsePositiveInt)||0;var B=t.representation.contentType,F=B==D.TEXT||B==D.APPLICATION;D=B==D.IMAGE;try{if(B=function(X,Q,$){return E.requestInitSegment_(X,Q,$)},t.representation.segmentBase)var V=shaka.dash.SegmentBase.createStreamInfo(t,B);else if(t.representation.segmentList)V=shaka.dash.SegmentList.createStreamInfo(t,this.streamMap_);else if(t.representation.segmentTemplate)V=shaka.dash.SegmentTemplate.createStreamInfo(t,B,this.streamMap_,!!this.manifest_,this.config_.dash.initialSegmentLimit,this.periodDurations_);else{goog.asserts.assert(F,"Must have Segment* with non-text streams.");var K=t.representation.baseUris,q=t.periodInfo.duration||0;V={generateSegmentIndex:function(){return Promise.resolve(shaka.media.SegmentIndex.forSingleSegment(w,q,K))}}}}catch(X){if((F||D)&&X.code==shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)return null;throw X}B=y.findChildren(m,"ContentProtection"),B=shaka.dash.ContentProtection.parseFromRepresentation(B,r,this.config_.dash.ignoreDrmInfo,this.config_.dash.keySystemsByURI),B=new Set(B?[B]:[]);var re=!1;y.findChildren(m,"SupplementalProperty").some(function(X){return X.getAttribute("schemeIdUri")=="tag:dolby.com,2018:dash:EC3_ExtensionType:2018"&&X.getAttribute("value")=="JOC"})&&(re=!0);var ee=!1;F&&(ee=l.includes("forced_subtitle")||l.includes("forced-subtitle"));var H;if(D&&((m=y.findChildren(m,"EssentialProperty").find(function(X){return["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"].includes(X.getAttribute("schemeIdUri"))}))&&(H=m.getAttribute("value")),!H))return null;var te;m=t.representation.codecs,t.profiles.includes("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10")&&(m.includes("hvc1.2.4.L153.B0")||m.includes("hev1.2.4.L153.B0"))&&(te="PQ");var W=t.representation.id?t.period.id+","+t.representation.id:"",z={id:this.globalId_++,originalId:t.representation.id,createSegmentIndex:function(){var X,Q,$;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oe){if(oe.nextAddress==1)return Q=(X=W&&t.dynamic&&E.streamMap_[W])?E.streamMap_[W]:z,Q.segmentIndex?oe.jumpTo(0):($=Q,oe.yield(V.generateSegmentIndex(),3));$.segmentIndex=oe.yieldResult,oe.jumpToEnd()})},closeSegmentIndex:function(){z.segmentIndex&&(z.segmentIndex.release(),z.segmentIndex=null)},segmentIndex:null,mimeType:t.representation.mimeType,codecs:t.representation.codecs,frameRate:t.representation.frameRate,pixelAspectRatio:t.representation.pixelAspectRatio,bandwidth:t.bandwidth,width:t.representation.width,height:t.representation.height,kind:i,encrypted:0<r.drmInfos.length,drmInfos:r.drmInfos,keyIds:B,language:n,label:s,type:t.adaptationSet.contentType,primary:o,trickModeVideo:null,emsgSchemeIdUris:t.representation.emsgSchemeIdUris,roles:l,forced:ee,channelsCount:t.representation.numChannels,audioSamplingRate:t.representation.audioSamplingRate,spatialAudio:re,closedCaptions:u,hdr:te,tilesLayout:H,matchedStreams:[]};return W&&t.dynamic&&!this.streamMap_[W]&&(this.streamMap_[W]=z),z},shaka.dash.DashParser.prototype.onUpdate_=function(){var t=this,r,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){switch(n.nextAddress){case 1:return goog.asserts.assert(0<=t.updatePeriod_,"There should be an update period"),shaka.log.info("Updating manifest..."),r=0,n.setCatchFinallyBlocks(2),n.yield(t.requestManifest_(),4);case 4:r=n.yieldResult,n.leaveTryBlock(3);break;case 2:i=n.enterCatchBlock(),goog.asserts.assert(i instanceof shaka.util.Error,"Should only receive a Shaka error"),t.playerInterface_&&(i.severity=shaka.util.Error.Severity.RECOVERABLE,t.playerInterface_.onError(i));case 3:if(!t.playerInterface_)return n.return();t.setUpdateTimer_(r),n.jumpToEnd()}})},shaka.dash.DashParser.prototype.setUpdateTimer_=function(t){0>this.updatePeriod_||(t=Math.max(shaka.dash.DashParser.MIN_UPDATE_PERIOD_,this.updatePeriod_-t,this.averageUpdateDuration_.getEstimate()),this.updateTimer_.tickAfter(t))},shaka.dash.DashParser.prototype.createFrame_=function(t,r,i){goog.asserts.assert(r||i,"Must provide either parent or baseUris");var n=shaka.util.ManifestParserUtils,s=shaka.util.XmlUtils;r=r||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,pixelAspectRatio:void 0,numChannels:null,audioSamplingRate:null,availabilityTimeOffset:0},i=i||r.baseUris;var o=s.parseNonNegativeInt,l=s.evalDivision,u=s.findChildren(t,"BaseURL"),m=u.map(s.getContents),E=t.getAttribute("contentType")||r.contentType,y=t.getAttribute("mimeType")||r.mimeType,D=t.getAttribute("codecs")||r.codecs;l=s.parseAttr(t,"frameRate",l)||r.frameRate;var w=t.getAttribute("sar")||r.pixelAspectRatio,B=this.emsgSchemeIdUris_(s.findChildren(t,"InbandEventStream"),r.emsgSchemeIdUris),F=s.findChildren(t,"AudioChannelConfiguration");F=this.parseAudioChannels_(F)||r.numChannels;var V=s.parseAttr(t,"audioSamplingRate",o)||r.audioSamplingRate;E||(E=shaka.dash.DashParser.guessContentType_(y,D));var K=s.findChild(t,"SegmentBase"),q=s.findChild(t,"SegmentTemplate"),re=K&&s.parseAttr(K,"availabilityTimeOffset",s.parseFloat)||0,ee=q&&s.parseAttr(q,"availabilityTimeOffset",s.parseFloat)||0;return u=u&&u.length&&s.parseAttr(u[0],"availabilityTimeOffset",s.parseFloat)||0,u=r.availabilityTimeOffset+u+re+ee,{baseUris:n.resolveUris(i,m),segmentBase:K||r.segmentBase,segmentList:s.findChild(t,"SegmentList")||r.segmentList,segmentTemplate:q||r.segmentTemplate,width:s.parseAttr(t,"width",o)||r.width,height:s.parseAttr(t,"height",o)||r.height,contentType:E,mimeType:y,codecs:D,frameRate:l,pixelAspectRatio:w,emsgSchemeIdUris:B,id:t.getAttribute("id"),numChannels:F,audioSamplingRate:V,availabilityTimeOffset:u}},shaka.dash.DashParser.prototype.emsgSchemeIdUris_=function(t,r){for(var i=r.slice(),n=$jscomp.makeIterator(t),s=n.next();!s.done;s=n.next())s=s.value.getAttribute("schemeIdUri"),i.includes(s)||i.push(s);return i},shaka.dash.DashParser.prototype.parseAudioChannels_=function(t){t=$jscomp.makeIterator(t);for(var r=t.next();!r.done;r=t.next()){var i=r.value;if((r=i.getAttribute("schemeIdUri"))&&(i=i.getAttribute("value")))switch(r){case"urn:mpeg:dash:outputChannelPositionList:2012":return i.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":var n=parseInt(i,10);if(!n){shaka.log.warning("Channel parsing failure! Ignoring scheme and value",r,i);continue}return n;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(n=parseInt(i,16),!n){shaka.log.warning("Channel parsing failure! Ignoring scheme and value",r,i);continue}for(t=0;n;)n&1&&++t,n>>=1;return t;case"urn:mpeg:mpegB:cicp:ChannelConfiguration":n=[0,1,2,3,4,5,6,8,2,3,4,7,8,24,8,12,10,12,14,12,14];var s=parseInt(i,10);if(!s){shaka.log.warning("Channel parsing failure! Ignoring scheme and value",r,i);continue}if(0<s&&s<n.length)return n[s];continue;default:shaka.log.warning("Unrecognized audio channel scheme:",r,i)}}return null},shaka.dash.DashParser.prototype.verifyRepresentation_=function(t){var r=shaka.util.ManifestParserUtils.ContentType,i=t.segmentBase?1:0;return i+=t.segmentList?1:0,i+=t.segmentTemplate?1:0,i==0?t.contentType==r.TEXT||t.contentType==r.APPLICATION?!0:(shaka.log.warning("Representation does not contain a segment information source:","the Representation must contain one of SegmentBase, SegmentList,",'SegmentTemplate, or explicitly indicate that it is "text".',t),!1):(i!=1&&(shaka.log.warning("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,","SegmentList, or SegmentTemplate.",t),t.segmentBase?(shaka.log.info("Using SegmentBase by default."),t.segmentList=null):(goog.asserts.assert(t.segmentList,"There should be a SegmentList"),shaka.log.info("Using SegmentList by default.")),t.segmentTemplate=null),!0)},shaka.dash.DashParser.prototype.requestForTiming_=function(t,r,i){var n=this,s,o,l,u,m,E,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(D){if(D.nextAddress==1)return s=shaka.util.ManifestParserUtils.resolveUris(t,[r]),o=shaka.net.NetworkingEngine.makeRequest(s,n.config_.retryParameters),o.method=i,l=shaka.net.NetworkingEngine.RequestType.TIMING,u=n.playerInterface_.networkingEngine.request(l,o),n.operationManager_.manage(u),D.yield(u.promise,2);if(m=D.yieldResult,i=="HEAD"){if(!m.headers||!m.headers.date)return shaka.log.warning("UTC timing response is missing","expected date header"),D.return(0);E=m.headers.date}else E=shaka.util.StringUtils.fromUTF8(m.data);return y=Date.parse(E),isNaN(y)?(shaka.log.warning("Unable to parse date from UTC timing response"),D.return(0)):D.return(y-Date.now())})},shaka.dash.DashParser.prototype.parseUtcTiming_=function(t,r){var i=this,n,s,o,l,u,m,E,y,D;return $jscomp.asyncExecutePromiseGeneratorProgram(function(w){switch(w.nextAddress){case 1:n=r.map(function(B){return{scheme:B.getAttribute("schemeIdUri"),value:B.getAttribute("value")}}),s=i.config_.dash.clockSyncUri,!n.length&&s&&n.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:s}),o=$jscomp.makeIterator(n),l=o.next();case 2:if(l.done){w.jumpTo(4);break}switch(u=l.value,w.setCatchFinallyBlocks(5),m=u.scheme,E=u.value,m){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return w.jumpTo(7);case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return w.jumpTo(8);case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return y=Date.parse(E),w.return(isNaN(y)?0:y-Date.now());case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":shaka.log.alwaysWarn("NTP UTCTiming scheme is not supported");break;default:shaka.log.alwaysWarn("Unrecognized scheme in UTCTiming element",m)}w.jumpTo(9);break;case 7:return w.yield(i.requestForTiming_(t,E,"HEAD"),10);case 10:return w.return(w.yieldResult);case 8:return w.yield(i.requestForTiming_(t,E,"GET"),11);case 11:return w.return(w.yieldResult);case 9:w.leaveTryBlock(3);break;case 5:D=w.enterCatchBlock(),shaka.log.warning("Error fetching time from UTCTiming elem",D.message);case 3:l=o.next(),w.jumpTo(2);break;case 4:return shaka.log.alwaysWarn("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),w.return(0)}})},shaka.dash.DashParser.prototype.parseEventStream_=function(t,r,i,n){var s=shaka.util.XmlUtils,o=s.parseNonNegativeInt,l=i.getAttribute("schemeIdUri")||"",u=i.getAttribute("value")||"",m=s.parseAttr(i,"timescale",o)||1;i=$jscomp.makeIterator(s.findChildren(i,"Event"));for(var E=i.next();!E.done;E=i.next()){E=E.value;var y=s.parseAttr(E,"presentationTime",o)||0,D=s.parseAttr(E,"duration",o)||0;y=y/m+t,D=y+D/m,r!=null&&(y=Math.min(y,t+r),D=Math.min(D,t+r)),D<n||(E={schemeIdUri:l,value:u,startTime:y,endTime:D,id:E.getAttribute("id")||"",eventElement:E},this.playerInterface_.onTimelineRegionAdded(E))}},shaka.dash.DashParser.prototype.requestInitSegment_=function(t,r,i){var n=this,s,o,l,u,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return E.nextAddress==1?(s=shaka.net.NetworkingEngine.RequestType.SEGMENT,o=shaka.util.Networking.createSegmentRequest(t,r,i,n.config_.retryParameters),l=n.playerInterface_.networkingEngine,u=l.request(s,o),n.operationManager_.manage(u),E.yield(u.promise,2)):(m=E.yieldResult,E.return(m.data))})},shaka.dash.DashParser.guessContentType_=function(t,r){var i=shaka.util.MimeUtils.getFullType(t,r);return shaka.text.TextEngine.isTypeSupported(i)?shaka.util.ManifestParserUtils.ContentType.TEXT:t.split("/")[0]},goog.exportSymbol("shaka.dash.DashParser",shaka.dash.DashParser),shaka.dash.DashParser.MIN_UPDATE_PERIOD_=3,shaka.media.ManifestParser.registerParserByExtension("mpd",function(){return new shaka.dash.DashParser}),shaka.media.ManifestParser.registerParserByMime("application/dash+xml",function(){return new shaka.dash.DashParser}),shaka.media.ManifestParser.registerParserByMime("video/vnd.mpeg.dash.mpd",function(){return new shaka.dash.DashParser}),shaka.hls={},shaka.hls.Playlist=function(t,r,i,n){this.absoluteUri=t,this.type=r,this.tags=i,this.segments=n||null},shaka.hls.PlaylistType={MASTER:0,MEDIA:1},shaka.hls.Tag=function(t,r,i,n){this.id=t,this.name=r,this.attributes=i,this.value=n===void 0?null:n},shaka.hls.Tag.prototype.toString=function(){var t=function(i){var n=isNaN(Number(i.value))?'"'+i.value+'"':i.value;return i.name+"="+n},r="#"+this.name;return t=this.attributes?this.attributes.map(t):[],this.value&&t.unshift(this.value),0<t.length&&(r+=":"+t.join(",")),r},shaka.hls.Tag.prototype.addAttribute=function(t){this.attributes.push(t)},shaka.hls.Tag.prototype.getAttribute=function(t){var r=this.attributes.filter(function(i){return i.name==t});return goog.asserts.assert(2>r.length,"A tag should not have multiple attributes with the same name!"),r.length?r[0]:null},shaka.hls.Tag.prototype.getAttributeValue=function(t,r){var i=this.getAttribute(t);return i?i.value:r||null},shaka.hls.Tag.prototype.getRequiredAttrValue=function(t){var r=this.getAttribute(t);if(!r)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_ATTRIBUTE_MISSING,t);return r.value},shaka.hls.Tag.prototype.setName=function(t){this.name=t},shaka.hls.Segment=function(t,r,i){i=i===void 0?[]:i,this.tags=r,this.absoluteUri=t,this.partialSegments=i},shaka.hls.Attribute=function(t,r){this.name=t,this.value=r},shaka.hls.Utils=function(){},shaka.hls.Utils.filterTagsByName=function(t,r){return t.filter(function(i){return i.name==r})},shaka.hls.Utils.filterTagsByType=function(t,r){return t.filter(function(i){return i.getRequiredAttrValue("TYPE")==r})},shaka.hls.Utils.getFirstTagWithName=function(t,r){var i=shaka.hls.Utils.filterTagsByName(t,r);return i.length?i[0]:null},shaka.hls.Utils.getFirstTagWithNameAsNumber=function(t,r,i){return i=i===void 0?0:i,(t=shaka.hls.Utils.getFirstTagWithName(t,r))?Number(t.value):i},shaka.hls.Utils.constructAbsoluteUri=function(t,r){return shaka.util.ManifestParserUtils.resolveUris([t],[r])[0]},shaka.hls.Utils.isComment=function(t){return/^#(?!EXT)/m.test(t)},shaka.util.TextParser=function(t){this.data_=t,this.position_=0},shaka.util.TextParser.prototype.atEnd=function(){return this.position_==this.data_.length},shaka.util.TextParser.prototype.readLine=function(){return this.readRegexReturnCapture_(/(.*?)(\n|$)/gm,1)},shaka.util.TextParser.prototype.readWord=function(){return this.readRegexReturnCapture_(/[^ \t\n]*/gm,0)},shaka.util.TextParser.prototype.skipWhitespace=function(){this.readRegex(/[ \t]+/gm)},shaka.util.TextParser.prototype.readRegex=function(t){return t=this.indexOf_(t),this.atEnd()||t==null||t.position!=this.position_?null:(this.position_+=t.length,t.results)},shaka.util.TextParser.prototype.readRegexReturnCapture_=function(t,r){if(this.atEnd())return null;var i=this.readRegex(t);return i?i[r]:null},shaka.util.TextParser.prototype.indexOf_=function(t){return goog.asserts.assert(t.global,"global flag should be set"),t.lastIndex=this.position_,t=t.exec(this.data_),t==null?null:{position:t.index,length:t[0].length,results:t}},shaka.hls.ManifestTextParser=function(){this.globalId_=0},shaka.hls.ManifestTextParser.prototype.parsePlaylist=function(t,r){var i=shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS,n=shaka.hls.ManifestTextParser.SEGMENT_TAGS,s=shaka.util.StringUtils.fromUTF8(t);s=s.replace(/\r\n|\r(?=[^\n]|$)/gm,`
`).trim();var o=s.split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(o[0]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_PLAYLIST_HEADER_MISSING);s=shaka.hls.PlaylistType.MASTER;for(var l=!0,u=$jscomp.makeIterator(o),m=u.next();!m.done;m=u.next())if(m=m.value,shaka.hls.Utils.isComment(m)||l)l=!1;else if(m=this.parseTag_(m),--this.globalId_,i.includes(m.name)){s=shaka.hls.PlaylistType.MEDIA;break}else m.name=="EXT-X-STREAM-INF"&&(l=!0);for(i=[],l=!0,u=0;u<o.length;u++){var E=o[u];if(m=o[u+1],shaka.hls.Utils.isComment(E)||l)l=!1;else{if(E=this.parseTag_(E),n.includes(E.name)){if(s!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);return n=o.splice(u,o.length-u),n=this.parseSegments_(r,n,i),new shaka.hls.Playlist(r,s,i,n)}i.push(E),E.name=="EXT-X-STREAM-INF"&&(l=new shaka.hls.Attribute("URI",m),E.addAttribute(l),l=!0)}}return new shaka.hls.Playlist(r,s,i)},shaka.hls.ManifestTextParser.prototype.parseSegments_=function(t,r,i){var n=[],s=[],o=[],l=null;r=$jscomp.makeIterator(r);for(var u=r.next();!u.done;u=r.next())u=u.value,/^(#EXT)/.test(u)?(u=this.parseTag_(u),shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS.includes(u.name)?i.push(u):u.name=="EXT-X-MAP"?l=u:u.name=="EXT-X-PART"?o.push(u):u.name=="EXT-X-PRELOAD-HINT"?u.getAttributeValue("TYPE")=="PART"?o.push(u):u.getAttributeValue("TYPE")=="MAP"&&(u.setName("EXT-X-MAP"),l=u):s.push(u)):shaka.hls.Utils.isComment(u)||(u=u.trim(),u=shaka.hls.Utils.constructAbsoluteUri(t,u),l&&s.push(l),s=new shaka.hls.Segment(u,s,o),n.push(s),s=[],o=[]);return o.length&&(l&&s.push(l),t=new shaka.hls.Segment("",s,o),n.push(t)),n},shaka.hls.ManifestTextParser.prototype.parseTag_=function(t){return shaka.hls.ManifestTextParser.parseTag(this.globalId_++,t)},shaka.hls.ManifestTextParser.parseTag=function(t,r){var i=r.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!i)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.INVALID_HLS_TAG,r);var n=i[1],s=i[2];i=[];var o;if(s){s=new shaka.util.TextParser(s);var l,u=s.readRegex(/^([^,=]+)(?:,|$)/g);for(u&&(o=u[1]),u=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;l=s.readRegex(u);)l=new shaka.hls.Attribute(l[1],l[2]||l[3]),i.push(l),s.skipWhitespace()}return new shaka.hls.Tag(t,n,i,o)},shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP".split(" "),shaka.hls.ManifestTextParser.SEGMENT_TAGS="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP".split(" "),shaka.net.DataUriPlugin=function(){},shaka.net.DataUriPlugin.parse=function(t,r,i,n){try{var s=shaka.net.DataUriPlugin.parseRaw(t);return shaka.util.AbortableOperation.completed({uri:t,originalUri:t,data:s.data,headers:{"content-type":s.contentType}})}catch(o){return shaka.util.AbortableOperation.failed(o)}},shaka.net.DataUriPlugin.parseRaw=function(t){var r=t.split(":");if(2>r.length||r[0]!="data")throw shaka.log.error("Bad data URI, failed to parse scheme"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_DATA_URI,t);if(r=r.slice(1).join(":").split(","),2>r.length)throw shaka.log.error("Bad data URI, failed to extract encoding and MIME type"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_DATA_URI,t);var i=r[0];t=window.decodeURIComponent(r.slice(1).join(",")),r=i.split(";"),i=r[0];var n=!1;return 1<r.length&&r[r.length-1]=="base64"&&(n=!0,r.pop()),{data:n?shaka.util.Uint8ArrayUtils.fromBase64(t):shaka.util.StringUtils.toUTF8(t),contentType:i}},goog.exportSymbol("shaka.net.DataUriPlugin",shaka.net.DataUriPlugin),goog.exportProperty(shaka.net.DataUriPlugin,"parse",shaka.net.DataUriPlugin.parse),shaka.net.NetworkingEngine.registerScheme("data",shaka.net.DataUriPlugin.parse),shaka.hls.HlsParser=function(){var t=this;this.config_=this.playerInterface_=null,this.globalId_=1,this.globalVariables_=new Map,this.groupIdToStreamInfosMap_=new Map,this.variantUriSet_=new Set,this.uriToStreamInfosMap_=new Map,this.presentationTimeline_=null,this.masterPlaylistUri_="",this.manifestTextParser_=new shaka.hls.ManifestTextParser,this.updatePlaylistDelay_=0,this.updatePlaylistTimer_=new shaka.util.Timer(function(){t.onUpdate_()}),this.presentationType_=shaka.hls.HlsParser.PresentationType_.VOD,this.manifest_=null,this.maxTargetDuration_=0,this.minTargetDuration_=1/0,this.lowLatencyPresentationDelay_=this.partialTargetDuration_=0,this.operationManager_=new shaka.util.OperationManager,this.segmentsToNotifyByStream_=[],this.groupIdToClosedCaptionsMap_=new Map,this.aesEncrypted_=!1,this.groupIdToCodecsMap_=new Map,this.playlistStartTime_=null,this.mapTagToInitSegmentRefMap_=new Map,this.discontinuityToTso_=new Map,this.lowLatencyMode_=!1},shaka.hls.HlsParser.prototype.configure=function(t){this.config_=t},shaka.hls.HlsParser.prototype.start=function(t,r){var i=this,n,s;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return o.nextAddress==1?(goog.asserts.assert(i.config_,"Must call configure() before start()!"),i.playerInterface_=r,i.lowLatencyMode_=r.isLowLatencyMode(),o.yield(i.requestManifest_(t),2)):o.nextAddress!=3?(n=o.yieldResult,i.masterPlaylistUri_=n.uri,goog.asserts.assert(n.data,"Response data should be non-null!"),o.yield(i.parseManifest_(n.data),3)):(s=i.updatePlaylistDelay_,0<s&&i.updatePlaylistTimer_.tickAfter(s),goog.asserts.assert(i.manifest_,"Manifest should be non-null"),o.return(i.manifest_))})},shaka.hls.HlsParser.prototype.stop=function(){this.updatePlaylistTimer_&&(this.updatePlaylistTimer_.stop(),this.updatePlaylistTimer_=null);var t=[];return this.operationManager_&&(t.push(this.operationManager_.destroy()),this.operationManager_=null),this.config_=this.playerInterface_=null,this.variantUriSet_.clear(),this.manifest_=null,this.uriToStreamInfosMap_.clear(),this.groupIdToStreamInfosMap_.clear(),this.groupIdToCodecsMap_.clear(),this.globalVariables_.clear(),Promise.all(t)},shaka.hls.HlsParser.prototype.update=function(){var t=this,r,i,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){if(s.nextAddress==1)return t.isLive_()?(r=[],t.playlistStartTime_=null,i=Array.from(t.uriToStreamInfosMap_.values()),i.length?s.yield(t.updateStream_(i[0]),2):s.jumpTo(2)):s.return();for(n=1;n<i.length;n++)r.push(t.updateStream_(i[n]));return s.yield(Promise.all(r),0)})},shaka.hls.HlsParser.prototype.updateStream_=function(t){var r=this,i,n,s,o,l,u,m,E,y,D,w,B,F;return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){if(V.nextAddress==1)return i=shaka.hls.HlsParser.PresentationType_,n=t.absoluteMediaPlaylistUri,s=new goog.Uri(n),r.lowLatencyMode_&&t.canSkipSegments&&s.setQueryData(new goog.Uri.QueryData("_HLS_skip=YES")),V.yield(r.requestManifest_(s.toString()),2);if(V.nextAddress!=3){if(o=V.yieldResult,l=r.manifestTextParser_.parsePlaylist(o.data,o.uri),l.type!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);return u=shaka.hls.Utils.filterTagsByName(l.tags,"EXT-X-DEFINE"),m=r.parseMediaVariables_(u),E=t.stream,V.yield(r.createSegments_(t.verbatimMediaPlaylistUri,l,E.type,E.mimeType,t.mediaSequenceToStartTime,m,t.discontinuityToMediaSequence,E.codecs,E.bandwidth),3)}y=V.yieldResult,E.segmentIndex.mergeAndEvict(y,r.presentationTimeline_.getSegmentAvailabilityStart()),y.length&&(D=shaka.hls.Utils.getFirstTagWithNameAsNumber(l.tags,"EXT-X-MEDIA-SEQUENCE",0),w=t.mediaSequenceToStartTime.get(D),E.segmentIndex.evict(w)),B=y[y.length-1],goog.asserts.assert(B,"Should have segments!"),(F=shaka.hls.Utils.getFirstTagWithName(l.tags,"EXT-X-ENDLIST"))&&(r.setPresentationType_(i.VOD),r.presentationTimeline_.setDuration(B.endTime)),V.jumpToEnd()})},shaka.hls.HlsParser.prototype.onExpirationUpdated=function(t,r){},shaka.hls.HlsParser.prototype.parseManifest_=function(t){var r=this,i,n,s,o,l,u,m,E,y,D,w,B,F,V,K,q,re,ee,H,te,W,z,X,Q,$,oe,ae,_e,ve,Pe,fe,xe,Ce,De,ke,Xe,et;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tt){switch(tt.nextAddress){case 1:if(i=shaka.hls.Utils,goog.asserts.assert(r.masterPlaylistUri_,"Master playlist URI must be set before calling parseManifest_!"),n=r.manifestTextParser_.parsePlaylist(t,r.masterPlaylistUri_),n.type!=shaka.hls.PlaylistType.MASTER)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_MASTER_PLAYLIST_NOT_PROVIDED);for(s=i.filterTagsByName(n.tags,"EXT-X-DEFINE"),r.parseMasterVariables_(s),o=i.filterTagsByName(n.tags,"EXT-X-MEDIA"),l=i.filterTagsByName(n.tags,"EXT-X-STREAM-INF"),u=i.filterTagsByName(n.tags,"EXT-X-IMAGE-STREAM-INF"),r.parseCodecs_(l),m=i.filterTagsByName(n.tags,"EXT-X-SESSION-DATA"),E=$jscomp.makeIterator(m),y=E.next();!y.done;y=E.next())D=y.value,w=D.getAttributeValue("DATA-ID"),B=D.getAttributeValue("URI"),F=D.getAttributeValue("LANGUAGE"),V=D.getAttributeValue("VALUE"),K=new Map().set("id",w),B&&K.set("uri",shaka.hls.Utils.constructAbsoluteUri(r.masterPlaylistUri_,B)),F&&K.set("language",F),V&&K.set("value",V),q=new shaka.util.FakeEvent("sessiondata",K),r.playerInterface_&&r.playerInterface_.onEvent(q);return tt.yield(r.createStreamInfosFromMediaTags_(o),2);case 2:return r.parseClosedCaptions_(o),tt.yield(r.createVariantsForTags_(l),3);case 3:return re=tt.yieldResult,tt.yield(r.parseTexts_(o),4);case 4:return ee=tt.yieldResult,tt.yield(r.parseImages_(u),5);case 5:if(H=tt.yieldResult,!r.playerInterface_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);if(r.aesEncrypted_&&re.length==0)throw shaka.log.info("No stream is created, because we don't support AES-128","encryption yet"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_AES_128_ENCRYPTION_NOT_SUPPORTED);for(W=te=1/0,z=$jscomp.makeIterator(r.uriToStreamInfosMap_.values()),X=z.next();!X.done;X=z.next())Q=X.value,te=Math.min(te,Q.minTimestamp),Q.stream.type!="text"&&(W=Math.min(W,Q.maxTimestamp-Q.minTimestamp));if(goog.asserts.assert(r.presentationTimeline_==null,"Presentation timeline created early!"),r.createPresentationTimeline_(),goog.asserts.assert(r.presentationTimeline_,"Presentation timeline not created!"),r.isLive_())r.updatePlaylistDelay_=r.minTargetDuration_,$=shaka.hls.HlsParser.PresentationType_,r.presentationType_==$.LIVE&&(oe=r.presentationTimeline_.getDelay(),isNaN(r.config_.availabilityWindowOverride)||(oe=r.config_.availabilityWindowOverride),r.presentationTimeline_.setSegmentAvailabilityDuration(oe));else for(r.presentationTimeline_.setDuration(W),r.presentationTimeline_.offset(-te),ae=$jscomp.makeIterator(r.uriToStreamInfosMap_.values()),X=ae.next();!X.done;X=ae.next())_e=X.value,_e.stream.segmentIndex.offset(-te),_e.stream.segmentIndex.fit(0,W);for(r.segmentsToNotifyByStream_=[],ve=[],Pe=$jscomp.makeIterator(re),fe=Pe.next();!fe.done;fe=Pe.next())for(xe=fe.value,Ce=$jscomp.makeIterator([xe.video,xe.audio]),De=Ce.next();!De.done;De=Ce.next())(ke=De.value)&&ve.push(ke);return tt.yield(Promise.all(ve.map(function(nt){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Be){return Be.yield(nt.createSegmentIndex(),0)})})),6);case 6:for(Xe=$jscomp.makeIterator(ve),De=Xe.next();!De.done;De=Xe.next())et=De.value,r.segmentsToNotifyByStream_.push(et.segmentIndex.references);r.notifySegments_(),r.presentationTimeline_.lockStartTime(),goog.asserts.assert(!r.presentationTimeline_.usingPresentationStartTime(),"We should not be using the presentation start time in HLS!"),r.manifest_={presentationTimeline:r.presentationTimeline_,variants:re,textStreams:ee,imageStreams:H,offlineSessionIds:[],minBufferTime:0},r.playerInterface_.makeTextStreamsForClosedCaptions(r.manifest_),tt.jumpToEnd()}})},shaka.hls.HlsParser.prototype.parseMasterVariables_=function(t){t=$jscomp.makeIterator(t);for(var r=t.next();!r.done;r=t.next()){var i=r.value;r=i.getAttributeValue("NAME"),i=i.getAttributeValue("VALUE"),r&&i&&(this.globalVariables_.has(r)||this.globalVariables_.set(r,i))}},shaka.hls.HlsParser.prototype.parseMediaVariables_=function(t){var r=new Map;t=$jscomp.makeIterator(t);for(var i=t.next();!i.done;i=t.next()){var n=i.value;i=n.getAttributeValue("NAME");var s=n.getAttributeValue("VALUE");n=n.getAttributeValue("IMPORT"),i&&s&&r.set(i,s),n&&(i=this.globalVariables_.get(n))&&r.set(n,i)}return r},shaka.hls.HlsParser.prototype.parseCodecs_=function(t){var r=shaka.util.ManifestParserUtils.ContentType;t=$jscomp.makeIterator(t);for(var i=t.next();!i.done;i=t.next()){var n=i.value,s=n.getAttributeValue("AUDIO");i=n.getAttributeValue("VIDEO");var o=n.getAttributeValue("SUBTITLES");if(n=this.getCodecsForVariantTag_(n),o){var l=shaka.util.ManifestParserUtils.guessCodecsSafe(r.TEXT,n);goog.asserts.assert(l!=null,"Text codecs should be valid."),this.groupIdToCodecsMap_.set(o,l),shaka.util.ArrayUtils.remove(n,l)}s&&(o=shaka.util.ManifestParserUtils.guessCodecs(r.AUDIO,n),this.groupIdToCodecsMap_.set(s,o)),i&&(s=shaka.util.ManifestParserUtils.guessCodecs(r.VIDEO,n),this.groupIdToCodecsMap_.set(i,s))}},shaka.hls.HlsParser.prototype.parseTexts_=function(t){var r=this,i,n,s,o,l,u,m,E,y,D,w,B;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){if(F.nextAddress==1)return i=shaka.hls.Utils.filterTagsByType(t,"SUBTITLES"),n=i.map(function(V){var K,q,re;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ee){if(ee.nextAddress==1)return(K=r.config_.disableText)?ee.return(null):(ee.setCatchFinallyBlocks(2),ee.yield(r.createStreamInfoFromMediaTag_(V),4));if(ee.nextAddress!=2)return q=ee.yieldResult,goog.asserts.assert(q,"Should always have a streamInfo for text"),ee.return(q.stream);if(re=ee.enterCatchBlock(),r.config_.hls.ignoreTextStreamFailures)return ee.return(null);throw re})}),F.yield(Promise.all(n),2);for(s=F.yieldResult,o=$jscomp.makeIterator(i),l=o.next();!l.done;l=o.next())if(u=l.value,m=u.getRequiredAttrValue("GROUP-ID"),(E=r.groupIdToCodecsMap_.get(m))&&(y=r.groupIdToStreamInfosMap_.get(m)))for(D=$jscomp.makeIterator(y),w=D.next();!w.done;w=D.next())B=w.value,B.stream.codecs=E;return F.return(s.filter(function(V){return V}))})},shaka.hls.HlsParser.prototype.parseImages_=function(t){var r=this,i,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){return s.nextAddress==1?(i=t.map(function(o){var l,u,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){if(E.nextAddress==1)return(l=r.config_.disableThumbnails)?E.return(null):(E.setCatchFinallyBlocks(2),E.yield(r.createStreamInfoFromImageTag_(o),4));if(E.nextAddress!=2)return u=E.yieldResult,goog.asserts.assert(u,"Should always have a streamInfo for image"),E.return(u.stream);if(m=E.enterCatchBlock(),r.config_.hls.ignoreImageStreamFailures)return E.return(null);throw m})}),s.yield(Promise.all(i),2)):(n=s.yieldResult,s.return(n.filter(function(o){return o})))})},shaka.hls.HlsParser.prototype.createStreamInfosFromMediaTags_=function(t){var r=this,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return n.nextAddress==1?(t=t.filter(function(s){var o=s.getAttributeValue("URI")||"";return s.getAttributeValue("TYPE")!="SUBTITLES"&&o!=""}),t.length?n.yield(r.createStreamInfoFromMediaTag_(t[0]),2):n.jumpTo(2)):(i=t.slice(1).map(function(s){return r.createStreamInfoFromMediaTag_(s)}),n.yield(Promise.all(i),0))})},shaka.hls.HlsParser.prototype.createVariantsForTags_=function(t){var r=this,i,n,s;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return o.nextAddress==1?(i=t.map(function(l){var u,m,E,y,D,w,B,F;return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){return V.nextAddress==1?(u=l.getAttributeValue("FRAME-RATE"),m=Number(l.getAttributeValue("AVERAGE-BANDWIDTH"))||Number(l.getRequiredAttrValue("BANDWIDTH")),E=l.getAttributeValue("RESOLUTION"),y=$jscomp.makeIterator(E?E.split("x"):[null,null]),D=y.next().value,w=y.next().value,B=l.getAttributeValue("VIDEO-RANGE"),V.yield(r.createStreamInfosForVariantTag_(l,E,u,m),2)):(F=V.yieldResult)?(goog.asserts.assert(F.audio.length||F.video.length,"We should have created a stream!"),V.return(r.createVariants_(F.audio,F.video,m,D,w,u,B))):V.return([])})}),o.yield(Promise.all(i),2)):(n=o.yieldResult,s=n.reduce(shaka.util.Functional.collapseArrays,[]),s=s.filter(function(l){return l!=null}),o.return(s))})},shaka.hls.HlsParser.prototype.createStreamInfosForVariantTag_=function(t,r,i,n){var s=this,o,l,u,m,E,y,D,w,B,F,V,K,q,re;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ee){if(ee.nextAddress==1)return o=shaka.util.ManifestParserUtils.ContentType,l=s.getCodecsForVariantTag_(t),u=t.getAttributeValue("AUDIO"),m=t.getAttributeValue("VIDEO"),goog.asserts.assert(u==null||m==null,"Unexpected: both video and audio described by media tags!"),y=(E=u||m)&&s.groupIdToStreamInfosMap_.has(E)?s.groupIdToStreamInfosMap_.get(E):[],D={audio:u?y:[],video:m?y:[]},shaka.log.debug("Guessing stream type for",t.toString()),B=!1,F=t.getRequiredAttrValue("URI"),V=D.audio.find(function(H){return H&&H.verbatimMediaPlaylistUri==F}),K=shaka.util.ManifestParserUtils.guessCodecsSafe(o.VIDEO,l),(q=shaka.util.ManifestParserUtils.guessCodecsSafe(o.AUDIO,l))&&!K?(w=o.AUDIO,shaka.log.debug("Guessing audio-only.")):!y.length&&q&&K?(shaka.log.debug("Guessing multiplexed audio+video."),w=o.VIDEO,l=[[K,q].join()]):D.audio.length&&V?(shaka.log.debug("Guessing audio-only."),w=o.AUDIO,B=!0):D.video.length?(shaka.log.debug("Guessing audio-only."),w=o.AUDIO):(shaka.log.debug("Guessing video-only."),w=o.VIDEO),B?ee.jumpTo(2):ee.yield(s.createStreamInfoFromVariantTag_(t,l,w,n),3);if(ee.nextAddress!=2&&(re=ee.yieldResult),re)D[re.stream.type]=[re];else if(re===null)return shaka.log.debug("streamInfo is null"),ee.return(null);return s.filterLegacyCodecs_(D),ee.return(D)})},shaka.hls.HlsParser.prototype.getCodecsForVariantTag_=function(t){var r=[];this.config_.disableVideo||r.push(this.config_.hls.defaultVideoCodec),this.config_.disableAudio||r.push(this.config_.hls.defaultAudioCodec),r=r.join(",");var i=t.getAttributeValue("CODECS",r).split(/\s*,\s*/);t=new Set,r=[],i=$jscomp.makeIterator(i);for(var n=i.next();!n.done;n=i.next()){n=n.value;var s=shaka.util.MimeUtils.getCodecBase(n);t.has(s)?shaka.log.debug("Ignoring duplicate codec"):(r.push(n),t.add(s))}return r},shaka.hls.HlsParser.prototype.getChannelsCount_=function(t){return t=t.getAttributeValue("CHANNELS"),t?(t=t.split("/")[0],parseInt(t,10)):null},shaka.hls.HlsParser.prototype.isSpatialAudio_=function(t){return(t=t.getAttributeValue("CHANNELS"))?t.includes("/JOC"):!1},shaka.hls.HlsParser.prototype.getClosedCaptions_=function(t,r){var i=shaka.util.ManifestParserUtils.ContentType,n=t.getAttributeValue("CLOSED-CAPTIONS");return r==i.VIDEO&&n&&n!="NONE"?this.groupIdToClosedCaptionsMap_.get(n):null},shaka.hls.HlsParser.prototype.getLanguage_=function(t){var r=shaka.util.LanguageUtils;return t=t.getAttributeValue("LANGUAGE")||"und",r.normalize(t)},shaka.hls.HlsParser.prototype.getType_=function(t){return t=t.getRequiredAttrValue("TYPE").toLowerCase(),t=="subtitles"&&(t=shaka.util.ManifestParserUtils.ContentType.TEXT),t},shaka.hls.HlsParser.prototype.filterLegacyCodecs_=function(t){t=$jscomp.makeIterator(t.audio.concat(t.video));for(var r=t.next();!r.done;r=t.next())if(r=r.value){var i=r.stream.codecs.split(",");i=i.filter(function(n){return n!="mp4a.40.34"}),r.stream.codecs=i.join(",")}},shaka.hls.HlsParser.prototype.createVariants_=function(t,r,i,n,s,o,l){for(var u=shaka.util.ManifestParserUtils.ContentType,m=shaka.media.DrmEngine,E=$jscomp.makeIterator(r),y=E.next();!y.done;y=E.next())this.addVideoAttributes_(y.value.stream,n,s,o,l);for(n=this.config_.disableAudio,(!t.length||n)&&(t=[null]),n=this.config_.disableVideo,(!r.length||n)&&(r=[null]),n=[],t=$jscomp.makeIterator(t),s=t.next();!s.done;s=t.next())for(s=s.value,o=$jscomp.makeIterator(r),l=o.next();!l.done;l=o.next()){var D=l.value;l=s?s.stream:null,E=D?D.stream:null,y=s?s.stream.drmInfos:null;var w=D?D.stream.drmInfos:null;D=(D?D.verbatimMediaPlaylistUri:"")+" - "+(s?s.verbatimMediaPlaylistUri:""),l&&E&&!m.areDrmCompatible(y,w)?shaka.log.warning("Incompatible DRM info in HLS variant.  Skipping."):this.variantUriSet_.has(D)?shaka.log.debug("Skipping variant which only differs in text streams."):(goog.asserts.assert(!l||l.type==u.AUDIO,"Audio parameter mismatch!"),goog.asserts.assert(!E||E.type==u.VIDEO,"Video parameter mismatch!"),l={id:this.globalId_++,language:l?l.language:"und",primary:!!l&&l.primary||!!E&&E.primary,audio:l,video:E,bandwidth:i,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},n.push(l),this.variantUriSet_.add(D))}return n},shaka.hls.HlsParser.prototype.parseClosedCaptions_=function(t){t=shaka.hls.Utils.filterTagsByType(t,"CLOSED-CAPTIONS"),t=$jscomp.makeIterator(t);for(var r=t.next();!r.done;r=t.next()){var i=r.value;goog.asserts.assert(i.name=="EXT-X-MEDIA","Should only be called on media tags!"),r=this.getLanguage_(i);var n=i.getRequiredAttrValue("GROUP-ID");i=i.getRequiredAttrValue("INSTREAM-ID"),this.groupIdToClosedCaptionsMap_.get(n)||this.groupIdToClosedCaptionsMap_.set(n,new Map),this.groupIdToClosedCaptionsMap_.get(n).set(i,r)}},shaka.hls.HlsParser.prototype.createStreamInfoFromMediaTag_=function(t){var r=this,i,n,s,o,l,u,m,E,y,D,w,B,F,V;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){return K.nextAddress==1?(goog.asserts.assert(t.name=="EXT-X-MEDIA","Should only be called on media tags!"),i=t.getRequiredAttrValue("GROUP-ID"),n="",s=r.getType_(t),s!=shaka.util.ManifestParserUtils.ContentType.TEXT&&i&&r.groupIdToCodecsMap_.has(i)&&(n=r.groupIdToCodecsMap_.get(i)),o=r.variableSubstitution_(t.getRequiredAttrValue("URI"),r.globalVariables_),r.uriToStreamInfosMap_.has(o)?K.return(r.uriToStreamInfosMap_.get(o)):(l=r.getLanguage_(t),u=t.getAttributeValue("NAME"),m=t.getAttributeValue("DEFAULT"),E=m=="YES",y=s=="audio"?r.getChannelsCount_(t):null,D=s=="audio"?r.isSpatialAudio_(t):!1,w=t.getAttributeValue("CHARACTERISTICS"),B=t.getAttributeValue("FORCED"),F=B=="YES",K.yield(r.createStreamInfo_(o,n,s,l,E,u,y,null,w,F,D),2))):(V=K.yieldResult,r.groupIdToStreamInfosMap_.has(i)?r.groupIdToStreamInfosMap_.get(i).push(V):r.groupIdToStreamInfosMap_.set(i,[V]),V==null?K.return(null):r.uriToStreamInfosMap_.has(o)?K.return(r.uriToStreamInfosMap_.get(o)):(r.uriToStreamInfosMap_.set(o,V),K.return(V)))})},shaka.hls.HlsParser.prototype.createStreamInfoFromImageTag_=function(t){var r=this,i,n,s,o,l,u,m,E,y,D,w;return $jscomp.asyncExecutePromiseGeneratorProgram(function(B){return B.nextAddress==1?(goog.asserts.assert(t.name=="EXT-X-IMAGE-STREAM-INF","Should only be called on image tags!"),i=shaka.util.ManifestParserUtils.ContentType.IMAGE,n=r.variableSubstitution_(t.getRequiredAttrValue("URI"),r.globalVariables_),s=t.getAttributeValue("CODECS","jpeg")||"",r.uriToStreamInfosMap_.has(n)?B.return(r.uriToStreamInfosMap_.get(n)):(o=r.getLanguage_(t),l=t.getAttributeValue("NAME"),u=t.getAttributeValue("CHARACTERISTICS"),B.yield(r.createStreamInfo_(n,s,i,o,!1,l,null,null,u,!1,!1),2))):(m=B.yieldResult,m==null?B.return(null):r.uriToStreamInfosMap_.has(n)?B.return(r.uriToStreamInfosMap_.get(n)):((E=t.getAttributeValue("RESOLUTION"))&&(y=m.stream.segmentIndex.get(0),(D=y.getTilesLayout())&&(m.stream.width=Number(E.split("x")[0])*Number(D.split("x")[0]),m.stream.height=Number(E.split("x")[1])*Number(D.split("x")[1]))),(w=t.getAttributeValue("BANDWIDTH"))&&(m.stream.bandwidth=Number(w)),r.uriToStreamInfosMap_.set(n,m),B.return(m)))})},shaka.hls.HlsParser.prototype.createStreamInfoFromVariantTag_=function(t,r,i,n){var s=this,o,l,u,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return E.nextAddress==1?(goog.asserts.assert(t.name=="EXT-X-STREAM-INF","Should only be called on variant tags!"),o=s.variableSubstitution_(t.getRequiredAttrValue("URI"),s.globalVariables_),s.uriToStreamInfosMap_.has(o)?E.return(s.uriToStreamInfosMap_.get(o)):(l=s.getClosedCaptions_(t,i),u=shaka.util.ManifestParserUtils.guessCodecs(i,r),E.yield(s.createStreamInfo_(o,u,i,"und",!1,null,null,l,null,!1,!1,n),2))):(m=E.yieldResult,m==null?E.return(null):s.uriToStreamInfosMap_.has(o)?E.return(s.uriToStreamInfosMap_.get(o)):(s.uriToStreamInfosMap_.set(o,m),E.return(m)))})},shaka.hls.HlsParser.prototype.createStreamInfo_=function(t,r,i,n,s,o,l,u,m,E,y,D){var w=this,B,F,V,K,q,re,ee,H,te,W,z,X,Q,$,oe,ae,_e,ve,Pe,fe,xe,Ce,De,ke,Xe,et,tt,nt,Be,Fe,J,ue,de,Oe,Ue,Ke,at,ut,st;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ct){switch(ct.nextAddress){case 1:return B=shaka.hls.Utils.constructAbsoluteUri(w.masterPlaylistUri_,t),ct.yield(w.requestManifest_(B),2);case 2:if(F=ct.yieldResult,B=F.uri,V=w.manifestTextParser_.parsePlaylist(F.data,B),V.type!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);if(K=[],V.segments)for(q=$jscomp.makeIterator(V.segments),re=q.next();!re.done;re=q.next())ee=re.value,H=shaka.hls.Utils.filterTagsByName(ee.tags,"EXT-X-KEY"),K.push.apply(K,$jscomp.arrayFromIterable(H));for(te=!1,W=[],z=new Set,X=$jscomp.makeIterator(K),Q=X.next();!Q.done;Q=X.next())if($=Q.value,oe=$.getRequiredAttrValue("METHOD"),oe!="NONE"){if(te=!0,oe=="AES-128")return shaka.log.warning("Unsupported HLS Encryption",oe),w.aesEncrypted_=!0,ct.return(null);if(ae=$.getRequiredAttrValue("KEYFORMAT"),ve=(_e=shaka.hls.HlsParser.KEYFORMATS_TO_DRM_PARSERS_[ae])?_e($):null){if(ve.keyIds)for(Pe=$jscomp.makeIterator(ve.keyIds),fe=Pe.next();!fe.done;fe=Pe.next())xe=fe.value,z.add(xe);W.push(ve)}else shaka.log.warning("Unsupported HLS KEYFORMAT",ae)}if(te&&!W.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_KEYFORMATS_NOT_SUPPORTED);return Ce=shaka.hls.Utils.filterTagsByName(V.tags,"EXT-X-DEFINE"),De=w.parseMediaVariables_(Ce),goog.asserts.assert(V.segments!=null,"Media playlist should have segments!"),w.determinePresentationType_(V),ct.yield(w.guessMimeType_(i,r,V,De),3);case 3:return ke=ct.yieldResult,shaka.hls.HlsParser.RAW_FORMATS_.includes(ke)&&(r=""),Xe=new Map,et=new Map,ct.setCatchFinallyBlocks(4),ct.yield(w.createSegments_(t,V,i,ke,Xe,De,et,r,D),6);case 6:tt=ct.yieldResult,ct.leaveTryBlock(5);break;case 4:if(nt=ct.enterCatchBlock(),nt.code==shaka.util.Error.Code.HLS_INTERNAL_SKIP_STREAM)return shaka.log.alwaysWarn("Skipping unsupported HLS stream",ke,t),ct.return(null);throw nt;case 5:if(Be=tt[0].startTime,Fe=tt[tt.length-1].endTime,J=new shaka.media.SegmentIndex(tt),ue=i==shaka.util.ManifestParserUtils.ContentType.TEXT?shaka.util.ManifestParserUtils.TextStreamKind.SUBTITLE:void 0,de=[],m)for(Oe=$jscomp.makeIterator(m.split(",")),Ue=Oe.next();!Ue.done;Ue=Oe.next())Ke=Ue.value,de.push(Ke);return ut=(at=shaka.hls.Utils.getFirstTagWithName(V.tags,"EXT-X-SERVER-CONTROL"))?at.getAttribute("CAN-SKIP-UNTIL")!=null:!1,st={id:w.globalId_++,originalId:o,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:J,mimeType:ke,codecs:r,kind:ue,encrypted:te,drmInfos:W,keyIds:z,language:n,label:o,type:i,primary:s,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:de,forced:E,channelsCount:l,audioSamplingRate:null,spatialAudio:y,closedCaptions:u,hdr:void 0,tilesLayout:void 0},ct.return({stream:st,verbatimMediaPlaylistUri:t,absoluteMediaPlaylistUri:B,minTimestamp:Be,maxTimestamp:Fe,mediaSequenceToStartTime:Xe,discontinuityToMediaSequence:et,canSkipSegments:ut})}})},shaka.hls.HlsParser.prototype.determinePresentationType_=function(t){var r=shaka.hls.HlsParser.PresentationType_,i=shaka.hls.Utils.getFirstTagWithName(t.tags,"EXT-X-PLAYLIST-TYPE"),n=shaka.hls.Utils.getFirstTagWithName(t.tags,"EXT-X-ENDLIST");n=i&&i.value=="VOD"||n,i=i&&i.value=="EVENT"&&!n,i=!n&&!i,n?this.setPresentationType_(r.VOD):(i?this.setPresentationType_(r.LIVE):this.setPresentationType_(r.EVENT),r=this.getRequiredTag_(t.tags,"EXT-X-TARGETDURATION"),r=Number(r.value),n=shaka.hls.Utils.getFirstTagWithName(t.tags,"EXT-X-PART-INF"),this.lowLatencyMode_&&n?(this.partialTargetDuration_=Number(n.getRequiredAttrValue("PART-TARGET")),this.minTargetDuration_=Math.min(this.partialTargetDuration_,this.minTargetDuration_),this.lowLatencyPresentationDelay_=(t=shaka.hls.Utils.getFirstTagWithName(t.tags,"EXT-X-SERVER-CONTROL"))?Number(t.getRequiredAttrValue("PART-HOLD-BACK")):0):this.minTargetDuration_=Math.min(r,this.minTargetDuration_),this.maxTargetDuration_=Math.max(r,this.maxTargetDuration_))},shaka.hls.HlsParser.prototype.createPresentationTimeline_=function(){this.isLive_()?(this.presentationTimeline_=new shaka.media.PresentationTimeline(0,this.config_.defaultPresentationDelay?this.config_.defaultPresentationDelay:this.lowLatencyPresentationDelay_?this.lowLatencyPresentationDelay_:3*this.maxTargetDuration_),this.presentationTimeline_.setStatic(!1)):(this.presentationTimeline_=new shaka.media.PresentationTimeline(null,0),this.presentationTimeline_.setStatic(!0))},shaka.hls.HlsParser.prototype.getInitSegmentReference_=function(t,r,i){if(r=shaka.hls.Utils.getFirstTagWithName(r,"EXT-X-MAP"),!r)return null;var n=r.getRequiredAttrValue("URI");return i=this.variableSubstitution_(shaka.hls.Utils.constructAbsoluteUri(t,n),i),t=[i,r.getAttributeValue("BYTERANGE","")].join("-"),this.mapTagToInitSegmentRefMap_.has(t)||(r=this.createInitSegmentReference_(i,r),this.mapTagToInitSegmentRefMap_.set(t,r)),this.mapTagToInitSegmentRefMap_.get(t)},shaka.hls.HlsParser.prototype.createInitSegmentReference_=function(t,r){var i=0,n=null,s=r.getAttributeValue("BYTERANGE");return s&&(i=s.split("@"),n=Number(i[0]),i=Number(i[1]),n=i+n-1),new shaka.media.InitSegmentReference(function(){return[t]},i,n)},shaka.hls.HlsParser.prototype.createSegmentReference_=function(t,r,i,n,s,o,l,u){var m=i.tags,E=this.variableSubstitution_(i.absoluteUri,o),y=shaka.hls.Utils.getFirstTagWithName(m,"EXTINF"),D=0;o=0;var w=null;if(!y){if(i.partialSegments.length==0)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_TAG_MISSING,"EXTINF");if(!this.lowLatencyMode_)return null}var B=[];if(this.lowLatencyMode_){D={};for(var F=0;F<i.partialSegments.length;D={$jscomp$loop$prop$pAbsoluteUri$621:D.$jscomp$loop$prop$pAbsoluteUri$621},F++){var V=i.partialSegments[F],K=F==0?r:B[B.length-1],q=F==0?n:K.endTime,re=Number(V.getAttributeValue("DURATION"))||this.partialTargetDuration_;if(re){re=q+re;var ee=0,H=null;V.name=="EXT-X-PRELOAD-HINT"?ee=(K=V.getAttributeValue("BYTERANGE-START"))?Number(K):0:(ee=V.getAttributeValue("BYTERANGE"),K=$jscomp.makeIterator(this.parseByteRange_(K,ee)),ee=K.next().value,H=K.next().value),(V=V.getAttributeValue("URI"))&&(D.$jscomp$loop$prop$pAbsoluteUri$621=shaka.hls.Utils.constructAbsoluteUri(l,V),q=new shaka.media.SegmentReference(q,re,function(te){return function(){return[te.$jscomp$loop$prop$pAbsoluteUri$621]}}(D),ee,H,t,s,0,1/0),B.push(q))}}}return y?(i=y.value.split(","),D=n+Number(i[0])):D=B[B.length-1].endTime,(i=shaka.hls.Utils.getFirstTagWithName(m,"EXT-X-BYTERANGE"))?(w=$jscomp.makeIterator(this.parseByteRange_(r,i.value)),o=w.next().value,w=w.next().value):B.length&&(o=B[0].startByte,w=B[B.length-1].endByte),r="",i=null,u==shaka.util.ManifestParserUtils.ContentType.IMAGE&&(r="1x1",u=shaka.hls.Utils.getFirstTagWithName(m,"EXT-X-TILES"))&&(r=u.getRequiredAttrValue("LAYOUT"),(u=u.getAttributeValue("DURATION"))&&(i=Number(u))),new shaka.media.SegmentReference(n,D,function(){return E.length?[E]:[]},o,w,t,s,0,1/0,B,r,i)},shaka.hls.HlsParser.prototype.parseByteRange_=function(t,r){var i=0,n=null;return r&&(i=r.split("@"),n=Number(i[0]),i[1]?i=Number(i[1]):(goog.asserts.assert(t,"Cannot refer back to previous HLS segment!"),i=t.endByte+1),n=i+n-1),[i,n]},shaka.hls.HlsParser.prototype.notifySegments_=function(){if(this.presentationTimeline_){for(var t=$jscomp.makeIterator(this.segmentsToNotifyByStream_),r=t.next();!r.done;r=t.next())this.presentationTimeline_.notifySegments(r.value);this.segmentsToNotifyByStream_=[]}},shaka.hls.HlsParser.prototype.createSegments_=function(t,r,i,n,s,o,l,u,m){var E=this,y,D,w,B,F,V,K,q,re,ee,H,te,W,z,X,Q,$,oe,ae,_e,ve;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pe){switch(Pe.nextAddress){case 1:if(y=r.segments,goog.asserts.assert(y.length,"Playlist should have segments!"),w=shaka.hls.Utils.getFirstTagWithNameAsNumber(r.tags,"EXT-X-MEDIA-SEQUENCE",0),F=(B=shaka.hls.Utils.getFirstTagWithName(r.tags,"EXT-X-SKIP"))?Number(B.getAttributeValue("SKIPPED-SEGMENTS")):0,V=w+F,E.isLive_()&&s.has(V)){K=s.get(V),Pe.jumpTo(2);break}if(E.playlistStartTime_!=null){Pe.jumpTo(3);break}return D=E.getInitSegmentReference_(r.absoluteUri,y[0].tags,o),goog.asserts.assert(i!=shaka.util.ManifestParserUtils.ContentType.TEXT&&i!=shaka.util.ManifestParserUtils.ContentType.IMAGE,"Should only get start time from audio or video streams"),q=E,Pe.yield(E.getStartTime_(t,D,n,V,!1,y[0],o,i,u,m),4);case 4:q.playlistStartTime_=Pe.yieldResult;case 3:K=E.playlistStartTime_;case 2:if(re=y[0].absoluteUri,shaka.log.debug("First segment",re.split("/").pop(),"starts at",K),ee=shaka.hls.Utils.getFirstTagWithNameAsNumber(r.tags,"EXT-X-DISCONTINUITY-SEQUENCE"),E.lowLatencyMode_&&(l.has(ee)||l.set(ee,V),F))for(H=l;H.has(ee+1)&&H.get(ee+1)<V;)ee++;te=E.discontinuityToTso_.get(ee)||0,W=[],z=0;case 5:if(!(z<y.length)){Pe.jumpTo(7);break}if(X=y[z],Q=W[W.length-1],$=z==0?K:Q.endTime,V=w+F+z,s.set(V,$),D=E.getInitSegmentReference_(r.absoluteUri,X.tags,o),oe=shaka.hls.Utils.getFirstTagWithName(X.tags,"EXT-X-DISCONTINUITY"),!oe){Pe.jumpTo(8);break}return ee++,l.set(ee,V),Pe.yield(E.getTimestampOffset_(ee,t,D,n,V,X,o,$,i,u,m),9);case 9:te=Pe.yieldResult;case 8:!E.lowLatencyMode_&&(ae=E.playerInterface_.isAutoLowLatencyMode())&&(E.playerInterface_.enableLowLatencyMode(),E.lowLatencyMode_=E.playerInterface_.isLowLatencyMode()),_e=shaka.hls.Utils.getFirstTagWithName(X.tags,"EXTINF"),E.lowLatencyMode_||_e?(ve=E.createSegmentReference_(D,Q,X,$,te,o,r.absoluteUri,i))&&W.push(ve):E.lowLatencyMode_||shaka.log.alwaysWarn("Low-latency HLS live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."),z++,Pe.jumpTo(5);break;case 7:return Pe.return(W)}})},shaka.hls.HlsParser.prototype.getTimestampOffset_=function(t,r,i,n,s,o,l,u,m,E,y){var D=this,w,B;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){return F.nextAddress==1?(w=0,D.discontinuityToTso_.has(t)?(w=D.discontinuityToTso_.get(t),F.jumpTo(2)):F.yield(D.getStartTime_(r,i,n,s,!0,o,l,m,E,y),3)):(F.nextAddress!=2&&(B=F.yieldResult,w=u-B,shaka.log.v1("Segment timestampOffset =",w),D.discontinuityToTso_.set(t,w)),F.return(w))})},shaka.hls.HlsParser.prototype.fetchStartOfSegment_=function(t,r,i,n,s){var o=this,l,u,m,E,y,D;return $jscomp.asyncExecutePromiseGeneratorProgram(function(w){switch(w.nextAddress){case 1:return l=shaka.net.NetworkingEngine.RequestType.SEGMENT,u=shaka.util.Networking.createSegmentRequest(t.getUris(),t.startByte,t.endByte,o.config_.retryParameters),o.playerInterface_.modifySegmentRequest(u,{type:r,init:t instanceof shaka.media.InitSegmentReference,duration:t.endTime-t.startTime,mimeType:i,codecs:n,bandwidth:s}),o.config_.hls.useFullSegmentsForStartTime?w.return(o.makeNetworkRequest_(u,l)):(m=shaka.util.Networking.createSegmentRequest(t.getUris(),t.startByte,t.startByte+shaka.hls.HlsParser.START_OF_SEGMENT_SIZE_-1,o.config_.retryParameters),o.playerInterface_.modifySegmentRequest(m,{type:r,init:t instanceof shaka.media.InitSegmentReference,duration:t.endTime-t.startTime,mimeType:i,codecs:n,bandwidth:s}),w.setCatchFinallyBlocks(2),w.yield(o.makeNetworkRequest_(m,l),4));case 4:return E=w.yieldResult,w.return(E);case 2:if(y=w.enterCatchBlock(),y.code==shaka.util.Error.Code.OPERATION_ABORTED)throw y;return shaka.log.alwaysWarn("Unable to fetch the starting part of HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",m.uris[0]),w.yield(o.makeNetworkRequest_(u,l),5);case 5:return D=w.yieldResult,w.return(D)}})},shaka.hls.HlsParser.prototype.getStartTime_=function(t,r,i,n,s,o,l,u,m,E){var y=this,D,w,B,F,V,K,q,re;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ee){switch(ee.nextAddress){case 1:if(D=y.createSegmentReference_(r,null,o,0,0,l,"",u),goog.asserts.assert(D!=null,"Segment reference should not be null!"),y.manifest_&&!s){if(w=y.uriToStreamInfosMap_.get(t),B=w.mediaSequenceToStartTime.get(n),B!=null)return shaka.log.v1("Found segment start time in previous manifest",B),ee.return(B);shaka.log.debug("Unable to find segment start time in previous manifest!")}if(shaka.log.v1("Fetching segment to find start time"),i=i.toLowerCase(),shaka.hls.HlsParser.RAW_FORMATS_.includes(i))throw shaka.log.alwaysWarn("Raw formats are not yet supported.  Skipping "+i),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INTERNAL_SKIP_STREAM);if(i=="video/webm")throw shaka.log.alwaysWarn("WebM in HLS is not yet supported.  Skipping."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INTERNAL_SKIP_STREAM);if(i!="video/mp4"&&i!="audio/mp4"){ee.jumpTo(2);break}return F=[y.fetchStartOfSegment_(D,u,i,m,E)],r&&F.push(y.fetchStartOfSegment_(r,u,i,m,E)),ee.yield(Promise.all(F),3);case 3:return V=ee.yieldResult,K=V[0],q=V[1]||V[0],ee.return(y.getStartTimeFromMp4Segment_(t,K.uri,K.data,q.data));case 2:if(i!="video/mp2t"){ee.jumpTo(4);break}return ee.yield(y.fetchStartOfSegment_(D,u,i,m,E),5);case 5:return re=ee.yieldResult,goog.asserts.assert(re.data,"Should have a response body!"),ee.return(y.getStartTimeFromTsSegment_(t,re.uri,re.data));case 4:throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,t)}})},shaka.hls.HlsParser.prototype.getStartTimeFromMp4Segment_=function(t,r,i,n){var s=shaka.util.Mp4Parser,o=0;if(new s().box("moov",s.children).box("trak",s.children).box("mdia",s.children).fullBox("mdhd",function(m){goog.asserts.assert(m.version==0||m.version==1,"MDHD version can only be 0 or 1"),o=shaka.util.Mp4BoxParsers.parseMDHD(m.reader,m.version).timescale,m.parser.stop()}).parse(n,!0),!o)throw shaka.log.error("Unable to find timescale in init segment!"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,t,r);var l=0,u=!1;if(new s().box("moof",s.children).box("traf",s.children).fullBox("tfdt",function(m){goog.asserts.assert(m.version==0||m.version==1,"TFDT version can only be 0 or 1"),l=shaka.util.Mp4BoxParsers.parseTFDT(m.reader,m.version).baseMediaDecodeTime/o,u=!0,m.parser.stop()}).parse(i,!0),!u)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,t,r);return l},shaka.hls.HlsParser.prototype.getStartTimeFromTsSegment_=function(t,r,i){var n=new shaka.util.DataViewReader(i,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),s=function(){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,t,r)},o=0,l=0;i=function(){n.seek(o+188),l=n.readUint8(),l!=71&&(n.seek(o+192),l=n.readUint8()),l!=71&&(n.seek(o+204),l=n.readUint8()),l!=71&&s(),n.rewind(1)};for(var u=Math.min(n.getLength()-188,940);;){if(o=n.getPosition(),l=n.readUint8(),l!=71){if(0<u){--u;continue}s()}u=0;var m=n.readUint16();if((m&8191)==8191)i();else if(m&16384)if(m=(n.readUint8()&48)>>4,m!=0&&m!=2||s(),m==3&&(m=n.readUint8(),n.skip(m)),n.readUint32()>>8!=1)i();else return n.skip(3),i=n.readUint8()>>6,i!=0&&i!=1||s(),u=n.readUint8(),u==0&&s(),i==2?goog.asserts.assert(u==5,"Bad PES header?"):i==3&&goog.asserts.assert(u==10,"Bad PES header?"),i=n.readUint8(),u=n.readUint16(),m=n.readUint16(),(1073741824*((i&14)>>1)+((u&65534)<<14|(m&65534)>>1))/shaka.hls.HlsParser.TS_TIMESCALE_;else i()}},shaka.hls.HlsParser.prototype.variableSubstitution_=function(t,r){var i=String(t).replace(/%7B/g,"{").replace(/%7D/g,"}"),n=i.match(/{\$\w*}/g);if(n){n=$jscomp.makeIterator(n);for(var s=n.next();!s.done;s=n.next()){s=s.value;var o=s.slice(2,s.length-1),l=r.get(o);if(l)i=i.replace(s,l);else throw shaka.log.error("A variable has been found that is not declared",o),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_VARIABLE_NOT_FOUND,o)}}return i},shaka.hls.HlsParser.prototype.guessMimeType_=function(t,r,i,n){var s=this,o,l,u,m,E,y,D,w,B,F,V,K;return $jscomp.asyncExecutePromiseGeneratorProgram(function(q){return q.nextAddress==1?(o=shaka.hls.HlsParser,l=shaka.util.ManifestParserUtils.ContentType,u=shaka.net.NetworkingEngine.RequestType.SEGMENT,goog.asserts.assert(i.segments.length,"Playlist should have segments!"),m=s.variableSubstitution_(i.segments[0].absoluteUri,n),E=new goog.Uri(m),y=E.getPath().split(".").pop(),D=o.EXTENSION_MAP_BY_CONTENT_TYPE_[t],(w=D[y])?q.return(w):t==l.TEXT?r&&r!="vtt"&&r!="wvtt"?q.return("application/mp4"):q.return("text/vtt"):t==l.IMAGE&&(!r||r=="jpeg")?q.return("image/jpeg"):(B=shaka.net.NetworkingEngine.makeRequest([m],s.config_.retryParameters),B.method="HEAD",q.yield(s.makeNetworkRequest_(B,u),2))):(F=q.yieldResult,V=F.headers["content-type"],V?q.return(V.split(";")[0]):(K=D.mp4,q.return(K)))})},shaka.hls.HlsParser.prototype.getRequiredTag_=function(t,r){var i=shaka.hls.Utils.getFirstTagWithName(t,r);if(!i)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_TAG_MISSING,r);return i},shaka.hls.HlsParser.prototype.addVideoAttributes_=function(t,r,i,n,s){t&&(t.width=Number(r)||void 0,t.height=Number(i)||void 0,t.frameRate=Number(n)||void 0,t.hdr=s||void 0)},shaka.hls.HlsParser.prototype.requestManifest_=function(t){var r=shaka.net.NetworkingEngine.RequestType.MANIFEST;return t=shaka.net.NetworkingEngine.makeRequest([t],this.config_.retryParameters),this.playerInterface_.modifyManifestRequest(t,{format:shaka.util.CmcdManager.StreamingFormat.HLS}),this.makeNetworkRequest_(t,r)},shaka.hls.HlsParser.prototype.onUpdate_=function(){var t=this,r,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(n.nextAddress==1)return shaka.log.info("Updating manifest..."),goog.asserts.assert(0<t.updatePlaylistDelay_,"We should only call |onUpdate_| when we are suppose to be updating."),t.playerInterface_?(n.setCatchFinallyBlocks(2),n.yield(t.update(),4)):n.return();if(n.nextAddress!=2)return r=t.updatePlaylistDelay_,t.updatePlaylistTimer_.tickAfter(r),n.leaveTryBlock(0);if(i=n.enterCatchBlock(),!t.playerInterface_)return n.return();goog.asserts.assert(i instanceof shaka.util.Error,"Should only receive a Shaka error"),i.severity=shaka.util.Error.Severity.RECOVERABLE,t.playerInterface_.onError(i),t.updatePlaylistTimer_.tickAfter(.1),n.jumpToEnd()})},shaka.hls.HlsParser.prototype.isLive_=function(){return this.presentationType_!=shaka.hls.HlsParser.PresentationType_.VOD},shaka.hls.HlsParser.prototype.setPresentationType_=function(t){this.presentationType_=t,this.presentationTimeline_&&this.presentationTimeline_.setStatic(!this.isLive_()),this.isLive_()||this.updatePlaylistTimer_.stop()},shaka.hls.HlsParser.prototype.makeNetworkRequest_=function(t,r){if(!this.operationManager_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);var i=this.playerInterface_.networkingEngine.request(r,t);return this.operationManager_.manage(i),i.promise},shaka.hls.HlsParser.widevineDrmParser_=function(t){var r=t.getRequiredAttrValue("METHOD"),i=["SAMPLE-AES","SAMPLE-AES-CTR"];return i.includes(r)?(r=t.getRequiredAttrValue("URI"),r=shaka.net.DataUriPlugin.parseRaw(r),r=shaka.util.BufferUtils.toUint8(r.data),r=shaka.util.ManifestParserUtils.createDrmInfo("com.widevine.alpha",[{initDataType:"cenc",initData:r}]),(t=t.getAttributeValue("KEYID"))&&(t=t.toLowerCase(),goog.asserts.assert(t.startsWith("0x"),"Incorrect KEYID format!"),r.keyIds=new Set([t.substr(2)])),r):(shaka.log.error("Widevine in HLS is only supported with [",i.join(", "),"], not",r),null)},shaka.hls.HlsParser.playreadyDrmParser_=function(t){var r=t.getRequiredAttrValue("METHOD"),i=["SAMPLE-AES","SAMPLE-AES-CTR"];return i.includes(r)?(t=t.getRequiredAttrValue("URI"),t=shaka.net.DataUriPlugin.parseRaw(t),t=shaka.util.BufferUtils.toUint8(t.data),r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),t=shaka.util.Pssh.createPssh(t,r),shaka.util.ManifestParserUtils.createDrmInfo("com.microsoft.playready",[{initDataType:"cenc",initData:t}])):(shaka.log.error("PlayReady in HLS is only supported with [",i.join(", "),"], not",r),null)},goog.exportSymbol("shaka.hls.HlsParser",shaka.hls.HlsParser),shaka.hls.HlsParser.AUDIO_EXTENSIONS_TO_MIME_TYPES_={mp4:"audio/mp4",mp4a:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",m4f:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},shaka.hls.HlsParser.RAW_FORMATS_=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"],shaka.hls.HlsParser.VIDEO_EXTENSIONS_TO_MIME_TYPES_={mp4:"video/mp4",mp4v:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",m4f:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t"},shaka.hls.HlsParser.TEXT_EXTENSIONS_TO_MIME_TYPES_={mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",m4f:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"},shaka.hls.HlsParser.IMAGE_EXTENSIONS_TO_MIME_TYPES_={jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml",webp:"image/webp",avif:"image/avif"},shaka.hls.HlsParser.EXTENSION_MAP_BY_CONTENT_TYPE_={audio:shaka.hls.HlsParser.AUDIO_EXTENSIONS_TO_MIME_TYPES_,video:shaka.hls.HlsParser.VIDEO_EXTENSIONS_TO_MIME_TYPES_,text:shaka.hls.HlsParser.TEXT_EXTENSIONS_TO_MIME_TYPES_,image:shaka.hls.HlsParser.IMAGE_EXTENSIONS_TO_MIME_TYPES_},shaka.hls.HlsParser.KEYFORMATS_TO_DRM_PARSERS_={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":shaka.hls.HlsParser.widevineDrmParser_,"com.microsoft.playready":shaka.hls.HlsParser.playreadyDrmParser_},shaka.hls.HlsParser.PresentationType_={VOD:"VOD",EVENT:"EVENT",LIVE:"LIVE"},shaka.hls.HlsParser.TS_TIMESCALE_=9e4,shaka.hls.HlsParser.START_OF_SEGMENT_SIZE_=2048,shaka.media.ManifestParser.registerParserByExtension("m3u8",function(){return new shaka.hls.HlsParser}),shaka.media.ManifestParser.registerParserByMime("application/x-mpegurl",function(){return new shaka.hls.HlsParser}),shaka.media.ManifestParser.registerParserByMime("application/vnd.apple.mpegurl",function(){return new shaka.hls.HlsParser}),shaka.net.HttpPluginUtils=function(){},shaka.net.HttpPluginUtils.makeResponse=function(t,r,i,n,s,o){if(200<=i&&299>=i&&i!=202)return{uri:s||n,originalUri:n,data:r,status:i,headers:t,fromCache:!!t["x-shaka-from-cache"]};s=null;try{s=shaka.util.StringUtils.fromBytesAutoDetect(r)}catch{}throw shaka.log.debug("HTTP error text:",s),new shaka.util.Error(i==401||i==403?shaka.util.Error.Severity.CRITICAL:shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.BAD_HTTP_STATUS,n,i,s,t,o)},shaka.net.HttpFetchPlugin=function(){},shaka.net.HttpFetchPlugin.parse=function(t,r,i,n,s){var o=new shaka.net.HttpFetchPlugin.Headers_;shaka.util.MapUtils.asMap(r.headers).forEach(function(E,y){o.append(y,E)});var l=new shaka.net.HttpFetchPlugin.AbortController_,u={canceled:!1,timedOut:!1};if(t=shaka.net.HttpFetchPlugin.request_(t,i,{body:r.body||void 0,headers:o,method:r.method,signal:l.signal,credentials:r.allowCrossSiteCredentials?"include":void 0},u,n,s,r.streamDataCallback),t=new shaka.util.AbortableOperation(t,function(){return u.canceled=!0,l.abort(),Promise.resolve()}),r=r.retryParameters.timeout){var m=new shaka.util.Timer(function(){u.timedOut=!0,l.abort()});m.tickAfter(r/1e3),t.finally(function(){m.stop()})}return t},shaka.net.HttpFetchPlugin.request_=function(t,r,i,n,s,o,l){var u,m,E,y,D,w,B,F,V,K,q,re,ee;return $jscomp.asyncExecutePromiseGeneratorProgram(function(H){switch(H.nextAddress){case 1:return u=shaka.net.HttpFetchPlugin.fetch_,m=shaka.net.HttpFetchPlugin.ReadableStream_,w=D=0,B=Date.now(),H.setCatchFinallyBlocks(2),H.yield(u(t,i),4);case 4:return E=H.yieldResult,o(shaka.net.HttpFetchPlugin.headersToGenericObject_(E.headers)),F=E.clone().body.getReader(),K=(V=E.headers.get("Content-Length"))?parseInt(V,10):0,q=function(te){var W=function(){var z,X,Q;return $jscomp.asyncExecutePromiseGeneratorProgram(function($){switch($.nextAddress){case 1:return $.setCatchFinallyBlocks(2),$.yield(F.read(),4);case 4:z=$.yieldResult,$.leaveTryBlock(3);break;case 2:return X=$.enterCatchBlock(),shaka.log.v1("error reading from stream",X.message),$.return();case 3:if(z.done){$.jumpTo(5);break}if(D+=z.value.byteLength,!l){$.jumpTo(5);break}return $.yield(l(z.value),5);case 5:Q=Date.now(),(100<Q-B||z.done)&&(s(Q-B,D-w,K-D),w=D,B=Q),z.done?(goog.asserts.assert(!z.value,'readObj should be unset when "done" is true.'),te.close()):(te.enqueue(z.value),W()),$.jumpToEnd()}})};W()},new m({start:q}),H.yield(E.arrayBuffer(),5);case 5:y=H.yieldResult,H.leaveTryBlock(3);break;case 2:throw re=H.enterCatchBlock(),n.canceled?new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.OPERATION_ABORTED,t,r):n.timedOut?new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,t,r):new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.HTTP_ERROR,t,re,r);case 3:return ee=shaka.net.HttpFetchPlugin.headersToGenericObject_(E.headers),H.return(shaka.net.HttpPluginUtils.makeResponse(ee,y,E.status,t,E.url,r))}})},shaka.net.HttpFetchPlugin.headersToGenericObject_=function(t){var r={};return t.forEach(function(i,n){r[n.trim()]=i}),r},shaka.net.HttpFetchPlugin.isSupported=function(){if(window.ReadableStream)try{new ReadableStream({})}catch{return!1}else return!1;return!(!window.fetch||!window.AbortController)},goog.exportSymbol("shaka.net.HttpFetchPlugin",shaka.net.HttpFetchPlugin),goog.exportProperty(shaka.net.HttpFetchPlugin,"isSupported",shaka.net.HttpFetchPlugin.isSupported),goog.exportProperty(shaka.net.HttpFetchPlugin,"parse",shaka.net.HttpFetchPlugin.parse),shaka.net.HttpFetchPlugin.fetch_=window.fetch,shaka.net.HttpFetchPlugin.AbortController_=window.AbortController,shaka.net.HttpFetchPlugin.ReadableStream_=window.ReadableStream,shaka.net.HttpFetchPlugin.Headers_=window.Headers,shaka.net.HttpFetchPlugin.isSupported()&&(shaka.net.NetworkingEngine.registerScheme("http",shaka.net.HttpFetchPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.PREFERRED,!0),shaka.net.NetworkingEngine.registerScheme("https",shaka.net.HttpFetchPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.PREFERRED,!0),shaka.net.NetworkingEngine.registerScheme("blob",shaka.net.HttpFetchPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.PREFERRED,!0)),shaka.net.HttpXHRPlugin=function(){},shaka.net.HttpXHRPlugin.parse=function(t,r,i,n,s){var o=new shaka.net.HttpXHRPlugin.Xhr_,l=Date.now(),u=0,m=new Promise(function(E,y){o.open(r.method,t,!0),o.responseType="arraybuffer",o.timeout=r.retryParameters.timeout,o.withCredentials=r.allowCrossSiteCredentials,o.onabort=function(){y(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.OPERATION_ABORTED,t,i))};var D=!1;o.onreadystatechange=function(F){o.readyState!=2||D||(F=shaka.net.HttpXHRPlugin.headersToGenericObject_(o),s(F),D=!0)},o.onload=function(F){F=shaka.net.HttpXHRPlugin.headersToGenericObject_(o),goog.asserts.assert(o.response instanceof ArrayBuffer,"XHR should have a response by now!");var V=o.response;try{var K=shaka.net.HttpPluginUtils.makeResponse(F,V,o.status,t,o.responseURL,i);E(K)}catch(q){goog.asserts.assert(q instanceof shaka.util.Error,"Wrong error type!"),y(q)}},o.onerror=function(F){y(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.HTTP_ERROR,t,F,i))},o.ontimeout=function(F){y(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,t,i))},o.onprogress=function(F){var V=Date.now();(100<V-l||F.lengthComputable&&F.loaded==F.total)&&(n(V-l,F.loaded-u,F.total-F.loaded),u=F.loaded,l=V)};for(var w in r.headers){var B=w.toLowerCase();o.setRequestHeader(B,r.headers[w])}o.send(r.body)});return new shaka.util.AbortableOperation(m,function(){return o.abort(),Promise.resolve()})},shaka.net.HttpXHRPlugin.headersToGenericObject_=function(t){var r=t.getAllResponseHeaders().trim().split(`\r
`);t={},r=$jscomp.makeIterator(r);for(var i=r.next();!i.done;i=r.next())i=i.value.split(": "),t[i[0].toLowerCase()]=i.slice(1).join(": ");return t},goog.exportSymbol("shaka.net.HttpXHRPlugin",shaka.net.HttpXHRPlugin),goog.exportProperty(shaka.net.HttpXHRPlugin,"parse",shaka.net.HttpXHRPlugin.parse),shaka.net.HttpXHRPlugin.Xhr_=window.XMLHttpRequest,shaka.net.NetworkingEngine.registerScheme("http",shaka.net.HttpXHRPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.FALLBACK,!0),shaka.net.NetworkingEngine.registerScheme("https",shaka.net.HttpXHRPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.FALLBACK,!0),shaka.net.NetworkingEngine.registerScheme("blob",shaka.net.HttpXHRPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.FALLBACK,!0),shaka.offline={},shaka.offline.DownloadInfo=function(t,r,i,n){this.ref=t,this.estimateId=r,this.groupId=i,this.isInitSegment=n},shaka.offline.DownloadInfo.idForSegmentRef=function(t){return t.getUris().map(function(r){return"{"+encodeURI(r)+"}"}).join("")+":"+t.startByte+":"+t.endByte},shaka.offline.DownloadInfo.prototype.getRefId=function(){return shaka.offline.DownloadInfo.idForSegmentRef(this.ref)},shaka.offline.DownloadInfo.prototype.makeSegmentRequest=function(t){return shaka.util.Networking.createSegmentRequest(this.ref.getUris(),this.ref.startByte,this.ref.endByte,t.streaming.retryParameters)},shaka.offline.DownloadProgressEstimator=function(){this.actualDownloaded_=this.estimatedDownloaded_=this.estimatedTotal_=0,this.pending_=new Map,this.nextId_=0},shaka.offline.DownloadProgressEstimator.prototype.open=function(t){this.estimatedTotal_+=t;var r=this.nextId_;return this.nextId_++,this.pending_.set(r,t),r},shaka.offline.DownloadProgressEstimator.prototype.close=function(t,r){if(this.pending_.has(t)){var i=this.pending_.get(t);this.pending_.delete(t),this.estimatedDownloaded_+=i,this.actualDownloaded_+=r}},shaka.offline.DownloadProgressEstimator.prototype.getEstimatedProgress=function(){return this.estimatedTotal_==0?0:this.estimatedDownloaded_/this.estimatedTotal_},shaka.offline.DownloadProgressEstimator.prototype.getTotalDownloaded=function(){return this.actualDownloaded_},shaka.offline.DownloadManager=function(t){var r=this;this.networkingEngine_=t,this.groups_=new Map,this.destroyer_=new shaka.util.Destroyer(function(){return r.abortAll().catch(function(){})}),this.abortCallbacks_=[],this.onProgress_=function(i,n){},this.onInitData_=function(i,n){},this.estimator_=new shaka.offline.DownloadProgressEstimator},shaka.offline.DownloadManager.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.offline.DownloadManager.prototype.setCallbacks=function(t,r){this.onProgress_=t,this.onInitData_=r},shaka.offline.DownloadManager.prototype.abortAll=function(){var t=this.abortCallbacks_.map(function(r){return r()});return this.abortCallbacks_=[],Promise.all(t)},shaka.offline.DownloadManager.prototype.addDownloadEstimate=function(t){return this.estimator_.open(t)},shaka.offline.DownloadManager.prototype.queue=function(t,r,i,n,s){var o=this;this.destroyer_.ensureNotDestroyed();var l=(this.groups_.get(t)||Promise.resolve()).then(function(){var u,m,E,y,D,w,B;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){if(F.nextAddress==1)return F.yield(o.fetchSegment_(r),2);if(u=F.yieldResult,o.destroyer_.destroyed())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.OPERATION_ABORTED);if(n)for(y in m=shaka.util.BufferUtils.toUint8(u),E=new shaka.util.Pssh(m),E.data)D=Number(y),w=E.data[D],B=E.systemIds[D],o.onInitData_(w,B);return o.estimator_.close(i,u.byteLength),o.onProgress_(o.estimator_.getEstimatedProgress(),o.estimator_.getTotalDownloaded()),F.return(s(u))})});return this.groups_.set(t,l),l},shaka.offline.DownloadManager.prototype.queueWork=function(t,r){this.destroyer_.ensureNotDestroyed();var i=(this.groups_.get(t)||Promise.resolve()).then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return n.yield(r(),0)})});return this.groups_.set(t,i),i},shaka.offline.DownloadManager.prototype.waitToFinish=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return r.nextAddress==1?r.yield(Promise.all(t.groups_.values()),2):r.return(t.estimator_.getTotalDownloaded())})},shaka.offline.DownloadManager.prototype.fetchSegment_=function(t){var r=this,i,n,s,o;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){return l.nextAddress==1?(i=shaka.net.NetworkingEngine.RequestType.SEGMENT,n=r.networkingEngine_.request(i,t),s=function(){return n.abort()},r.abortCallbacks_.push(s),l.yield(n.promise,2)):(o=l.yieldResult,shaka.util.ArrayUtils.remove(r.abortCallbacks_,s),l.return(o.data))})},shaka.offline.indexeddb={},shaka.offline.indexeddb.DBOperation=function(t,r){var i=this;this.transaction_=t,this.store_=t.objectStore(r),this.promise_=new shaka.util.PublicPromise,t.onabort=function(n){n.preventDefault(),i.promise_.reject()},t.onerror=function(n){n.preventDefault(),i.promise_.reject()},t.oncomplete=function(n){i.promise_.resolve()}},shaka.offline.indexeddb.DBOperation.prototype.abort=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(r.nextAddress==1){try{t.transaction_.abort()}catch{}return r.setCatchFinallyBlocks(2),r.yield(t.promise_,4)}if(r.nextAddress!=2)return r.leaveTryBlock(0);r.enterCatchBlock(),r.jumpToEnd()})},shaka.offline.indexeddb.DBOperation.prototype.forEachEntry=function(t){var r=this;return new Promise(function(i,n){var s=r.store_.openCursor();s.onerror=n,s.onsuccess=function(o){var l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){if(u.nextAddress==1)return s.result==null?(i(),u.return()):(l=s.result,u.yield(t(l.key,l.value,l),2));l.continue(),u.jumpToEnd()})}})},shaka.offline.indexeddb.DBOperation.prototype.store=function(){return this.store_},shaka.offline.indexeddb.DBOperation.prototype.promise=function(){return this.promise_},shaka.offline.indexeddb.DBConnection=function(t){this.connection_=t,this.pending_=[]},shaka.offline.indexeddb.DBConnection.prototype.destroy=function(){return Promise.all(this.pending_.map(function(t){return t.abort()}))},shaka.offline.indexeddb.DBConnection.prototype.startReadOnlyOperation=function(t){return this.startOperation_(t,"readonly")},shaka.offline.indexeddb.DBConnection.prototype.startReadWriteOperation=function(t){return this.startOperation_(t,"readwrite")},shaka.offline.indexeddb.DBConnection.prototype.startOperation_=function(t,r){var i=this,n=this.connection_.transaction([t],r),s=new shaka.offline.indexeddb.DBOperation(n,t);return this.pending_.push(s),s.promise().then(function(){return i.stopTracking_(s)},function(){return i.stopTracking_(s)}),s},shaka.offline.indexeddb.DBConnection.prototype.stopTracking_=function(t){shaka.util.ArrayUtils.remove(this.pending_,t)},shaka.offline.indexeddb.BaseStorageCell=function(t,r,i){this.connection_=new shaka.offline.indexeddb.DBConnection(t),this.segmentStore_=r,this.manifestStore_=i},shaka.offline.indexeddb.BaseStorageCell.prototype.destroy=function(){return this.connection_.destroy()},shaka.offline.indexeddb.BaseStorageCell.prototype.hasFixedKeySpace=function(){return!0},shaka.offline.indexeddb.BaseStorageCell.prototype.addSegments=function(t){return this.rejectAdd(this.segmentStore_)},shaka.offline.indexeddb.BaseStorageCell.prototype.removeSegments=function(t,r){return this.remove_(this.segmentStore_,t,r)},shaka.offline.indexeddb.BaseStorageCell.prototype.getSegments=function(t){var r=this,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return n.nextAddress==1?n.yield(r.get_(r.segmentStore_,t),2):(i=n.yieldResult,n.return(i.map(function(s){return r.convertSegmentData(s)})))})},shaka.offline.indexeddb.BaseStorageCell.prototype.addManifests=function(t){return this.rejectAdd(this.manifestStore_)},shaka.offline.indexeddb.BaseStorageCell.prototype.updateManifest=function(t,r){return this.rejectUpdate(this.manifestStore_)},shaka.offline.indexeddb.BaseStorageCell.prototype.updateManifestImplementation=function(t,r){var i=this.connection_.startReadWriteOperation(this.manifestStore_),n=i.store();return n.get(t).onsuccess=function(s){n.put(r,t)},i.promise()},shaka.offline.indexeddb.BaseStorageCell.prototype.updateManifestExpiration=function(t,r){var i=this.connection_.startReadWriteOperation(this.manifestStore_),n=i.store();return n.get(t).onsuccess=function(s){(s=s.target.result)&&(s.expiration=r,n.put(s,t))},i.promise()},shaka.offline.indexeddb.BaseStorageCell.prototype.removeManifests=function(t,r){return this.remove_(this.manifestStore_,t,r)},shaka.offline.indexeddb.BaseStorageCell.prototype.getManifests=function(t){var r=this,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return n.nextAddress==1?n.yield(r.get_(r.manifestStore_,t),2):(i=n.yieldResult,n.return(Promise.all(i.map(function(s){return r.convertManifest(s)}))))})},shaka.offline.indexeddb.BaseStorageCell.prototype.getAllManifests=function(){var t=this,r,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return n.nextAddress==1?(r=t.connection_.startReadOnlyOperation(t.manifestStore_),i=new Map,n.yield(r.forEachEntry(function(s,o){var l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){if(u.nextAddress==1)return u.yield(t.convertManifest(o),2);l=u.yieldResult,i.set(s,l),u.jumpToEnd()})}),2)):n.nextAddress!=3?n.yield(r.promise(),3):n.return(i)})},shaka.offline.indexeddb.BaseStorageCell.prototype.convertSegmentData=function(t){return t},shaka.offline.indexeddb.BaseStorageCell.prototype.convertManifest=function(t){return Promise.resolve(t)},shaka.offline.indexeddb.BaseStorageCell.prototype.rejectAdd=function(t){return Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.NEW_KEY_OPERATION_NOT_SUPPORTED,"Cannot add new value to "+t))},shaka.offline.indexeddb.BaseStorageCell.prototype.rejectUpdate=function(t){return Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MODIFY_OPERATION_NOT_SUPPORTED,"Cannot modify values in "+t))},shaka.offline.indexeddb.BaseStorageCell.prototype.add=function(t,r){var i=this,n,s,o,l,u,m,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){if(y.nextAddress==1){for(n=i.connection_.startReadWriteOperation(t),s=n.store(),o=[],l={},u=$jscomp.makeIterator(r),m=u.next();!m.done;l={$jscomp$loop$prop$request$623:l.$jscomp$loop$prop$request$623},m=u.next())E=m.value,l.$jscomp$loop$prop$request$623=s.add(E),l.$jscomp$loop$prop$request$623.onsuccess=function(D){return function(w){o.push(D.$jscomp$loop$prop$request$623.result)}}(l);return y.yield(n.promise(),2)}return y.return(o)})},shaka.offline.indexeddb.BaseStorageCell.prototype.remove_=function(t,r,i){t=this.connection_.startReadWriteOperation(t);var n=t.store(),s={};r=$jscomp.makeIterator(r);for(var o=r.next();!o.done;s={$jscomp$loop$prop$key$625:s.$jscomp$loop$prop$key$625},o=r.next())s.$jscomp$loop$prop$key$625=o.value,n.delete(s.$jscomp$loop$prop$key$625).onsuccess=function(l){return function(){return i(l.$jscomp$loop$prop$key$625)}}(s);return t.promise()},shaka.offline.indexeddb.BaseStorageCell.prototype.get_=function(t,r){var i=this,n,s,o,l,u,m,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){if(y.nextAddress==1){for(n=i.connection_.startReadOnlyOperation(t),s=n.store(),o={},l=[],u={},m=$jscomp.makeIterator(r),E=m.next();!E.done;u={$jscomp$loop$prop$request$627:u.$jscomp$loop$prop$request$627,$jscomp$loop$prop$key$628:u.$jscomp$loop$prop$key$628},E=m.next())u.$jscomp$loop$prop$key$628=E.value,u.$jscomp$loop$prop$request$627=s.get(u.$jscomp$loop$prop$key$628),u.$jscomp$loop$prop$request$627.onsuccess=function(D){return function(){D.$jscomp$loop$prop$request$627.result==null&&l.push(D.$jscomp$loop$prop$key$628),o[D.$jscomp$loop$prop$key$628]=D.$jscomp$loop$prop$request$627.result}}(u);return y.yield(n.promise(),2)}if(l.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+l);return y.return(r.map(function(D){return o[D]}))})},shaka.offline.indexeddb.EmeSessionStorageCell=function(t,r){this.connection_=new shaka.offline.indexeddb.DBConnection(t),this.store_=r},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.destroy=function(){return this.connection_.destroy()},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.getAll=function(){var t=this,r,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return n.nextAddress==1?(r=t.connection_.startReadOnlyOperation(t.store_),i=[],n.yield(r.forEachEntry(function(s,o){i.push(o)}),2)):n.nextAddress!=3?n.yield(r.promise(),3):n.return(i)})},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.add=function(t){var r=this.connection_.startReadWriteOperation(this.store_),i=r.store();t=$jscomp.makeIterator(t);for(var n=t.next();!n.done;n=t.next())i.add(n.value);return r.promise()},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.remove=function(t){var r=this,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return n.nextAddress==1?(i=r.connection_.startReadWriteOperation(r.store_),n.yield(i.forEachEntry(function(s,o,l){t.includes(o.sessionId)&&l.delete()}),2)):n.yield(i.promise(),0)})},shaka.offline.StorageCellHandle={},shaka.offline.StorageCellPath={},shaka.offline.StorageMuxer=function(){this.mechanisms_=new Map},shaka.offline.StorageMuxer.prototype.destroy=function(){for(var t=[],r=$jscomp.makeIterator(this.mechanisms_.values()),i=r.next();!i.done;i=r.next())t.push(i.value.destroy());return this.mechanisms_.clear(),Promise.all(t)},shaka.offline.StorageMuxer.prototype.init=function(){var t=this;shaka.offline.StorageMuxer.getRegistry_().forEach(function(s,o){var l=s();l?t.mechanisms_.set(o,l):shaka.log.info("Skipping "+o+" as it is not supported on this platform")});for(var r=[],i=$jscomp.makeIterator(this.mechanisms_.values()),n=i.next();!n.done;n=i.next())r.push(n.value.init());return Promise.all(r)},shaka.offline.StorageMuxer.prototype.getActive=function(){var t=null;if(this.mechanisms_.forEach(function(r,i){r.getCells().forEach(function(n,s){n.hasFixedKeySpace()||t||(t={path:{mechanism:i,cell:s},cell:n})})}),t)return t;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find a cell that supports add-operations")},shaka.offline.StorageMuxer.prototype.forEachCell=function(t){this.mechanisms_.forEach(function(r,i){r.getCells().forEach(function(n,s){t({mechanism:i,cell:s},n)})})},shaka.offline.StorageMuxer.prototype.getCell=function(t,r){var i=this.mechanisms_.get(t);if(!i)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find mechanism with name "+t);if(i=i.getCells().get(r),!i)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find cell with name "+r);return i},shaka.offline.StorageMuxer.prototype.forEachEmeSessionCell=function(t){this.mechanisms_.forEach(function(r,i){t(r.getEmeSessionCell())})},shaka.offline.StorageMuxer.prototype.getEmeSessionCell=function(){var t=Array.from(this.mechanisms_.keys());if(!t.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORAGE_NOT_SUPPORTED,"No supported storage mechanisms found");return this.mechanisms_.get(t[0]).getEmeSessionCell()},shaka.offline.StorageMuxer.prototype.resolvePath=function(t){var r=this.mechanisms_.get(t.mechanism);return r?r.getCells().get(t.cell):null},shaka.offline.StorageMuxer.prototype.erase=function(){var t=this,r,i,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){return s.nextAddress==1?(r=Array.from(t.mechanisms_.values()),i=0<r.length,i||(n=shaka.offline.StorageMuxer.getRegistry_(),n.forEach(function(o,l){var u=o();u&&r.push(u)})),s.yield(Promise.all(r.map(function(o){return o.erase()})),2)):i?s.jumpTo(0):s.yield(Promise.all(r.map(function(o){return o.destroy()})),0)})},shaka.offline.StorageMuxer.register=function(t,r){shaka.offline.StorageMuxer.registry_.set(t,r)},shaka.offline.StorageMuxer.unregister=function(t){shaka.offline.StorageMuxer.registry_.delete(t)},shaka.offline.StorageMuxer.support=function(){var t=shaka.offline.StorageMuxer.getRegistry_();t=$jscomp.makeIterator(t.values());for(var r=t.next();!r.done;r=t.next())if(r=r.value,r=r())return r.destroy(),!0;return!1},shaka.offline.StorageMuxer.overrideSupport=function(t){shaka.offline.StorageMuxer.override_=t},shaka.offline.StorageMuxer.clearOverride=function(){shaka.offline.StorageMuxer.override_=null},shaka.offline.StorageMuxer.getRegistry_=function(){var t=shaka.offline.StorageMuxer.override_,r=shaka.offline.StorageMuxer.registry_;return COMPILED?r:t||r},goog.exportSymbol("shaka.offline.StorageMuxer",shaka.offline.StorageMuxer),goog.exportProperty(shaka.offline.StorageMuxer,"unregister",shaka.offline.StorageMuxer.unregister),goog.exportProperty(shaka.offline.StorageMuxer,"register",shaka.offline.StorageMuxer.register),goog.exportProperty(shaka.offline.StorageMuxer.prototype,"destroy",shaka.offline.StorageMuxer.prototype.destroy),shaka.offline.StorageMuxer.override_=null,shaka.offline.StorageMuxer.registry_=new Map,shaka.offline.indexeddb.V1StorageCell=function(){shaka.offline.indexeddb.BaseStorageCell.apply(this,arguments)},$jscomp.inherits(shaka.offline.indexeddb.V1StorageCell,shaka.offline.indexeddb.BaseStorageCell),shaka.offline.indexeddb.V1StorageCell.prototype.updateManifestExpiration=function(t,r){var i=this,n,s,o;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){return n=i.connection_.startReadWriteOperation(i.manifestStore_),s=n.store(),o=new shaka.util.PublicPromise,s.get(t).onsuccess=function(u){(u=u.target.result)?(goog.asserts.assert(u.key==t,"With in-line keys, the keys should match"),u.expiration=r,s.put(u),o.resolve()):o.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+t))},l.yield(Promise.all([n.promise(),o]),0)})},shaka.offline.indexeddb.V1StorageCell.prototype.convertManifest=function(t){var r,i,n,s,o,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){if(m.nextAddress==1){for(r=shaka.offline.indexeddb.V1StorageCell,i=[],n=0;n<t.periods.length;++n)s=n==t.periods.length-1?t.duration:t.periods[n+1].startTime,o=s-t.periods[n].startTime,l=r.convertPeriod_(t.periods[n],o),i.push(l);return m.yield(shaka.util.PeriodCombiner.combineDbStreams(i),2)}return u=m.yieldResult,m.return({creationTime:0,originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:t.expiration==null?1/0:t.expiration,streams:u,sessionIds:t.sessionIds,drmInfo:t.drmInfo,appMetadata:t.appMetadata})})},shaka.offline.indexeddb.V1StorageCell.convertPeriod_=function(t,r){var i=shaka.offline.indexeddb.V1StorageCell;i.fillMissingVariants_(t);for(var n=$jscomp.makeIterator(t.streams),s=n.next();!s.done;s=n.next())goog.asserts.assert(s.value.variantIds,"After filling in missing variants, each stream should have variant ids");return t.streams.map(function(o){return i.convertStream_(o,t.startTime,r)})},shaka.offline.indexeddb.V1StorageCell.convertStream_=function(t,r,i){var n=shaka.offline.indexeddb.V1StorageCell,s=t.initSegmentUri?n.getKeyFromSegmentUri_(t.initSegmentUri):null,o=r+t.presentationTimeOffset,l=r+i;return{id:t.id,originalId:null,primary:t.primary,type:t.contentType,mimeType:t.mimeType,codecs:t.codecs,frameRate:t.frameRate,pixelAspectRatio:void 0,hdr:void 0,kind:t.kind,language:t.language,label:t.label,width:t.width,height:t.height,initSegmentKey:s,encrypted:t.encrypted,keyIds:new Set([t.keyId]),segments:t.segments.map(function(u){return n.convertSegment_(u,s,r,l,o)}),variantIds:t.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0}},shaka.offline.indexeddb.V1StorageCell.convertSegment_=function(t,r,i,n,s){var o=shaka.offline.indexeddb.V1StorageCell.getKeyFromSegmentUri_(t.uri);return{startTime:i+t.startTime,endTime:i+t.endTime,dataKey:o,initSegmentKey:r,appendWindowStart:i,appendWindowEnd:n,timestampOffset:s,tilesLayout:""}},shaka.offline.indexeddb.V1StorageCell.prototype.convertSegmentData=function(t){return{data:t.data}},shaka.offline.indexeddb.V1StorageCell.getKeyFromSegmentUri_=function(t){var r;if((r=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(t))||(r=/^offline:segment\/([0-9]+)$/.exec(t)))return Number(r[1]);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,"Could not parse uri "+t)},shaka.offline.indexeddb.V1StorageCell.fillMissingVariants_=function(t){var r=shaka.util.ManifestParserUtils.ContentType.AUDIO,i=shaka.util.ManifestParserUtils.ContentType.VIDEO,n=t.streams.filter(function(E){return E.contentType==r});if(t=t.streams.filter(function(E){return E.contentType==i}),!n.every(function(E){return E.variantIds})||!t.every(function(E){return E.variantIds})){goog.asserts.assert(n.every(function(E){return!E.variantIds}),"Some audio streams have variant ids and some do not."),goog.asserts.assert(t.every(function(E){return!E.variantIds}),"Some video streams have variant ids and some do not.");for(var s=$jscomp.makeIterator(n),o=s.next();!o.done;o=s.next())o.value.variantIds=[];for(s=$jscomp.makeIterator(t),o=s.next();!o.done;o=s.next())o.value.variantIds=[];if(s=0,t.length&&!n.length){shaka.log.debug("Found video-only content. Creating variants for video.");var l=s++,u=$jscomp.makeIterator(t);for(o=u.next();!o.done;o=u.next())o.value.variantIds.push(l)}if(!t.length&&n.length)for(shaka.log.debug("Found audio-only content. Creating variants for audio."),l=s++,u=$jscomp.makeIterator(n),o=u.next();!o.done;o=u.next())o.value.variantIds.push(l);if(t.length&&n.length)for(shaka.log.debug("Found audio-video content. Creating variants."),n=$jscomp.makeIterator(n),o=n.next();!o.done;o=n.next())for(o=o.value,l=$jscomp.makeIterator(t),u=l.next();!u.done;u=l.next()){u=u.value;var m=s++;o.variantIds.push(m),u.variantIds.push(m)}}},shaka.offline.indexeddb.V2StorageCell=function(){shaka.offline.indexeddb.BaseStorageCell.apply(this,arguments)},$jscomp.inherits(shaka.offline.indexeddb.V2StorageCell,shaka.offline.indexeddb.BaseStorageCell),shaka.offline.indexeddb.V2StorageCell.prototype.convertManifest=function(t){var r=this,i,n,s,o,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){if(m.nextAddress==1){for(i=[],n=0;n<t.periods.length;++n)s=n==t.periods.length-1?t.duration:t.periods[n+1].startTime,o=s-t.periods[n].startTime,l=r.convertPeriod_(t.periods[n],o),i.push(l);return m.yield(shaka.util.PeriodCombiner.combineDbStreams(i),2)}return u=m.yieldResult,m.return({appMetadata:t.appMetadata,creationTime:0,drmInfo:t.drmInfo,duration:t.duration,expiration:t.expiration==null?1/0:t.expiration,originalManifestUri:t.originalManifestUri,sessionIds:t.sessionIds,size:t.size,streams:u})})},shaka.offline.indexeddb.V2StorageCell.prototype.convertPeriod_=function(t,r){for(var i=[],n=$jscomp.makeIterator(t.streams),s=n.next();!s.done;s=n.next())s=s.value,s.variantIds.length!=0&&i.push(this.convertStream_(s,t.startTime,t.startTime+r));return i},shaka.offline.indexeddb.V2StorageCell.prototype.convertStream_=function(t,r,i){var n=this;return{id:t.id,originalId:t.originalId,primary:t.primary,type:t.contentType,mimeType:t.mimeType,codecs:t.codecs,frameRate:t.frameRate,pixelAspectRatio:t.pixelAspectRatio,hdr:void 0,kind:t.kind,language:t.language,label:t.label,width:t.width,height:t.height,encrypted:t.encrypted,keyIds:new Set([t.keyId]),segments:t.segments.map(function(s){return n.convertSegment_(s,t.initSegmentKey,r,i,t.presentationTimeOffset)}),variantIds:t.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0}},shaka.offline.indexeddb.V2StorageCell.prototype.convertSegment_=function(t,r,i,n,s){return{startTime:i+t.startTime,endTime:i+t.endTime,initSegmentKey:r,appendWindowStart:i,appendWindowEnd:n,timestampOffset:i-s,dataKey:t.dataKey,tilesLayout:""}},shaka.offline.indexeddb.V5StorageCell=function(){shaka.offline.indexeddb.BaseStorageCell.apply(this,arguments)},$jscomp.inherits(shaka.offline.indexeddb.V5StorageCell,shaka.offline.indexeddb.BaseStorageCell),shaka.offline.indexeddb.V5StorageCell.prototype.hasFixedKeySpace=function(){return!1},shaka.offline.indexeddb.V5StorageCell.prototype.addSegments=function(t){return this.add(this.segmentStore_,t)},shaka.offline.indexeddb.V5StorageCell.prototype.addManifests=function(t){return this.add(this.manifestStore_,t)},shaka.offline.indexeddb.V5StorageCell.prototype.updateManifest=function(t,r){return this.updateManifestImplementation(t,r)},shaka.offline.indexeddb.V5StorageCell.prototype.convertManifest=function(t){return t.expiration==null&&(t.expiration=1/0),Promise.resolve(t)},shaka.offline.indexeddb.StorageMechanism=function(){this.sessions_=this.v5_=this.v3_=this.v2_=this.v1_=this.db_=null},shaka.offline.indexeddb.StorageMechanism.prototype.init=function(){var t=this,r=shaka.offline.indexeddb.StorageMechanism.DB_NAME,i=shaka.offline.indexeddb.StorageMechanism.VERSION,n=new shaka.util.PublicPromise,s=window.indexedDB.open(r,i);return s.onsuccess=function(o){o=s.result,t.db_=o,t.v1_=shaka.offline.indexeddb.StorageMechanism.createV1_(o),t.v2_=shaka.offline.indexeddb.StorageMechanism.createV2_(o),t.v3_=shaka.offline.indexeddb.StorageMechanism.createV3_(o),t.v5_=shaka.offline.indexeddb.StorageMechanism.createV5_(o),t.sessions_=shaka.offline.indexeddb.StorageMechanism.createEmeSessionCell_(o),n.resolve()},s.onupgradeneeded=function(o){t.createStores_(s.result)},s.onerror=function(o){n.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.INDEXED_DB_ERROR,s.error)),o.preventDefault()},n},shaka.offline.indexeddb.StorageMechanism.prototype.destroy=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){switch(r.nextAddress){case 1:if(!t.v1_){r.jumpTo(2);break}return r.yield(t.v1_.destroy(),2);case 2:if(!t.v2_){r.jumpTo(4);break}return r.yield(t.v2_.destroy(),4);case 4:if(!t.v3_){r.jumpTo(6);break}return r.yield(t.v3_.destroy(),6);case 6:if(!t.v5_){r.jumpTo(8);break}return r.yield(t.v5_.destroy(),8);case 8:if(!t.sessions_){r.jumpTo(10);break}return r.yield(t.sessions_.destroy(),10);case 10:t.db_&&t.db_.close(),r.jumpToEnd()}})},shaka.offline.indexeddb.StorageMechanism.prototype.getCells=function(){var t=new Map;return this.v1_&&t.set("v1",this.v1_),this.v2_&&t.set("v2",this.v2_),this.v3_&&t.set("v3",this.v3_),this.v5_&&t.set("v5",this.v5_),t},shaka.offline.indexeddb.StorageMechanism.prototype.getEmeSessionCell=function(){return goog.asserts.assert(this.sessions_,"Cannot be destroyed."),this.sessions_},shaka.offline.indexeddb.StorageMechanism.prototype.erase=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){switch(r.nextAddress){case 1:if(!t.v1_){r.jumpTo(2);break}return r.yield(t.v1_.destroy(),2);case 2:if(!t.v2_){r.jumpTo(4);break}return r.yield(t.v2_.destroy(),4);case 4:if(!t.v3_){r.jumpTo(6);break}return r.yield(t.v3_.destroy(),6);case 6:if(!t.v5_){r.jumpTo(8);break}return r.yield(t.v5_.destroy(),8);case 8:return t.db_&&t.db_.close(),r.yield(shaka.offline.indexeddb.StorageMechanism.deleteAll_(),10);case 10:return t.db_=null,t.v1_=null,t.v2_=null,t.v3_=null,t.v5_=null,r.yield(t.init(),0)}})},shaka.offline.indexeddb.StorageMechanism.createV1_=function(t){var r=shaka.offline.indexeddb.StorageMechanism,i=r.V1_SEGMENT_STORE;r=r.V1_MANIFEST_STORE;var n=t.objectStoreNames;return n.contains(r)&&n.contains(i)?(shaka.log.debug("Mounting v1 idb storage cell"),new shaka.offline.indexeddb.V1StorageCell(t,i,r)):null},shaka.offline.indexeddb.StorageMechanism.createV2_=function(t){var r=shaka.offline.indexeddb.StorageMechanism,i=r.V2_SEGMENT_STORE;r=r.V2_MANIFEST_STORE;var n=t.objectStoreNames;return n.contains(r)&&n.contains(i)?(shaka.log.debug("Mounting v2 idb storage cell"),new shaka.offline.indexeddb.V2StorageCell(t,i,r)):null},shaka.offline.indexeddb.StorageMechanism.createV3_=function(t){var r=shaka.offline.indexeddb.StorageMechanism,i=r.V3_SEGMENT_STORE;r=r.V3_MANIFEST_STORE;var n=t.objectStoreNames;return n.contains(r)&&n.contains(i)?(shaka.log.debug("Mounting v3 idb storage cell"),new shaka.offline.indexeddb.V2StorageCell(t,i,r)):null},shaka.offline.indexeddb.StorageMechanism.createV5_=function(t){var r=shaka.offline.indexeddb.StorageMechanism,i=r.V5_SEGMENT_STORE;r=r.V5_MANIFEST_STORE;var n=t.objectStoreNames;return n.contains(r)&&n.contains(i)?(shaka.log.debug("Mounting v5 idb storage cell"),new shaka.offline.indexeddb.V5StorageCell(t,i,r)):null},shaka.offline.indexeddb.StorageMechanism.createEmeSessionCell_=function(t){var r=shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE;return t.objectStoreNames.contains(r)?(shaka.log.debug("Mounting session ID idb storage cell"),new shaka.offline.indexeddb.EmeSessionStorageCell(t,r)):null},shaka.offline.indexeddb.StorageMechanism.prototype.createStores_=function(t){for(var r=$jscomp.makeIterator([shaka.offline.indexeddb.StorageMechanism.V5_SEGMENT_STORE,shaka.offline.indexeddb.StorageMechanism.V5_MANIFEST_STORE,shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE]),i=r.next();!i.done;i=r.next())i=i.value,t.objectStoreNames.contains(i)||t.createObjectStore(i,{autoIncrement:!0})},shaka.offline.indexeddb.StorageMechanism.deleteAll_=function(){var t=shaka.offline.indexeddb.StorageMechanism.DB_NAME,r=new shaka.util.PublicPromise,i=window.indexedDB.deleteDatabase(t);return i.onblocked=function(n){shaka.log.warning("Deleting",t,"is being blocked",n)},i.onsuccess=function(n){r.resolve()},i.onerror=function(n){r.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.INDEXED_DB_ERROR,i.error)),n.preventDefault()},r},shaka.offline.indexeddb.StorageMechanism.DB_NAME="shaka_offline_db",shaka.offline.indexeddb.StorageMechanism.VERSION=5,shaka.offline.indexeddb.StorageMechanism.V1_SEGMENT_STORE="segment",shaka.offline.indexeddb.StorageMechanism.V2_SEGMENT_STORE="segment-v2",shaka.offline.indexeddb.StorageMechanism.V3_SEGMENT_STORE="segment-v3",shaka.offline.indexeddb.StorageMechanism.V5_SEGMENT_STORE="segment-v5",shaka.offline.indexeddb.StorageMechanism.V1_MANIFEST_STORE="manifest",shaka.offline.indexeddb.StorageMechanism.V2_MANIFEST_STORE="manifest-v2",shaka.offline.indexeddb.StorageMechanism.V3_MANIFEST_STORE="manifest-v3",shaka.offline.indexeddb.StorageMechanism.V5_MANIFEST_STORE="manifest-v5",shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE="session-ids",shaka.offline.StorageMuxer.register("idb",function(){return shaka.util.Platform.isChromecast()||shaka.util.Platform.isXboxOne()||!window.indexedDB?null:new shaka.offline.indexeddb.StorageMechanism}),shaka.offline.OfflineUri=function(t,r,i,n){this.type_=t,this.mechanism_=r,this.cell_=i,this.key_=n,this.asString_=["offline:",t,"/",r,"/",i,"/",n].join("")},shaka.offline.OfflineUri.prototype.isManifest=function(){return this.type_=="manifest"},shaka.offline.OfflineUri.prototype.isSegment=function(){return this.type_=="segment"},shaka.offline.OfflineUri.prototype.mechanism=function(){return this.mechanism_},shaka.offline.OfflineUri.prototype.cell=function(){return this.cell_},shaka.offline.OfflineUri.prototype.key=function(){return this.key_},shaka.offline.OfflineUri.prototype.toString=function(){return this.asString_},shaka.offline.OfflineUri.parse=function(t){if(t=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(t),t==null)return null;var r=t[1];if(r!="manifest"&&r!="segment")return null;var i=t[2];if(!i)return null;var n=t[3];return n&&r!=null?new shaka.offline.OfflineUri(r,i,n,Number(t[4])):null},shaka.offline.OfflineUri.manifest=function(t,r,i){return new shaka.offline.OfflineUri("manifest",t,r,i)},shaka.offline.OfflineUri.segment=function(t,r,i){return new shaka.offline.OfflineUri("segment",t,r,i)},shaka.offline.ManifestConverter=function(t,r){this.mechanism_=t,this.cell_=r},shaka.offline.ManifestConverter.prototype.fromManifestDB=function(t){var r=this,i=new shaka.media.PresentationTimeline(null,0);i.setDuration(t.duration);var n=t.streams.filter(function(E){return r.isAudio_(E)}),s=t.streams.filter(function(E){return r.isVideo_(E)});n=this.createVariants(n,s,i),s=t.streams.filter(function(E){return r.isText_(E)}).map(function(E){return r.fromStreamDB_(E,i)});var o=t.streams.filter(function(E){return r.isImage_(E)}).map(function(E){return r.fromStreamDB_(E,i)}),l=t.drmInfo?[t.drmInfo]:[];if(t.drmInfo)for(var u=$jscomp.makeIterator(n.values()),m=u.next();!m.done;m=u.next())m=m.value,m.audio&&m.audio.encrypted&&(m.audio.drmInfos=l),m.video&&m.video.encrypted&&(m.video.drmInfos=l);return{presentationTimeline:i,minBufferTime:2,offlineSessionIds:t.sessionIds,variants:Array.from(n.values()),textStreams:s,imageStreams:o}},shaka.offline.ManifestConverter.prototype.createVariants=function(t,r,i){for(var n=new Set,s=$jscomp.makeIterator(t),o=s.next();!o.done;o=s.next()){var l=$jscomp.makeIterator(o.value.variantIds);for(o=l.next();!o.done;o=l.next())n.add(o.value)}for(s=$jscomp.makeIterator(r),o=s.next();!o.done;o=s.next())for(l=$jscomp.makeIterator(o.value.variantIds),o=l.next();!o.done;o=l.next())n.add(o.value);for(s=new Map,n=$jscomp.makeIterator(n),o=n.next();!o.done;o=n.next())o=o.value,s.set(o,this.createEmptyVariant_(o));for(t=$jscomp.makeIterator(t),n=t.next();!n.done;n=t.next())for(n=n.value,o=this.fromStreamDB_(n,i),l=$jscomp.makeIterator(n.variantIds),n=l.next();!n.done;n=l.next())n=s.get(n.value),goog.asserts.assert(!n.audio,"A variant should only have one audio stream"),n.language=o.language,n.primary=n.primary||o.primary,n.audio=o;for(r=$jscomp.makeIterator(r),t=r.next();!t.done;t=r.next())for(n=t.value,t=this.fromStreamDB_(n,i),o=$jscomp.makeIterator(n.variantIds),n=o.next();!n.done;n=o.next())n=s.get(n.value),goog.asserts.assert(!n.video,"A variant should only have one video stream"),n.primary=n.primary||t.primary,n.video=t;return s},shaka.offline.ManifestConverter.prototype.fromStreamDB_=function(t,r){var i=this,n=t.segments.map(function(s,o){return i.fromSegmentDB_(o,s)});return r.notifySegments(n),n=new shaka.media.SegmentIndex(n),{id:t.id,originalId:t.originalId,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:n,mimeType:t.mimeType,codecs:t.codecs,width:t.width||void 0,height:t.height||void 0,frameRate:t.frameRate,pixelAspectRatio:t.pixelAspectRatio,hdr:t.hdr,kind:t.kind,encrypted:t.encrypted,drmInfos:[],keyIds:t.keyIds,language:t.language,label:t.label,type:t.type,primary:t.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:t.roles,forced:t.forced,channelsCount:t.channelsCount,audioSamplingRate:t.audioSamplingRate,spatialAudio:t.spatialAudio,closedCaptions:t.closedCaptions,tilesLayout:t.tilesLayout}},shaka.offline.ManifestConverter.prototype.fromSegmentDB_=function(t,r){var i=shaka.offline.OfflineUri.segment(this.mechanism_,this.cell_,r.dataKey),n=r.initSegmentKey!=null?this.fromInitSegmentDB_(r.initSegmentKey):null;return new shaka.media.SegmentReference(r.startTime,r.endTime,function(){return[i.toString()]},0,null,n,r.timestampOffset,r.appendWindowStart,r.appendWindowEnd,[],r.tilesLayout||"")},shaka.offline.ManifestConverter.prototype.fromInitSegmentDB_=function(t){var r=shaka.offline.OfflineUri.segment(this.mechanism_,this.cell_,t);return new shaka.media.InitSegmentReference(function(){return[r.toString()]},0,null)},shaka.offline.ManifestConverter.prototype.isAudio_=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.AUDIO},shaka.offline.ManifestConverter.prototype.isVideo_=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.VIDEO},shaka.offline.ManifestConverter.prototype.isText_=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.TEXT},shaka.offline.ManifestConverter.prototype.isImage_=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.IMAGE},shaka.offline.ManifestConverter.prototype.createEmptyVariant_=function(t){return{id:t,language:"",primary:!1,audio:null,video:null,bandwidth:0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]}},shaka.offline.OfflineManifestParser=function(){this.uri_=null},shaka.offline.OfflineManifestParser.prototype.configure=function(t){},shaka.offline.OfflineManifestParser.prototype.start=function(t,r){var i=this,n,s,o,l,u,m,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){switch(y.nextAddress){case 1:if(n=shaka.offline.OfflineUri.parse(t),i.uri_=n,n==null||!n.isManifest())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,t);return s=new shaka.offline.StorageMuxer,y.setFinallyBlock(2),y.yield(s.init(),4);case 4:return y.yield(s.getCell(n.mechanism(),n.cell()),5);case 5:return o=y.yieldResult,y.yield(o.getManifests([n.key()]),6);case 6:return l=y.yieldResult,u=l[0],m=new shaka.offline.ManifestConverter(n.mechanism(),n.cell()),E=m.fromManifestDB(u),r.makeTextStreamsForClosedCaptions(E),y.return(E);case 2:return y.enterFinallyBlock(),y.yield(s.destroy(),7);case 7:y.leaveFinallyBlock(0)}})},shaka.offline.OfflineManifestParser.prototype.stop=function(){return Promise.resolve()},shaka.offline.OfflineManifestParser.prototype.update=function(){},shaka.offline.OfflineManifestParser.prototype.onExpirationUpdated=function(t,r){var i=this,n,s,o,l,u,m,E,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(D){switch(D.nextAddress){case 1:return goog.asserts.assert(i.uri_,"Should not get update event before start has been called"),n=i.uri_,s=new shaka.offline.StorageMuxer,D.setCatchFinallyBlocks(2,3),D.yield(s.init(),5);case 5:return D.yield(s.getCell(n.mechanism(),n.cell()),6);case 6:return o=D.yieldResult,D.yield(o.getManifests([n.key()]),7);case 7:if(l=D.yieldResult,u=l[0],m=u.sessionIds.includes(t),E=u.expiration==null||u.expiration>r,!m||!E){D.jumpTo(3);break}return shaka.log.debug("Updating expiration for stored content"),D.yield(o.updateManifestExpiration(n.key(),r),3);case 3:return D.enterFinallyBlock(),D.yield(s.destroy(),10);case 10:D.leaveFinallyBlock(0);break;case 2:y=D.enterCatchBlock(),shaka.log.error("There was an error updating",n,y),D.jumpTo(3)}})},shaka.media.ManifestParser.registerParserByMime("application/x-offline-manifest",function(){return new shaka.offline.OfflineManifestParser}),shaka.offline.OfflineScheme=function(){},shaka.offline.OfflineScheme.plugin=function(t,r,i,n){return(r=shaka.offline.OfflineUri.parse(t))&&r.isManifest()?shaka.offline.OfflineScheme.getManifest_(t):r&&r.isSegment()?shaka.offline.OfflineScheme.getSegment_(r.key(),r):shaka.util.AbortableOperation.failed(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,t))},shaka.offline.OfflineScheme.getManifest_=function(t){return t={uri:t,originalUri:t,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}},shaka.util.AbortableOperation.completed(t)},shaka.offline.OfflineScheme.getSegment_=function(t,r){goog.asserts.assert(r.isSegment(),"Only segment uri's should be given to getSegment");var i=new shaka.offline.StorageMuxer;return shaka.util.AbortableOperation.completed(void 0).chain(function(){return i.init()}).chain(function(){return i.getCell(r.mechanism(),r.cell())}).chain(function(n){return n.getSegments([r.key()])}).chain(function(n){return{uri:r,data:n[0].data,headers:{}}}).finally(function(){return i.destroy()})},goog.exportSymbol("shaka.offline.OfflineScheme",shaka.offline.OfflineScheme),goog.exportProperty(shaka.offline.OfflineScheme,"plugin",shaka.offline.OfflineScheme.plugin),shaka.net.NetworkingEngine.registerScheme("offline",shaka.offline.OfflineScheme.plugin),shaka.offline.SessionDeleter=function(){},shaka.offline.SessionDeleter.prototype.delete=function(t,r,i){var n=this,s,o,l,u,m,E,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(D){switch(D.nextAddress){case 1:s=shaka.offline.SessionDeleter,o=[],l=$jscomp.makeIterator(s.createBuckets_(i)),u=l.next();case 2:if(u.done){D.jumpTo(4);break}return m=u.value,E=n.doDelete_(t,r,m),D.yield(E,5);case 5:y=D.yieldResult,o=o.concat(y),u=l.next(),D.jumpTo(2);break;case 4:return D.return(o)}})},shaka.offline.SessionDeleter.prototype.doDelete_=function(t,r,i){var n,s,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(u){switch(u.nextAddress){case 1:return n=new shaka.media.DrmEngine({netEngine:r,onError:function(){},onKeyStatus:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),u.setCatchFinallyBlocks(2),n.configure(t),u.yield(n.initForRemoval(i.info.keySystem,i.info.licenseUri,i.info.serverCertificate,i.info.audioCapabilities,i.info.videoCapabilities),4);case 4:u.leaveTryBlock(3);break;case 2:return s=u.enterCatchBlock(),shaka.log.warning("Error initializing EME",s),u.yield(n.destroy(),5);case 5:return u.return([]);case 3:return u.setCatchFinallyBlocks(6),u.yield(n.setServerCertificate(),8);case 8:u.leaveTryBlock(7);break;case 6:return o=u.enterCatchBlock(),shaka.log.warning("Error setting server certificate",o),u.yield(n.destroy(),9);case 9:return u.return([]);case 7:return l=[],u.yield(Promise.all(i.sessionIds.map(function(m){var E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){if(y.nextAddress==1)return y.setCatchFinallyBlocks(2),y.yield(n.removeSession(m),4);if(y.nextAddress!=2)return l.push(m),y.leaveTryBlock(0);E=y.enterCatchBlock(),shaka.log.warning("Error deleting offline session",E),y.jumpToEnd()})})),10);case 10:return u.yield(n.destroy(),11);case 11:return u.return(l)}})},shaka.offline.SessionDeleter.createBuckets_=function(t){var r=shaka.offline.SessionDeleter,i=[];t=$jscomp.makeIterator(t);for(var n=t.next();!n.done;n=t.next()){n=n.value;for(var s=!1,o=$jscomp.makeIterator(i),l=o.next();!l.done;l=o.next())if(l=l.value,r.isCompatible_(l.info,n)){l.sessionIds.push(n.sessionId),s=!0;break}s||i.push({info:n,sessionIds:[n.sessionId]})}return i},shaka.offline.SessionDeleter.isCompatible_=function(t,r){var i=shaka.util.ArrayUtils,n=function(s,o){return s.robustness==o.robustness&&s.contentType==o.contentType};return t.keySystem==r.keySystem&&t.licenseUri==r.licenseUri&&i.hasSameElements(t.audioCapabilities,r.audioCapabilities,n)&&i.hasSameElements(t.videoCapabilities,r.videoCapabilities,n)},shaka.offline.StoredContentUtils=function(){},shaka.offline.StoredContentUtils.fromManifest=function(t,r,i,n){goog.asserts.assert(r.variants.length,"Cannot create stored content from manifest with no variants.");var s=r.presentationTimeline.getDuration();return r=shaka.offline.StoredContentUtils.getTracks_(r),{offlineUri:null,originalManifestUri:t,duration:s,size:i,expiration:1/0,tracks:r,appMetadata:n,isIncomplete:!1}},shaka.offline.StoredContentUtils.fromManifestDB=function(t,r){goog.asserts.assert(r.streams.length,"Cannot create stored content from manifestDB with no streams.");var i=new shaka.offline.ManifestConverter(t.mechanism(),t.cell()).fromManifestDB(r),n=r.appMetadata||{};return i=shaka.offline.StoredContentUtils.getTracks_(i),goog.asserts.assert(r.expiration!=null,"Manifest expiration must be set by now!"),{offlineUri:t.toString(),originalManifestUri:r.originalManifestUri,duration:r.duration,size:r.size,expiration:r.expiration,tracks:i,appMetadata:n,isIncomplete:r.isIncomplete||!1}},shaka.offline.StoredContentUtils.getTracks_=function(t){var r=shaka.util.StreamUtils,i=[],n=r.getPlayableVariants(t.variants);n=$jscomp.makeIterator(n);for(var s=n.next();!s.done;s=n.next())i.push(r.variantToTrack(s.value));for(t=$jscomp.makeIterator(t.textStreams),n=t.next();!n.done;n=t.next())i.push(r.textStreamToTrack(n.value));return i},shaka.offline.StreamBandwidthEstimator=function(){this.estimateByStreamId_={}},shaka.offline.StreamBandwidthEstimator.prototype.addVariant=function(t){var r=t.audio,i=t.video;if(r&&!i&&this.setBitrate_(r.id,r.bandwidth||t.bandwidth),!r&&i&&this.setBitrate_(i.id,i.bandwidth||t.bandwidth),r&&i){var n=r.bandwidth||shaka.offline.StreamBandwidthEstimator.DEFAULT_AUDIO_BITRATE_,s=i.bandwidth||t.bandwidth-n;0>=s&&(shaka.log.warning("Audio bit rate consumes variants bandwidth. Setting video bandwidth to match variant's bandwidth."),s=t.bandwidth),this.setBitrate_(r.id,n),this.setBitrate_(i.id,s)}},shaka.offline.StreamBandwidthEstimator.prototype.setBitrate_=function(t,r){this.estimateByStreamId_[t]=r},shaka.offline.StreamBandwidthEstimator.prototype.addText=function(t){this.estimateByStreamId_[t.id]=shaka.offline.StreamBandwidthEstimator.DEFAULT_TEXT_BITRATE_},shaka.offline.StreamBandwidthEstimator.prototype.addImage=function(t){this.estimateByStreamId_[t.id]=t.bandwidth||shaka.offline.StreamBandwidthEstimator.DEFAULT_IMAGE_BITRATE_},shaka.offline.StreamBandwidthEstimator.prototype.getSegmentEstimate=function(t,r){var i=r.endTime-r.startTime;return this.getEstimate_(t)*i},shaka.offline.StreamBandwidthEstimator.prototype.getInitSegmentEstimate=function(t){return .5*this.getEstimate_(t)},shaka.offline.StreamBandwidthEstimator.prototype.getEstimate_=function(t){return t=this.estimateByStreamId_[t],t==null&&(t=0,shaka.log.error("Asking for bitrate of stream not given to the estimator")),t==0&&shaka.log.warning("Using bitrate of 0, this stream won't affect progress"),t},shaka.offline.StreamBandwidthEstimator.DEFAULT_AUDIO_BITRATE_=393216,shaka.offline.StreamBandwidthEstimator.DEFAULT_TEXT_BITRATE_=52,shaka.offline.StreamBandwidthEstimator.DEFAULT_IMAGE_BITRATE_=2048,shaka.offline.Storage=function(t){var r=this;if(t&&t.constructor!=shaka.Player)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.LOCAL_PLAYER_INSTANCE_REQUIRED);this.networkingEngine_=this.config_=null,t?(this.config_=t.getSharedConfiguration(),this.networkingEngine_=t.getNetworkingEngine(),goog.asserts.assert(this.networkingEngine_,"Storage should not be initialized with a player that had |destroy| called on it.")):(this.config_=shaka.util.PlayerConfiguration.createDefault(),this.networkingEngine_=new shaka.net.NetworkingEngine),this.openOperations_=[],this.openDownloadManagers_=[];var i=!t;this.destroyer_=new shaka.util.Destroyer(function(){var n,s,o,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){switch(m.nextAddress){case 1:return m.yield(Promise.all(r.openDownloadManagers_.map(function(E){return E.abortAll()})),2);case 2:for(n=function(){},s=[],o=$jscomp.makeIterator(r.openOperations_),l=o.next();!l.done;l=o.next())u=l.value,s.push(u.then(n,n));return m.yield(Promise.all(s),3);case 3:if(!i){m.jumpTo(4);break}return m.yield(r.networkingEngine_.destroy(),4);case 4:r.config_=null,r.networkingEngine_=null,m.jumpToEnd()}})})},shaka.offline.Storage.support=function(){return shaka.util.Platform.supportsMediaSource()?shaka.offline.StorageMuxer.support():!1},shaka.offline.Storage.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.offline.Storage.prototype.configure=function(t,r){return goog.asserts.assert(typeof t=="object"||arguments.length==2,"String configs should have values!"),arguments.length==2&&typeof t=="string"&&(t=shaka.util.ConfigUtils.convertToConfigObject(t,r)),goog.asserts.assert(typeof t=="object","Should be an object!"),t.manifest&&t.manifest.dash&&"defaultPresentationDelay"in t.manifest.dash&&(shaka.Deprecate.deprecateFeature(4,"manifest.dash.defaultPresentationDelay configuration","Please Use manifest.defaultPresentationDelay instead."),t.manifest.defaultPresentationDelay=t.manifest.dash.defaultPresentationDelay,delete t.manifest.dash.defaultPresentationDelay),goog.asserts.assert(this.config_,"Cannot reconfigure storage after calling destroy."),shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,t)},shaka.offline.Storage.prototype.getConfiguration=function(){goog.asserts.assert(this.config_,"Config must not be null!");var t=shaka.util.PlayerConfiguration.createDefault();return shaka.util.PlayerConfiguration.mergeConfigObjects(t,this.config_,shaka.util.PlayerConfiguration.createDefault()),t},shaka.offline.Storage.prototype.getNetworkingEngine=function(){return this.networkingEngine_},shaka.offline.Storage.prototype.store=function(t,r,i){var n=this;goog.asserts.assert(this.networkingEngine_,"Cannot call |store| after calling |destroy|.");var s=this.getConfiguration(),o=new shaka.offline.DownloadManager(this.networkingEngine_);this.openDownloadManagers_.push(o),r=this.store_(t,r||{},function(){var u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){return m.nextAddress==1?(goog.asserts.assert(n.networkingEngine_,"Should not call |store| after |destroy|"),m.yield(shaka.media.ManifestParser.getFactory(t,n.networkingEngine_,s.manifest.retryParameters,i||null),2)):(u=m.yieldResult,m.return(shaka.util.Functional.callFactory(u)))})},s,o);var l=new shaka.util.AbortableOperation(r,function(){return o.abortAll()});return l.finally(function(){shaka.util.ArrayUtils.remove(n.openDownloadManagers_,o)}),l.then=function(u){return shaka.Deprecate.deprecateFeature(4,"shaka.offline.Storage.store.then","Storage operations now return a shaka.util.AbortableOperation, rather than a promise.  Please update to conform to this new API; you can use the |chain| method instead."),l.promise.then(u)},this.startAbortableOperation_(l)},shaka.offline.Storage.prototype.getStoreInProgress=function(){return shaka.Deprecate.deprecateFeature(4,"shaka.offline.Storage.getStoreInProgress","Multiple concurrent downloads are now supported."),!1},shaka.offline.Storage.prototype.store_=function(t,r,i,n,s){var o=this,l,u,m,E,y,D,w,B,F,V,K,q,re,ee;return $jscomp.asyncExecutePromiseGeneratorProgram(function(H){switch(H.nextAddress){case 1:return o.requireSupport_(),u=l=null,m=new shaka.offline.StorageMuxer,D=y=E=null,H.setCatchFinallyBlocks(2,3),H.yield(i(),5);case 5:return l=H.yieldResult,H.yield(o.parseManifest(t,l,n),6);case 6:if(w=H.yieldResult,o.ensureNotDestroyed_(),B=!w.presentationTimeline.isLive()&&!w.presentationTimeline.isInProgress(),!B)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.CANNOT_STORE_LIVE_OFFLINE,t);return H.yield(o.createDrmEngine(w,function(te){D=D||te},n),7);case 7:if(u=H.yieldResult,o.ensureNotDestroyed_(),D)throw D;return H.yield(o.filterManifest_(w,u,n),8);case 8:return H.yield(m.init(),9);case 9:return o.ensureNotDestroyed_(),H.yield(m.getActive(),10);case 10:return E=H.yieldResult,o.ensureNotDestroyed_(),goog.asserts.assert(u,"drmEngine should be non-null here."),F=o.makeManifestDB_(u,w,t,r,n,s),V=F.manifestDB,K=F.toDownload,H.yield(E.cell.addManifests([V]),11);case 11:if(q=H.yieldResult,o.ensureNotDestroyed_(),y=q[0],goog.asserts.assert(u,"drmEngine should be non-null here."),o.ensureNotDestroyed_(),D)throw D;return H.yield(o.downloadSegments_(K,y,V,s,n,E.cell,w,u),12);case 12:return o.ensureNotDestroyed_(),re=shaka.offline.OfflineUri.manifest(E.path.mechanism,E.path.cell,y),H.return(shaka.offline.StoredContentUtils.fromManifestDB(re,V));case 3:return H.enterFinallyBlock(),H.yield(m.destroy(),13);case 13:if(!l){H.jumpTo(14);break}return H.yield(l.stop(),14);case 14:if(!u){H.jumpTo(16);break}return H.yield(u.destroy(),16);case 16:H.leaveFinallyBlock(0);break;case 2:if(ee=H.enterCatchBlock(),y==null){H.jumpTo(18);break}return H.yield(shaka.offline.Storage.cleanStoredManifest(y),18);case 18:throw D||ee}})},shaka.offline.Storage.prototype.downloadSegments_=function(t,r,i,n,s,o,l,u){var m=this,E,y,D,w,B,F,V,K,q,re;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ee){switch(ee.nextAddress){case 1:if(E={},y=0,D=function(H,te){var W,z,X,Q,$,oe,ae;return $jscomp.asyncExecutePromiseGeneratorProgram(function(_e){if(_e.nextAddress==1){for(W={},z=$jscomp.makeIterator(H),X=z.next();!X.done;W={$jscomp$loop$prop$download$537$630:W.$jscomp$loop$prop$download$537$630},X=z.next())W.$jscomp$loop$prop$download$537$630=X.value,Q=W.$jscomp$loop$prop$download$537$630.makeSegmentRequest(s),$=W.$jscomp$loop$prop$download$537$630.estimateId,oe=W.$jscomp$loop$prop$download$537$630.isInitSegment,ae=function(ve){return function(Pe){var fe,xe,Ce;return $jscomp.asyncExecutePromiseGeneratorProgram(function(De){if(De.nextAddress==1)return De.yield(o.addSegments([{data:Pe}]),2);fe=De.yieldResult,m.ensureNotDestroyed_(),xe=ve.$jscomp$loop$prop$download$537$630.ref,Ce=shaka.offline.DownloadInfo.idForSegmentRef(xe),E[Ce]=fe[0],y+=Pe.byteLength,De.jumpToEnd()})}}(W),n.queue(W.$jscomp$loop$prop$download$537$630.groupId,Q,$,oe,ae);return _e.yield(n.waitToFinish(),2)}return te?(m.ensureNotDestroyed_(),m.setManifestDrmFields_(l,i,u,s),_e.yield(o.updateManifest(r,i),0)):_e.jumpTo(0)})},w=!1,ee.setCatchFinallyBlocks(2),!m.getManifestIsEncrypted_(l)||!w||m.getManifestIncludesInitData_(l)){ee.jumpTo(4);break}return ee.yield(D(t.filter(function(H){return H.isInitSegment}),!0),5);case 5:return m.ensureNotDestroyed_(),t=t.filter(function(H){return!H.isInitSegment}),B=E,F=y,E={},y=0,ee.yield(shaka.offline.Storage.assignSegmentsToManifest(o,r,i,B,F,function(){return m.ensureNotDestroyed_()}),6);case 6:m.ensureNotDestroyed_();case 4:if(w){ee.jumpTo(7);break}return ee.yield(D(t,!1),8);case 8:return m.ensureNotDestroyed_(),V=E,K=y,E={},y=0,ee.yield(shaka.offline.Storage.assignSegmentsToManifest(o,r,i,V,K,function(){return m.ensureNotDestroyed_()}),9);case 9:m.ensureNotDestroyed_(),goog.asserts.assert(!i.isIncomplete,"The manifest should be complete by now");case 7:ee.leaveTryBlock(0);break;case 2:return q=ee.enterCatchBlock(),re=Object.values(E),ee.yield(o.removeSegments(re,function(H){}),10);case 10:throw q}})},shaka.offline.Storage.cleanStoredManifest=function(t){var r,i,n,s;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){switch(o.nextAddress){case 1:return r=new shaka.offline.StorageMuxer,o.yield(r.init(),2);case 2:return o.yield(r.getActive(),3);case 3:return i=o.yieldResult,n=shaka.offline.OfflineUri.manifest(i.path.mechanism,i.path.cell,t),o.yield(r.destroy(),4);case 4:return s=new shaka.offline.Storage,o.yield(s.remove(n.toString()),0)}})},shaka.offline.Storage.assignSegmentsToManifest=function(t,r,i,n,s,o){var l,u,m,E,y,D,w,B,F,V,K;return $jscomp.asyncExecutePromiseGeneratorProgram(function(q){switch(q.nextAddress){case 1:for(l=!1,q.setCatchFinallyBlocks(2),u=!0,m=$jscomp.makeIterator(i.streams),E=m.next();!E.done;E=m.next())for(y=E.value,D=$jscomp.makeIterator(y.segments),w=D.next();!w.done;w=D.next())B=w.value,F=B.pendingSegmentRefId?n[B.pendingSegmentRefId]:null,F!=null&&(B.dataKey=F,B.pendingSegmentRefId=void 0),F=B.pendingInitSegmentRefId?n[B.pendingInitSegmentRefId]:null,F!=null&&(B.initSegmentKey=F,B.pendingInitSegmentRefId=void 0),B.pendingSegmentRefId&&(u=!1),B.pendingInitSegmentRefId&&(u=!1);return i.size+=s,u&&(i.isIncomplete=!1),q.yield(t.updateManifest(r,i),4);case 4:l=!0,o(),q.leaveTryBlock(0);break;case 2:return V=q.enterCatchBlock(),q.yield(shaka.offline.Storage.cleanStoredManifest(r),5);case 5:if(l){q.jumpTo(6);break}return K=Object.values(n),q.yield(t.removeSegments(K,function(re){}),6);case 6:throw V}})},shaka.offline.Storage.prototype.filterManifest_=function(t,r,i){var n,s,o,l,u,m,E,y,D,w,B,F,V,K,q,re,ee,H,te,W,z,X,Q,$,oe,ae,_e,ve,Pe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fe){switch(fe.nextAddress){case 1:return n={width:1/0,height:1/0},shaka.util.StreamUtils.filterByRestrictions(t,i.restrictions,n),fe.yield(shaka.util.StreamUtils.filterManifestByMediaCapabilities(t,i.offline.usePersistentLicense),2);case 2:for(s=[],o=i.preferredAudioChannelCount,l=i.preferredDecodingAttributes,u=i.preferredVideoCodecs,m=i.preferredAudioCodecs,shaka.util.StreamUtils.chooseCodecsAndFilterManifest(t,u,m,o,l),E=$jscomp.makeIterator(t.variants),y=E.next();!y.done;y=E.next())D=y.value,goog.asserts.assert(shaka.util.StreamUtils.isPlayable(D),'We should have already filtered by "is playable"'),s.push(shaka.util.StreamUtils.variantToTrack(D));for(w=$jscomp.makeIterator(t.textStreams),B=w.next();!B.done;B=w.next())F=B.value,s.push(shaka.util.StreamUtils.textStreamToTrack(F));for(V=$jscomp.makeIterator(t.imageStreams),K=V.next();!K.done;K=V.next())q=K.value,s.push(shaka.util.StreamUtils.imageStreamToTrack(q));return fe.yield(i.offline.trackSelectionCallback(s),3);case 3:for(re=fe.yieldResult,ee=t.presentationTimeline.getDuration(),H=0,te=$jscomp.makeIterator(re),W=te.next();!W.done;W=te.next())z=W.value,X=z.bandwidth*ee/8,H+=X;return fe.setCatchFinallyBlocks(4),fe.yield(i.offline.downloadSizeCallback(H),6);case 6:if(Q=fe.yieldResult,!Q)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORAGE_LIMIT_REACHED);fe.leaveTryBlock(5);break;case 4:throw $=fe.enterCatchBlock(),$ instanceof shaka.util.Error?$:(shaka.log.warning("downloadSizeCallback has produced an unexpected error",$),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.DOWNLOAD_SIZE_CALLBACK_ERROR));case 5:for(oe=new Set,ae=new Set,_e=new Set,ve=$jscomp.makeIterator(re),W=ve.next();!W.done;W=ve.next())Pe=W.value,Pe.type=="variant"&&oe.add(Pe.id),Pe.type=="text"&&ae.add(Pe.id),Pe.type=="image"&&_e.add(Pe.id);t.variants=t.variants.filter(function(xe){return oe.has(xe.id)}),t.textStreams=t.textStreams.filter(function(xe){return ae.has(xe.id)}),t.imageStreams=t.imageStreams.filter(function(xe){return _e.has(xe.id)}),shaka.offline.Storage.validateManifest_(t),fe.jumpToEnd()}})},shaka.offline.Storage.prototype.makeManifestDB_=function(t,r,i,n,s,o){var l=shaka.offline.StoredContentUtils.fromManifest(i,r,0,n),u=s.offline.progressCallback;o.setCallbacks(function(B,F){l.size=F,u(l,B)},function(B,F){m&&s.offline.usePersistentLicense&&E==F&&t.newInitData("cenc",B)});var m=this.getManifestIsEncrypted_(r)&&!this.getManifestIncludesInitData_(r),E=null;if(m){var y=t.getDrmInfo();E=shaka.offline.Storage.defaultSystemIds_.get(y.keySystem)}y=new shaka.offline.StreamBandwidthEstimator;for(var D=$jscomp.makeIterator(r.textStreams),w=D.next();!w.done;w=D.next())y.addText(w.value);for(D=$jscomp.makeIterator(r.imageStreams),w=D.next();!w.done;w=D.next())y.addImage(w.value);for(w=$jscomp.makeIterator(r.variants),D=w.next();!D.done;D=w.next())y.addVariant(D.value);return y=this.createStreams_(o,y,t,r,s),o=y.streams,y=y.toDownload,w=t.getDrmInfo(),D=s.offline.usePersistentLicense,w&&D&&(w.initData=[]),{manifestDB:{creationTime:Date.now(),originalManifestUri:i,duration:r.presentationTimeline.getDuration(),size:0,expiration:t.getExpiration(),streams:o,sessionIds:D?t.getSessionIds():[],drmInfo:w,appMetadata:n,isIncomplete:!0},toDownload:y}},shaka.offline.Storage.prototype.getManifestIsEncrypted_=function(t){return t.variants.some(function(r){var i=r.audio&&r.audio.encrypted;return r.video&&r.video.encrypted||i})},shaka.offline.Storage.prototype.getManifestIncludesInitData_=function(t){return t.variants.some(function(r){return(r.video?r.video.drmInfos:[]).concat(r.audio?r.audio.drmInfos:[]).some(function(i){return i.initData&&i.initData.length})})},shaka.offline.Storage.prototype.setManifestDrmFields_=function(t,r,i,n){if(r.expiration=i.getExpiration(),i=i.getSessionIds(),r.sessionIds=n.offline.usePersistentLicense?i:[],this.getManifestIsEncrypted_(t)&&n.offline.usePersistentLicense&&!i.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.NO_INIT_DATA_FOR_OFFLINE)},shaka.offline.Storage.prototype.remove=function(t){return this.startOperation_(this.remove_(t))},shaka.offline.Storage.prototype.remove_=function(t){var r=this,i,n,s,o,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){switch(m.nextAddress){case 1:if(r.requireSupport_(),i=shaka.offline.OfflineUri.parse(t),i==null||!i.isManifest())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,t);return n=i,s=new shaka.offline.StorageMuxer,m.setFinallyBlock(2),m.yield(s.init(),4);case 4:return m.yield(s.getCell(n.mechanism(),n.cell()),5);case 5:return o=m.yieldResult,m.yield(o.getManifests([n.key()]),6);case 6:return l=m.yieldResult,u=l[0],m.yield(Promise.all([r.removeFromDRM_(n,u,s),r.removeFromStorage_(o,n,u)]),2);case 2:return m.enterFinallyBlock(),m.yield(s.destroy(),8);case 8:m.leaveFinallyBlock(0)}})},shaka.offline.Storage.getCapabilities_=function(t,r){for(var i=shaka.util.MimeUtils,n=[],s=$jscomp.makeIterator(t.streams),o=s.next();!o.done;o=s.next())o=o.value,r&&o.type=="video"?n.push({contentType:i.getFullType(o.mimeType,o.codecs),robustness:t.drmInfo.videoRobustness}):r||o.type!="audio"||n.push({contentType:i.getFullType(o.mimeType,o.codecs),robustness:t.drmInfo.audioRobustness});return n},shaka.offline.Storage.prototype.removeFromDRM_=function(t,r,i){var n=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){return goog.asserts.assert(n.networkingEngine_,"Cannot be destroyed"),s.yield(shaka.offline.Storage.deleteLicenseFor_(n.networkingEngine_,n.config_.drm,i,r),0)})},shaka.offline.Storage.prototype.removeFromStorage_=function(t,r,i){var n=this,s=shaka.offline.Storage.getAllSegmentIds_(i),o=s.length+1,l=0,u=shaka.offline.StoredContentUtils.fromManifestDB(r,i);return i=function(m){l+=1,n.config_.offline.progressCallback(u,l/o)},Promise.all([t.removeSegments(s,i),t.removeManifests([r.key()],i)])},shaka.offline.Storage.prototype.removeEmeSessions=function(){return this.startOperation_(this.removeEmeSessions_())},shaka.offline.Storage.prototype.removeEmeSessions_=function(){var t=this,r,i,n,s,o,l,u,m,E,y,D;return $jscomp.asyncExecutePromiseGeneratorProgram(function(w){switch(w.nextAddress){case 1:return t.requireSupport_(),goog.asserts.assert(t.networkingEngine_,"Cannot be destroyed"),r=t.networkingEngine_,i=t.config_.drm,n=new shaka.offline.StorageMuxer,s=new shaka.offline.SessionDeleter,o=!1,w.setFinallyBlock(2),w.yield(n.init(),4);case 4:l=[],n.forEachEmeSessionCell(function(B){return l.push(B)}),u=$jscomp.makeIterator(l),m=u.next();case 5:if(m.done){w.jumpTo(2);break}return E=m.value,w.yield(E.getAll(),8);case 8:return y=w.yieldResult,w.yield(s.delete(i,r,y),9);case 9:return D=w.yieldResult,w.yield(E.remove(D),10);case 10:D.length!=y.length&&(o=!0),m=u.next(),w.jumpTo(5);break;case 2:return w.enterFinallyBlock(),w.yield(n.destroy(),11);case 11:w.leaveFinallyBlock(3);break;case 3:return w.return(!o)}})},shaka.offline.Storage.prototype.list=function(){return this.startOperation_(this.list_())},shaka.offline.Storage.prototype.list_=function(){var t=this,r,i,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){switch(s.nextAddress){case 1:return t.requireSupport_(),r=[],i=new shaka.offline.StorageMuxer,s.setFinallyBlock(2),s.yield(i.init(),4);case 4:return n=Promise.resolve(),i.forEachCell(function(o,l){n=n.then(function(){var u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){if(m.nextAddress==1)return m.yield(l.getAllManifests(),2);u=m.yieldResult,u.forEach(function(E,y){var D=shaka.offline.OfflineUri.manifest(o.mechanism,o.cell,y);D=shaka.offline.StoredContentUtils.fromManifestDB(D,E),r.push(D)}),m.jumpToEnd()})})}),s.yield(n,2);case 2:return s.enterFinallyBlock(),s.yield(i.destroy(),6);case 6:s.leaveFinallyBlock(3);break;case 3:return s.return(r)}})},shaka.offline.Storage.prototype.parseManifest=function(t,r,i){var n=this,s,o,l,u,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){if(E.nextAddress==1)return s=null,o=n.networkingEngine_,goog.asserts.assert(o,"Should be initialized!"),l={networkingEngine:o,modifyManifestRequest:function(y,D){},modifySegmentRequest:function(y,D){},filter:function(){return Promise.resolve()},makeTextStreamsForClosedCaptions:function(y){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(y){s=y},isLowLatencyMode:function(){return!1},isAutoLowLatencyMode:function(){return!1},enableLowLatencyMode:function(){}},r.configure(i.manifest),n.ensureNotDestroyed_(),E.yield(r.start(t,l),2);if(E.nextAddress!=3)return u=E.yieldResult,n.ensureNotDestroyed_(),m=shaka.offline.Storage.getAllStreamsFromManifest_(u),E.yield(Promise.all(shaka.util.Iterables.map(m,function(y){return y.createSegmentIndex()})),3);if(n.ensureNotDestroyed_(),s)throw s;return E.return(u)})},shaka.offline.Storage.prototype.createDrmEngine=function(t,r,i){var n=this,s;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){switch(o.nextAddress){case 1:return goog.asserts.assert(n.networkingEngine_,"Cannot call |createDrmEngine| after |destroy|"),s=new shaka.media.DrmEngine({netEngine:n.networkingEngine_,onError:r,onKeyStatus:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),s.configure(i.drm),o.yield(s.initForStorage(t.variants,i.offline.usePersistentLicense),2);case 2:return o.yield(s.setServerCertificate(),3);case 3:return o.yield(s.createOrLoad(),4);case 4:return o.return(s)}})},shaka.offline.Storage.prototype.createStreams_=function(t,r,i,n,s){i=new Map;var o=shaka.offline.Storage.getAllStreamsFromManifest_(n),l=new Map;o=$jscomp.makeIterator(o);for(var u=o.next();!u.done;u=o.next()){u=u.value;var m=this.createStream_(t,r,n,u,s,i);l.set(u.id,m)}for(t=$jscomp.makeIterator(n.variants),r=t.next();!r.done;r=t.next())r=r.value,r.audio&&l.get(r.audio.id).variantIds.push(r.id),r.video&&l.get(r.video.id).variantIds.push(r.id);return{streams:Array.from(l.values()),toDownload:Array.from(i.values())}},shaka.offline.Storage.prototype.createStream_=function(t,r,i,n,s,o){var l={id:n.id,originalId:n.originalId,primary:n.primary,type:n.type,mimeType:n.mimeType,codecs:n.codecs,frameRate:n.frameRate,pixelAspectRatio:n.pixelAspectRatio,hdr:n.hdr,kind:n.kind,language:n.language,label:n.label,width:n.width||null,height:n.height||null,encrypted:n.encrypted,keyIds:n.keyIds,segments:[],variantIds:[],roles:n.roles,forced:n.forced,channelsCount:n.channelsCount,audioSamplingRate:n.audioSamplingRate,spatialAudio:n.spatialAudio,closedCaptions:n.closedCaptions,tilesLayout:n.tilesLayout};return i=i.presentationTimeline.getSegmentAvailabilityStart(),shaka.offline.Storage.forEachSegment_(n,i,function(u){var m=shaka.offline.DownloadInfo.idForSegmentRef(u),E=void 0;if(!o.has(m)){var y=t.addDownloadEstimate(r.getSegmentEstimate(n.id,u));y=new shaka.offline.DownloadInfo(u,y,n.id,!1),o.set(m,y)}u.initSegmentReference&&(E=shaka.offline.DownloadInfo.idForSegmentRef(u.initSegmentReference),o.has(E)||(y=t.addDownloadEstimate(r.getInitSegmentEstimate(n.id)),y=new shaka.offline.DownloadInfo(u.initSegmentReference,y,n.id,!0),o.set(E,y))),l.segments.push({pendingInitSegmentRefId:E,initSegmentKey:E?0:null,startTime:u.startTime,endTime:u.endTime,appendWindowStart:u.appendWindowStart,appendWindowEnd:u.appendWindowEnd,timestampOffset:u.timestampOffset,tilesLayout:u.tilesLayout,pendingSegmentRefId:m,dataKey:0})}),l},shaka.offline.Storage.forEachSegment_=function(t,r,i){if(r=t.segmentIndex.find(r),r!=null)for(var n=t.segmentIndex.get(r);n;)i(n),n=t.segmentIndex.get(++r)},shaka.offline.Storage.prototype.ensureNotDestroyed_=function(){if(this.destroyer_.destroyed())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.OPERATION_ABORTED)},shaka.offline.Storage.prototype.requireSupport_=function(){if(!shaka.offline.Storage.support())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORAGE_NOT_SUPPORTED)},shaka.offline.Storage.prototype.startOperation_=function(t){var r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return i.nextAddress==1?(r.openOperations_.push(t),i.setFinallyBlock(2),i.yield(t,4)):i.nextAddress!=2?i.return(i.yieldResult):(i.enterFinallyBlock(),shaka.util.ArrayUtils.remove(r.openOperations_,t),i.leaveFinallyBlock(0))})},shaka.offline.Storage.prototype.startAbortableOperation_=function(t){var r=this,i=t.promise;return this.openOperations_.push(i),t.finally(function(){shaka.util.ArrayUtils.remove(r.openOperations_,i)})},shaka.offline.Storage.getAllSegmentIds_=function(t){var r=new Set;t=$jscomp.makeIterator(t.streams);for(var i=t.next();!i.done;i=t.next()){i=$jscomp.makeIterator(i.value.segments);for(var n=i.next();!n.done;n=i.next())n=n.value,n.initSegmentKey!=null&&r.add(n.initSegmentKey),r.add(n.dataKey)}return Array.from(r)},shaka.offline.Storage.deleteAll=function(){var t;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return r.nextAddress==1?(t=new shaka.offline.StorageMuxer,r.setFinallyBlock(2),r.yield(t.erase(),2)):r.nextAddress!=5?(r.enterFinallyBlock(),r.yield(t.destroy(),5)):r.leaveFinallyBlock(0)})},shaka.offline.Storage.deleteLicenseFor_=function(t,r,i,n){var s,o,l,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){return m.nextAddress==1?n.drmInfo?(s=i.getEmeSessionCell(),o=n.sessionIds.map(function(E){return{sessionId:E,keySystem:n.drmInfo.keySystem,licenseUri:n.drmInfo.licenseServerUri,serverCertificate:n.drmInfo.serverCertificate,audioCapabilities:shaka.offline.Storage.getCapabilities_(n,!1),videoCapabilities:shaka.offline.Storage.getCapabilities_(n,!0)}}),l=new shaka.offline.SessionDeleter,m.yield(l.delete(r,t,o),2)):m.return():m.nextAddress!=3?(u=m.yieldResult,m.yield(s.remove(u),3)):m.yield(s.add(o.filter(function(E){return!u.includes(E.sessionId)})),0)})},shaka.offline.Storage.getAllStreamsFromManifest_=function(t){for(var r=new Set,i=$jscomp.makeIterator(t.textStreams),n=i.next();!n.done;n=i.next())r.add(n.value);for(i=$jscomp.makeIterator(t.imageStreams),n=i.next();!n.done;n=i.next())r.add(n.value);for(t=$jscomp.makeIterator(t.variants),i=t.next();!i.done;i=t.next())i=i.value,i.audio&&r.add(i.audio),i.video&&r.add(i.video);return r},shaka.offline.Storage.validateManifest_=function(t){var r=new Set(t.variants.map(function(l){return l.video})),i=new Set(t.variants.map(function(l){return l.audio}));t=t.textStreams,1<r.size&&shaka.log.warning("Multiple video tracks selected to be stored"),r=$jscomp.makeIterator(i);for(var n=r.next();!n.done;n=r.next()){n=n.value;for(var s=$jscomp.makeIterator(i),o=s.next();!o.done;o=s.next())o=o.value,n!=o&&n.language==o.language&&shaka.log.warning("Similar audio tracks were selected to be stored",n.id,o.id)}for(i=$jscomp.makeIterator(t),r=i.next();!r.done;r=i.next())for(r=r.value,n=$jscomp.makeIterator(t),s=n.next();!s.done;s=n.next())s=s.value,r!=s&&r.language==s.language&&shaka.log.warning("Similar text tracks were selected to be stored",r.id,s.id)},goog.exportSymbol("shaka.offline.Storage",shaka.offline.Storage),goog.exportProperty(shaka.offline.Storage,"deleteAll",shaka.offline.Storage.deleteAll),goog.exportProperty(shaka.offline.Storage.prototype,"list",shaka.offline.Storage.prototype.list),goog.exportProperty(shaka.offline.Storage.prototype,"removeEmeSessions",shaka.offline.Storage.prototype.removeEmeSessions),goog.exportProperty(shaka.offline.Storage.prototype,"remove",shaka.offline.Storage.prototype.remove),goog.exportProperty(shaka.offline.Storage.prototype,"getStoreInProgress",shaka.offline.Storage.prototype.getStoreInProgress),goog.exportProperty(shaka.offline.Storage.prototype,"store",shaka.offline.Storage.prototype.store),goog.exportProperty(shaka.offline.Storage.prototype,"getNetworkingEngine",shaka.offline.Storage.prototype.getNetworkingEngine),goog.exportProperty(shaka.offline.Storage.prototype,"getConfiguration",shaka.offline.Storage.prototype.getConfiguration),goog.exportProperty(shaka.offline.Storage.prototype,"configure",shaka.offline.Storage.prototype.configure),goog.exportProperty(shaka.offline.Storage.prototype,"destroy",shaka.offline.Storage.prototype.destroy),goog.exportProperty(shaka.offline.Storage,"support",shaka.offline.Storage.support),shaka.offline.Storage.defaultSystemIds_=new Map().set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.recommendation","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.software","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.hardware","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb"),shaka.Player.registerSupportPlugin("offline",shaka.offline.Storage.support),shaka.polyfill=function(){},shaka.polyfill.installAll=function(){for(var t=$jscomp.makeIterator(shaka.polyfill.polyfills_),r=t.next();!r.done;r=t.next()){r=r.value;try{r.callback()}catch(i){shaka.log.alwaysWarn("Error installing polyfill!",i)}}},shaka.polyfill.register=function(t,r){for(var i={priority:r||0,callback:t},n=0;n<shaka.polyfill.polyfills_.length;n++)if(shaka.polyfill.polyfills_[n].priority<i.priority){shaka.polyfill.polyfills_.splice(n,0,i);return}shaka.polyfill.polyfills_.push(i)},goog.exportSymbol("shaka.polyfill",shaka.polyfill),goog.exportProperty(shaka.polyfill,"register",shaka.polyfill.register),goog.exportProperty(shaka.polyfill,"installAll",shaka.polyfill.installAll),shaka.polyfill.polyfills_=[],shaka.polyfill.Aria=function(){},shaka.polyfill.Aria.install=function(){if(Object.getOwnPropertyDescriptor(Element.prototype,"ariaHidden"))shaka.log.info("Using native ARIAMixin interface.");else{shaka.log.info("ARIAMixin interface not detected. Installing polyfill.");for(var t=$jscomp.makeIterator(["ariaHidden","ariaLabel","ariaPressed","ariaSelected"]),r=t.next();!r.done;r=t.next())shaka.polyfill.Aria.addARIAMixinAttribute_(r.value)}},shaka.polyfill.Aria.addARIAMixinAttribute_=function(t){var r="aria-"+t.toLowerCase().replace(/^aria/,"");Object.defineProperty(Element.prototype,t,{get:function(){return this.getAttribute(r)},set:function(i){i==null||i==null?this.removeAttribute(r):this.setAttribute(r,i)}})},goog.exportProperty(shaka.polyfill,"Aria",shaka.polyfill.Aria),goog.exportProperty(shaka.polyfill.Aria,"install",shaka.polyfill.Aria.install),shaka.polyfill.register(shaka.polyfill.Aria.install),shaka.polyfill.EncryptionScheme=function(){},shaka.polyfill.EncryptionScheme.install=function(){EncryptionSchemePolyfills.install()},goog.exportProperty(shaka.polyfill,"EncryptionScheme",shaka.polyfill.EncryptionScheme),goog.exportProperty(shaka.polyfill.EncryptionScheme,"install",shaka.polyfill.EncryptionScheme.install),shaka.polyfill.register(shaka.polyfill.EncryptionScheme.install,-2),shaka.polyfill.Fullscreen=function(){},shaka.polyfill.Fullscreen.install=function(){if(window.Document){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,t=Document.prototype,t.exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),t=shaka.polyfill.Fullscreen.proxyEvent_,document.addEventListener("webkitfullscreenchange",t),document.addEventListener("webkitfullscreenerror",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("mozfullscreenerror",t),document.addEventListener("MSFullscreenChange",t),document.addEventListener("MSFullscreenError",t)}},shaka.polyfill.Fullscreen.proxyEvent_=function(t){var r=t.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),i=document.createEvent("Event");i.initEvent(r,t.bubbles,t.cancelable),t.target.dispatchEvent(i)},goog.exportProperty(shaka.polyfill,"Fullscreen",shaka.polyfill.Fullscreen),goog.exportProperty(shaka.polyfill.Fullscreen,"install",shaka.polyfill.Fullscreen.install),shaka.polyfill.register(shaka.polyfill.Fullscreen.install),shaka.polyfill.MathRound=function(){},shaka.polyfill.MathRound.install=function(){shaka.log.debug("mathRound.install");var t=shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_+1;if(Math.round(t)!=t){shaka.log.debug("polyfill Math.round");var r=Math.round;Math.round=function(i){var n=i;return i<=shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_&&(n=r(i)),n}}},goog.exportProperty(shaka.polyfill,"MathRound",shaka.polyfill.MathRound),goog.exportProperty(shaka.polyfill.MathRound,"install",shaka.polyfill.MathRound.install),shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_=4503599627370496,shaka.polyfill.register(shaka.polyfill.MathRound.install),shaka.polyfill.MediaCapabilities=function(){},shaka.polyfill.MediaCapabilities.install=function(){shaka.util.Platform.isChromecast()||shaka.util.Platform.isApple()||shaka.util.Platform.isPS4()||shaka.util.Platform.isPS5()||shaka.util.Platform.isWebOS()||shaka.util.Platform.isTizen()||!navigator.mediaCapabilities?(shaka.log.info("MediaCapabilities: install"),navigator.mediaCapabilities||(navigator.mediaCapabilities={}),shaka.polyfill.MediaCapabilities.originalMcap=navigator.mediaCapabilities,navigator.mediaCapabilities.decodingInfo=shaka.polyfill.MediaCapabilities.decodingInfo_):shaka.log.info("MediaCapabilities: Native mediaCapabilities support found.")},shaka.polyfill.MediaCapabilities.decodingInfo_=function(t){var r,i,n,s,o,l,u,m,E,y,D,w,B,F,V,K;return $jscomp.asyncExecutePromiseGeneratorProgram(function(q){switch(q.nextAddress){case 1:if(r={supported:!1,powerEfficient:!0,smooth:!0,keySystemAccess:null,configuration:t},!t)return q.return(r);if(t.type=="media-source"){if(!shaka.util.Platform.supportsMediaSource()||t.video&&(i=t.video.contentType,n=MediaSource.isTypeSupported(i),!n)||t.audio&&(s=t.audio.contentType,o=MediaSource.isTypeSupported(s),!o))return q.return(r)}else if(t.type=="file"){if(t.video&&(l=t.video.contentType,u=shaka.util.Platform.supportsMediaType(l),!u)||t.audio&&(m=t.audio.contentType,E=shaka.util.Platform.supportsMediaType(m),!E))return q.return(r)}else return q.return(r);return t.keySystemConfiguration?(y=t.keySystemConfiguration,D=[],w=[],y.audio&&(B={robustness:y.audio.robustness||"",contentType:t.audio.contentType},D.push(B)),y.video&&(F={robustness:y.video.robustness||"",contentType:t.video.contentType},w.push(F)),V={initDataTypes:[y.initDataType],distinctiveIdentifier:y.distinctiveIdentifier,persistentState:y.persistentState,sessionTypes:y.sessionTypes},D.length&&(V.audioCapabilities=D),w.length&&(V.videoCapabilities=w),q.setCatchFinallyBlocks(3),q.yield(navigator.requestMediaKeySystemAccess(y.keySystem,[V]),5)):(r.supported=!0,q.return(Promise.resolve(r)));case 5:K=q.yieldResult,q.leaveTryBlock(4);break;case 3:q.enterCatchBlock(),shaka.log.info("navigator.requestMediaKeySystemAccess failed.");case 4:K&&(r.supported=!0,r.keySystemAccess=K);case 2:return q.return(r)}})},goog.exportProperty(shaka.polyfill,"MediaCapabilities",shaka.polyfill.MediaCapabilities),goog.exportProperty(shaka.polyfill.MediaCapabilities,"install",shaka.polyfill.MediaCapabilities.install),shaka.polyfill.MediaCapabilities.originalMcap=null,goog.exportProperty(shaka.polyfill.MediaCapabilities,"originalMcap",shaka.polyfill.MediaCapabilities.originalMcap),shaka.polyfill.register(shaka.polyfill.MediaCapabilities.install,-1),shaka.polyfill.MediaSource=function(){},shaka.polyfill.MediaSource.install=function(){shaka.log.debug("MediaSource.install");var t=shaka.util.Platform.safariVersion();window.MediaSource?window.cast&&cast.__platform__&&cast.__platform__.canDisplayType?(shaka.log.info("Patching Chromecast MSE bugs."),shaka.polyfill.MediaSource.patchCastIsTypeSupported_()):t?(shaka.polyfill.MediaSource.rejectTsContent_(),12>=t?(shaka.log.info("Patching Safari 11 & 12 MSE bugs."),shaka.polyfill.MediaSource.stubAbort_(),shaka.polyfill.MediaSource.patchRemovalRange_()):(shaka.log.info("Patching Safari 13 MSE bugs."),shaka.polyfill.MediaSource.stubAbort_())):shaka.util.Platform.isTizen2()||shaka.util.Platform.isTizen3()||shaka.util.Platform.isTizen4()?(shaka.log.info("Rejecting Opus."),shaka.polyfill.MediaSource.rejectCodec_("opus")):shaka.log.info("Using native MSE as-is."):shaka.log.info("No MSE implementation available."),window.MediaSource&&MediaSource.isTypeSupported('video/webm; codecs="vp9"')&&!MediaSource.isTypeSupported('video/webm; codecs="vp09.00.10.08"')&&(shaka.log.info("Patching vp09 support queries."),shaka.polyfill.MediaSource.patchVp09_())},shaka.polyfill.MediaSource.stubAbort_=function(){var t=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(){var r=$jscomp.getRestArguments.apply(0,arguments);return r=t.apply(this,r),r.abort=function(){},r}},shaka.polyfill.MediaSource.patchRemovalRange_=function(){var t=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(r,i){return t.call(this,r,i-.001)}},shaka.polyfill.MediaSource.rejectTsContent_=function(){var t=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(r){return r.split(/ *; */)[0].split("/")[1].toLowerCase()=="mp2t"?!1:t(r)}},shaka.polyfill.MediaSource.rejectCodec_=function(t){var r=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(i){return shaka.util.MimeUtils.getCodecBase(i)!=t&&r(i)}},shaka.polyfill.MediaSource.patchCastIsTypeSupported_=function(){var t=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(r){var i=r.split(/ *; */);return i.shift(),i.some(function(n){return n.startsWith("codecs=")})?cast.__platform__.canDisplayType(r):t(r)}},shaka.polyfill.MediaSource.patchVp09_=function(){var t=MediaSource.isTypeSupported;shaka.util.Platform.isWebOS()||(MediaSource.isTypeSupported=function(r){var i=r.split(/ *; */),n=i.findIndex(function(l){return l.startsWith("codecs=")});if(0>n)return t(r);var s=i[n].replace("codecs=","").replace(/"/g,"").split(/\s*,\s*/),o=s.findIndex(function(l){return l.startsWith("vp09")});return 0<=o&&(s[o]="vp9",i[n]='codecs="'+s.join(",")+'"',r=i.join("; ")),t(r)})},goog.exportProperty(shaka.polyfill,"MediaSource",shaka.polyfill.MediaSource),goog.exportProperty(shaka.polyfill.MediaSource,"install",shaka.polyfill.MediaSource.install),shaka.polyfill.register(shaka.polyfill.MediaSource.install),shaka.polyfill.Orientation=function(){},shaka.polyfill.Orientation.install=function(){screen.orientation||window.orientation!=null&&shaka.polyfill.Orientation.installBasedOnWindowMethods_()},shaka.polyfill.Orientation.installBasedOnWindowMethods_=function(){var t=new shaka.polyfill.Orientation.FakeOrientation;screen.orientation=t;var r=function(){switch(window.orientation){case-90:t.type="landscape-secondary",t.angle=270;break;case 0:t.type="portrait-primary",t.angle=0;break;case 90:t.type="landscape-primary",t.angle=90;break;case 180:t.type="portrait-secondary",t.angle=180}};r(),window.addEventListener("orientationchange",function(){r(),t.dispatchChangeEvent()})},goog.exportProperty(shaka.polyfill,"Orientation",shaka.polyfill.Orientation),goog.exportProperty(shaka.polyfill.Orientation,"install",shaka.polyfill.Orientation.install),shaka.polyfill.Orientation.FakeOrientation=function(){shaka.util.FakeEventTarget.call(this),this.type="",this.angle=0},$jscomp.inherits(shaka.polyfill.Orientation.FakeOrientation,shaka.util.FakeEventTarget),shaka.polyfill.Orientation.FakeOrientation.prototype.dispatchChangeEvent=function(){var t=new shaka.util.FakeEvent("change");this.dispatchEvent(t)},shaka.polyfill.Orientation.FakeOrientation.prototype.lock=function(t){var r=function(n){return screen.lockOrientation?screen.lockOrientation(n):screen.mozLockOrientation?screen.mozLockOrientation(n):screen.msLockOrientation?screen.msLockOrientation(n):!1},i=!1;switch(t){case"natural":i=r("default");break;case"any":i=!0,this.unlock();break;default:i=r(t)}return i?Promise.resolve():(t=Error("screen.orientation.lock() is not available on this device"),t.name="NotSupportedError",t.code=DOMException.NOT_SUPPORTED_ERR,Promise.reject(t))},shaka.polyfill.Orientation.FakeOrientation.prototype.unlock=function(){screen.unlockOrientation?screen.unlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},shaka.polyfill.register(shaka.polyfill.Orientation.install),shaka.polyfill.PatchedMediaKeysApple=function(){},shaka.polyfill.PatchedMediaKeysApple.install=function(){if(window.HTMLVideoElement&&window.WebKitMediaKeys){shaka.log.info("Using Apple-prefixed EME");var t=shaka.polyfill.PatchedMediaKeysApple;delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=t.setMediaKeys,window.MediaKeys=t.MediaKeys,window.MediaKeySystemAccess=t.MediaKeySystemAccess,navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysApple.requestMediaKeySystemAccess=function(t,r){shaka.log.debug("PatchedMediaKeysApple.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var i=shaka.polyfill.PatchedMediaKeysApple;try{var n=new i.MediaKeySystemAccess(t,r);return Promise.resolve(n)}catch(s){return Promise.reject(s)}},shaka.polyfill.PatchedMediaKeysApple.setMediaKeys=function(t){shaka.log.debug("PatchedMediaKeysApple.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var r=shaka.polyfill.PatchedMediaKeysApple,i=this.mediaKeys;return i&&i!=t&&(goog.asserts.assert(i instanceof r.MediaKeys,"non-polyfill instance of oldMediaKeys"),i.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=t)?(goog.asserts.assert(t instanceof r.MediaKeys,"non-polyfill instance of newMediaKeys"),t.setMedia(this)):Promise.resolve()},shaka.polyfill.PatchedMediaKeysApple.onWebkitNeedKey_=function(t){if(shaka.log.debug("PatchedMediaKeysApple.onWebkitNeedKey_",t),goog.asserts.assert(this.mediaKeys instanceof shaka.polyfill.PatchedMediaKeysApple.MediaKeys,"non-polyfill instance of newMediaKeys"),goog.asserts.assert(t.initData!=null,"missing init data!"),t=shaka.util.BufferUtils.toUint8(t.initData),shaka.util.BufferUtils.toDataView(t).getUint32(0,!0)+4!=t.byteLength)throw new RangeError("Malformed FairPlay init data");t=shaka.util.StringUtils.fromUTF16(t.subarray(4),!0),t=shaka.util.StringUtils.toUTF8(t);var r=new Event("encrypted");r.initDataType="skd",r.initData=shaka.util.BufferUtils.toArrayBuffer(t),this.dispatchEvent(r)},goog.exportProperty(shaka.polyfill,"PatchedMediaKeysApple",shaka.polyfill.PatchedMediaKeysApple),goog.exportProperty(shaka.polyfill.PatchedMediaKeysApple,"install",shaka.polyfill.PatchedMediaKeysApple.install),shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess=function(t,r){if(shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess"),this.keySystem=t,t.startsWith("com.apple.fps")){for(var i=$jscomp.makeIterator(r),n=i.next();!n.done;n=i.next())if(n=this.checkConfig_(n.value)){this.configuration_=n;return}}throw i=Error("Unsupported keySystem"),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.checkConfig_=function(t){if(t.persistentState=="required")return null;var r={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:t.initDataTypes,sessionTypes:["temporary"],label:t.label},i=!1,n=!1;if(t.audioCapabilities){for(var s=$jscomp.makeIterator(t.audioCapabilities),o=s.next();!o.done;o=s.next())if(o=o.value,o.contentType){i=!0;var l=o.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(this.keySystem,l)&&(r.audioCapabilities.push(o),n=!0)}}if(t.videoCapabilities)for(t=$jscomp.makeIterator(t.videoCapabilities),o=t.next();!o.done;o=t.next())s=o.value,s.contentType&&(i=!0,o=s.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,o)&&(r.videoCapabilities.push(s),n=!0));return i||(n=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),n?r:null},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess.createMediaKeys");var t=new shaka.polyfill.PatchedMediaKeysApple.MediaKeys(this.keySystem);return Promise.resolve(t)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysApple.MediaKeys=function(t){shaka.log.debug("PatchedMediaKeysApple.MediaKeys"),this.nativeMediaKeys_=new WebKitMediaKeys(t),this.eventManager_=new shaka.util.EventManager},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.createSession=function(t){if(shaka.log.debug("PatchedMediaKeysApple.MediaKeys.createSession"),t=t||"temporary",t!="temporary")throw new TypeError("Session type "+t+" is unsupported on this platform.");return new shaka.polyfill.PatchedMediaKeysApple.MediaKeySession(this.nativeMediaKeys_,t)},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.setServerCertificate=function(t){return shaka.log.debug("PatchedMediaKeysApple.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.setMedia=function(t){var r=this,i=shaka.polyfill.PatchedMediaKeysApple;if(this.eventManager_.removeAll(),!t)return Promise.resolve();this.eventManager_.listen(t,"webkitneedkey",i.onWebkitNeedKey_);try{return shaka.util.MediaReadyState.waitForReadyState(t,HTMLMediaElement.HAVE_METADATA,this.eventManager_,function(){t.webkitSetMediaKeys(r.nativeMediaKeys_)}),Promise.resolve()}catch(n){return Promise.reject(n)}},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession=function(t,r){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.nativeMediaKeySession_=null,this.nativeMediaKeys_=t,this.updatePromise_=this.generateRequestPromise_=null,this.eventManager_=new shaka.util.EventManager,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap},$jscomp.inherits(shaka.polyfill.PatchedMediaKeysApple.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.generateRequest=function(t,r){var i=this;shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.generateRequest"),this.generateRequestPromise_=new shaka.util.PublicPromise;try{var n=this.nativeMediaKeys_.createSession("video/mp4",shaka.util.BufferUtils.toUint8(r));this.nativeMediaKeySession_=n,this.sessionId=n.sessionId||"",this.eventManager_.listen(this.nativeMediaKeySession_,"webkitkeymessage",function(s){return i.onWebkitKeyMessage_(s)}),this.eventManager_.listen(n,"webkitkeyadded",function(s){return i.onWebkitKeyAdded_(s)}),this.eventManager_.listen(n,"webkitkeyerror",function(s){return i.onWebkitKeyError_(s)}),this.updateKeyStatus_("status-pending")}catch(s){this.generateRequestPromise_.reject(s)}return this.generateRequestPromise_},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.load=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.update=function(t){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.update"),this.updatePromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_.update(shaka.util.BufferUtils.toUint8(t))}catch(r){this.updatePromise_.reject(r)}return this.updatePromise_},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.close=function(){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.close");try{this.nativeMediaKeySession_.close(),this.closed.resolve(),this.eventManager_.removeAll()}catch(t){this.closed.reject(t)}return this.closed},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyMessage_=function(t){shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyMessage_",t),goog.asserts.assert(this.generateRequestPromise_,"generateRequestPromise_ should be set before now!"),this.generateRequestPromise_&&(this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null);var r=this.keyStatuses.getStatus()==null;t=new Map().set("messageType",r?"license-request":"license-renewal").set("message",shaka.util.BufferUtils.toArrayBuffer(t.message)),t=new shaka.util.FakeEvent("message",t),this.dispatchEvent(t)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyAdded_=function(t){shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyAdded_",t),goog.asserts.assert(!this.generateRequestPromise_,"Key added during generate!"),goog.asserts.assert(this.updatePromise_,"updatePromise_ should be set before now!"),this.updatePromise_&&(this.updateKeyStatus_("usable"),this.updatePromise_.resolve(),this.updatePromise_=null)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyError_=function(t){if(shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyError_",t),t=Error("EME PatchedMediaKeysApple key error"),t.errorCode=this.nativeMediaKeySession_.error,this.generateRequestPromise_!=null)this.generateRequestPromise_.reject(t),this.generateRequestPromise_=null;else if(this.updatePromise_!=null)this.updatePromise_.reject(t),this.updatePromise_=null;else switch(this.nativeMediaKeySession_.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:this.updateKeyStatus_("output-not-allowed");break;default:this.updateKeyStatus_("internal-error")}},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.updateKeyStatus_=function(t){this.keyStatuses.setStatus(t),t=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(t)},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.setStatus=function(t){this.size=t==null?0:1,this.status_=t},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.forEach=function(t){this.status_&&t(this.status_,shaka.media.DrmEngine.DUMMY_KEY_ID.value())},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.get=function(t){if(this.has(t))return this.status_},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.has=function(t){var r=shaka.media.DrmEngine.DUMMY_KEY_ID.value();return!!(this.status_&&shaka.util.BufferUtils.equal(t,r))},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysApple.install),shaka.polyfill.PatchedMediaKeysMs=function(){},shaka.polyfill.PatchedMediaKeysMs.install=function(){if(window.HTMLVideoElement&&window.MSMediaKeys&&(!navigator.requestMediaKeySystemAccess||!MediaKeySystemAccess.prototype.getConfiguration)){shaka.log.info("Using ms-prefixed EME v20140218");var t=shaka.polyfill.PatchedMediaKeysMs;delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,window.MediaKeys=t.MediaKeys,window.MediaKeySystemAccess=t.MediaKeySystemAccess,navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess,HTMLMediaElement.prototype.setMediaKeys=t.MediaKeySystemAccess.setMediaKeys}},shaka.polyfill.PatchedMediaKeysMs.requestMediaKeySystemAccess=function(t,r){shaka.log.debug("PatchedMediaKeysMs.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var i=shaka.polyfill.PatchedMediaKeysMs;try{var n=new i.MediaKeySystemAccess(t,r);return Promise.resolve(n)}catch(s){return Promise.reject(s)}},shaka.polyfill.PatchedMediaKeysMs.onMsNeedKey_=function(t){if(shaka.log.debug("PatchedMediaKeysMs.onMsNeedKey_",t),t.initData){var r=new CustomEvent("encrypted");r.initDataType="cenc",r.initData=shaka.util.BufferUtils.toArrayBuffer(shaka.util.Pssh.normaliseInitData(t.initData)),this.dispatchEvent(r)}},goog.exportProperty(shaka.polyfill,"PatchedMediaKeysMs",shaka.polyfill.PatchedMediaKeysMs),goog.exportProperty(shaka.polyfill.PatchedMediaKeysMs,"install",shaka.polyfill.PatchedMediaKeysMs.install),shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess=function(t,r){shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess"),this.keySystem=t;for(var i=!1,n=$jscomp.makeIterator(r),s=n.next();!s.done;s=n.next()){s=s.value;var o={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:s.initDataTypes,sessionTypes:["temporary"],label:s.label},l=!1;if(s.audioCapabilities){for(var u=$jscomp.makeIterator(s.audioCapabilities),m=u.next();!m.done;m=u.next())if(m=m.value,m.contentType){l=!0;var E=m.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,E)&&(o.audioCapabilities.push(m),i=!0)}}if(s.videoCapabilities)for(u=$jscomp.makeIterator(s.videoCapabilities),m=u.next();!m.done;m=u.next())m=m.value,m.contentType&&(l=!0,E=m.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,E)&&(o.videoCapabilities.push(m),i=!0));if(l||(i=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),s.persistentState=="required"&&(i=!1),i){this.configuration_=o;return}}throw i=Error("Unsupported keySystem"),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var t=new shaka.polyfill.PatchedMediaKeysMs.MediaKeys(this.keySystem);return Promise.resolve(t)},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.setMediaKeys=function(t){shaka.log.debug("PatchedMediaKeysMs.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var r=shaka.polyfill.PatchedMediaKeysMs,i=this.mediaKeys;return i&&i!=t&&(goog.asserts.assert(i instanceof r.MediaKeys,"non-polyfill instance of oldMediaKeys"),i.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=t)?(goog.asserts.assert(t instanceof r.MediaKeys,"non-polyfill instance of newMediaKeys"),t.setMedia(this)):Promise.resolve()},shaka.polyfill.PatchedMediaKeysMs.MediaKeys=function(t){shaka.log.debug("PatchedMediaKeysMs.MediaKeys"),this.nativeMediaKeys_=new MSMediaKeys(t),this.eventManager_=new shaka.util.EventManager},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.createSession=function(t){if(shaka.log.debug("PatchedMediaKeysMs.MediaKeys.createSession"),t=t||"temporary",t!="temporary")throw new TypeError("Session type "+t+" is unsupported on this platform.");return new shaka.polyfill.PatchedMediaKeysMs.MediaKeySession(this.nativeMediaKeys_,t)},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.setServerCertificate=function(t){return shaka.log.debug("PatchedMediaKeysMs.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.setMedia=function(t){var r=this,i=shaka.polyfill.PatchedMediaKeysMs;if(this.eventManager_.removeAll(),!t)return Promise.resolve();this.eventManager_.listen(t,"msneedkey",i.onMsNeedKey_);try{return shaka.util.MediaReadyState.waitForReadyState(t,HTMLMediaElement.HAVE_METADATA,this.eventManager_,function(){t.msSetMediaKeys(r.nativeMediaKeys_)}),Promise.resolve()}catch(n){return Promise.reject(n)}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession=function(t,r){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.nativeMediaKeySession_=null,this.nativeMediaKeys_=t,this.updatePromise_=this.generateRequestPromise_=null,this.eventManager_=new shaka.util.EventManager,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap},$jscomp.inherits(shaka.polyfill.PatchedMediaKeysMs.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.generateRequest=function(t,r){var i=this;shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.generateRequest"),this.generateRequestPromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_=this.nativeMediaKeys_.createSession("video/mp4",shaka.util.BufferUtils.toUint8(r),null),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeymessage",function(n){return i.onMsKeyMessage_(n)}),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeyadded",function(n){return i.onMsKeyAdded_(n)}),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeyerror",function(n){return i.onMsKeyError_(n)}),this.updateKeyStatus_("status-pending")}catch(n){this.generateRequestPromise_.reject(n)}return this.generateRequestPromise_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.load=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.update=function(t){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.update"),this.updatePromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_.update(shaka.util.BufferUtils.toUint8(t))}catch(r){this.updatePromise_.reject(r)}return this.updatePromise_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.close=function(){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.close");try{this.nativeMediaKeySession_.close(),this.closed.resolve(),this.eventManager_.removeAll()}catch(t){this.closed.reject(t)}return this.closed},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyMessage_=function(t){shaka.log.debug("PatchedMediaKeysMs.onMsKeyMessage_",t),goog.asserts.assert(this.generateRequestPromise_,"generateRequestPromise_ not set in onMsKeyMessage_"),this.generateRequestPromise_&&(this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null);var r=this.keyStatuses.getStatus()==null;t=new Map().set("messageType",r?"license-request":"license-renewal").set("message",shaka.util.BufferUtils.toArrayBuffer(t.message)),t=new shaka.util.FakeEvent("message",t),this.dispatchEvent(t)},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyAdded_=function(t){shaka.log.debug("PatchedMediaKeysMs.onMsKeyAdded_",t),this.generateRequestPromise_?(shaka.log.debug("Simulating completion for a PR persistent license."),goog.asserts.assert(!this.updatePromise_,"updatePromise_ and generateRequestPromise_ set in onMsKeyAdded_"),this.updateKeyStatus_("usable"),this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null):(goog.asserts.assert(this.updatePromise_,"updatePromise_ not set in onMsKeyAdded_"),this.updatePromise_&&(this.updateKeyStatus_("usable"),this.updatePromise_.resolve(),this.updatePromise_=null))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyError_=function(t){if(shaka.log.debug("PatchedMediaKeysMs.onMsKeyError_",t),t=Error("EME PatchedMediaKeysMs key error"),t.errorCode=this.nativeMediaKeySession_.error,this.generateRequestPromise_!=null)this.generateRequestPromise_.reject(t),this.generateRequestPromise_=null;else if(this.updatePromise_!=null)this.updatePromise_.reject(t),this.updatePromise_=null;else switch(this.nativeMediaKeySession_.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:this.updateKeyStatus_("output-not-allowed");break;default:this.updateKeyStatus_("internal-error")}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.updateKeyStatus_=function(t){this.keyStatuses.setStatus(t),t=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(t)},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.setStatus=function(t){this.size=t==null?0:1,this.status_=t},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.forEach=function(t){this.status_&&t(this.status_,shaka.media.DrmEngine.DUMMY_KEY_ID.value())},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.get=function(t){if(this.has(t))return this.status_},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.has=function(t){var r=shaka.media.DrmEngine.DUMMY_KEY_ID.value();return!!(this.status_&&shaka.util.BufferUtils.equal(t,r))},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysMs.install),shaka.polyfill.PatchedMediaKeysNop=function(){},shaka.polyfill.PatchedMediaKeysNop.install=function(){if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){shaka.log.info("EME not available.");var t=shaka.polyfill.PatchedMediaKeysNop;navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=t.setMediaKeys,window.MediaKeys=t.MediaKeys,window.MediaKeySystemAccess=t.MediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysNop.requestMediaKeySystemAccess=function(t,r){return shaka.log.debug("PatchedMediaKeysNop.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess'),Promise.reject(Error("The key system specified is not supported."))},shaka.polyfill.PatchedMediaKeysNop.setMediaKeys=function(t){return shaka.log.debug("PatchedMediaKeysNop.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys'),t==null?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))},goog.exportProperty(shaka.polyfill,"PatchedMediaKeysNop",shaka.polyfill.PatchedMediaKeysNop),goog.exportProperty(shaka.polyfill.PatchedMediaKeysNop,"install",shaka.polyfill.PatchedMediaKeysNop.install),shaka.polyfill.PatchedMediaKeysNop.MediaKeys=function(){throw new TypeError("Illegal constructor.")},shaka.polyfill.PatchedMediaKeysNop.MediaKeys.prototype.createSession=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeys.prototype.setServerCertificate=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess=function(){throw this.keySystem="",new TypeError("Illegal constructor.")},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess.prototype.getConfiguration=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess.prototype.createMediaKeys=function(){},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysNop.install,-10),shaka.polyfill.PatchedMediaKeysWebkit=function(){},shaka.polyfill.PatchedMediaKeysWebkit.install=function(){var t=shaka.polyfill.PatchedMediaKeysWebkit;if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)shaka.log.info("Using webkit-prefixed EME v0.1b"),t.prefix_="webkit";else if(HTMLMediaElement.prototype.generateKeyRequest)shaka.log.info("Using nonprefixed EME v0.1b");else return;goog.asserts.assert(HTMLMediaElement.prototype[t.prefixApi_("generateKeyRequest")],"PatchedMediaKeysWebkit APIs not available!"),navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=t.setMediaKeys,window.MediaKeys=t.MediaKeys,window.MediaKeySystemAccess=t.MediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysWebkit.prefixApi_=function(t){var r=shaka.polyfill.PatchedMediaKeysWebkit.prefix_;return r?r+t.charAt(0).toUpperCase()+t.slice(1):t},shaka.polyfill.PatchedMediaKeysWebkit.requestMediaKeySystemAccess=function(t,r){shaka.log.debug("PatchedMediaKeysWebkit.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var i=shaka.polyfill.PatchedMediaKeysWebkit;try{var n=new i.MediaKeySystemAccess(t,r);return Promise.resolve(n)}catch(s){return Promise.reject(s)}},shaka.polyfill.PatchedMediaKeysWebkit.setMediaKeys=function(t){shaka.log.debug("PatchedMediaKeysWebkit.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var r=shaka.polyfill.PatchedMediaKeysWebkit,i=this.mediaKeys;return i&&i!=t&&(goog.asserts.assert(i instanceof r.MediaKeys,"non-polyfill instance of oldMediaKeys"),i.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=t)&&(goog.asserts.assert(t instanceof r.MediaKeys,"non-polyfill instance of newMediaKeys"),t.setMedia(this)),Promise.resolve()},shaka.polyfill.PatchedMediaKeysWebkit.getVideoElement_=function(){var t=document.getElementsByTagName("video");return t.length?t[0]:document.createElement("video")},goog.exportProperty(shaka.polyfill,"PatchedMediaKeysWebkit",shaka.polyfill.PatchedMediaKeysWebkit),goog.exportProperty(shaka.polyfill.PatchedMediaKeysWebkit,"install",shaka.polyfill.PatchedMediaKeysWebkit.install),shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess=function(t,r){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess"),this.internalKeySystem_=this.keySystem=t;var i=!1;t=="org.w3.clearkey"&&(this.internalKeySystem_="webkit-org.w3.clearkey",i=!1);for(var n=!1,s=shaka.polyfill.PatchedMediaKeysWebkit.getVideoElement_(),o=$jscomp.makeIterator(r),l=o.next();!l.done;l=o.next()){l=l.value;var u={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:l.initDataTypes,sessionTypes:["temporary"],label:l.label},m=!1;if(l.audioCapabilities){for(var E=$jscomp.makeIterator(l.audioCapabilities),y=E.next();!y.done;y=E.next())if(y=y.value,y.contentType){m=!0;var D=y.contentType.split(";")[0];s.canPlayType(D,this.internalKeySystem_)&&(u.audioCapabilities.push(y),n=!0)}}if(l.videoCapabilities)for(E=$jscomp.makeIterator(l.videoCapabilities),y=E.next();!y.done;y=E.next())y=y.value,y.contentType&&(m=!0,s.canPlayType(y.contentType,this.internalKeySystem_)&&(u.videoCapabilities.push(y),n=!0));if(m||(n=s.canPlayType("video/mp4",this.internalKeySystem_)||s.canPlayType("video/webm",this.internalKeySystem_)),l.persistentState=="required"&&(i?(u.persistentState="required",u.sessionTypes=["persistent-license"]):n=!1),n){this.configuration_=u;return}}throw i="Unsupported keySystem",(t=="org.w3.clearkey"||t=="com.widevine.alpha")&&(i="None of the requested configurations were supported."),i=Error(i),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var t=new shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys(this.internalKeySystem_);return Promise.resolve(t)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys=function(t){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys"),this.keySystem_=t,this.media_=null,this.eventManager_=new shaka.util.EventManager,this.newSessions_=[],this.sessionMap_=new Map},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.setMedia=function(t){var r=this;this.media_=t,this.eventManager_.removeAll();var i=shaka.polyfill.PatchedMediaKeysWebkit.prefix_;t&&(this.eventManager_.listen(t,i+"needkey",function(n){return r.onWebkitNeedKey_(n)}),this.eventManager_.listen(t,i+"keymessage",function(n){return r.onWebkitKeyMessage_(n)}),this.eventManager_.listen(t,i+"keyadded",function(n){return r.onWebkitKeyAdded_(n)}),this.eventManager_.listen(t,i+"keyerror",function(n){return r.onWebkitKeyError_(n)}))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.createSession=function(t){if(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.createSession"),t=t||"temporary",t!="temporary"&&t!="persistent-license")throw new TypeError("Session type "+t+" is unsupported on this platform.");var r=shaka.polyfill.PatchedMediaKeysWebkit,i=this.media_||document.createElement("video");return i.src||(i.src="about:blank"),t=new r.MediaKeySession(i,this.keySystem_,t),this.newSessions_.push(t),t},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.setServerCertificate=function(t){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitNeedKey_=function(t){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitNeedKey_",t),goog.asserts.assert(this.media_,"media_ not set in onWebkitNeedKey_");var r=new CustomEvent("encrypted");r.initDataType="cenc",r.initData=shaka.util.BufferUtils.toArrayBuffer(t.initData),this.media_.dispatchEvent(r)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyMessage_=function(t){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyMessage_",t);var r=this.findSession_(t.sessionId);if(r){var i=r.keyStatuses.getStatus()==null;t=new Map().set("messageType",i?"licenserequest":"licenserenewal").set("message",t.message),t=new shaka.util.FakeEvent("message",t),r.generated(),r.dispatchEvent(t)}else shaka.log.error("Session not found",t.sessionId)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyAdded_=function(t){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyAdded_",t),t=this.findSession_(t.sessionId),goog.asserts.assert(t,"unable to find session in onWebkitKeyAdded_"),t&&t.ready()},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyError_=function(t){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyError_",t);var r=this.findSession_(t.sessionId);goog.asserts.assert(r,"unable to find session in onWebkitKeyError_"),r&&r.handleError(t)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.findSession_=function(t){var r=this.sessionMap_.get(t);return r?(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",r),r):(r=this.newSessions_.shift())?(r.sessionId=t,this.sessionMap_.set(t,r),shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",r),r):null},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession=function(t,r,i){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.media_=t,this.initialized_=!1,this.updatePromise_=this.generatePromise_=null,this.keySystem_=r,this.type_=i,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap},$jscomp.inherits(shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generated=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.generated"),this.generatePromise_&&(this.generatePromise_.resolve(),this.generatePromise_=null)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.ready=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.ready"),this.updateKeyStatus_("usable"),this.updatePromise_&&this.updatePromise_.resolve(),this.updatePromise_=null},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.handleError=function(t){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.handleError",t);var r=Error("EME v0.1b key error"),i=t.errorCode;i.systemCode=t.systemCode,r.errorCode=i,!t.sessionId&&this.generatePromise_?(t.systemCode==45&&(r.message="Unsupported session type."),this.generatePromise_.reject(r),this.generatePromise_=null):t.sessionId&&this.updatePromise_?(this.updatePromise_.reject(r),this.updatePromise_=null):(r=t.systemCode,t.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?this.updateKeyStatus_("output-restricted"):r==1?this.updateKeyStatus_("expired"):this.updateKeyStatus_("internal-error"))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generate_=function(t,r){var i=this,n=shaka.polyfill.PatchedMediaKeysWebkit;if(this.initialized_)return Promise.reject(Error("The session is already initialized."));this.initialized_=!0;try{if(this.type_=="persistent-license"){var s=shaka.util.StringUtils;if(r)var o=shaka.util.BufferUtils.toUint8(s.toUTF8("LOAD_SESSION|"+r));else{goog.asserts.assert(t,"expecting init data");var l=s.toUTF8("PERSISTENT|");o=shaka.util.Uint8ArrayUtils.concat(l,t)}}else goog.asserts.assert(this.type_=="temporary","expected temporary session"),goog.asserts.assert(!r,"unexpected offline session ID"),goog.asserts.assert(t,"expecting init data"),o=shaka.util.BufferUtils.toUint8(t);goog.asserts.assert(o,"init data not set!")}catch(m){return Promise.reject(m)}goog.asserts.assert(this.generatePromise_==null,"generatePromise_ should be null"),this.generatePromise_=new shaka.util.PublicPromise;var u=n.prefixApi_("generateKeyRequest");try{this.media_[u](this.keySystem_,o)}catch(m){if(m.name!="InvalidStateError")return this.generatePromise_=null,Promise.reject(m);new shaka.util.Timer(function(){try{i.media_[u](i.keySystem_,o)}catch(E){i.generatePromise_.reject(E),i.generatePromise_=null}}).tickAfter(.01)}return this.generatePromise_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.update_=function(t,r){var i=this,n=shaka.polyfill.PatchedMediaKeysWebkit;if(this.updatePromise_)this.updatePromise_.then(function(){return i.update_(t,r)}).catch(function(){return i.update_(t,r)});else{if(this.updatePromise_=t,this.keySystem_=="webkit-org.w3.clearkey"){var s=shaka.util.Uint8ArrayUtils,o=shaka.util.StringUtils.fromUTF8(r),l=JSON.parse(o);l.keys[0].kty!="oct"&&(this.updatePromise_.reject(Error("Response is not a valid JSON Web Key Set.")),this.updatePromise_=null),o=s.fromBase64(l.keys[0].k),s=s.fromBase64(l.keys[0].kid)}else o=shaka.util.BufferUtils.toUint8(r),s=null;n=n.prefixApi_("addKey");try{this.media_[n](this.keySystem_,o,s,this.sessionId)}catch(u){this.updatePromise_.reject(u),this.updatePromise_=null}}},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.updateKeyStatus_=function(t){this.keyStatuses.setStatus(t),t=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(t)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generateRequest=function(t,r){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.generateRequest"),this.generate_(r,null)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.load=function(t){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.load"),this.type_=="persistent-license"?this.generate_(null,t):Promise.reject(Error("Not a persistent session."))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.update=function(t){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.update",t),goog.asserts.assert(this.sessionId,"update without session ID");var r=new shaka.util.PublicPromise;return this.update_(r,t),r},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.close=function(){var t=shaka.polyfill.PatchedMediaKeysWebkit;if(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.close"),this.type_!="persistent-license"){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;t=t.prefixApi_("cancelKeyRequest");try{this.media_[t](this.keySystem_,this.sessionId)}catch{}}return this.closed.resolve(),this.closed},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.remove"),this.type_!="persistent-license"?Promise.reject(Error("Not a persistent session.")):this.close()},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.setStatus=function(t){this.size=t==null?0:1,this.status_=t},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.forEach=function(t){this.status_&&t(this.status_,shaka.media.DrmEngine.DUMMY_KEY_ID.value())},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.get=function(t){if(this.has(t))return this.status_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.has=function(t){var r=shaka.media.DrmEngine.DUMMY_KEY_ID.value();return!!(this.status_&&shaka.util.BufferUtils.equal(t,r))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.prefix_="",shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysWebkit.install),shaka.polyfill.PiPWebkit=function(){},shaka.polyfill.PiPWebkit.install=function(){if(window.HTMLVideoElement){var t=HTMLVideoElement.prototype;if((!t.requestPictureInPicture||!document.exitPictureInPicture)&&t.webkitSupportsPresentationMode){var r=shaka.polyfill.PiPWebkit;shaka.log.debug("PiPWebkit.install"),document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,t.requestPictureInPicture=r.requestPictureInPicture_,Object.defineProperty(t,"disablePictureInPicture",{get:r.getDisablePictureInPicture_,set:r.setDisablePictureInPicture_,enumerable:!0,configurable:!0}),document.exitPictureInPicture=r.exitPictureInPicture_,document.addEventListener("webkitpresentationmodechanged",r.proxyEvent_,!0)}}},shaka.polyfill.PiPWebkit.proxyEvent_=function(t){if(t=t.target,t.webkitPresentationMode==shaka.polyfill.PiPWebkit.PIP_MODE_){document.pictureInPictureElement=t;var r=new Event("enterpictureinpicture");t.dispatchEvent(r)}else document.pictureInPictureElement==t&&(document.pictureInPictureElement=null),r=new Event("leavepictureinpicture"),t.dispatchEvent(r)},shaka.polyfill.PiPWebkit.requestPictureInPicture_=function(){var t=shaka.polyfill.PiPWebkit;return this.webkitSupportsPresentationMode(t.PIP_MODE_)?(this.webkitSetPresentationMode(t.PIP_MODE_),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))},shaka.polyfill.PiPWebkit.exitPictureInPicture_=function(){var t=shaka.polyfill.PiPWebkit,r=document.pictureInPictureElement;return r?(r.webkitSetPresentationMode(t.INLINE_MODE_),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))},shaka.polyfill.PiPWebkit.getDisablePictureInPicture_=function(){return this.hasAttribute("disablePictureInPicture")?!0:!this.webkitSupportsPresentationMode(shaka.polyfill.PiPWebkit.PIP_MODE_)},shaka.polyfill.PiPWebkit.setDisablePictureInPicture_=function(t){t?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")},goog.exportProperty(shaka.polyfill,"PiPWebkit",shaka.polyfill.PiPWebkit),goog.exportProperty(shaka.polyfill.PiPWebkit,"install",shaka.polyfill.PiPWebkit.install),shaka.polyfill.PiPWebkit.PIP_MODE_="picture-in-picture",shaka.polyfill.PiPWebkit.INLINE_MODE_="inline",shaka.polyfill.register(shaka.polyfill.PiPWebkit.install),shaka.polyfill.RandomUUID=function(){},shaka.polyfill.RandomUUID.install=function(){shaka.log.debug("randomUUID.install"),window.crypto?"randomUUID"in window.crypto?shaka.log.debug("RandomUUID: Native window.crypto.randomUUID() support found."):window.crypto.randomUUID=shaka.polyfill.RandomUUID.randomUUID_:shaka.log.debug("window.crypto must be available to install randomUUID polyfill.")},shaka.polyfill.RandomUUID.randomUUID_=function(){var t=URL.createObjectURL(new Blob),r=t.toString();return URL.revokeObjectURL(t),r.substr(r.lastIndexOf("/")+1)},goog.exportProperty(shaka.polyfill,"RandomUUID",shaka.polyfill.RandomUUID),goog.exportProperty(shaka.polyfill.RandomUUID,"install",shaka.polyfill.RandomUUID.install),shaka.polyfill.register(shaka.polyfill.RandomUUID.install),shaka.polyfill.StorageEstimate=function(){},shaka.polyfill.StorageEstimate.install=function(){navigator.storage&&navigator.storage.estimate||!navigator.webkitTemporaryStorage||!navigator.webkitTemporaryStorage.queryUsageAndQuota||("storage"in navigator||(navigator.storage={}),navigator.storage.estimate=shaka.polyfill.StorageEstimate.storageEstimate_)},shaka.polyfill.StorageEstimate.storageEstimate_=function(){return new Promise(function(t,r){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(i,n){t({usage:i,quota:n})},r)})},goog.exportProperty(shaka.polyfill,"StorageEstimate",shaka.polyfill.StorageEstimate),goog.exportProperty(shaka.polyfill.StorageEstimate,"install",shaka.polyfill.StorageEstimate.install),shaka.polyfill.register(shaka.polyfill.StorageEstimate.install),shaka.polyfill.Symbol=function(){},shaka.polyfill.Symbol.install=function(){shaka.log.debug("Symbol.install");var t=Symbol.prototype;"description"in t||Object.defineProperty(t,"description",{get:shaka.polyfill.Symbol.getSymbolDescription_})},shaka.polyfill.Symbol.getSymbolDescription_=function(){var t=/\((.*)\)/.exec(this.toString());return t?t[1]:void 0},goog.exportProperty(shaka.polyfill,"Symbol",shaka.polyfill.Symbol),goog.exportProperty(shaka.polyfill.Symbol,"install",shaka.polyfill.Symbol.install),shaka.polyfill.register(shaka.polyfill.Symbol.install),shaka.polyfill.VideoPlayPromise=function(){},shaka.polyfill.VideoPlayPromise.install=function(){if(shaka.log.debug("VideoPlayPromise.install"),window.HTMLMediaElement){var t=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var r=t.apply(this);return r&&r.catch(function(){}),r}}},goog.exportProperty(shaka.polyfill,"VideoPlayPromise",shaka.polyfill.VideoPlayPromise),goog.exportProperty(shaka.polyfill.VideoPlayPromise,"install",shaka.polyfill.VideoPlayPromise.install),shaka.polyfill.register(shaka.polyfill.VideoPlayPromise.install),shaka.polyfill.VideoPlaybackQuality=function(){},shaka.polyfill.VideoPlaybackQuality.install=function(){if(window.HTMLVideoElement){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&("webkitDroppedFrameCount"in t||shaka.util.Platform.isWebOS3())&&(t.getVideoPlaybackQuality=shaka.polyfill.VideoPlaybackQuality.webkit_)}},shaka.polyfill.VideoPlaybackQuality.webkit_=function(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}},goog.exportProperty(shaka.polyfill,"VideoPlaybackQuality",shaka.polyfill.VideoPlaybackQuality),goog.exportProperty(shaka.polyfill.VideoPlaybackQuality,"install",shaka.polyfill.VideoPlaybackQuality.install),shaka.polyfill.register(shaka.polyfill.VideoPlaybackQuality.install),shaka.polyfill.VTTCue=function(){},shaka.polyfill.VTTCue.install=function(){if(window.VTTCue)shaka.log.info("Using native VTTCue.");else if(window.TextTrackCue){var t=null,r=TextTrackCue.length;r==3?(shaka.log.info("Using VTTCue polyfill from 3 argument TextTrackCue."),t=shaka.polyfill.VTTCue.from3ArgsTextTrackCue_):r==6?(shaka.log.info("Using VTTCue polyfill from 6 argument TextTrackCue."),t=shaka.polyfill.VTTCue.from6ArgsTextTrackCue_):shaka.polyfill.VTTCue.canUse3ArgsTextTrackCue_()&&(shaka.log.info("Using VTTCue polyfill from 3 argument TextTrackCue."),t=shaka.polyfill.VTTCue.from3ArgsTextTrackCue_),t?window.VTTCue=function(i,n,s){return t(i,n,s)}:shaka.log.error("No recognized signature for TextTrackCue found!")}else shaka.log.error("VTTCue not available.")},shaka.polyfill.VTTCue.from3ArgsTextTrackCue_=function(t,r,i){return new window.TextTrackCue(t,r,i)},shaka.polyfill.VTTCue.from6ArgsTextTrackCue_=function(t,r,i){return new window.TextTrackCue(t+"-"+r+"-"+i,t,r,i)},shaka.polyfill.VTTCue.canUse3ArgsTextTrackCue_=function(){try{return!!shaka.polyfill.VTTCue.from3ArgsTextTrackCue_(1,2,"")}catch{return!1}},goog.exportProperty(shaka.polyfill,"VTTCue",shaka.polyfill.VTTCue),goog.exportProperty(shaka.polyfill.VTTCue,"install",shaka.polyfill.VTTCue.install),shaka.polyfill.register(shaka.polyfill.VTTCue.install),shaka.text.LrcTextParser=function(){},shaka.text.LrcTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"LRC does not have init segments")},shaka.text.LrcTextParser.prototype.parseMedia=function(t,r){var i=shaka.text.LrcTextParser,n=null,s=[],o=shaka.util.StringUtils.fromUTF8(t).split(/\r?\n/);o=$jscomp.makeIterator(o);for(var l=o.next();!l.done;l=o.next()){var u=l.value;u&&!/^\s+$/.test(u)&&((l=i.lyricLine_.exec(u))?(u=i.parseTime_(l[1]),l=new shaka.text.Cue(u,r.segmentEnd?r.segmentEnd:u+2,l[2]),n&&(n.endTime=u,s.push(n)),n=l):shaka.log.warning("LrcTextParser encountered an unknown line.",u))}return n&&s.push(n),s},shaka.text.LrcTextParser.parseTime_=function(t){var r=shaka.text.LrcTextParser.timeFormat_.exec(t);return t=parseInt(r[1],10),r=parseFloat(r[2].replace(",",".")),60*t+r},goog.exportSymbol("shaka.text.LrcTextParser",shaka.text.LrcTextParser),goog.exportProperty(shaka.text.LrcTextParser.prototype,"parseMedia",shaka.text.LrcTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.LrcTextParser.prototype,"parseInit",shaka.text.LrcTextParser.prototype.parseInit),shaka.text.LrcTextParser.lyricLine_=/^\[(\d{1,2}:\d{1,2}(?:[.,]\d{1,3})?)\](.*)/,shaka.text.LrcTextParser.timeFormat_=/^(\d+):(\d{1,2}(?:[.,]\d{1,3})?)$/,shaka.text.TextEngine.registerParser("application/x-subtitle-lrc",function(){return new shaka.text.LrcTextParser}),shaka.text.TtmlTextParser=function(){},shaka.text.TtmlTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"TTML does not have init segments")},shaka.text.TtmlTextParser.prototype.parseMedia=function(t,r){var i=shaka.text.TtmlTextParser,n=shaka.util.XmlUtils,s=i.parameterNs_,o=i.styleNs_,l=shaka.util.StringUtils.fromUTF8(t),u=[],m=new DOMParser,E=null;if(l=="")return u;try{E=m.parseFromString(l,"text/xml")}catch{throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,"Failed to parse TTML.")}if(E){if(l=E.getElementsByTagName("parsererror")[0])throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,l.textContent);if(l=E.getElementsByTagName("tt")[0],!l)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,"TTML does not contain <tt> tag.");if(E=l.getElementsByTagName("body")[0],!E)return[];m=n.getAttributeNSList(l,s,"frameRate");var y=n.getAttributeNSList(l,s,"subFrameRate"),D=n.getAttributeNSList(l,s,"frameRateMultiplier"),w=n.getAttributeNSList(l,s,"tickRate"),B=n.getAttributeNSList(l,s,"cellResolution"),F=l.getAttribute("xml:space")||"default";if(s=n.getAttributeNSList(l,o,"extent"),F!="default"&&F!="preserve")throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,"Invalid xml:space value: "+F);o=F=="default",m=new i.RateInfo_(m,y,D,w),y=i.getCellResolution_(B),D=(D=l.getElementsByTagName("metadata")[0])?n.getChildren(D):[],w=Array.from(l.getElementsByTagName("style")),l=Array.from(l.getElementsByTagName("region")),B=[],F=$jscomp.makeIterator(l);for(var V=F.next();!V.done;V=F.next())(V=i.parseCueRegion_(V.value,w,s))&&B.push(V);if(n.findChildren(E,"p").length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE,"<p> can only be inside <div> in TTML");for(s=$jscomp.makeIterator(n.findChildren(E,"div")),F=s.next();!F.done;F=s.next())if(n.findChildren(F.value,"span").length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE,"<span> can only be inside <p> in TTML");(i=i.parseCue_(E,r.periodStart,m,D,w,l,B,o,y,null,!1))&&u.push(i)}return u},shaka.text.TtmlTextParser.parseCue_=function(t,r,i,n,s,o,l,u,m,E,y){var D=t.parentNode;if(t.nodeType==Node.COMMENT_NODE)return null;if(t.nodeType==Node.TEXT_NODE){if(!y)return null;var w=document.createElement("span");w.textContent=t.textContent}else goog.asserts.assert(t.nodeType==Node.ELEMENT_NODE,"nodeType should be ELEMENT_NODE!"),w=t;goog.asserts.assert(w,"cueElement should be non-null!");for(var B=null,F=$jscomp.makeIterator(shaka.text.TtmlTextParser.smpteNsList_),V=F.next();!V.done&&!(B=shaka.text.TtmlTextParser.getElementsFromCollection_(w,"backgroundImage",n,"#",V.value)[0]);V=F.next());if(F=y,(t.nodeName=="p"||B)&&(y=!0),u=(w.getAttribute("xml:space")||(u?"default":"preserve"))=="default",V=Array.from(w.childNodes).every(function(H){return H.nodeType==Node.TEXT_NODE}),t=[],!V)for(var K=$jscomp.makeIterator(w.childNodes),q=K.next();!q.done;q=K.next())(q=shaka.text.TtmlTextParser.parseCue_(q.value,r,i,n,s,o,l,u,m,w,y))&&t.push(q);n=E!=null,K=/\S/.test(w.textContent);var re=w.hasAttribute("begin")||w.hasAttribute("end")||w.hasAttribute("dur");if(!(re||K||w.tagName=="br"||t.length!=0||n&&!u))return null;for(q=shaka.text.TtmlTextParser.parseTime_(w,i),K=q.start,q=q.end;D&&D.nodeType==Node.ELEMENT_NODE&&D.tagName!="tt";)q=shaka.text.TtmlTextParser.resolveTime_(D,i,K,q),K=q.start,q=q.end,D=D.parentNode;if(K==null&&(K=0),K+=r,q=q==null?1/0:q+r,!re&&0<t.length)for(K=1/0,q=0,r=$jscomp.makeIterator(t),i=r.next();!i.done;i=r.next())i=i.value,K=Math.min(K,i.startTime),q=Math.max(q,i.endTime);if(w.tagName=="br")return s=new shaka.text.Cue(K,q,""),s.lineBreak=!0,s;if(r="",V&&(r=w.textContent,u&&(r=r.trim(),r=r.replace(/\s+/g," "))),r=new shaka.text.Cue(K,q,r),r.nestedCues=t,y||(r.isContainer=!0),m&&(r.cellResolution=m),m=shaka.text.TtmlTextParser.getElementsFromCollection_(w,"region",o,"")[0],w.hasAttribute("region")&&m&&m.getAttribute("xml:id")){var ee=m.getAttribute("xml:id");r.region=l.filter(function(H){return H.id==ee})[0]}return l=m,E&&n&&!w.getAttribute("region")&&!w.getAttribute("style")&&(l=shaka.text.TtmlTextParser.getElementsFromCollection_(E,"region",o,"")[0]),shaka.text.TtmlTextParser.addStyle_(r,w,l,B,s,F,t.length==0),r},shaka.text.TtmlTextParser.parseCueRegion_=function(t,r,i){var n=shaka.text.TtmlTextParser,s=new shaka.text.CueRegion,o=t.getAttribute("xml:id");if(!o)return shaka.log.warning("TtmlTextParser parser encountered a region with no id. Region will be ignored."),null;s.id=o,o=null,i&&(o=n.percentValues_.exec(i)||n.pixelValues_.exec(i)),i=o?Number(o[1]):null,o=o?Number(o[2]):null;var l,u;return(l=n.getStyleAttributeFromRegion_(t,r,"extent"))&&(l=(u=n.percentValues_.exec(l))||n.pixelValues_.exec(l),l!=null&&(s.width=Number(l[1]),s.height=Number(l[2]),u||(i!=null&&(s.width=100*s.width/i),o!=null&&(s.height=100*s.height/o)),s.widthUnits=u||i!=null?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX,s.heightUnits=u||o!=null?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX)),(t=n.getStyleAttributeFromRegion_(t,r,"origin"))&&(l=(u=n.percentValues_.exec(t))||n.pixelValues_.exec(t),l!=null&&(s.viewportAnchorX=Number(l[1]),s.viewportAnchorY=Number(l[2]),u||(o!=null&&(s.viewportAnchorY=100*s.viewportAnchorY/o),i!=null&&(s.viewportAnchorX=100*s.viewportAnchorX/i)),s.viewportAnchorUnits=u||i!=null?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX)),s},shaka.text.TtmlTextParser.addStyle_=function(t,r,i,n,s,o,l){var u=shaka.text.TtmlTextParser,m=shaka.text.Cue;o=o||l,u.getStyleAttribute_(r,i,s,"direction",o)=="rtl"&&(t.direction=m.direction.HORIZONTAL_RIGHT_TO_LEFT),l=u.getStyleAttribute_(r,i,s,"writingMode",o),l=="tb"||l=="tblr"?t.writingMode=m.writingMode.VERTICAL_LEFT_TO_RIGHT:l=="tbrl"?t.writingMode=m.writingMode.VERTICAL_RIGHT_TO_LEFT:l=="rltb"||l=="rl"?t.direction=m.direction.HORIZONTAL_RIGHT_TO_LEFT:l&&(t.direction=m.direction.HORIZONTAL_LEFT_TO_RIGHT),(l=u.getStyleAttribute_(r,i,s,"textAlign",!0))?(t.positionAlign=u.textAlignToPositionAlign_[l],t.lineAlign=u.textAlignToLineAlign_[l],goog.asserts.assert(l.toUpperCase()in m.textAlign,l.toUpperCase()+" Should be in Cue.textAlign values!"),t.textAlign=m.textAlign[l.toUpperCase()]):t.textAlign=m.textAlign.CENTER,(l=u.getStyleAttribute_(r,i,s,"displayAlign",!0))&&(goog.asserts.assert(l.toUpperCase()in m.displayAlign,l.toUpperCase()+" Should be in Cue.displayAlign values!"),t.displayAlign=m.displayAlign[l.toUpperCase()]),(l=u.getStyleAttribute_(r,i,s,"color",o))&&(t.color=l),(l=u.getStyleAttribute_(r,i,s,"backgroundColor",o))&&(t.backgroundColor=l),(l=u.getStyleAttribute_(r,i,s,"border",o))&&(t.border=l),(l=u.getStyleAttribute_(r,i,s,"fontFamily",o))&&(t.fontFamily=l),(l=u.getStyleAttribute_(r,i,s,"fontWeight",o))&&l=="bold"&&(t.fontWeight=m.fontWeight.BOLD),l=u.getStyleAttribute_(r,i,s,"wrapOption",o),t.wrapLine=!(l&&l=="noWrap"),(l=u.getStyleAttribute_(r,i,s,"lineHeight",o))&&l.match(u.unitValues_)&&(t.lineHeight=l),(l=u.getStyleAttribute_(r,i,s,"fontSize",o))&&(l.match(u.unitValues_)||l.match(u.percentValue_))&&(t.fontSize=l),(l=u.getStyleAttribute_(r,i,s,"fontStyle",o))&&(goog.asserts.assert(l.toUpperCase()in m.fontStyle,l.toUpperCase()+" Should be in Cue.fontStyle values!"),t.fontStyle=m.fontStyle[l.toUpperCase()]),n&&(m=n.getAttribute("imageType")||n.getAttribute("imagetype"),l=n.getAttribute("encoding"),n=n.textContent.trim(),m=="PNG"&&l=="Base64"&&n&&(t.backgroundImage="data:image/png;base64,"+n)),(n=u.getStyleAttribute_(r,i,s,"textOutline",o))&&(n=n.split(" "),n[0].match(u.unitValues_)?t.textStrokeColor=t.color:(t.textStrokeColor=n[0],n.shift()),n[0]&&n[0].match(u.unitValues_)?t.textStrokeWidth=n[0]:t.textStrokeColor=""),(n=u.getStyleAttribute_(r,i,s,"letterSpacing",o))&&n.match(u.unitValues_)&&(t.letterSpacing=n),(n=u.getStyleAttribute_(r,i,s,"linePadding",o))&&n.match(u.unitValues_)&&(t.linePadding=n),(o=u.getStyleAttribute_(r,i,s,"opacity",o))&&(t.opacity=parseFloat(o)),(i=u.getStyleAttributeFromRegion_(i,s,"textDecoration"))&&u.addTextDecoration_(t,i),(r=u.getStyleAttributeFromElement_(r,s,"textDecoration"))&&u.addTextDecoration_(t,r)},shaka.text.TtmlTextParser.addTextDecoration_=function(t,r){for(var i=shaka.text.Cue,n=$jscomp.makeIterator(r.split(" ")),s=n.next();!s.done;s=n.next())switch(s.value){case"underline":t.textDecoration.includes(i.textDecoration.UNDERLINE)||t.textDecoration.push(i.textDecoration.UNDERLINE);break;case"noUnderline":t.textDecoration.includes(i.textDecoration.UNDERLINE)&&shaka.util.ArrayUtils.remove(t.textDecoration,i.textDecoration.UNDERLINE);break;case"lineThrough":t.textDecoration.includes(i.textDecoration.LINE_THROUGH)||t.textDecoration.push(i.textDecoration.LINE_THROUGH);break;case"noLineThrough":t.textDecoration.includes(i.textDecoration.LINE_THROUGH)&&shaka.util.ArrayUtils.remove(t.textDecoration,i.textDecoration.LINE_THROUGH);break;case"overline":t.textDecoration.includes(i.textDecoration.OVERLINE)||t.textDecoration.push(i.textDecoration.OVERLINE);break;case"noOverline":t.textDecoration.includes(i.textDecoration.OVERLINE)&&shaka.util.ArrayUtils.remove(t.textDecoration,i.textDecoration.OVERLINE)}},shaka.text.TtmlTextParser.getStyleAttribute_=function(t,r,i,n,s){s=s===void 0?!0:s;var o=shaka.text.TtmlTextParser;return(t=o.getStyleAttributeFromElement_(t,i,n))?t:s?o.getStyleAttributeFromRegion_(r,i,n):null},shaka.text.TtmlTextParser.getStyleAttributeFromRegion_=function(t,r,i){if(!t)return null;var n=shaka.util.XmlUtils.getAttributeNSList(t,shaka.text.TtmlTextParser.styleNs_,i);return n||shaka.text.TtmlTextParser.getInheritedStyleAttribute_(t,r,i)},shaka.text.TtmlTextParser.getStyleAttributeFromElement_=function(t,r,i){var n=shaka.util.XmlUtils.getAttributeNSList(t,shaka.text.TtmlTextParser.styleNs_,i);return n||shaka.text.TtmlTextParser.getInheritedStyleAttribute_(t,r,i)},shaka.text.TtmlTextParser.getInheritedStyleAttribute_=function(t,r,i){var n=shaka.util.XmlUtils,s=shaka.text.TtmlTextParser.styleNs_,o=shaka.text.TtmlTextParser.styleEbuttsNs_;t=shaka.text.TtmlTextParser.getElementsFromCollection_(t,"style",r,"");for(var l=null,u=0;u<t.length;u++){var m=n.getAttributeNS(t[u],o,i);m||(m=n.getAttributeNSList(t[u],s,i)),m||(m=shaka.text.TtmlTextParser.getStyleAttributeFromElement_(t[u],r,i)),m&&(l=m)}return l},shaka.text.TtmlTextParser.getElementsFromCollection_=function(t,r,i,n,s){var o=[];if(!t||1>i.length)return o;if(t=shaka.text.TtmlTextParser.getInheritedAttribute_(t,r,s))for(t=t.split(" "),t=$jscomp.makeIterator(t),r=t.next();!r.done;r=t.next()){r=r.value,s=$jscomp.makeIterator(i);for(var l=s.next();!l.done;l=s.next())if(l=l.value,n+l.getAttribute("xml:id")==r){o.push(l);break}}return o},shaka.text.TtmlTextParser.getInheritedAttribute_=function(t,r,i){for(var n=null,s=shaka.util.XmlUtils;t&&!(n=i?s.getAttributeNS(t,i,r):t.getAttribute(r))&&(t=t.parentNode,t instanceof Element););return n},shaka.text.TtmlTextParser.resolveTime_=function(t,r,i,n){return t=shaka.text.TtmlTextParser.parseTime_(t,r),i==null?i=t.start:t.start!=null&&(i+=t.start),n==null?n=t.end:t.start!=null&&(n+=t.start),{start:i,end:n}},shaka.text.TtmlTextParser.parseTime_=function(t,r){var i=shaka.text.TtmlTextParser.parseTimeAttribute_(t.getAttribute("begin"),r),n=shaka.text.TtmlTextParser.parseTimeAttribute_(t.getAttribute("end"),r),s=shaka.text.TtmlTextParser.parseTimeAttribute_(t.getAttribute("dur"),r);return n==null&&s!=null&&(n=i+s),{start:i,end:n}},shaka.text.TtmlTextParser.parseTimeAttribute_=function(t,r){var i=null,n=shaka.text.TtmlTextParser;if(n.timeColonFormatFrames_.test(t))i=n.parseColonTimeWithFrames_(r,t);else if(n.timeColonFormat_.test(t))i=n.parseTimeFromRegex_(n.timeColonFormat_,t);else if(n.timeColonFormatMilliseconds_.test(t))i=n.parseTimeFromRegex_(n.timeColonFormatMilliseconds_,t);else if(n.timeFramesFormat_.test(t))i=n.parseFramesTime_(r,t);else if(n.timeTickFormat_.test(t))i=n.parseTickTime_(r,t);else if(n.timeHMSFormat_.test(t))i=n.parseTimeFromRegex_(n.timeHMSFormat_,t);else if(t)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE,"Could not parse cue time range in TTML");return i},shaka.text.TtmlTextParser.parseFramesTime_=function(t,r){var i=shaka.text.TtmlTextParser.timeFramesFormat_.exec(r);return Number(i[1])/t.frameRate},shaka.text.TtmlTextParser.parseTickTime_=function(t,r){var i=shaka.text.TtmlTextParser.timeTickFormat_.exec(r);return Number(i[1])/t.tickRate},shaka.text.TtmlTextParser.parseColonTimeWithFrames_=function(t,r){var i=shaka.text.TtmlTextParser.timeColonFormatFrames_.exec(r),n=Number(i[1]),s=Number(i[2]),o=Number(i[3]),l=Number(i[4]);return l+=(Number(i[5])||0)/t.subFrameRate,o+=l/t.frameRate,o+60*s+3600*n},shaka.text.TtmlTextParser.parseTimeFromRegex_=function(t,r){var i=t.exec(r);return i==null||i[0]==""?null:(Number(i[4])||0)/1e3+(Number(i[3])||0)+60*(Number(i[2])||0)+3600*(Number(i[1])||0)},shaka.text.TtmlTextParser.getCellResolution_=function(t){if(!t)return null;var r=/^(\d+) (\d+)$/.exec(t);return r?(t=parseInt(r[1],10),r=parseInt(r[2],10),{columns:t,rows:r}):null},goog.exportSymbol("shaka.text.TtmlTextParser",shaka.text.TtmlTextParser),goog.exportProperty(shaka.text.TtmlTextParser.prototype,"parseMedia",shaka.text.TtmlTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.TtmlTextParser.prototype,"parseInit",shaka.text.TtmlTextParser.prototype.parseInit),shaka.text.TtmlTextParser.RateInfo_=function(t,r,i,n){this.frameRate=Number(t)||30,this.subFrameRate=Number(r)||1,this.tickRate=Number(n),this.tickRate==0&&(this.tickRate=t?this.frameRate*this.subFrameRate:1),i&&(t=/^(\d+) (\d+)$/g.exec(i))&&(this.frameRate*=Number(t[1])/Number(t[2]))},shaka.text.TtmlTextParser.percentValues_=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,shaka.text.TtmlTextParser.percentValue_=/^(\d{1,2}(?:\.\d+)?|100)%$/,shaka.text.TtmlTextParser.unitValues_=/^(\d+px|\d+em|\d*\.?\d+c)$/,shaka.text.TtmlTextParser.pixelValues_=/^(\d+)px (\d+)px$/,shaka.text.TtmlTextParser.timeColonFormatFrames_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,shaka.text.TtmlTextParser.timeColonFormat_=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,shaka.text.TtmlTextParser.timeColonFormatMilliseconds_=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,shaka.text.TtmlTextParser.timeFramesFormat_=/^(\d*(?:\.\d*)?)f$/,shaka.text.TtmlTextParser.timeTickFormat_=/^(\d*(?:\.\d*)?)t$/,shaka.text.TtmlTextParser.timeHMSFormat_=RegExp("^(?:(\\d*(?:\\.\\d*)?)h)?(?:(\\d*(?:\\.\\d*)?)m)?(?:(\\d*(?:\\.\\d*)?)s)?(?:(\\d*(?:\\.\\d*)?)ms)?$"),shaka.text.TtmlTextParser.textAlignToLineAlign_={left:shaka.text.Cue.lineAlign.START,center:shaka.text.Cue.lineAlign.CENTER,right:shaka.text.Cue.lineAlign.END,start:shaka.text.Cue.lineAlign.START,end:shaka.text.Cue.lineAlign.END},shaka.text.TtmlTextParser.textAlignToPositionAlign_={left:shaka.text.Cue.positionAlign.LEFT,center:shaka.text.Cue.positionAlign.CENTER,right:shaka.text.Cue.positionAlign.RIGHT},shaka.text.TtmlTextParser.parameterNs_=["http://www.w3.org/ns/ttml#parameter","http://www.w3.org/2006/10/ttaf1#parameter"],shaka.text.TtmlTextParser.styleNs_=["http://www.w3.org/ns/ttml#styling","http://www.w3.org/2006/10/ttaf1#styling"],shaka.text.TtmlTextParser.styleEbuttsNs_="urn:ebu:tt:style",shaka.text.TtmlTextParser.smpteNsList_=["http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt","http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"],shaka.text.TextEngine.registerParser("application/ttml+xml",function(){return new shaka.text.TtmlTextParser}),shaka.text.Mp4TtmlParser=function(){this.parser_=new shaka.text.TtmlTextParser},shaka.text.Mp4TtmlParser.prototype.parseInit=function(t){var r=shaka.util.Mp4Parser,i=!1;if(new r().box("moov",r.children).box("trak",r.children).box("mdia",r.children).box("minf",r.children).box("stbl",r.children).fullBox("stsd",r.sampleDescription).box("stpp",function(n){i=!0,n.parser.stop()}).parse(t),!i)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_TTML)},shaka.text.Mp4TtmlParser.prototype.parseMedia=function(t,r){var i=this,n=shaka.util.Mp4Parser,s=!1,o=[];if(new n().box("mdat",n.allData(function(l){s=!0,o=o.concat(i.parser_.parseMedia(l,r))})).parse(t,!1),!s)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_TTML);return o},goog.exportSymbol("shaka.text.Mp4TtmlParser",shaka.text.Mp4TtmlParser),goog.exportProperty(shaka.text.Mp4TtmlParser.prototype,"parseMedia",shaka.text.Mp4TtmlParser.prototype.parseMedia),goog.exportProperty(shaka.text.Mp4TtmlParser.prototype,"parseInit",shaka.text.Mp4TtmlParser.prototype.parseInit),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp"',function(){return new shaka.text.Mp4TtmlParser}),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp.ttml"',function(){return new shaka.text.Mp4TtmlParser}),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp.ttml.im1t"',function(){return new shaka.text.Mp4TtmlParser}),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp.TTML.im1t"',function(){return new shaka.text.Mp4TtmlParser}),shaka.text.VttTextParser=function(){},shaka.text.VttTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"VTT does not have init segments")},shaka.text.VttTextParser.prototype.parseMedia=function(t,r){var i=shaka.text.VttTextParser,n=shaka.util.StringUtils.fromUTF8(t);if(n=n.replace(/\r\n|\r(?=[^\n]|$)/gm,`
`),n=n.split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(n[0]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_HEADER);var s=r.periodStart;if(n[0].includes("X-TIMESTAMP-MAP")){var o=n[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),l=n[0].match(/MPEGTS:(\d+)/m);if(o&&l){if(s=new shaka.util.TextParser(o[1]),s=shaka.text.VttTextParser.parseTime_(s),s==null)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_HEADER);l=Number(l[1]),o=shaka.text.VttTextParser.MPEG_TIMESCALE_;for(var u=shaka.text.VttTextParser.TS_ROLLOVER_/o,m=r.segmentStart;m>=u;)m-=u,l+=shaka.text.VttTextParser.TS_ROLLOVER_;s=r.periodStart+l/o-s}}for(l=[],o=$jscomp.makeIterator(n[0].split(`
`)),u=o.next();!u.done;u=o.next())u=u.value,/^Region:/.test(u)&&(u=i.parseRegion_(u),l.push(u));for(o=new Map,i.addDefaultTextColor_(o),u=[],n=$jscomp.makeIterator(n.slice(1)),m=n.next();!m.done;m=n.next())m=m.value.split(`
`),i.parseStyle_(m,o),(m=i.parseCue_(m,s,l,o))&&u.push(m);return u},shaka.text.VttTextParser.addDefaultTextColor_=function(t){for(var r=$jscomp.makeIterator(Object.entries(shaka.text.Cue.defaultTextColor)),i=r.next();!i.done;i=r.next()){var n=$jscomp.makeIterator(i.value);i=n.next().value,n=n.next().value;var s=new shaka.text.Cue(0,0,"");s.color=n,t.set(i,s)}for(r=$jscomp.makeIterator(Object.entries(shaka.text.Cue.defaultTextBackgroundColor)),i=r.next();!i.done;i=r.next())n=$jscomp.makeIterator(i.value),i=n.next().value,n=n.next().value,s=new shaka.text.Cue(0,0,""),s.backgroundColor=n,t.set(i,s)},shaka.text.VttTextParser.parseRegion_=function(t){var r=shaka.text.VttTextParser;t=new shaka.util.TextParser(t);var i=new shaka.text.CueRegion;t.readWord(),t.skipWhitespace();for(var n=t.readWord();n;)r.parseRegionSetting_(i,n)||shaka.log.warning("VTT parser encountered an invalid VTTRegion setting: ",n," The setting will be ignored."),t.skipWhitespace(),n=t.readWord();return i},shaka.text.VttTextParser.parseStyle_=function(t,r){if((t.length!=1||t[0])&&!/^NOTE($|[ \t])/.test(t[0])&&t[0]=="STYLE"&&t[1].includes("::cue")){var i="global",n=t[1].match(/\((.*)\)/);if(n&&(i=n.pop()),n=t.slice(2,-1),t[1].includes("}")){var s=/\{(.*?)\}/.exec(t[1]);s&&(n=s[1].split(";"))}s=new shaka.text.Cue(0,0,"");for(var o=!1,l=0;l<n.length;l++){var u=/^\s*([^:]+):\s*(.*)/.exec(n[l]);if(u){var m=u[1].trim(),E=u[2].trim().replace(";","");switch(m){case"background-color":o=!0,s.backgroundColor=E;break;case"color":o=!0,s.color=E;break;case"font-family":o=!0,s.fontFamily=E;break;case"font-size":o=!0,s.fontSize=E;break;case"font-weight":700<=parseInt(E,10)&&(o=!0,s.fontWeight=shaka.text.Cue.fontWeight.BOLD);break;case"font-style":switch(E){case"normal":o=!0,s.fontStyle=shaka.text.Cue.fontStyle.NORMAL;break;case"italic":o=!0,s.fontStyle=shaka.text.Cue.fontStyle.ITALIC;break;case"oblique":o=!0,s.fontStyle=shaka.text.Cue.fontStyle.OBLIQUE}break;case"opacity":o=!0,s.opacity=parseFloat(E);break;case"white-space":o=!0,s.wrapLine=E!="noWrap";break;default:shaka.log.warning("VTT parser encountered an unsupported style: ",u)}}}o&&r.set(i,s)}},shaka.text.VttTextParser.parseCue_=function(t,r,i,n){var s=shaka.text.VttTextParser;if(t.length==1&&!t[0]||/^NOTE($|[ \t])/.test(t[0])||t[0]=="STYLE")return null;var o=null;t[0].includes("-->")||(o=t[0],t.splice(0,1));var l=new shaka.util.TextParser(t[0]),u=s.parseTime_(l),m=l.readRegex(/[ \t]+--\x3e[ \t]+/g),E=s.parseTime_(l);if(u==null||m==null||E==null)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE,"Could not parse cue time range in WebVTT");for(u+=r,E+=r,r=t.slice(1).join(`
`).trim(),n.has("global")?(t=n.get("global").clone(),t.startTime=u,t.endTime=E,t.payload=""):t=new shaka.text.Cue(u,E,""),s.parseCueStyles(r,t,n),l.skipWhitespace(),n=l.readWord();n;)s.parseCueSetting(t,n,i)||shaka.log.warning("VTT parser encountered an invalid VTT setting: ",n," The setting will be ignored."),l.skipWhitespace(),n=l.readWord();return o!=null&&(t.id=o),t},shaka.text.VttTextParser.parseCueStyles=function(t,r,i){var n=shaka.text.VttTextParser;i.size===0&&n.addDefaultTextColor_(i),t=n.replaceColorPayload_(t);var s=shaka.util.XmlUtils.parseXmlString("<span>"+t+"</span>","span");if(s){var o=[];if(s=s.childNodes,s.length==1){var l=s[0];if(l.nodeType==Node.TEXT_NODE||l.nodeType==Node.CDATA_SECTION_NODE){r.payload=t;return}}for(t=$jscomp.makeIterator(s),s=t.next();!s.done;s=t.next())n.generateCueFromElement_(s.value,r,o,i);r.nestedCues=o}else shaka.log.warning("The cue's markup could not be parsed: ",t),r.payload=t},shaka.text.VttTextParser.replaceColorPayload_=function(t){for(var r=[],i=-1,n="",s=0;s<t.length;s++)if(t[s]==="/"){var o=t.indexOf(">",s);if(o<=s)return t;o=t.substring(s+1,o);var l=r.pop();if(o&&l){if(l===o)n+="/"+o+">";else{if(!l.startsWith("c.")||o!=="c")return t;n+="/"+l+">"}s+=o.length+1}else return t}else t[s]==="<"?i=s+1:t[s]===">"&&0<i&&(r.push(t.substr(i,s-i)),i=-1),n+=t[s];return n},shaka.text.VttTextParser.getOrDefault_=function(t,r){return t&&0<t.length?t:r},shaka.text.VttTextParser.mergeStyle_=function(t,r){if(r){var i=shaka.text.VttTextParser;t.backgroundColor=i.getOrDefault_(r.backgroundColor,t.backgroundColor),t.color=i.getOrDefault_(r.color,t.color),t.fontFamily=i.getOrDefault_(r.fontFamily,t.fontFamily),t.fontSize=i.getOrDefault_(r.fontSize,t.fontSize),t.fontWeight=r.fontWeight,t.fontStyle=r.fontStyle,t.opacity=r.opacity,t.wrapLine=r.wrapLine}},shaka.text.VttTextParser.generateCueFromElement_=function(t,r,i,n){var s=shaka.text.VttTextParser,o=r.clone();if(t.nodeType===Node.ELEMENT_NODE&&t.nodeName){var l=shaka.text.Cue.fontWeight.BOLD,u=shaka.text.Cue.fontStyle.ITALIC,m=shaka.text.Cue.textDecoration.UNDERLINE,E=t.nodeName.split(/[ .]+/);E=$jscomp.makeIterator(E);for(var y=E.next();!y.done;y=E.next())switch(y=y.value,n.has(y)&&s.mergeStyle_(o,n.get(y)),y){case"b":o.fontWeight=l;break;case"i":o.fontStyle=u;break;case"u":o.textDecoration.push(m)}}if(shaka.util.XmlUtils.isText(t))for(n=t.textContent.split(`
`),s=!0,n=$jscomp.makeIterator(n),t=n.next();!t.done;t=n.next())t=t.value,s||(s=r.clone(),s.lineBreak=!0,i.push(s)),0<t.length&&(s=o.clone(),s.payload=t,i.push(s)),s=!1;else for(r=$jscomp.makeIterator(t.childNodes),t=r.next();!t.done;t=r.next())s.generateCueFromElement_(t.value,o,i,n)},shaka.text.VttTextParser.parseCueSetting=function(t,r,i){var n=shaka.text.VttTextParser,s;if(s=/^align:(start|middle|center|end|left|right)$/.exec(r))n.setTextAlign_(t,s[1]);else if(s=/^vertical:(lr|rl)$/.exec(r))n.setVerticalWritingMode_(t,s[1]);else if(s=/^size:([\d.]+)%$/.exec(r))t.size=Number(s[1]);else if(s=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(r))t.position=Number(s[1]),s[2]&&n.setPositionAlign_(t,s[2]);else if(s=/^region:(.*)$/.exec(r))(r=n.getRegionById_(i,s[1]))&&(t.region=r);else return n.parsedLineValueAndInterpretation_(t,r);return!0},shaka.text.VttTextParser.getRegionById_=function(t,r){var i=t.filter(function(n){return n.id==r});return i.length?(goog.asserts.assert(i.length==1,"VTTRegion ids should be unique!"),i[0]):(shaka.log.warning("VTT parser could not find a region with id: ",r," The region will be ignored."),null)},shaka.text.VttTextParser.parseRegionSetting_=function(t,r){var i;if(i=/^id=(.*)$/.exec(r))t.id=i[1];else if(i=/^width=(\d{1,2}|100)%$/.exec(r))t.width=Number(i[1]);else if(i=/^lines=(\d+)$/.exec(r))t.height=Number(i[1]),t.heightUnits=shaka.text.CueRegion.units.LINES;else if(i=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(r))t.regionAnchorX=Number(i[1]),t.regionAnchorY=Number(i[2]);else if(i=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(r))t.viewportAnchorX=Number(i[1]),t.viewportAnchorY=Number(i[2]);else if(/^scroll=up$/.exec(r))t.scroll=shaka.text.CueRegion.scrollMode.UP;else return!1;return!0},shaka.text.VttTextParser.setTextAlign_=function(t,r){var i=shaka.text.Cue;r=="middle"?t.textAlign=i.textAlign.CENTER:(goog.asserts.assert(r.toUpperCase()in i.textAlign,r.toUpperCase()+" Should be in Cue.textAlign values!"),t.textAlign=i.textAlign[r.toUpperCase()])},shaka.text.VttTextParser.setPositionAlign_=function(t,r){var i=shaka.text.Cue;t.positionAlign=r=="line-left"||r=="start"?i.positionAlign.LEFT:r=="line-right"||r=="end"?i.positionAlign.RIGHT:i.positionAlign.CENTER},shaka.text.VttTextParser.setVerticalWritingMode_=function(t,r){var i=shaka.text.Cue;t.writingMode=r=="lr"?i.writingMode.VERTICAL_LEFT_TO_RIGHT:i.writingMode.VERTICAL_RIGHT_TO_LEFT},shaka.text.VttTextParser.parsedLineValueAndInterpretation_=function(t,r){var i=shaka.text.Cue,n;if(n=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(r))t.lineInterpretation=i.lineInterpretation.PERCENTAGE,t.line=Number(n[1]),n[2]&&(goog.asserts.assert(n[2].toUpperCase()in i.lineAlign,n[2].toUpperCase()+" Should be in Cue.lineAlign values!"),t.lineAlign=i.lineAlign[n[2].toUpperCase()]);else if(n=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(r))t.lineInterpretation=i.lineInterpretation.LINE_NUMBER,t.line=Number(n[1]),n[2]&&(goog.asserts.assert(n[2].toUpperCase()in i.lineAlign,n[2].toUpperCase()+" Should be in Cue.lineAlign values!"),t.lineAlign=i.lineAlign[n[2].toUpperCase()]);else return!1;return!0},shaka.text.VttTextParser.parseTime_=function(t){if(t=t.readRegex(/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g),t==null)return null;var r=Number(t[2]),i=Number(t[3]);return 59<r||59<i?null:Number(t[4])/1e3+i+60*r+3600*(Number(t[1])||0)},goog.exportSymbol("shaka.text.VttTextParser",shaka.text.VttTextParser),goog.exportProperty(shaka.text.VttTextParser.prototype,"parseMedia",shaka.text.VttTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.VttTextParser.prototype,"parseInit",shaka.text.VttTextParser.prototype.parseInit),shaka.text.VttTextParser.MPEG_TIMESCALE_=9e4,shaka.text.VttTextParser.TS_ROLLOVER_=8589934592,shaka.text.TextEngine.registerParser("text/vtt",function(){return new shaka.text.VttTextParser}),shaka.text.TextEngine.registerParser('text/vtt; codecs="vtt"',function(){return new shaka.text.VttTextParser}),shaka.text.TextEngine.registerParser('text/vtt; codecs="wvtt"',function(){return new shaka.text.VttTextParser}),shaka.text.Mp4VttParser=function(){this.timescale_=null},shaka.text.Mp4VttParser.prototype.parseInit=function(t){var r=this,i=shaka.util.Mp4Parser,n=!1;if(new i().box("moov",i.children).box("trak",i.children).box("mdia",i.children).fullBox("mdhd",function(s){goog.asserts.assert(s.version==0||s.version==1,"MDHD version can only be 0 or 1"),s=shaka.util.Mp4BoxParsers.parseMDHD(s.reader,s.version),r.timescale_=s.timescale}).box("minf",i.children).box("stbl",i.children).fullBox("stsd",i.sampleDescription).box("wvtt",function(s){n=!0}).parse(t),!this.timescale_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);if(!n)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT)},shaka.text.Mp4VttParser.prototype.parseMedia=function(t,r){if(!this.timescale_)throw shaka.log.error("No init segment for MP4+VTT!"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);var i=shaka.util.Mp4Parser,n=0,s=[],o,l=[],u=!1,m=!1,E=!1,y=null;if(new i().box("moof",i.children).box("traf",i.children).fullBox("tfdt",function(H){u=!0,goog.asserts.assert(H.version==0||H.version==1,"TFDT version can only be 0 or 1"),n=shaka.util.Mp4BoxParsers.parseTFDT(H.reader,H.version).baseMediaDecodeTime}).fullBox("tfhd",function(H){goog.asserts.assert(H.flags!=null,"A TFHD box should have a valid flags value"),y=shaka.util.Mp4BoxParsers.parseTFHD(H.reader,H.flags).defaultSampleDuration}).fullBox("trun",function(H){m=!0,goog.asserts.assert(H.version!=null,"A TRUN box should have a valid version value"),goog.asserts.assert(H.flags!=null,"A TRUN box should have a valid flags value"),s=shaka.util.Mp4BoxParsers.parseTRUN(H.reader,H.version,H.flags).sampleData}).box("mdat",i.allData(function(H){goog.asserts.assert(!E,"VTT cues in mp4 with multiple MDAT are not currently supported"),E=!0,o=H})).parse(t,!1),!E&&!u&&!m)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);i=n;for(var D=new shaka.util.DataViewReader(o,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),w=$jscomp.makeIterator(s),B=w.next();!B.done;B=w.next()){B=B.value;var F=B.sampleDuration||y,V=B.sampleCompositionTimeOffset?n+B.sampleCompositionTimeOffset:i;i=V+(F||0);var K=0;do{var q=D.readUint32();K+=q;var re=D.readUint32();re=shaka.util.Mp4Parser.typeToString(re);var ee=null;re=="vttc"?8<q&&(ee=D.readBytes(q-8)):(re!="vtte"&&shaka.log.error("Unknown box "+re+"! Skipping!"),D.skip(q-8)),F?ee&&(goog.asserts.assert(this.timescale_!=null,"Timescale should not be null!"),q=shaka.text.Mp4VttParser.parseVTTC_(ee,r.periodStart+V/this.timescale_,r.periodStart+i/this.timescale_),l.push(q)):shaka.log.error("WVTT sample duration unknown, and no default found!"),goog.asserts.assert(!B.sampleSize||K<=B.sampleSize,"The samples do not fit evenly into the sample sizes given in the TRUN box!")}while(B.sampleSize&&K<B.sampleSize)}return goog.asserts.assert(!D.hasMoreData(),"MDAT which contain VTT cues and non-VTT data are not currently supported!"),l.filter(shaka.util.Functional.isNotNull)},shaka.text.Mp4VttParser.parseVTTC_=function(t,r,i){var n,s,o;return new shaka.util.Mp4Parser().box("payl",shaka.util.Mp4Parser.allData(function(l){n=shaka.util.StringUtils.fromUTF8(l)})).box("iden",shaka.util.Mp4Parser.allData(function(l){s=shaka.util.StringUtils.fromUTF8(l)})).box("sttg",shaka.util.Mp4Parser.allData(function(l){o=shaka.util.StringUtils.fromUTF8(l)})).parse(t),n?shaka.text.Mp4VttParser.assembleCue_(n,s,o,r,i):null},shaka.text.Mp4VttParser.assembleCue_=function(t,r,i,n,s){if(n=new shaka.text.Cue(n,s,""),s=new Map,shaka.text.VttTextParser.parseCueStyles(t,n,s),r&&(n.id=r),i)for(t=new shaka.util.TextParser(i),r=t.readWord();r;)shaka.text.VttTextParser.parseCueSetting(n,r,[])||shaka.log.warning("VTT parser encountered an invalid VTT setting: ",r," The setting will be ignored."),t.skipWhitespace(),r=t.readWord();return n},goog.exportSymbol("shaka.text.Mp4VttParser",shaka.text.Mp4VttParser),goog.exportProperty(shaka.text.Mp4VttParser.prototype,"parseMedia",shaka.text.Mp4VttParser.prototype.parseMedia),goog.exportProperty(shaka.text.Mp4VttParser.prototype,"parseInit",shaka.text.Mp4VttParser.prototype.parseInit),shaka.text.TextEngine.registerParser('application/mp4; codecs="wvtt"',function(){return new shaka.text.Mp4VttParser}),shaka.text.SbvTextParser=function(){},shaka.text.SbvTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"SubViewer does not have init segments")},shaka.text.SbvTextParser.prototype.parseMedia=function(t,r){var i=shaka.text.SbvTextParser,n=shaka.util.StringUtils.fromUTF8(t).replace(/\r+/g,"");n=n.trim();var s=[];if(n=="")return s;n=n.split(`

`),n=$jscomp.makeIterator(n);for(var o=n.next();!o.done;o=n.next()){var l=o.value.split(`
`),u=new shaka.util.TextParser(l[0]);o=i.parseTime_(u);var m=u.readRegex(/,/g);if(u=i.parseTime_(u),o==null||m==null||u==null)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE,"Could not parse cue time range in SubViewer");l=l.slice(1).join(`
`).trim(),o=new shaka.text.Cue(o,u,l),s.push(o)}return s},shaka.text.SbvTextParser.parseTime_=function(t){if(t=t.readRegex(/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g),t==null)return null;var r=Number(t[2]),i=Number(t[3]);return 59<r||59<i?null:Number(t[4])/1e3+i+60*r+3600*(Number(t[1])||0)},goog.exportSymbol("shaka.text.SbvTextParser",shaka.text.SbvTextParser),goog.exportProperty(shaka.text.SbvTextParser.prototype,"parseMedia",shaka.text.SbvTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.SbvTextParser.prototype,"parseInit",shaka.text.SbvTextParser.prototype.parseInit),shaka.text.TextEngine.registerParser("text/x-subviewer",function(){return new shaka.text.SbvTextParser}),shaka.text.SrtTextParser=function(){this.parser_=new shaka.text.VttTextParser},shaka.text.SrtTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"SRT does not have init segments")},shaka.text.SrtTextParser.prototype.parseMedia=function(t,r){var i=shaka.text.SrtTextParser,n=shaka.util.BufferUtils,s=shaka.util.StringUtils,o=s.fromUTF8(t);return i=i.srt2webvtt(o),n=n.toUint8(s.toUTF8(i)),this.parser_.parseMedia(n,r)},shaka.text.SrtTextParser.srt2webvtt=function(t){var r=shaka.text.SrtTextParser,i=`WEBVTT

`;if(t=="")return i;t=t.replace(/\r+/g,""),t=t.trim(),t=t.split(`

`),t=$jscomp.makeIterator(t);for(var n=t.next();!n.done;n=t.next())i+=r.convertSrtCue_(n.value);return i},shaka.text.SrtTextParser.convertSrtCue_=function(t){return t=t.split(/\n/),t[0].match(/\d+/)&&t.shift(),t[0]=t[0].replace(/,/g,"."),t.join(`
`)+`

`},goog.exportSymbol("shaka.text.SrtTextParser",shaka.text.SrtTextParser),goog.exportProperty(shaka.text.SrtTextParser,"srt2webvtt",shaka.text.SrtTextParser.srt2webvtt),goog.exportProperty(shaka.text.SrtTextParser.prototype,"parseMedia",shaka.text.SrtTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.SrtTextParser.prototype,"parseInit",shaka.text.SrtTextParser.prototype.parseInit),shaka.text.TextEngine.registerParser("text/srt",function(){return new shaka.text.SrtTextParser}),shaka.text.SsaTextParser=function(){},shaka.text.SsaTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"SSA does not have init segments")},shaka.text.SsaTextParser.prototype.parseMedia=function(t,r){var i=shaka.text.SsaTextParser,n="",s="",o=shaka.util.StringUtils.fromUTF8(t).split(/\r?\n\s*\r?\n/);o=$jscomp.makeIterator(o);for(var l=o.next();!l.done;l=o.next()){l=l.value;var u=i.ssaContent_.exec(l);if(u){var m=u[1];if(u=u[2],m=="V4 Styles"||m=="V4+ Styles"){n=u;continue}if(m=="Events"){s=u;continue}}shaka.log.warning("SsaTextParser parser encountered an unknown part.",l)}for(o=[],l=null,n=n.split(/\r?\n/),n=$jscomp.makeIterator(n),u=n.next();!u.done;u=n.next())if(m=u.value,!/^\s*;/.test(m)&&(u=i.lineParts_.exec(m))){if(m=u[1].trim(),u=u[2].trim(),m=="Format")l=u.split(i.valuesFormat_);else if(m=="Style"){m=u.split(i.valuesFormat_),u={};for(var E=0;E<l.length&&E<m.length;E++)u[l[E]]=m[E];o.push(u)}}for(l=[],n=null,m=s.split(/\r?\n/),s={},m=$jscomp.makeIterator(m),u=m.next();!u.done;s={$jscomp$loop$prop$styleName$632:s.$jscomp$loop$prop$styleName$632},u=m.next())if(u=u.value,!/^\s*;/.test(u)&&(E=i.lineParts_.exec(u))){if(u=E[1].trim(),E=E[2].trim(),u=="Format")n=E.split(i.valuesFormat_);else if(u=="Dialogue"){E=E.split(i.valuesFormat_),u={};for(var y=0;y<n.length&&y<E.length;y++)u[n[y]]=E[y];y=i.parseTime_(u.Start);var D=i.parseTime_(u.End);E=E.slice(n.length-1).join(",").replace(/\\N/g,`
`).replace(/\{[^}]+\}/g,""),E=new shaka.text.Cue(y,D,E),s.$jscomp$loop$prop$styleName$632=u.Style,(u=o.find(function(w){return function(B){return B.Name==w.$jscomp$loop$prop$styleName$632}}(s)))&&i.addStyle_(E,u),l.push(E)}}return l},shaka.text.SsaTextParser.addStyle_=function(t,r){var i=shaka.text.Cue,n=shaka.text.SsaTextParser,s=r.Fontname;if(s&&(t.fontFamily=s),(s=r.Fontsize)&&(t.fontSize=s+"px"),(s=r.PrimaryColour)&&(s=n.parseSsaColor_(s))&&(t.color=s),(s=r.BackColour)&&(n=n.parseSsaColor_(s))&&(t.backgroundColor=n),r.Bold&&(t.fontWeight=i.fontWeight.BOLD),r.Italic&&(t.fontStyle=i.fontStyle.ITALIC),r.Underline&&t.textDecoration.push(i.textDecoration.UNDERLINE),(n=r.Spacing)&&(t.letterSpacing=n+"px"),n=r.Alignment)switch(parseInt(n,10)){case 1:t.displayAlign=i.displayAlign.AFTER,t.textAlign=i.textAlign.START;break;case 2:t.displayAlign=i.displayAlign.AFTER,t.textAlign=i.textAlign.CENTER;break;case 3:t.displayAlign=i.displayAlign.AFTER,t.textAlign=i.textAlign.END;break;case 5:t.displayAlign=i.displayAlign.BEFORE,t.textAlign=i.textAlign.START;break;case 6:t.displayAlign=i.displayAlign.BEFORE,t.textAlign=i.textAlign.CENTER;break;case 7:t.displayAlign=i.displayAlign.BEFORE,t.textAlign=i.textAlign.END;break;case 9:t.displayAlign=i.displayAlign.CENTER,t.textAlign=i.textAlign.START;break;case 10:t.displayAlign=i.displayAlign.CENTER,t.textAlign=i.textAlign.CENTER;break;case 11:t.displayAlign=i.displayAlign.CENTER,t.textAlign=i.textAlign.END}(i=r.AlphaLevel)&&(t.opacity=parseFloat(i))},shaka.text.SsaTextParser.parseSsaColor_=function(t){return t=parseInt(t.replace("&H",""),16),0<=t?"rgba("+(t&255)+","+(t>>8&255)+","+(t>>16&255)+","+(t>>24&255^255)/255+")":null},shaka.text.SsaTextParser.parseTime_=function(t){var r=shaka.text.SsaTextParser.timeFormat_.exec(t);t=r[1]?parseInt(r[1].replace(":",""),10):0;var i=parseInt(r[2],10);return r=parseFloat(r[3]),3600*t+60*i+r},goog.exportSymbol("shaka.text.SsaTextParser",shaka.text.SsaTextParser),goog.exportProperty(shaka.text.SsaTextParser.prototype,"parseMedia",shaka.text.SsaTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.SsaTextParser.prototype,"parseInit",shaka.text.SsaTextParser.prototype.parseInit),shaka.text.SsaTextParser.ssaContent_=/^\s*\[([^\]]+)\]\r?\n([\s\S]*)/,shaka.text.SsaTextParser.lineParts_=/^\s*([^:]+):\s*(.*)/,shaka.text.SsaTextParser.valuesFormat_=/\s*,\s*/,shaka.text.SsaTextParser.timeFormat_=/^(\d+:)?(\d{1,2}):(\d{1,2}(?:[.]\d{1,3})?)?$/,shaka.text.TextEngine.registerParser("text/x-ssa",function(){return new shaka.text.SsaTextParser});var EmeEncryptionSchemePolyfill=function(){};EmeEncryptionSchemePolyfill.install=function(){EmeEncryptionSchemePolyfill.originalRMKSA_?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(EmeEncryptionSchemePolyfill.originalRMKSA_=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=EmeEncryptionSchemePolyfill.probeRMKSA_):console.debug("EmeEncryptionSchemePolyfill: EME not found")},EmeEncryptionSchemePolyfill.probeRMKSA_=function(t,r){var i=this,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(s){return s.nextAddress==1?(console.assert(i==navigator,'bad "this" for requestMediaKeySystemAccess'),s.yield(EmeEncryptionSchemePolyfill.originalRMKSA_.call(i,t,r),2)):(n=s.yieldResult,hasEncryptionScheme(n)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=EmeEncryptionSchemePolyfill.originalRMKSA_,s.return(n)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=EmeEncryptionSchemePolyfill.polyfillRMKSA_,s.return(EmeEncryptionSchemePolyfill.polyfillRMKSA_.call(i,t,r))))})},EmeEncryptionSchemePolyfill.polyfillRMKSA_=function(t,r){var i=this,n,s,o,l,u,m,E,y,D,w;return $jscomp.asyncExecutePromiseGeneratorProgram(function(B){if(B.nextAddress==1){for(console.assert(i==navigator,'bad "this" for requestMediaKeySystemAccess'),n=guessSupportedScheme(t),s=[],o=$jscomp.makeIterator(r),l=o.next();!l.done;l=o.next())u=l.value,m=EmeEncryptionSchemePolyfill.filterCapabilities_(u.videoCapabilities,n),E=EmeEncryptionSchemePolyfill.filterCapabilities_(u.audioCapabilities,n),u.videoCapabilities&&u.videoCapabilities.length&&!m.length||u.audioCapabilities&&u.audioCapabilities.length&&!E.length||(y=Object.assign({},u),y.videoCapabilities=m,y.audioCapabilities=E,s.push(y));if(!s.length)throw D=Error("Unsupported keySystem or supportedConfigurations."),D.name="NotSupportedError",D.code=DOMException.NOT_SUPPORTED_ERR,D;return B.yield(EmeEncryptionSchemePolyfill.originalRMKSA_.call(i,t,s),2)}return w=B.yieldResult,B.return(new EmeEncryptionSchemePolyfillMediaKeySystemAccess(w,n))})},EmeEncryptionSchemePolyfill.filterCapabilities_=function(t,r){return t&&t.filter(function(i){return!i.encryptionScheme||i.encryptionScheme==r})},goog.exportSymbol("EmeEncryptionSchemePolyfill",EmeEncryptionSchemePolyfill),goog.exportProperty(EmeEncryptionSchemePolyfill,"install",EmeEncryptionSchemePolyfill.install);var McEncryptionSchemePolyfill=function(){};McEncryptionSchemePolyfill.install=function(){McEncryptionSchemePolyfill.originalDecodingInfo_?console.debug("McEncryptionSchemePolyfill: Already installed."):navigator.mediaCapabilities?(McEncryptionSchemePolyfill.originalDecodingInfo_=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=McEncryptionSchemePolyfill.probeDecodingInfo_):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")},McEncryptionSchemePolyfill.probeDecodingInfo_=function(t){var r=this,i,n,s;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){switch(o.nextAddress){case 1:return console.assert(r==navigator.mediaCapabilities,'bad "this" for decodingInfo'),o.yield(McEncryptionSchemePolyfill.originalDecodingInfo_.call(r,t),2);case 2:if(i=o.yieldResult,!t.keySystemConfiguration)return o.return(i);if((n=i.keySystemAccess)&&hasEncryptionScheme(n))return console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=McEncryptionSchemePolyfill.originalDecodingInfo_,o.return(i);if(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=McEncryptionSchemePolyfill.polyfillDecodingInfo_,n){o.jumpTo(3);break}return s=i,o.yield(McEncryptionSchemePolyfill.getMediaKeySystemAccess_(t),4);case 4:return s.keySystemAccess=o.yieldResult,o.return(i);case 3:return o.return(McEncryptionSchemePolyfill.polyfillDecodingInfo_.call(r,t))}})},McEncryptionSchemePolyfill.polyfillDecodingInfo_=function(t){var r=this,i,n,s,o,l,u,m,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){switch(y.nextAddress){case 1:return console.assert(r==navigator.mediaCapabilities,'bad "this" for decodingInfo'),i=null,t.keySystemConfiguration&&(n=t.keySystemConfiguration,s=n.keySystem,o=n.audio&&n.audio.encryptionScheme,l=n.video&&n.video.encryptionScheme,i=guessSupportedScheme(s),u={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:t},o&&o!=i||l&&l!=i)?y.return(u):y.yield(McEncryptionSchemePolyfill.originalDecodingInfo_.call(r,t),2);case 2:if(m=y.yieldResult,m.keySystemAccess){m.keySystemAccess=new EmeEncryptionSchemePolyfillMediaKeySystemAccess(m.keySystemAccess,i),y.jumpTo(3);break}if(!t.keySystemConfiguration){y.jumpTo(3);break}return E=m,y.yield(McEncryptionSchemePolyfill.getMediaKeySystemAccess_(t),5);case 5:E.keySystemAccess=y.yieldResult;case 3:return y.return(m)}})},McEncryptionSchemePolyfill.getMediaKeySystemAccess_=function(t){var r,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return n.nextAddress==1?(r=McEncryptionSchemePolyfill.convertToMediaKeySystemConfig_(t),n.yield(navigator.requestMediaKeySystemAccess(t.keySystemConfiguration.keySystem,[r]),2)):(i=n.yieldResult,n.return(i))})},McEncryptionSchemePolyfill.convertToMediaKeySystemConfig_=function(t){var r=t.keySystemConfiguration,i=[],n=[];return r.audio&&i.push({robustness:r.audio.robustness||"",contentType:t.audio.contentType}),r.video&&n.push({robustness:r.video.robustness||"",contentType:t.video.contentType}),t={initDataTypes:r.initDataType?[r.initDataType]:[],distinctiveIdentifier:r.distinctiveIdentifier,persistentState:r.persistentState,sessionTypes:r.sessionTypes},i.length&&(t.audioCapabilities=i),n.length&&(t.videoCapabilities=n),t},goog.exportSymbol("McEncryptionSchemePolyfill",McEncryptionSchemePolyfill),goog.exportProperty(McEncryptionSchemePolyfill,"install",McEncryptionSchemePolyfill.install);var EmeEncryptionSchemePolyfillMediaKeySystemAccess=function(t,r){this.mksa_=t,this.scheme_=r,this.keySystem=t.keySystem};EmeEncryptionSchemePolyfillMediaKeySystemAccess.prototype.getConfiguration=function(){var t=this.mksa_.getConfiguration();if(t.videoCapabilities)for(var r=$jscomp.makeIterator(t.videoCapabilities),i=r.next();!i.done;i=r.next())i.value.encryptionScheme=this.scheme_;if(t.audioCapabilities)for(r=$jscomp.makeIterator(t.audioCapabilities),i=r.next();!i.done;i=r.next())i.value.encryptionScheme=this.scheme_;return t},EmeEncryptionSchemePolyfillMediaKeySystemAccess.prototype.createMediaKeys=function(){return this.mksa_.createMediaKeys()};function guessSupportedScheme(t){return t.startsWith("com.widevine")||t.startsWith("com.microsoft")||t.startsWith("com.chromecast")||t.startsWith("com.adobe")||t.startsWith("org.w3")?"cenc":t.startsWith("com.apple")?"cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",t,"Please contribute!"),null)}function hasEncryptionScheme(t){t=t.getConfiguration();var r=t.audioCapabilities&&t.audioCapabilities[0];return!!((t=t.videoCapabilities&&t.videoCapabilities[0]||r)&&t.encryptionScheme!==void 0)}var EncryptionSchemePolyfills=function(){};EncryptionSchemePolyfills.install=function(){EmeEncryptionSchemePolyfill.install(),McEncryptionSchemePolyfill.install()},goog.exportSymbol("EncryptionSchemePolyfills",EncryptionSchemePolyfills),goog.exportProperty(EncryptionSchemePolyfills,"install",EncryptionSchemePolyfills.install),function(){typeof module<"u"&&module.exports&&(module.exports=EncryptionSchemePolyfills)}()}.call(exportTo,innerGlobal,innerGlobal,void 0),typeof exports<"u")for(var k in exportTo.shaka)exports[k]=exportTo.shaka[k];else typeof define=="function"&&define.amd?define(function(){return exportTo.shaka}):innerGlobal.shaka=exportTo.shaka})()});var wn=wi(En(),1),vn=wi(xn(),1);var Ja=(i=>(i.WIDEVINE="widevine",i.FAIRPLAY="fairplay",i))(Ja||{});var Cn={eng:"English",en:"English",und:"English"};var Cr={Default:"default","50%":.5,"75%":.75,"100%":1,"150%":1.5,"200%":2},hr={Default:"default",White:"255, 255, 255",Black:"0, 0, 0",Gray:"128, 128, 128",Yellow:"255, 255, 0",Green:"0, 128, 0",Cyan:"0, 255, 255",Blue:"0, 0, 255",Red:"255, 0, 0"},Yr={Default:"default","25%":.2,"50%":.4,"75%":.6,"100%":.8};var vr=class{static async togglePlayPause(r){if(r.isContainerFocused=!0,r.player.playerState.isCasting){r.player.castSender.onPlayPause();return}if(!r.player.playerState.loaded)return;if(r.contextMenu.style.display==="block"){r.contextMenu.style.display="none";return}if(r.optionsMenuWrapper.classList.contains("flex")){this.toggleShowHide(r.optionsMenuWrapper,"none");return}let i=r.videoElement;i.paused?(r.player.hls.startLoad(),await i.play(),r.player.setPlayerState({hasUserPaused:!1}),typeof r.player.onPlayCallback=="function"&&r.player.onPlayCallback()):(r.player.hls.stopLoad(),i.pause(),r.player.setPlayerState({hasUserPaused:!0}),typeof r.player.onPauseCallback=="function"&&r.player.onPauseCallback())}static toggleMuteUnMute(r){if(r.isContainerFocused=!0,r.player.playerState.isCasting){r.player.castSender.onMuteUnMute();return}if(!r.player.playerState.loaded)return;let i=r.videoElement;i.muted?i.muted=!1:i.muted=!0}static toggleForwardRewind(r,i){if(r.player.playerState.isCasting){i?r.player.castSender.onForward():r.player.castSender.onRewind();return}if(!r.player.playerState.loaded)return;let n=r.videoElement;if(n){if(!n.duration)return;let s=n.currentTime,o=n.duration;if(s>=0&&o>=0){if(i){let u=Math.min(s+30,o);r.progressSliderValue=String(u),r.controlsProgressRangeInput&&(r.controlsProgressRangeInput.value=String(u)),n.currentTime=u;return}let l=Math.max(s-15,0);r.progressSliderValue=String(l),r.controlsProgressRangeInput&&(r.controlsProgressRangeInput.value=String(l)),n.currentTime=l}}}static seekTime(r,i){if(r.isContainerFocused=!0,r.player.playerState.isCasting||!r.player.playerState.loaded)return;let n=r.videoElement;if(n){if(!n.duration||n.duration===1/0)return;n.currentTime=i}}static togglePip(r){if(r.isContainerFocused=!0,r.player.playerState.isCasting||!r.player.playerState.loaded)return;let i=r.videoElement;document.pictureInPictureEnabled&&(this.isFullScreen()&&this.toggleFullScreen(r),i&&i!==document.pictureInPictureElement?i.requestPictureInPicture().catch(()=>console.log()):document.exitPictureInPicture().catch(()=>console.log()))}static toggleFullScreen(r){if(r.isContainerFocused=!0,r.player.playerState.isCasting||!r.player.playerState.loaded)return;let i=r.videoElement,n=r.mainWrapper;i===document.pictureInPictureElement&&this.togglePip(r),document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.requestFullscreen?n.requestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}static fullScreenEvent(r){r.player.playerState.isCasting||(this.isFullScreen()?r.controlsFullScreen.innerHTML=this.Icons({type:"fullscreen_exit"}):r.controlsFullScreen.innerHTML=this.Icons({type:"fullscreen_enter"}))}static onEndedReplay(r){if(r.isContainerFocused=!0,r.player.playerState.isCasting){r.player.castSender.onRestartPlay();return}r.player.playerState.loaded&&(r.videoElement.currentTime=0,r.player.playerState.isPlaying||(this.toggleWrappers({ui:r,none:!0}),this.togglePlayPause(r).catch(()=>console.log())))}static isFullScreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.msExitFullscreen)}static formatTime(r){if(Number.isNaN(r)||!Number.isFinite(r))return"00:00";let i=r?new Date(r*1e3).toISOString().substring(11,19).split(":"):[];if(i.length===3){if(parseInt(i[0])===0)return`${i[1]}:${i[2]}`;if(parseInt(i[0])>0)return`${i[0]}:${i[1]}:${i[2]}`}return"00:00"}static getBrowser(){let r=navigator.userAgent;return/edg/i.test(r)?"edge":/chrome|crios/i.test(r)&&!/opr|opera|chromium|edg|ucbrowser|googlebot/i.test(r)||/chromium/i.test(r)?"chrome":/firefox|fxios/i.test(r)&&!/seamonkey/i.test(r)?"firefox":/; msie|trident/i.test(r)&&!/ucbrowser/i.test(r)?"ie":/safari/i.test(r)&&!/chromium|edg|ucbrowser|chrome|crios|opr|opera|fxios|firefox/i.test(r)?"safari":/opr|opera/i.test(r)?"opera":"unkown"}static delay(r=0){return new Promise(i=>setTimeout(()=>i(!0),r))}static hasHeader(r){return!!r&&typeof r=="object"&&Object.keys(r).length===1&&typeof Object.keys(r)[0]=="string"&&typeof Object.values(r)[0]=="string"}static toggleShowHide(r,i){if(i==="none"){r.classList.remove("flex"),r.classList.remove("block"),r.classList.add("none");return}if(i==="block"){r.classList.remove("none"),r.classList.remove("flex"),r.classList.add("block");return}i==="flex"&&(r.classList.remove("none"),r.classList.remove("block"),r.classList.add("flex"))}static toggleOpacity(r,i){r&&(i?(r.classList.remove("opacity-0"),r.classList.add("opacity-1")):(r.classList.remove("opacity-1"),r.classList.add("opacity-0")))}static toggleWrappers({ui:r,none:i,loading:n,error:s,ended:o,na:l}){let u=()=>{this.toggleShowHide(r.loaderWrapper,"none"),this.toggleShowHide(r.errorWrapper,"none"),this.toggleShowHide(r.endedWrapper,"none"),this.toggleShowHide(r.contentNotAvailableWrapper,"none"),r.player.setPlayerState({uiState:"none"})};if(i){u();return}if(n){u(),this.toggleShowHide(r.loaderWrapper,"flex"),r.player.setPlayerState({uiState:"loading"});return}if(s){u(),this.toggleShowHide(r.errorWrapper,"flex"),r.player.setPlayerState({uiState:"error"});return}if(o){u(),this.toggleShowHide(r.endedWrapper,"flex"),r.player.setPlayerState({uiState:"ended"});return}l&&(u(),this.toggleShowHide(r.contentNotAvailableWrapper,"flex"))}static fatelErrorRetry(r){let i=r.player.getConfig().maxRetryCount;if(console.log("RETRY #",this.retryCount,this.fairPlayErrorCount),this.retryCount===i){this.toggleWrappers({ui:r,error:!0});return}this.toggleWrappers({ui:r,loading:!0}),this.retryCount+=1,r.player.retry()}static resetRetryCounter(){this.retryCount=0,this.fairPlayErrorCount=0}static async getMimeType(r){if(r)try{if(/.*(\.mp4).*$/.test(r))return"video/mp4";if(/.*(\.webm).*$/.test(r))return"video/webm";if(/.*(\.ogg).*$/.test(r))return"audio/ogg";if(/.*(\.ogv).*$/.test(r))return"audio/ogg";if(/.*(\.m3u8).*$/.test(r))return"application/x-mpegurl";if(/.*(\.mpd).*$/.test(r))return"application/dash+xml";let n=(await fetch(r,{method:"HEAD"})).headers.get("content-type");if(n){if(n.includes("application/x-mpegurl"))return"application/x-mpegurl";if(n.includes("application/vnd.apple.mpegurl"))return"application/vnd.apple.mpegurl";if(n.includes("application/dash+xml"))return"application/dash+xml"}return"none"}catch{return"none"}return"none"}static urlCheck(r){return r.url?!0:(console.error(`Incorrect Source: ${JSON.stringify(r,null,2)}`),!1)}static checkTextTracks(r){if(r.player.getPlayerState().loaded){this.checkTextTracksTimer&&clearTimeout(this.checkTextTracksTimer);let i=r.getVideoElement().textTracks,n=Object.keys(i||{}).reduce((s,o)=>(i[o].mode="hidden",i[o].kind!=="metadata"&&Object.keys(i[o].cues||{}).length?[...s,{id:o,label:i[o].label,lang:i[o].language,track:i[o]}]:[...s]),[]);if(!n.length)this.checkTextTracksTimer=setTimeout(()=>this.checkTextTracks(r),500);else{r.player.setPlayerState({textTracks:n}),r.controlsCloseCaptionButton.classList.remove("none");let s=sessionStorage.getItem("closeCaptionID");s&&this.setSelectedTextTrack(r,s),this.setCloseCaptionButtonUI(r)}}}static setCloseCaptionButtonUI(r){r.player.playerState.selectedTextTrackId?r.controlsCloseCaptionButton.innerHTML=this.Icons({type:"cc_enabled"}):r.controlsCloseCaptionButton.innerHTML=this.Icons({type:"cc_disabled"})}static isLive(r){return!!(r.videoElement.duration===1/0||r.player.shaka.isLive())}static onVolumeSliderChange(r,i){let{value:n}=i.target;r.volumeSliderValue=n;let s=Number(n),o=r.videoElement;o.volume=s,s>0?o.muted&&(o.muted=!1):o.muted=!0}static onVideoProgressChange(r,i){let{value:n}=i.target;r.progressSliderValue=n,r.videoElement.currentTime=Number(n)}static sliderColorValue(r){if(!r)return;let i=(Number(r.value)-Number(r.min))/(Number(r.max)-Number(r.min))*100;r.style.background=`linear-gradient(to right, #1C6FEE 0%, #1C6FEE ${i}%, rgba(240, 240, 240, 0.4) ${i}%, rgba(240, 240, 240, 0.4) 100%)`}static enterPIP(r,i){r.controlsPIP.innerHTML=this.Icons({type:"pip_exit"}),typeof i=="function"&&i()}static leavePIP(r,i){r.controlsPIP.innerHTML=this.Icons({type:"pip_enter"}),typeof i=="function"&&i()}static setSelectedTextTrack(r,i){r.optionsMenuState="none",this.toggleShowHide(r.optionsMenuWrapper,"none"),i!==r.player.playerState.selectedTextTrackId&&(r.player.setPlayerState({selectedTextTrackId:i}),this.setCloseCaptionButtonUI(r),this.toggleTextTracks(r,i))}static toggleTextTracks(r,i){let n=r.player.playerState.textTracks;this.resetCloseCaptionContainer(r);let s=this.activeCuesEvent(r);n?.length&&(n.forEach(o=>{o.track.removeEventListener("cuechange",s,!0)}),i?(Object.keys(r.videoElement.textTracks||{}).forEach(o=>{r.videoElement&&(r.videoElement.textTracks[o].mode="disabled")}),Object.keys(r.videoElement.textTracks||{}).forEach(o=>{r.videoElement&&(r.videoElement.textTracks[o].mode="hidden")}),n[i].track.addEventListener("cuechange",s,!0)):Object.keys(r.videoElement.textTracks||{}).forEach(o=>{r.videoElement&&(r.videoElement.textTracks[o].mode="disabled")}))}static setCloseCaptionStyles(r,i={},n=!1){let s=localStorage.getItem("closeCaptionStyles"),o={};s&&(o=JSON.parse(s));let l={textSize:Cr.Default,textColor:hr.Default,bgColor:hr.Default,bgOpacity:Yr.Default,...o,...i};localStorage.setItem("closeCaptionStyles",JSON.stringify({...l}));let u=r.closeCaptionsContainer.getElementsByClassName("close-caption");if(u?.length){if(l.textColor===hr.Default)for(let m=0,E=u.length;m<E;m++)u[m].style.color=`rgb(${hr.White})`;else for(let m=0,E=u.length;m<E;m++)u[m].style.color=`rgb(${l.textColor})`;for(let m=0,E=u.length;m<E;m++)u[m].style.backgroundColor=`rgba(${l.bgColor==="default"?hr.Black:l.bgColor},${l.bgOpacity==="default"?Yr["100%"]:l.bgOpacity})`;if(l.textSize===Cr.Default)for(let m=0,E=u.length;m<E;m++)u[m].style.fontSize=n?`${Cr["100%"]+1}rem`:`${Cr["100%"]}rem`;else for(let m=0,E=u.length;m<E;m++)u[m].style.fontSize=n?`${Number(l.textSize)+1}rem`:`${Number(l.textSize)}rem`}}static getCloseCaptionStyles(){let r=localStorage.getItem("closeCaptionStyles"),i={};r&&(i=JSON.parse(r));let n=Object.keys(Cr).find(u=>Cr[u]===i.textSize),s=Object.keys(hr).find(u=>hr[u]===i.textColor),o=Object.keys(hr).find(u=>hr[u]===i.bgColor),l=Object.keys(Yr).find(u=>Yr[u]===i.bgOpacity);return{textColor:s,textSize:n,bgColor:o,bgOpacity:l}}static isCastSenderFrameworkAvailable(){return window?.cast&&window?.chrome?.cast&&window?.cast?.framework}static Icons({type:r,iconSize:i="24px",fill:n="#fff"}){switch(r){case"play":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>`;case"pause":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>`;case"volume_up":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>`;case"volume_down":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"/></svg>`;case"volume_off":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M4.34 2.93L2.93 4.34 7.29 8.7 7 9H3v6h4l5 5v-6.59l4.18 4.18c-.65.49-1.38.88-2.18 1.11v2.06c1.34-.3 2.57-.92 3.61-1.75l2.05 2.05 1.41-1.41L4.34 2.93zM19 12c0 .82-.15 1.61-.41 2.34l1.53 1.53c.56-1.17.88-2.48.88-3.87 0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zm-7-8l-1.88 1.88L12 7.76zm4.5 8c0-1.77-1.02-3.29-2.5-4.03v1.79l2.48 2.48c.01-.08.02-.16.02-.24z"/></svg>`;case"cast_enter":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0zm0 0h24v24H0V0z" fill="none"/><path d="M23 3H1v5h2V5h18v14h-7v2h9V3zM1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11z"/></svg>`;case"cast_exit":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0zm0 0h24v24H0V0z" fill="none"/><path d="M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm18-7H5v1.63c3.96 1.28 7.09 4.41 8.37 8.37H19V7zM1 10v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm22-7H1v5h2V5h18v14h-7v2h9V3z"/></svg>`;case"airplay_exit":case"airplay_enter":return`<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><g><rect fill="none" height="24" width="24"/><rect fill="none" height="24" width="24"/><rect fill="none" height="24" width="24"/></g><g><path d="M6,22h12l-6-6L6,22z M23,3H1v16h6v-2H3V5h18v12h-4v2h6V3z"/></g></svg>`;case"fullscreen_enter":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>`;case"fullscreen_exit":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>`;case"pip_enter":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 11h-8v6h8v-6zm4 10V3H1v18h22zm-2-1.98H3V4.97h18v14.05z"/></svg>`;case"pip_exit":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M23 3H1v18h22V3zm-2 16h-9v-6h9v6z"/></svg>`;case"settings":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19.44 12.99l-.01.02c.04-.33.08-.67.08-1.01 0-.34-.03-.66-.07-.99l.01.02 2.44-1.92-2.43-4.22-2.87 1.16.01.01c-.52-.4-1.09-.74-1.71-1h.01L14.44 2H9.57l-.44 3.07h.01c-.62.26-1.19.6-1.71 1l.01-.01-2.88-1.17-2.44 4.22 2.44 1.92.01-.02c-.04.33-.07.65-.07.99 0 .34.03.68.08 1.01l-.01-.02-2.1 1.65-.33.26 2.43 4.2 2.88-1.15-.02-.04c.53.41 1.1.75 1.73 1.01h-.03L9.58 22h4.85s.03-.18.06-.42l.38-2.65h-.01c.62-.26 1.2-.6 1.73-1.01l-.02.04 2.88 1.15 2.43-4.2s-.14-.12-.33-.26l-2.11-1.66zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>`;case"cc_enabled":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none"/><path d="M21 4H3v16h18V4zm-10 7H9.5v-.5h-2v3h2V13H11v2H6V9h5v2zm7 0h-1.5v-.5h-2v3h2V13H18v2h-5V9h5v2z"/></svg>`;case"cc_disabled":return`<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><rect fill="none" height="24" width="24"/><path d="M6.83,4H21v14.17L17.83,15H18v-2h-1.5v0.5h-0.17l-1.83-1.83V10.5h2V11H18V9h-5v1.17L6.83,4z M19.78,22.61L17.17,20H3V5.83 L1.39,4.22l1.41-1.41l18.38,18.38L19.78,22.61z M11,13.83L10.17,13H9.5v0.5h-2v-3h0.17L6.17,9H6v6h5V13.83z"/></svg>`;case"arrow_back":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0V0z" fill="none" opacity=".87"/><path d="M17.51 3.87L15.73 2.1 5.84 12l9.9 9.9 1.77-1.77L9.38 12l8.13-8.13z"/></svg>`;case"replay":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0z" fill="none"/><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>`;case"rewind":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0z" fill="none"/><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/></svg>`;case"forward":return`<svg xmlns="http://www.w3.org/2000/svg" height=${i} viewBox="0 0 24 24" width=${i} fill=${n}><path d="M0 0h24v24H0z" fill="none"/><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/></svg>`;default:return""}}},Ie=vr;yr(Ie,"retryCount",0),yr(Ie,"fairPlayErrorCount",0),yr(Ie,"checkTextTracksTimer",null),yr(Ie,"activeCuesEvent",r=>i=>{let n=[],s=i?.target?.activeCues;Object.keys(s||{})?.length&&(n=Object.keys(s).reduce((l,u)=>[...l,s[u].text],[])),vr.resetCloseCaptionContainer(r);let o=r.closeCaptionsContainer;o&&n?.length&&(n.forEach(l=>{let u=document.createElement("div");u.className="close-caption",u.id="close-caption",u.innerHTML=l,o.appendChild(u)}),vr.setCloseCaptionStyles(r,{},vr.isFullScreen()),o.style.display="flex")}),yr(Ie,"resetCloseCaptionContainer",r=>{let i=r.closeCaptionsContainer;if(i)for(i.style.display="none";i.firstChild;)i.removeChild(i.firstChild)}),yr(Ie,"addEventCallback",(r,i)=>{if(r.player.eventCallbacks?.length){let n=r.player.eventCallbacks.findIndex(s=>s.event===i);if(n!==-1){let s=r.player.eventCallbacks[n];typeof s.callback=="function"&&s.callback()}}}),yr(Ie,"keyDownEvents",(r,i)=>{if(r.isContainerFocused){if(i.preventDefault(),i?.code==="Space"&&vr.togglePlayPause(r),i?.code==="ArrowUp"){if(r.player.playerState.isCasting){r.player.castSender.onMuteUnMute();return}let n=Number(Number(r.volumeSliderValue).toFixed(1));n<1&&vr.onVolumeSliderChange(r,{target:{value:n+.1}})}if(i?.code==="ArrowDown"){if(r.player.playerState.isCasting){r.player.castSender.onMuteUnMute();return}let n=Number(Number(r.volumeSliderValue).toFixed(1));n>0&&vr.onVolumeSliderChange(r,{target:{value:n-.1}})}if(i?.code==="ArrowLeft"){if(vr.isLive(r))return;vr.toggleForwardRewind(r,!1)}if(i?.code==="ArrowRight"){if(vr.isLive(r))return;vr.toggleForwardRewind(r,!0)}}});var Li=class{ui;constructor(r){this.ui=r}webkitPlaybackTargetAvailabilityChangedEvent=(r,i)=>n=>{switch(n?.availability){case"available":r.innerHTML=Ie.Icons({type:"airplay_enter"}),r.classList.remove("none"),r.onclick=()=>{i.webkitShowPlaybackTargetPicker()};break;case"not-available":default:r.innerHTML="",r.classList.add("none");break}};webkitCurrentPlaybackTargetIsWirelessChangedEvent=(r,i,n)=>s=>{let o=s?.target?.remote?.state;o==="connected"?(r.innerHTML=Ie.Icons({type:"airplay_exit"}),Ie.toggleShowHide(n,"none"),this.ui.player.setPlayerState({isAirplay:!0}),this.ui.player.playerState.isPlaying&&i&&this.ui.player.reloadPlayer().catch(()=>console.log())):o==="disconnected"&&(r.innerHTML=Ie.Icons({type:"airplay_enter"}),Ie.toggleShowHide(n,"flex"),this.ui.player.setPlayerState({isAirplay:!1}),this.ui.player.playerState.isPlaying&&i&&this.ui.player.reloadPlayer().catch(()=>console.log()))};init=()=>{if(Ie.getBrowser()==="safari"&&window.WebKitPlaybackTargetAvailabilityEvent){let r=this.ui.videoElement,i=this.ui.controlsRemotePlaybackButton,n=this.ui.controlsVolumeWrapper,s=Ie.isLive(this.ui),o=this.webkitPlaybackTargetAvailabilityChangedEvent(i,r),l=this.webkitCurrentPlaybackTargetIsWirelessChangedEvent(i,s,n);r.addEventListener("webkitplaybacktargetavailabilitychanged",o),r.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",l)}}};var mn="urn:x-cast:com.multiplayer.app",Oi=class{ui;androidReceiverCompatible=!1;castReceiverId=null;hasReceivers=!1;session=null;receiverName="";apiReady=!1;isCasting=!1;seekTime=-1;playerCastingButton;isTextTrackVisible=!1;loaded=!1;stoppedForced=!1;type=null;constructor(r){this.ui=r}load=()=>{window.__onGCastApiAvailable=r=>{r&&window?.cast&&window?.chrome?.cast&&window?.cast?.framework&&(this.loaded=!0)},window.addEventListener("unload",()=>{this.isCasting&&this.stopCasting()})};init=()=>{if(!(Ie.getBrowser()!=="chrome"&&Ie.getBrowser()!=="edge")&&(this.playerCastingButton=this.ui.controlsRemotePlaybackButton,this.castReceiverId=this.ui.player.config.castReceiverId,!!this.loaded&&this.castReceiverId&&(this.apiReady=!0,window?.chrome?.cast?.SessionRequest))){let r=new window.chrome.cast.SessionRequest(this.castReceiverId,[],null,this.androidReceiverCompatible,null),i=new window.chrome.cast.ApiConfig(r,n=>this.onSessionInitiated(n),n=>this.onReceiverStatusChange(n),"origin_scoped");window.chrome.cast.initialize(i,()=>this.onInitSuccess(),n=>this.onInitError(n))}};onInitSuccess=()=>{console.log()};onInitError=r=>{console.log("onInitError: ",r),this.hasReceivers=!1,this.isCasting=!1};onSessionInitiated=r=>{this.session=r,this.session.addUpdateListener(this.onConnectionStatusChanged.bind(this)),this.session.addMessageListener(mn,(i,n)=>this.onMessageReceived(i,n)),this.onConnectionStatusChanged()};removeListeners=()=>{this.session&&(this.session.removeUpdateListener(this.onConnectionStatusChanged.bind(this)),this.session.removeMessageListener(mn,(r,i)=>this.onMessageReceived(r,i)))};onReceiverStatusChange=r=>{this.hasReceivers=r==="available",this.ui.player.isInitialized&&(this.hasReceivers?(this.playerCastingButton.innerHTML=Ie.Icons({type:"cast_enter"}),this.playerCastingButton.classList.remove("none"),this.playerCastingButton.onclick=this.cast.bind(this)):(this.playerCastingButton.innerHTML="",this.playerCastingButton.classList.add("none")))};onConnectionStatusChanged=()=>{let r=this.session&&this.session.status==="connected";if(this.isCasting,this.isCasting,this.seekTime=this.ui.player.isInitialized?this.ui.getVideoElement().currentTime:-1,this.isCasting=r,this.receiverName=r?this.session.receiver.friendlyName:"",this.isCasting)this.playerCastingButton.innerHTML=Ie.Icons({type:"cast_exit"}),this.ui.mainWrapper.classList.add("none"),this.ui.player.removePlayer(),setTimeout(()=>{this.ui.player.setPlayerState({isCasting:!0}),this.ui.addCastingUIElements(),this.CastingUIBinds(),this.stoppedForced=!1},300);else{if(this.ui.player.setPlayerState({isCasting:!1}),this.ui.removeCastingUIElements(),this.stoppedForced)return;this.ui.player.init({elem:this.ui.container,source:this.ui.player.source,config:this.ui.player.config,contextLogoUrl:this.ui.contextLogoUrl,eventCallbacks:this.ui.player.eventCallbacks,onPauseCallback:this.ui.player.onPauseCallback,onPlayCallback:this.ui.player.onPlayCallback,onLeavePIPCallback:this.ui.player.onLeavePIPCallback,onEnterPIPCallback:this.ui.player.onEnterPIPCallback,onPlayerStateChange:this.ui.player.onPlayerStateChange}).catch(()=>{})}};CastingUIBinds=()=>{this.ui.castingTitle.innerHTML=`Casting to <b>${this.receiverName}</b>`,this.ui.castingRemotePlaybackButton.onclick=this.cast.bind(this),this.ui.castingPlayPauseButton.onclick=this.onPlayPause.bind(this),this.ui.castingVolumeButtoon.onclick=this.onMuteUnMute.bind(this),this.ui.castingForwardButton.onclick=this.onForward.bind(this),this.ui.castingRewindButton.onclick=this.onRewind.bind(this),this.ui.castingRestartPlayButton.onclick=this.onRestartPlay.bind(this),this.ui.castingCloseCaptionButton.onclick=this.onTextTracksChange.bind(this)};onConnectionError=r=>{r?.code==="timeout"&&this.stopCasting()};stopCasting=()=>{try{this.session.stop(()=>{this.stoppedForced=!0},()=>{this.stoppedForced=!0})}catch{console.log()}};cast=()=>{if(!this.apiReady){console.log("error: ","api is not ready.");return}if(!this.hasReceivers){console.log("error: ","no receivers.");return}window.chrome.cast.requestSession(r=>this.onSessionInitiated(r),r=>this.onConnectionError(r))};onMessageReceived=(r,i)=>{try{let n=JSON.parse(i),{type:s,data:o}=n;switch(s){case"info":{let{currentTime:l}=o;sessionStorage.setItem("videoCurrentTime",String(Math.floor(l)));break}case"player_loaded":{let{texts:l,variants:u}=o;this.ui.player.setPlayerState({textTracks:l||[]}),this.ui.player.setPlayerState({videoTracks:u||[]}),Array.isArray(l)&&l.length&&this.ui.castingCloseCaptionButton.classList.remove("none");break}case"player":{let{event:l,value:u}=o;switch(l){case"playing":this.ui.player.setPlayerState({isPlaying:u}),this.ui.castingPlayPauseButton.innerHTML=u?Ie.Icons({type:"pause"}):Ie.Icons({type:"play"});break;case"mute":this.ui.player.setPlayerState({isMuted:u}),this.ui.castingVolumeButtoon.innerHTML=u?Ie.Icons({type:"volume_off"}):Ie.Icons({type:"volume_up"});break;case"text-tracks":this.isTextTrackVisible=u,this.ui.castingCloseCaptionButton.innerHTML=u?Ie.Icons({type:"cc_enabled"}):Ie.Icons({type:"cc_disabled"});break;case"abort":case"emptied":case"ended":this.ui.castingPlayPauseButton.classList.add("none"),this.ui.castingVolumeButtoon.classList.add("none"),this.ui.castingForwardButton.classList.add("none"),this.ui.castingRestartPlayButton.classList.add("none"),this.ui.castingRewindButton.classList.add("none"),this.ui.castingCloseCaptionButton.classList.add("none");break;case"canplaythrough":case"loadeddata":Ie.addEventCallback(this.ui,"loadedmetadata"),this.ui.castingPlayPauseButton.classList.remove("none"),this.ui.castingVolumeButtoon.classList.remove("none"),this.type!=="channel"&&(this.ui.castingForwardButton.classList.remove("none"),this.ui.castingRestartPlayButton.classList.remove("none"),this.ui.castingRewindButton.classList.remove("none"));break;default:break}break}default:break}}catch(n){console.log("onMessageReceived: ","error in parse",n)}};sendMessage=r=>{let i=JSON.stringify(r);if(this.isCasting&&this.session)try{this.session.sendMessage(mn,i,()=>{},n=>console.log("sendMessage error: ",n))}catch(n){console.log("try sendMessage error",n)}};onPlayPause=()=>{this.sendMessage({type:"player",data:{event:"playing",value:!this.ui.player.playerState.isPlaying}}),this.ui.player.playerState.isPlaying?this.ui.player?.onPauseCallback?.():this.ui.player?.onPlayCallback?.()};onMuteUnMute=()=>{this.sendMessage({type:"player",data:{event:"mute",value:!this.ui.player.playerState.isMuted}})};onForward=()=>{this.sendMessage({type:"player",data:{event:"forward",value:10}})};onRewind=()=>{this.sendMessage({type:"player",data:{event:"rewind",value:10}})};onRestartPlay=()=>{this.sendMessage({type:"player",data:{event:"restart",value:!0}})};onTextTracksChange=()=>{this.sendMessage({type:"player",data:{event:"text-tracks",value:!this.isTextTrackVisible}})};sendSourceInfo=({type:r,stream:i,vidgoToken:n,seekTime:s})=>{this.sendMessage({type:"stream",data:{type:r,stream:i,seekTime:s,vidgoToken:n}}),this.type=r};sendMediaInfo=({vidTitle:r,description:i,logoUrl:n})=>{this.sendMessage({type:"media_info",data:{vidTitle:r,description:i,logoUrl:n}})};sendRefreshToken=r=>{this.sendMessage({type:"vidgo",data:{token:r}})}};var Pa=wi(An(),1);var Ui=class{ui;player=null;isHlsStopped=!1;constructor(r){this.ui=r}init=async(r,i,n)=>Pa.default.isSupported()?(Ie.urlCheck(i),this.player||(this.player=new Pa.default({...Pa.default.DefaultConfig,debug:n,startPosition:i.startTime??-1,liveDurationInfinity:!0,enableWorker:!0,maxBufferLength:30,maxBufferSize:3e7})),this.player.attachMedia(r),this.player.on(Pa.default.Events.MEDIA_ATTACHED,()=>{this.player.loadSource(i.url??"")}),this.addEvents(),Promise.resolve()):(console.error("HLS not supported."),Promise.reject());destroy=async()=>(this.player&&(this.player.stopLoad(),this.player.detachMedia(),this.player.destroy(),this.player=null),Promise.resolve());startLoad=r=>{this.player&&this.isHlsStopped&&(this.player.startLoad(r),this.isHlsStopped=!1)};stopLoad=()=>{this.player&&(this.player.stopLoad(),this.isHlsStopped=!0)};addEvents=()=>{this.player&&this.player.on(Pa.default.Events.ERROR,this.errorEvent.bind(this))};removeEvents=()=>{this.player&&this.player.removeAllListeners()};errorEvent=(r,i)=>{console.log("hls-error",r,i),i?.details==="bufferStalledError"&&Ie.toggleWrappers({ui:this.ui,loading:!0}),i?.fatal&&Ie.fatelErrorRetry(this.ui)}};var Ni=class{ui;constructor(r){this.ui=r}init=async(r,i)=>(Ie.urlCheck(i),r.src=i.url||"",Promise.resolve());destroy=async()=>{this.ui.videoElement.src="",this.ui.videoElement.load()}};var or=wi(bn(),1);var Fi=class{ui;player=null;isSupported=!1;contentId=null;url=void 0;constructor(r){this.ui=r,this.player=new or.default.Player,this.isSupported=or.default.Player.isBrowserSupported(),this.isSupported&&or.default.polyfill.installAll()}isLive=()=>this.player?.isLive();init=async(r,i,n,s,o)=>{try{if(!this.isSupported){console.log("Shaka not supported");return}Ie.urlCheck(i),await this.player?.attach(r),this.ui.player.setPlayerState({player:"shaka"}),this.url=i.url;let l=Ie.getBrowser()==="safari";or.default.log.setLevel(n?or.default.log.Level.DEBUG:or.default.log.Level.NONE),this.player?.resetConfiguration(),this.player?.getNetworkingEngine()?.clearAllResponseFilters(),this.player?.getNetworkingEngine()?.clearAllRequestFilters(),this.addEvents();let u={},m=Ie.hasHeader(i.drm?.licenseHeader);l&&i.drm?.drmType==="fairplay"?o?(u=this.basicDrmConfigs(i),this.vidgoResponseFilter()):m||i?.drm?.requireBase64Encoding?(u=this.basicDrmConfigs(i,!1),this.buydrmFairplayRequestFilter(i),this.buyDrmFairplayResponseFilter()):u=this.basicDrmConfigs(i):i.drm?.drmType==="widevine"&&(u=this.basicDrmConfigs(i),m&&this.buydrmWidevineRequestFilter(i)),this.player?.configure({streaming:{alwaysStreamText:!0,autoLowLatencyMode:!0,jumpLargeGaps:!0,lowLatencyMode:!1,updateIntervalSeconds:.1,preferNativeHls:!0,useNativeHlsOnSafari:!0,stallEnabled:!0,stallSkip:0},...u}),this.player?.load(this.url??"",null,s).then(()=>{r.play().catch(()=>console.log()),r.currentTime=i.startTime??-1}).catch(()=>{})}catch(l){return console.log("shaka-init-error",l),this.ui.player.setPlayerState({player:"none"}),Promise.reject()}};buydrmWidevineRequestFilter=r=>{let i=this.buydrmWidevineRequestFilterImpl(r);this.player?.getNetworkingEngine()?.registerRequestFilter(i)};buydrmFairplayRequestFilter=r=>{let i=this.buydrmFairplayRequestFilterImpl(r);this.player?.getNetworkingEngine()?.registerRequestFilter(i)};buyDrmFairplayResponseFilter=()=>{let r=this.buyDrmFairplayResponseFilterImpl();this.player?.getNetworkingEngine()?.registerResponseFilter(r)};vidgoResponseFilter=()=>{let r=this.vidgoResponseFilterImpl();this.player?.getNetworkingEngine()?.registerResponseFilter(r)};buydrmWidevineRequestFilterImpl=r=>(i,n)=>{i===or.default.net.NetworkingEngine.RequestType.LICENSE&&(n.headers={...n.headers,...r.drm?.licenseHeader})};buydrmFairplayRequestFilterImpl=r=>(i,n)=>{if(i===or.default.net.NetworkingEngine.RequestType.LICENSE){let s=new Uint8Array(n.body),l=`spc=${or.default.util.Uint8ArrayUtils.toStandardBase64(s)}&assetId=${this.contentId}`;n.headers={...n.headers,"Content-Type":"application/x-www-form-urlencoded",...r.drm?.licenseHeader},n.body=or.default.util.StringUtils.toUTF8(l)}};buyDrmFairplayResponseFilterImpl=()=>(r,i)=>{if(r===or.default.net.NetworkingEngine.RequestType.LICENSE){let n=or.default.util.StringUtils.fromUTF8(i.data);n=n.trim(),n.startsWith("<ckc>")&&n.endsWith("</ckc>")&&(n=n.slice(5,-6)),i.data=or.default.util.Uint8ArrayUtils.fromBase64(n).buffer}};vidgoResponseFilterImpl=()=>(r,i)=>{if(r===or.default.net.NetworkingEngine.RequestType.LICENSE){let n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(i.data))),s=Buffer.from(n.ckc,"base64"),o=s.length,l=new Uint8Array(new ArrayBuffer(o));for(let u=0;u<o;u+=1)l[u]=s[u];i.data=l}};initDataTransformImpl=(r,i,n)=>{if(i!=="skd")return r;this.contentId=or.default.util.FairPlayUtils.defaultGetContentId(r);let s=n.serverCertificate;return or.default.util.FairPlayUtils.initDataTransform(r,this.contentId,s)};basicDrmConfigs=(r,i=!0)=>r.drm?.drmType==="widevine"?{drm:{servers:{"com.widevine.alpha":r.drm?.licenseUrl},advanced:{"com.widevine.alpha":{videoRobustness:"SW_SECURE_CRYPTO",audioRobustness:"SW_SECURE_CRYPTO"}}}}:r.drm?.drmType==="fairplay"?i?{drm:{servers:{"com.apple.fps.1_0":r.drm?.licenseUrl},advanced:{"com.apple.fps.1_0":{serverCertificateUri:r.drm?.certicateUrl}}}}:{drm:{servers:{"com.apple.fps":r.drm?.licenseUrl},advanced:{"com.apple.fps":{serverCertificateUri:r.drm?.certicateUrl}},initDataTransform:this.initDataTransformImpl}}:{};reload=async()=>{if(this.url)try{return await this.player?.load(this.url||""),Promise.resolve()}catch(r){return Ie.fatelErrorRetry(this.ui),Promise.reject(r)}};destroy=async()=>(await this.player?.detach(),Promise.resolve());addEvents=()=>{this.removeEvents(),this.player?.addEventListener("buffering",this.shakaBufferingEvent.bind(this)),this.player?.addEventListener("error",this.shakaErrorEvent.bind(this)),this.player?.addEventListener("stalldetected",this.shakaStallDetectedEvent.bind(this))};removeEvents=()=>{this.player?.removeEventListener("buffering",this.shakaBufferingEvent.bind(this)),this.player?.removeEventListener("error",this.shakaErrorEvent.bind(this)),this.player?.removeEventListener("stalldetected",this.shakaStallDetectedEvent.bind(this))};shakaBufferingEvent=r=>{this.ui.player.getPlayerState().loaded&&(r?.buffering?Ie.toggleWrappers({ui:this.ui,loading:!0}):Ie.toggleWrappers({ui:this.ui,loading:!1}))};shakaErrorEvent=r=>{console.log("shaka-error-event",r),Ie.fatelErrorRetry(this.ui)};shakaStallDetectedEvent=()=>{this.ui.player.getPlayerState().loaded&&Ie.toggleWrappers({ui:this.ui,loading:!0})}};var Bi=class{player;container;containerWrapper;mainWrapper;contextMenu;contextLogoUrl="";videoPosterUrl="";contextMenuTimer=null;wrapper;media;videoElement;closeCaptionsContainer;loaderWrapper;endedWrapper;replayButton;errorWrapper;contentNotAvailableWrapper;controlsWrapper;showControlsTimer=null;controlsPlayPauseButton;controlsVolumeWrapper;controlsVolumeButton;controlsVolumeRangeInput;controlsTimeText;controlsProgressBar;controlsProgressRangeInput;controlsPIP;controlsRemotePlaybackButton;controlsCloseCaptionButton;controlsFullScreen;controlsSettingsButton;optionsMenuWrapper;castingWrapper;castingTitle;castingIconsContainer;castingPlayPauseButton;castingCloseCaptionButton;castingVolumeButtoon;castingRemotePlaybackButton;castingRewindButton;castingForwardButton;castingRestartPlayButton;volumeSliderValue="0";progressSliderValue="0";isElementsAdded=!1;isCastingUIAdded=!1;optionsMenuState="none";containerFocusCounter=0;isContainerFocused=!1;constructor(){}setContainer=(r,i,n="",s="")=>{this.player=r,this.container=i,this.container.style.backgroundColor="#000",this.container.tabIndex=-1,this.container.onblur=()=>{this.isContainerFocused=!1,console.log("container onblur")},this.contextLogoUrl=n,this.videoPosterUrl=s,this.addContainerWrapper(),this.isElementsAdded||this.addElements(),Ie.toggleWrappers({ui:this,none:!0})};addElements=()=>{this.addMainWrapper(),this.addAspectRatio(),this.addWrapperDiv(),this.addMediaDiv(),this.addVideoElement(),this.addCloseCaptionContainer(),this.addLoaderWrapper(),this.addEndedWrapper(),this.addControlsWrapper(),this.addControlsProgressBar(),this.addOptionsMenuWrapper(),this.addContextMenu(),this.addErrorWrapper(),this.addContentNotAvailableWrapper(),this.isElementsAdded=!0};removeUI=()=>{this.isElementsAdded&&(this.mainWrapper.remove(),this.isElementsAdded=!1)};removeCastingUIElements=()=>{this.isCastingUIAdded&&(this.castingWrapper.remove(),this.isCastingUIAdded=!1,this.isElementsAdded=!1)};removeAllUI=()=>{this.isElementsAdded&&(this.containerWrapper.remove(),this.isCastingUIAdded=!1,this.isElementsAdded=!1)};create=r=>{let i=document.createElement(r.tag);return r.classListAdd&&i.classList.add(...r.classListAdd),r.className&&(i.className=r.className),r.id&&(i.id=r.id),r.innerHTML&&(i.innerHTML=r.innerHTML),r.innerText&&(i.innerText=r.innerText),r.parent.appendChild(i),i};addContainerWrapper=()=>{document.getElementById("media-player-main-wrappper")||(this.containerWrapper=this.create({tag:"div",parent:this.container,className:"wrapper",id:"media-player-main-wrappper"}))};addMainWrapper=()=>{this.mainWrapper=this.create({tag:"div",parent:this.containerWrapper,className:"media-player"}),this.contextLogoUrl&&(this.mainWrapper.oncontextmenu=this.mainWrapperContextMenu.bind(this)),this.mainWrapper.onclick=this.mainWrapperClick.bind(this),this.mainWrapper.onmouseenter=this.mainWrapperMouseEnter.bind(this),this.mainWrapper.onmousemove=this.mainWrapperMouseEnter.bind(this),this.mainWrapper.onmouseleave=this.mainWrapperMouseLeave.bind(this)};addMediaDiv=()=>{this.media=this.create({tag:"div",parent:this.wrapper,className:"media"})};addWrapperDiv=()=>{this.wrapper=this.create({tag:"div",parent:this.mainWrapper,className:"wrapper"})};addAspectRatio=()=>{this.create({tag:"div",parent:this.mainWrapper,className:"aspect reset"})};mainWrapperMouseEnter=()=>{this.showControlsTimer&&clearTimeout(this.showControlsTimer);let r=this.player.getPlayerState();r.loaded&&r.uiState!=="error"&&r.uiState!=="ended"&&Ie.toggleOpacity(this.controlsWrapper,!0)};mainWrapperMouseLeave=()=>{this.showControlsTimer&&clearTimeout(this.showControlsTimer),!this.optionsMenuWrapper.classList.contains("flex")&&(this.showControlsTimer=setTimeout(()=>{Ie.toggleOpacity(this.controlsWrapper,!1)},1e3))};mainWrapperContextMenu=r=>{r.preventDefault();let{clientX:i,clientY:n}=r,{x:s,y:o,width:l,height:u}=this.mainWrapper.getBoundingClientRect();this.contextMenu.style.display="block";let{clientWidth:m,clientHeight:E}=this.contextMenu,y=s+l-m-5,D=o+u-E-5,w=n>D?D:n,B=i>y?y:i;this.contextMenu.style.top=`${w}px`,this.contextMenu.style.left=`${B}px`,this.hideContextMenu(!0)};hideContextMenu=r=>{this.contextMenuTimer&&clearTimeout(this.contextMenuTimer),r?this.contextMenuTimer=setTimeout(()=>this.contextMenu.style.display="none",5*1e3):this.contextMenu.style.display="none"};mainWrapperClick=r=>{r.preventDefault(),this.hideContextMenu(!1)};addCloseCaptionContainer=()=>{this.closeCaptionsContainer=this.create({tag:"div",parent:this.wrapper,className:"close-captions-container"})};addLoaderWrapper=()=>{this.loaderWrapper=this.create({tag:"div",parent:this.wrapper,className:"loader-wrapper",innerHTML:'<div class="loader"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>'})};addEndedWrapper=()=>{this.endedWrapper=this.create({tag:"div",parent:this.wrapper,className:"ended-wrapper"}),this.replayButton=this.create({tag:"div",parent:this.endedWrapper,className:"icons",innerHTML:Ie.Icons({type:"replay"})}),this.endedWrapper.onclick=()=>Ie.onEndedReplay(this)};addControlsWrapper=()=>{this.controlsWrapper=this.create({tag:"div",parent:this.wrapper,classListAdd:["controls-wrapper","none"]});let r=this.create({tag:"div",parent:this.controlsWrapper,className:"controls"}),i=this.create({tag:"div",parent:r,className:"controls-first"}),n=this.create({tag:"div",parent:r,className:"controls-second"});this.addControlsPlayPauseButton(i),this.addVolumeControls(i),this.addControlsTimeText(i),this.addControlsRemovePlayback(n),this.addControlsPIP(n),this.addControlsCloseCaptionButton(n),this.addControlsFullScreen(n),this.addControlsSettingsButton(n)};addControlsPlayPauseButton=r=>{this.controlsPlayPauseButton=this.create({tag:"div",parent:r,className:"icons",innerHTML:Ie.Icons({type:"pause"})}),this.controlsPlayPauseButton.onclick=async()=>{await Ie.togglePlayPause(this)}};addVolumeControls=r=>{this.controlsVolumeWrapper=this.create({tag:"div",parent:r,classListAdd:["vertical-slider","flex"]}),this.controlsVolumeButton=this.create({tag:"div",parent:this.controlsVolumeWrapper,className:"icons",innerHTML:Ie.Icons({type:"volume_off"})}),this.controlsVolumeButton.onclick=()=>{Ie.toggleMuteUnMute(this)};let i=this.create({tag:"div",parent:this.controlsVolumeWrapper,className:"volume-range"});this.controlsVolumeRangeInput=this.create({tag:"input",parent:i}),this.controlsVolumeRangeInput.type="range",this.controlsVolumeRangeInput.min="0",this.controlsVolumeRangeInput.max="1",this.controlsVolumeRangeInput.step="any",this.controlsVolumeRangeInput.value=this.volumeSliderValue,this.controlsVolumeRangeInput.onclick=()=>{this.container.focus(),this.isContainerFocused=!0},this.controlsVolumeRangeInput.oninput=n=>Ie.onVolumeSliderChange(this,n)};addControlsTimeText=r=>{this.controlsTimeText=this.create({tag:"div",parent:r,className:"time-text"})};addControlsProgressBar=()=>{this.controlsProgressBar=this.create({tag:"div",parent:this.controlsWrapper,classListAdd:["video-progress","none"]}),this.controlsProgressRangeInput=this.create({tag:"input",parent:this.controlsProgressBar}),this.controlsProgressRangeInput.type="range",this.controlsProgressRangeInput.min="0",this.controlsProgressRangeInput.max="0",this.controlsProgressRangeInput.step="any",this.controlsProgressRangeInput.value=this.progressSliderValue,this.controlsProgressRangeInput.onclick=()=>{this.container.focus(),this.isContainerFocused=!0},this.controlsProgressRangeInput.oninput=r=>Ie.onVideoProgressChange(this,r)};addControlsPIP=r=>{this.controlsPIP=this.create({tag:"div",parent:r,classListAdd:["icons","none"]}),this.controlsPIP.onclick=()=>Ie.togglePip(this)};addControlsRemovePlayback=r=>{this.controlsRemotePlaybackButton=this.create({tag:"div",parent:r,classListAdd:["icons","none"]})};addControlsCloseCaptionButton=r=>{this.controlsCloseCaptionButton=this.create({tag:"div",parent:r,classListAdd:["icons","none"]}),this.controlsCloseCaptionButton.onclick=()=>{this.optionsMenuState!=="cc"?(this.optionsMenuState="cc",this.addControlsCloseCaptionMenu()):(this.optionsMenuState="none",this.addControlsCloseCaptionMenu())}};addControlsCloseCaptionMenu=()=>{if(this.optionsMenuWrapper.innerHTML="",this.optionsMenuState==="cc"){Ie.toggleShowHide(this.optionsMenuWrapper,"flex"),this.optionsMenuWrapper.style.right="70px";let r=this.player.playerState.textTracks,i=this.player.playerState.selectedTextTrackId,n=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"head"});this.create({tag:"div",parent:n,className:"head-item",innerText:"Close Caption"});let s=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"menu"}),o=this.create({tag:"div",parent:s,className:"cc-menu-item"});o.setAttribute("role","cc-off"),o.onclick=()=>{Ie.setSelectedTextTrack(this,null),sessionStorage.removeItem("closeCaptionID")},this.create({tag:"div",parent:o,className:i===null?"menu-select":""}),this.create({tag:"div",parent:o,innerText:"Off"}),r.forEach((l,u)=>{let m=this.create({tag:"div",parent:s,className:"cc-menu-item"});m.setAttribute("role",`cc-${u}`),m.onclick=()=>{Ie.setSelectedTextTrack(this,String(u)),sessionStorage.setItem("closeCaptionID",String(u))},this.create({tag:"div",parent:m,className:i===u.toString()?"menu-select":""}),this.create({tag:"div",parent:m,innerHTML:`<div>${Cn[l.lang]||"English"}</div>`})})}else Ie.toggleShowHide(this.optionsMenuWrapper,"none")};addControlsSettingsButton=r=>{this.controlsSettingsButton=this.create({tag:"div",parent:r,className:"icons",innerHTML:Ie.Icons({type:"settings"})}),this.controlsSettingsButton.onclick=()=>{this.optionsMenuState==="none"||this.optionsMenuState==="cc"?(this.optionsMenuState="settings",this.addControlsSetingsMenu()):(this.optionsMenuState="none",this.addControlsSetingsMenu())}};addControlsSetingsMenu=()=>{if(this.optionsMenuWrapper.innerHTML="",this.optionsMenuState==="none"){Ie.toggleShowHide(this.optionsMenuWrapper,"none");return}if(Ie.toggleShowHide(this.optionsMenuWrapper,"flex"),this.optionsMenuWrapper.style.right="10px",this.optionsMenuState==="settings"){let r=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"head"});this.create({tag:"div",parent:r,className:"head-item",innerText:"Settings"});let i=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"menu"}),n=this.create({tag:"div",parent:i,className:"menu-item",innerHTML:"<div>Close Caption</div><div>Options</div>"});n.setAttribute("role","cc-settings"),n.onclick=()=>{this.optionsMenuState="cc_settings",this.addControlsSetingsMenu()};return}if(this.optionsMenuState==="cc_settings"){let r=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"head"});r.style.cursor="pointer",r.setAttribute("role","back-to-settings"),r.onclick=()=>{this.optionsMenuState="settings",this.addControlsSetingsMenu()},this.create({tag:"div",parent:r,className:"head-item",innerHTML:`${Ie.Icons({type:"arrow_back",iconSize:"12px"})}<div>Close Caption Options</div>`});let i=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"menu"}),n=this.create({tag:"div",parent:i,className:"menu-item",innerHTML:`<div>Text Size</div><div>${Ie.getCloseCaptionStyles().textSize}</div>`});n.setAttribute("role","cc-settings-text-size"),n.onclick=()=>{this.optionsMenuState="textSize",this.addControlsSetingsMenu()};let s=this.create({tag:"div",parent:i,className:"menu-item",innerHTML:`<div>Text Color</div><div>${Ie.getCloseCaptionStyles().textColor}</div>`});s.setAttribute("role","cc-settings-text-color"),s.onclick=()=>{this.optionsMenuState="textColor",this.addControlsSetingsMenu()};let o=this.create({tag:"div",parent:i,className:"menu-item",innerHTML:`<div>Background Color</div><div>${Ie.getCloseCaptionStyles().bgColor}</div>`});o.setAttribute("role","cc-settings-bg-color"),o.onclick=()=>{this.optionsMenuState="bgColor",this.addControlsSetingsMenu()};let l=this.create({tag:"div",parent:i,className:"menu-item",innerHTML:`<div>Background Opacity</div><div>${Ie.getCloseCaptionStyles().bgOpacity}</div>`});l.setAttribute("role","cc-settings-bg-opacity"),l.onclick=()=>{this.optionsMenuState="bgOpacity",this.addControlsSetingsMenu()};return}if(this.optionsMenuState==="textSize"){let r=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"head"});r.style.cursor="pointer",r.setAttribute("role","back-to-cc-settings"),r.onclick=()=>{this.optionsMenuState="cc_settings",this.addControlsSetingsMenu()},this.create({tag:"div",parent:r,className:"head-item",innerHTML:`${Ie.Icons({type:"arrow_back",iconSize:"12px"})}<div>Text Size</div>`});let i=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"menu"}),n=Ie.getCloseCaptionStyles().textSize;Object.keys(Cr).forEach(s=>{let o=this.create({tag:"div",parent:i,className:"menu-item-options",innerHTML:`<div>${s}</div>`});o.setAttribute("role",`cc-settings-text-size-${s}`),o.style.backgroundColor=n===s?"#1c6fee":"",o.onclick=()=>{this.optionsMenuState="cc_settings",Ie.setCloseCaptionStyles(this,{textSize:Cr[s]},Ie.isFullScreen()),this.addControlsSetingsMenu()}});return}if(this.optionsMenuState==="textColor"){let r=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"head"});r.style.cursor="pointer",r.setAttribute("role","back-to-cc-settings"),r.onclick=()=>{this.optionsMenuState="cc_settings",this.addControlsSetingsMenu()},this.create({tag:"div",parent:r,className:"head-item",innerHTML:`${Ie.Icons({type:"arrow_back",iconSize:"12px"})}<div>Text Color</div>`});let i=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"menu"}),n=Ie.getCloseCaptionStyles().textColor;Object.keys(hr).forEach(s=>{let o=this.create({tag:"div",parent:i,className:"menu-item-options",innerHTML:`<div>${s}</div>`});o.setAttribute("role",`cc-settings-text-color-${s}`),o.style.backgroundColor=n===s?"#1c6fee":"",o.onclick=()=>{this.optionsMenuState="cc_settings",Ie.setCloseCaptionStyles(this,{textColor:hr[s]},Ie.isFullScreen()),this.addControlsSetingsMenu()}});return}if(this.optionsMenuState==="bgColor"){let r=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"head"});r.style.cursor="pointer",r.setAttribute("role","back-to-cc-settings"),r.onclick=()=>{this.optionsMenuState="cc_settings",this.addControlsSetingsMenu()},this.create({tag:"div",parent:r,className:"head-item",innerHTML:`${Ie.Icons({type:"arrow_back",iconSize:"12px"})}<div>Background Color</div>`});let i=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"menu"}),n=Ie.getCloseCaptionStyles().bgColor;Object.keys(hr).forEach(s=>{let o=this.create({tag:"div",parent:i,className:"menu-item-options",innerHTML:`<div>${s}</div>`});o.setAttribute("role",`cc-settings-bg-color-${s}`),o.style.backgroundColor=n===s?"#1c6fee":"",o.onclick=()=>{this.optionsMenuState="cc_settings",Ie.setCloseCaptionStyles(this,{bgColor:hr[s]},Ie.isFullScreen()),this.addControlsSetingsMenu()}});return}if(this.optionsMenuState==="bgOpacity"){let r=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"head"});r.style.cursor="pointer",r.setAttribute("role","back-to-cc-settings"),r.onclick=()=>{this.optionsMenuState="cc_settings",this.addControlsSetingsMenu()},this.create({tag:"div",parent:r,className:"head-item",innerHTML:`${Ie.Icons({type:"arrow_back",iconSize:"12px"})}<div>Backgroud Opacity</div>`});let i=this.create({tag:"div",parent:this.optionsMenuWrapper,className:"menu"}),n=Ie.getCloseCaptionStyles().bgOpacity;Object.keys(Yr).forEach(s=>{let o=this.create({tag:"div",parent:i,className:"menu-item-options",innerHTML:`<div>${s}</div>`});o.setAttribute("role",`cc-settings-bg-opacity-${s}`),o.style.backgroundColor=n===s?"#1c6fee":"",o.onclick=()=>{this.optionsMenuState="cc_settings",Ie.setCloseCaptionStyles(this,{bgOpacity:Yr[s]},Ie.isFullScreen()),this.addControlsSetingsMenu()}})}};addControlsFullScreen=r=>{this.controlsFullScreen=this.create({tag:"div",parent:r,className:"icons",innerHTML:Ie.Icons({type:"fullscreen_enter"})}),this.controlsFullScreen.onclick=()=>Ie.toggleFullScreen(this)};addContextMenu=()=>{this.contextMenu=this.create({tag:"div",parent:this.mainWrapper,className:"context-menu"});let r=this.create({tag:"div",parent:this.contextMenu,className:"item"}),i=this.create({tag:"img",parent:r});i.src=this.contextLogoUrl||"",i.alt="Logo",this.create({tag:"div",parent:r,className:"text"}).innerText="Player"};addVideoElement=()=>{this.videoElement=this.create({tag:"video",parent:this.media}),this.videoElement.setAttribute("preload","metadata"),this.videoElement.setAttribute("playsinline","true"),this.videoElement.setAttribute("webkit-playsinline","true"),this.videoElement.setAttribute("x-webkit-airplay","allow"),this.videoElement.setAttribute("airplay","allow"),this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.setAttribute("poster",this.videoPosterUrl||""),this.videoElement.oncontextmenu=this.videoElementContextMenu.bind(this),this.videoElement.onclick=async()=>{if(!this.isContainerFocused){this.isContainerFocused=!0;return}await Ie.togglePlayPause(this)}};removeVideoPlayer=()=>{this.videoElement.remove()};videoElementContextMenu=r=>(r.preventDefault(),!1);addOptionsMenuWrapper=()=>{this.optionsMenuWrapper=this.create({tag:"div",parent:this.wrapper,classListAdd:["options-menu","none"]})};addErrorWrapper=()=>{this.errorWrapper=this.create({tag:"div",parent:this.wrapper,className:"error-wrapper",innerHTML:'<div class="error-msg"><div style="cursor: auto"></div><div>ERROR</div></div>'})};addContentNotAvailableWrapper=()=>{this.contentNotAvailableWrapper=this.create({tag:"div",parent:this.wrapper,className:"content-not-available",innerHTML:'<div class="content-msg"><div style="cursor: auto"></div><div>Content is currently unavailable.</div></div>'})};getVideoElement=()=>this.videoElement;addCastingUIElements=()=>{document.getElementById("media-player-casting-wrapper")||(this.castingWrapper=this.create({tag:"div",id:"media-player-casting-wrapper",parent:this.containerWrapper,className:"cast-overlay-container"}),this.castingWrapper.oncontextmenu=r=>{r.preventDefault()},this.addCastingTtile(),this.addCastingIconsContainer(),this.addCastingRewindButton(),this.addCastingPlayPauseButton(),this.addCastingForwardButton(),this.addCastingRestartPlayButton(),this.addCastingCloseCaptionButton(),this.addCastingVolumeButtoon(),this.addCastingRemotePlaybackButton(),this.isCastingUIAdded=!0)};addCastingTtile=()=>{this.castingTitle=this.create({tag:"div",parent:this.castingWrapper,className:"title"})};addCastingIconsContainer=()=>{this.castingIconsContainer=this.create({tag:"div",parent:this.castingWrapper,classListAdd:["icons-container"]})};addCastingPlayPauseButton=()=>{this.castingPlayPauseButton=this.create({tag:"div",parent:this.castingIconsContainer,classListAdd:["icons","none"],innerHTML:Ie.Icons({type:"play"})})};addCastingCloseCaptionButton=()=>{this.castingCloseCaptionButton=this.create({tag:"div",parent:this.castingIconsContainer,classListAdd:["icons","none"],innerHTML:Ie.Icons({type:"cc_disabled"})})};addCastingVolumeButtoon=()=>{this.castingVolumeButtoon=this.create({tag:"div",parent:this.castingIconsContainer,classListAdd:["icons","none"],innerHTML:Ie.Icons({type:"volume_up"})})};addCastingRemotePlaybackButton=()=>{this.castingRemotePlaybackButton=this.create({tag:"div",parent:this.castingIconsContainer,className:"icons",innerHTML:Ie.Icons({type:"cast_exit"})})};addCastingRewindButton=()=>{this.castingRewindButton=this.create({tag:"div",parent:this.castingIconsContainer,classListAdd:["icons","none"],innerHTML:Ie.Icons({type:"rewind"})})};addCastingForwardButton=()=>{this.castingForwardButton=this.create({tag:"div",parent:this.castingIconsContainer,classListAdd:["icons","none"],innerHTML:Ie.Icons({type:"forward"})})};addCastingRestartPlayButton=()=>{this.castingRestartPlayButton=this.create({tag:"div",parent:this.castingIconsContainer,classListAdd:["icons","none"],innerHTML:Ie.Icons({type:"replay"})})}};var $i=class{ui;timeUpdated=!1;progressCounter=0;events=[];constructor(r){this.ui=r,this.events=[{event:"abort",callback:this.abortEvent.bind(this)},{event:"canplay",callback:this.canPlayEvent.bind(this)},{event:"canplaythrough",callback:this.canPlayThroughEvent.bind(this)},{event:"durationchange",callback:this.durationChangeEvent.bind(this)},{event:"emptied",callback:this.emptiedEvent.bind(this)},{event:"ended",callback:this.endedEvent.bind(this)},{event:"error",callback:this.errorEvent.bind(this)},{event:"loadeddata",callback:this.loadedDataEvent.bind(this)},{event:"loadedmetadata",callback:this.loadedMetaDataEvent.bind(this)},{event:"loadstart",callback:this.loadStartEvent.bind(this)},{event:"pause",callback:this.pauseEvent.bind(this)},{event:"play",callback:this.playEvent.bind(this)},{event:"playing",callback:this.playingEvent.bind(this)},{event:"progress",callback:this.progressEvent.bind(this)},{event:"ratechange",callback:this.rateChangeEvent.bind(this)},{event:"seeked",callback:this.seekedEvent.bind(this)},{event:"seeking",callback:this.seekingEvent.bind(this)},{event:"stalled",callback:this.stalledEvent.bind(this)},{event:"suspend",callback:this.suspendEvent.bind(this)},{event:"timeupdate",callback:this.timeUpdateEvent.bind(this)},{event:"volumechange",callback:this.volumeChangeEvent.bind(this)},{event:"waiting",callback:this.waitingEvent.bind(this)}]}addEvents=()=>{this.removeEvents(),this.events.forEach(r=>{this.ui.videoElement.addEventListener(r.event,r.callback)})};removeEvents=()=>{this.events.forEach(r=>{this.ui.videoElement.removeEventListener(r.event,r.callback)})};getConfig=()=>this.ui.player.getConfig();abortEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onAbort"),this.timeUpdated=!1,Ie.addEventCallback(this.ui,"abort")};canPlayEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onCanPlay"),Ie.addEventCallback(this.ui,"canplay")};canPlayThroughEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onCanPlayThrough"),Ie.addEventCallback(this.ui,"canplaythrough")};durationChangeEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onDurationChange"),Ie.addEventCallback(this.ui,"durationchange")};emptiedEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onEmptied"),this.ui.player.setPlayerState({isPlaying:!1}),this.ui.player.playerState.uiState,this.ui.player.playerState.player!=="shaka"&&Ie.toggleWrappers({ui:this.ui,loading:!0}),Ie.addEventCallback(this.ui,"emptied")};endedEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onEnded"),Ie.toggleWrappers({ui:this.ui,ended:!0}),Ie.addEventCallback(this.ui,"ended")};errorEvent=r=>{console.log("error",r),this.getConfig().debug&&console.log("VIDEO - onError"),Ie.fatelErrorRetry(this.ui),Ie.addEventCallback(this.ui,"error")};loadedDataEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onLoadedData"),this.ui.videoElement.buffered.length&&Ie.resetRetryCounter(),this.getConfig().disableControls||(Ie.toggleShowHide(this.ui.controlsWrapper,"flex"),Ie.toggleOpacity(this.ui.controlsWrapper,!1)),this.ui.player.setPlayerState({loaded:!0,isPlaying:!1}),Ie.checkTextTracks(this.ui),this.volumeChangeEvent(),Ie.addEventCallback(this.ui,"loadeddata")};loadedMetaDataEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onLoadedMetaData");let r=this.ui.videoElement;this.getConfig()?.startMuted&&(r.muted=!0),r.play().then(()=>{}).catch(()=>{r.muted=!0,r.play().catch(()=>{})}),Ie.addEventCallback(this.ui,"loadedmetadata")};loadStartEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onLoadStart"),Ie.toggleWrappers({ui:this.ui,loading:!0}),this.ui.player.setPlayerState({isPlaying:!1}),Ie.addEventCallback(this.ui,"loadstart")};pauseEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onPause"),this.ui.controlsPlayPauseButton.innerHTML=Ie.Icons({type:"play"}),this.ui.player.setPlayerState({isPlaying:!1}),this.ui.player.playerState.isPIP&&this.ui.player?.onPauseCallback?.(),Ie.addEventCallback(this.ui,"pause")};playEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onPlay"),Ie.toggleWrappers({ui:this.ui,none:!0}),this.ui.player.playerState.isPIP&&this.ui.player?.onPlayCallback?.(),Ie.addEventCallback(this.ui,"play")};playingEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onPlaying"),this.ui.controlsPlayPauseButton.innerHTML=Ie.Icons({type:"pause"}),Ie.toggleWrappers({ui:this.ui,none:!0}),this.ui.player.setPlayerState({isPlaying:!0}),Ie.resetRetryCounter(),Ie.addEventCallback(this.ui,"playing")};progressEvent=()=>{if(this.getConfig().debug&&console.log("VIDEO - onProgress","progressCounter",this.progressCounter,"timeUpdated",this.timeUpdated),Ie.addEventCallback(this.ui,"progress"),!this.ui.player.playerState.hasUserPaused){if(this.timeUpdated){this.progressCounter=0,this.timeUpdated=!1;return}this.progressCounter>5&&this.progressCounter<=10&&this.ui.videoElement.buffered?.length&&(this.ui.videoElement.currentTime=this.ui.videoElement.buffered.end(0)),this.progressCounter>10&&(this.progressCounter=0,this.ui.player.reloadPlayer().catch(()=>console.log()))}this.progressCounter+=1};rateChangeEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onRateChange"),Ie.toggleWrappers({ui:this.ui,loading:!0}),Ie.addEventCallback(this.ui,"ratechange")};seekedEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onSeeked",this.ui.player.playerState),Ie.toggleWrappers({ui:this.ui,none:!0}),this.ui.player.playerState.isPlaying||(this.ui.player.hls.stopLoad(),this.ui.player.playerState.hasUserPaused||this.ui.videoElement.play().catch(()=>console.log())),Ie.addEventCallback(this.ui,"seeked")};seekingEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onSeeking"),this.ui.player.playerState.isPlaying||(Ie.toggleWrappers({ui:this.ui,loading:!0}),this.ui.player.hls.startLoad()),Ie.addEventCallback(this.ui,"seeking")};stalledEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onStalled"),this.ui.player.playerState.isPlaying&&Ie.toggleWrappers({ui:this.ui,loading:!0}),Ie.isLive(this.ui)&&!this.timeUpdated&&!this.ui.player.playerState.hasUserPaused&&(this.ui.videoElement.buffered.length&&(this.ui.videoElement.currentTime=this.ui.videoElement.buffered.end(0)),this.ui.videoElement.play().catch(()=>{})),Ie.addEventCallback(this.ui,"stalled")};suspendEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onSuspend"),Ie.addEventCallback(this.ui,"suspend")};timeUpdateEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onTimeUpdate"),this.timeUpdated=!0,this.ui.player.playerState.isPlaying&&Ie.toggleWrappers({ui:this.ui,none:!0});let r=this.ui.videoElement,i=r.currentTime,n=r.duration,s=Ie.isLive(this.ui);this.ui.player.playerState.loaded&&(s?(this.ui.controlsTimeText.innerText="Live",Ie.toggleShowHide(this.ui.controlsProgressBar,"none")):n&&i?(sessionStorage.setItem("videoCurrentTime",String(Math.floor(i))),Ie.sliderColorValue(this.ui.controlsProgressRangeInput),Ie.toggleShowHide(this.ui.controlsProgressBar,"flex"),this.ui.controlsProgressRangeInput.value=String(i),this.ui.controlsTimeText.innerText=`${Ie.formatTime(i)} / ${Ie.formatTime(n)}`,this.ui.controlsProgressRangeInput.max=String(n)):this.ui.controlsTimeText.innerText=""),Ie.addEventCallback(this.ui,"timeupdate")};volumeChangeEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onVolumeChange");let r=this.ui.videoElement;r.muted?(this.ui.volumeSliderValue="0",this.ui.controlsVolumeRangeInput.value="0",this.ui.player.setPlayerState({isMuted:!0}),this.ui.controlsVolumeButton.innerHTML=Ie.Icons({type:"volume_off"})):(this.ui.volumeSliderValue=String(r.volume),this.ui.controlsVolumeRangeInput.value=String(r.volume),this.ui.player.setPlayerState({isMuted:!1}),r.volume>.5?this.ui.controlsVolumeButton.innerHTML=Ie.Icons({type:"volume_up"}):this.ui.controlsVolumeButton.innerHTML=Ie.Icons({type:"volume_down"})),Ie.sliderColorValue(this.ui.controlsVolumeRangeInput),Ie.addEventCallback(this.ui,"volumechange")};waitingEvent=()=>{this.getConfig().debug&&console.log("VIDEO - onWaiting"),Ie.toggleWrappers({ui:this.ui,loading:!0}),this.ui.player.playerState.hasUserPaused||this.ui.player.hls.startLoad(),Ie.addEventCallback(this.ui,"waiting")}};var Mn={debug:!1,isVidgo:!1,maxRetryCount:5,disableControls:!1,type:null,castReceiverId:null,startMuted:!1},ji={player:"none",loaded:!1,uiState:"none",textTracks:[],videoTracks:[],audioTracks:[],selectedTextTrackId:null,selectedVideoTrackId:null,selectedAudioTrackId:null,isPlaying:!1,isMuted:!1,showPIP:!1,isPIP:!1,isCasting:!1,isAirplay:!1,hasUserPaused:!1,isUnmounting:!1},oa=class{ui;videoEvents;native;hls;shaka;airplay;castSender;isInitialized=!1;stateTimer=void 0;playerState;unMountTimer=void 0;reInitTimer=void 0;source={url:void 0,drm:void 0};config;onPauseCallback=void 0;onPlayCallback=void 0;onEnterPIPCallback=void 0;onLeavePIPCallback=void 0;onPlayerStateChange=void 0;eventCallbacks=[];constructor(){window.muxjs=wn.default,this.ui=new Bi,this.castSender=new Oi(this.ui),this.castSender.load(),this.videoEvents=new $i(this.ui),this.native=new Ni(this.ui),this.hls=new Ui(this.ui),this.shaka=new Fi(this.ui),this.airplay=new Li(this.ui),this.config=Mn,this.playerState=ji}init=async({elem:r,source:i,contextLogoUrl:n,videoPosterUrl:s,config:o,eventCallbacks:l,onPauseCallback:u,onPlayCallback:m,onLeavePIPCallback:E,onEnterPIPCallback:y,onPlayerStateChange:D})=>{try{if(clearTimeout(this.reInitTimer),this.playerState.isUnmounting&&(this.reInitTimer=setTimeout(()=>{this.init({elem:r,source:i,contextLogoUrl:n,videoPosterUrl:s,config:o,eventCallbacks:l,onPauseCallback:u,onPlayCallback:m,onEnterPIPCallback:y,onLeavePIPCallback:E,onPlayerStateChange:D})},50)),!r)return;!this.isInitialized&&!this.playerState.isCasting&&(clearTimeout(this.stateTimer),this.ui.setContainer(this,r,n,s),this.videoEvents.addEvents(),this.airplay.init(),this.__windowOnLoad(),Ie.setCloseCaptionStyles(this.ui),this.isInitialized=!0),this.eventCallbacks=l,this.onPauseCallback=u,this.onPlayCallback=m,this.onEnterPIPCallback=y,this.onLeavePIPCallback=E,this.onPlayerStateChange=D,this.updateConfig(o),this.castSender.init(),await this.setSource(i,!1)}catch(w){console.log(w)}};setSource=async(r,i)=>{try{if(!r.url)return Promise.resolve();let n=(0,vn.default)(r),s=(0,vn.default)(this.source),o=-1;if(n===s?o=Number(sessionStorage.getItem("videoCurrentTime"))||-1:sessionStorage.removeItem("videoCurrentTime"),this.source={...r,startTime:r.startTime??o},this.playerState.isCasting)return Promise.resolve();let l=this.source.drm?.drmType==="fairplay"||this.source.drm?.drmType==="widevine",u=await Ie.getMimeType(this.source.url),m=u==="application/x-mpegurl"||u==="application/vnd.apple.mpegurl",E=u==="application/dash+xml",y=Ie.getBrowser()==="safari",D=y||l||E,w=!y&&m,B=!D&&!w;return await this.detachMediaElement(i),D?(await this.shaka.init(this.ui.videoElement,this.source,this.config.debug,u,this.config.isVidgo),Promise.resolve()):w?(this.setPlayerState({player:"hls"}),await this.hls.init(this.ui.videoElement,this.source,this.config.debug),Promise.resolve()):(B&&(this.setPlayerState({player:"native"}),await this.native.init(this.ui.videoElement,this.source)),Promise.resolve())}catch(n){return console.log(n),Promise.reject(n)}};getSource=()=>this.source;getConfig=()=>this.config;updateConfig=r=>{this.config={...Mn,...this.config,...r}};getPlayerState=()=>this.playerState;setPlayerState=r=>{this.playerState={...ji,...this.playerState,...r},typeof this.onPlayerStateChange=="function"&&this.onPlayerStateChange(this.playerState)};fullScreenEvent=r=>{Ie.fullScreenEvent(r)};enterPIPEvent=r=>{Ie.enterPIP(r,this.onEnterPIPCallback)};leavePIPEvent=r=>{Ie.leavePIP(r,this.onLeavePIPCallback)};getVideoElement=()=>this.ui.videoElement;toggleVideoElement=()=>{Ie.toggleTextTracks(this.ui,null),this.videoEvents.removeEvents(),this.ui.removeVideoPlayer(),this.ui.addVideoElement(),this.videoEvents.addEvents(),this.airplay.init(),this.castSender.init()};detachMediaElement=async r=>{try{return this.playerState.player==="none"||(r||(Ie.toggleShowHide(this.ui.controlsWrapper,"none"),Ie.toggleOpacity(this.ui.controlsWrapper,!1),Ie.toggleShowHide(this.ui.optionsMenuWrapper,"none"),Ie.toggleShowHide(this.ui.controlsProgressBar,"none"),this.ui.controlsTimeText.innerText="",this.ui.controlsPIP.innerHTML="",this.ui.controlsPIP.classList.add("none"),this.ui.controlsCloseCaptionButton.classList.add("none"),this.ui.optionsMenuState="none",this.ui.optionsMenuWrapper.innerHTML="",Ie.resetRetryCounter()),this.playerState.player==="shaka"&&await this.shaka.destroy(),this.playerState.player==="hls"&&await this.hls.destroy(),this.playerState.player==="native"&&await this.native.destroy(),this.setPlayerState({...ji,isCasting:this.playerState.isCasting,isPIP:this.playerState.isPIP,isAirplay:this.playerState.isAirplay}),Ie.toggleTextTracks(this.ui,null)),Promise.resolve()}catch(i){return console.log(i),Promise.reject(i)}};removePlayer=()=>{this.isInitialized&&(this.ui.videoElement.muted=!0,this.detachMediaElement(!1).then(()=>{this.videoEvents.removeEvents(),this.removeEvents(),document.pictureInPictureEnabled&&document.pictureInPictureElement&&(sessionStorage.removeItem("pip-enter"),document.exitPictureInPicture().catch(r=>console.log(r))),this.ui.removeUI(),this.isInitialized=!1}).catch(()=>{}))};removeEvents=()=>{document.removeEventListener("fullscreenchange",this.fullScreenEvent.bind(this,this.ui)),document.removeEventListener("enterpictureinpicture",this.enterPIPEvent.bind(this,this.ui)),document.removeEventListener("leavepictureinpicture",this.leavePIPEvent.bind(this,this.ui)),document.removeEventListener("keydown",Ie.keyDownEvents.bind(this,this.ui)),clearInterval(this.stateTimer)};unmount=()=>{clearTimeout(this.unMountTimer),this.setPlayerState({isUnmounting:!0}),this.playerState.isCasting&&(this.castSender.stopCasting(),this.isInitialized=!1,this.setPlayerState({...ji})),this.isInitialized&&(sessionStorage.removeItem("videoCurrentTime"),this.removePlayer(),this.ui.removeAllUI(),this.unMountTimer=setTimeout(()=>this.setPlayerState({isUnmounting:!1}),50))};reloadPlayer=async(r=!0)=>{try{return r&&await Ie.delay(2*1e3),this.playerState.player==="shaka"?(await this.shaka.reload(),Promise.resolve()):(this.retry(!0),Promise.resolve())}catch{return Promise.reject()}};retry=(r=!1)=>{if(Ie.toggleWrappers({ui:this.ui,loading:!0}),r){this.setSource(this.source,r).catch(()=>{});return}this.reloadPlayer().catch(()=>console.log())};onTogglePlayPause=()=>{Ie.togglePlayPause(this.ui).catch(()=>{})};onToggleMuteUnMute=()=>{Ie.toggleMuteUnMute(this.ui)};onToggleForwardRewind=r=>{Ie.toggleForwardRewind(this.ui,r)};onSeekTime=r=>{Ie.seekTime(this.ui,r)};onTogglePip=()=>{Ie.togglePip(this.ui)};onToggleFullScreen=()=>{Ie.toggleFullScreen(this.ui)};onEndedReplay=()=>{Ie.onEndedReplay(this.ui)};__windowOnLoad=()=>{this.removeEvents(),document.addEventListener("fullscreenchange",this.fullScreenEvent.bind(this,this.ui)),document.addEventListener("enterpictureinpicture",this.enterPIPEvent.bind(this,this.ui)),document.addEventListener("leavepictureinpicture",this.leavePIPEvent.bind(this,this.ui)),document.addEventListener("keydown",Ie.keyDownEvents.bind(this,this.ui)),this.__stateUpdater()};__stateUpdater=()=>{clearTimeout(this.stateTimer);let r=!!document.pictureInPictureEnabled,i=this.ui.videoElement===document.pictureInPictureElement;r&&(this.ui.controlsPIP.innerHTML=i?Ie.Icons({type:"pip_exit"}):Ie.Icons({type:"pip_enter"}),this.ui.controlsPIP.classList.remove("none")),this.setPlayerState({showPIP:r,isPIP:i}),this.stateTimer=setTimeout(this.__stateUpdater.bind(this),500)}},Aa=oa;yr(Aa,"_instance"),yr(Aa,"_isBrowser",()=>typeof window=="object"),yr(Aa,"getInstance",()=>{if(oa._isBrowser())return oa._instance||(oa._instance=new oa),oa._instance;throw new Error("Library only supported in browsers!")});var nr=Aa.getInstance();var jn={instance:nr,DRMEnums:Ja,init:nr.init,getVideoElement:nr.ui.getVideoElement,getPlayerState:nr.getPlayerState,setPlayerState:nr.setPlayerState,unmount:nr.unmount,removePlayer:nr.removePlayer,onTogglePlayPause:nr.onTogglePlayPause,onToggleMuteUnMute:nr.onToggleMuteUnMute,onToggleForwardRewind:nr.onToggleForwardRewind,onSeekTime:nr.onSeekTime,onTogglePip:nr.onTogglePip,onToggleFullScreen:nr.onToggleFullScreen,onEndedReplay:nr.onEndedReplay,setCastingSource:nr.castSender.sendSourceInfo,setCastingMediaInfo:nr.castSender.sendMediaInfo,stopCasting:nr.castSender.stopCasting};window.mplayer=jn;export{Ja as DRMEnums,jn as default};
